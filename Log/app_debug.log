2025-10-08 10:27:52,860 - APP.persistence.log_handler - INFO - Đã cấu hình logging xoay vòng. File log: Log\app_debug.log, Size: 5MB, Backups: 5
2025-10-08 10:27:52,861 - APP.persistence.log_handler - DEBUG - Hoàn tất thiết lập logging cho ứng dụng.
2025-10-08 10:27:52,861 - __main__ - INFO - Ứng dụng đang khởi động...
2025-10-08 10:27:53,007 - APP.ui.app_ui - DEBUG - Bắt đầu khởi tạo AppUI.
2025-10-08 10:27:53,009 - APP.utils.threading_utils - INFO - Khởi tạo ThreadPoolExecutor với tối đa 10 luồng.
2025-10-08 10:27:53,010 - APP.ui.app_ui - DEBUG - Khởi tạo các biến Tkinter.
2025-10-08 10:27:53,012 - APP.utils.general_utils - DEBUG - Bắt đầu deobfuscate text với salt.
2025-10-08 10:27:53,013 - APP.utils.general_utils - DEBUG - Tạo machine key.
2025-10-08 10:27:53,013 - APP.utils.general_utils - DEBUG - Đã tạo machine key. Độ dài: 32 bytes.
2025-10-08 10:27:53,014 - APP.utils.general_utils - DEBUG - Thực hiện XOR bytes.
2025-10-08 10:27:53,014 - APP.utils.general_utils - DEBUG - Đã deobfuscate text thành công.
2025-10-08 10:27:53,015 - APP.ui.app_ui - DEBUG - Các biến Tkinter đã được khởi tạo.
2025-10-08 10:27:53,017 - APP.services.news_service - DEBUG - Luồng nền NewsService bắt đầu, chờ 2 giây để config được tải.
2025-10-08 10:27:53,017 - APP.services.news_service - INFO - Dịch vụ nền NewsService đã được khởi động.
2025-10-08 10:27:53,020 - APP.ui.utils.timeframe_detector - DEBUG - TimeframeDetector đã được khởi tạo và biên dịch 9 mẫu regex.
2025-10-08 10:27:53,020 - APP.ui.utils.ui_builder - DEBUG - Bắt đầu build_ui.
2025-10-08 10:27:53,119 - APP.ui.components.chart_tab - DEBUG - Bắt đầu hàm __init__ của ChartTab.
2025-10-08 10:27:53,120 - APP.ui.components.chart_tab - DEBUG - Bắt đầu hàm _init_vars.
2025-10-08 10:27:53,120 - APP.ui.components.chart_tab - DEBUG - Kết thúc hàm _init_vars.
2025-10-08 10:27:53,122 - APP.ui.components.chart_tab - DEBUG - Bắt đầu hàm _build_controls.
2025-10-08 10:27:53,127 - APP.services.mt5_service - DEBUG - Bắt đầu get_all_symbols.
2025-10-08 10:27:53,128 - APP.services.mt5_service - DEBUG - Bắt đầu ensure_initialized. Path: None
2025-10-08 10:27:53,128 - APP.services.mt5_service - DEBUG - Bắt đầu connect MT5. Path: None
2025-10-08 10:27:53,147 - APP.services.mt5_service - INFO - Kết nối MT5 thành công.
2025-10-08 10:27:53,149 - APP.services.mt5_service - DEBUG - Kết thúc connect MT5.
2025-10-08 10:27:53,150 - APP.services.mt5_service - DEBUG - Kết thúc ensure_initialized. Kết quả: True
2025-10-08 10:27:53,159 - APP.services.mt5_service - DEBUG - Đã lấy được 357 symbols.
2025-10-08 10:27:53,166 - APP.ui.components.chart_tab - DEBUG - Kết thúc hàm _build_controls.
2025-10-08 10:27:53,181 - matplotlib.font_manager - DEBUG - findfont: Matching sans\-serif:style=normal:variant=normal:weight=normal:stretch=normal:size=10.0.
2025-10-08 10:27:53,189 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSerif-Bold.ttf', name='DejaVu Serif', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,192 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXNonUniBolIta.ttf', name='STIXNonUnicode', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:53,194 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXNonUniBol.ttf', name='STIXNonUnicode', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,196 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\cmb10.ttf', name='cmb10', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,197 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSansMono-Bold.ttf', name='DejaVu Sans Mono', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,204 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXGeneral.ttf', name='STIXGeneral', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,209 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXSizFourSymBol.ttf', name='STIXSizeFourSym', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,212 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSans.ttf', name='DejaVu Sans', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 0.05
2025-10-08 10:27:53,214 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSansMono.ttf', name='DejaVu Sans Mono', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,215 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXSizFiveSymReg.ttf', name='STIXSizeFiveSym', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,218 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\cmsy10.ttf', name='cmsy10', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,219 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXSizThreeSymReg.ttf', name='STIXSizeThreeSym', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,220 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSans-Oblique.ttf', name='DejaVu Sans', style='oblique', variant='normal', weight=400, stretch='normal', size='scalable')) = 1.05
2025-10-08 10:27:53,224 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXSizThreeSymBol.ttf', name='STIXSizeThreeSym', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,225 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\cmmi10.ttf', name='cmmi10', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,225 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXSizOneSymBol.ttf', name='STIXSizeOneSym', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,226 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\cmss10.ttf', name='cmss10', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,227 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSans-BoldOblique.ttf', name='DejaVu Sans', style='oblique', variant='normal', weight=700, stretch='normal', size='scalable')) = 1.335
2025-10-08 10:27:53,228 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXSizTwoSymBol.ttf', name='STIXSizeTwoSym', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,228 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSans-Bold.ttf', name='DejaVu Sans', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 0.33499999999999996
2025-10-08 10:27:53,229 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXGeneralItalic.ttf', name='STIXGeneral', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:53,231 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSerif-Italic.ttf', name='DejaVu Serif', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:53,232 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXGeneralBol.ttf', name='STIXGeneral', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,232 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\cmtt10.ttf', name='cmtt10', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,233 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSansMono-BoldOblique.ttf', name='DejaVu Sans Mono', style='oblique', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:53,233 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSansDisplay.ttf', name='DejaVu Sans Display', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,234 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\cmr10.ttf', name='cmr10', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,236 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSerif-BoldItalic.ttf', name='DejaVu Serif', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:53,254 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSerifDisplay.ttf', name='DejaVu Serif Display', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,267 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\cmex10.ttf', name='cmex10', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,268 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXGeneralBolIta.ttf', name='STIXGeneral', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:53,268 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXNonUniIta.ttf', name='STIXNonUnicode', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:53,269 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXNonUni.ttf', name='STIXNonUnicode', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,270 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXSizFourSymReg.ttf', name='STIXSizeFourSym', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,271 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXSizTwoSymReg.ttf', name='STIXSizeTwoSym', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,291 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSansMono-Oblique.ttf', name='DejaVu Sans Mono', style='oblique', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:53,300 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXSizOneSymReg.ttf', name='STIXSizeOneSym', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,301 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSerif.ttf', name='DejaVu Serif', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,301 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\msyi.ttf', name='Microsoft Yi Baiti', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,302 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\tahoma.ttf', name='Tahoma', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,303 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\mmrtextb.ttf', name='Myanmar Text', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,303 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\YuGothL.ttc', name='Yu Gothic', style='normal', variant='normal', weight=300, stretch='normal', size='scalable')) = 10.145
2025-10-08 10:27:53,304 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\mvboli.ttf', name='MV Boli', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,305 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\LeelawUI.ttf', name='Leelawadee UI', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,306 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\palai.ttf', name='Palatino Linotype', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:53,330 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\calibrili.ttf', name='Calibri', style='italic', variant='normal', weight=300, stretch='normal', size='scalable')) = 11.145
2025-10-08 10:27:53,331 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\verdana.ttf', name='Verdana', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 3.6863636363636365
2025-10-08 10:27:53,332 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\couri.ttf', name='Courier New', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:53,333 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoeui.ttf', name='Segoe UI', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,334 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\seguisym.ttf', name='Segoe UI Symbol', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,335 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\msjhbd.ttc', name='Microsoft JhengHei', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,361 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\verdanai.ttf', name='Verdana', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 4.6863636363636365
2025-10-08 10:27:53,382 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\calibriz.ttf', name='Calibri', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:53,382 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\seguisbi.ttf', name='Segoe UI', style='italic', variant='normal', weight=600, stretch='normal', size='scalable')) = 11.24
2025-10-08 10:27:53,384 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\ariali.ttf', name='Arial', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 7.413636363636363
2025-10-08 10:27:53,384 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\msjh.ttc', name='Microsoft JhengHei', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,385 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\georgiai.ttf', name='Georgia', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:53,412 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\Candaral.ttf', name='Candara', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,412 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\phagspa.ttf', name='Microsoft PhagsPa', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,413 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\bahnschrift.ttf', name='Bahnschrift', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,414 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoeuiz.ttf', name='Segoe UI', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:53,415 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\impact.ttf', name='Impact', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,415 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\Candarai.ttf', name='Candara', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:53,416 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\corbelli.ttf', name='Corbel', style='italic', variant='normal', weight=300, stretch='normal', size='scalable')) = 11.145
2025-10-08 10:27:53,508 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\malgunsl.ttf', name='Malgun Gothic', style='normal', variant='normal', weight=300, stretch='normal', size='scalable')) = 10.145
2025-10-08 10:27:53,608 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\l_10646.ttf', name='Lucida Sans Unicode', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,649 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\comicbd.ttf', name='Comic Sans MS', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,710 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\palabi.ttf', name='Palatino Linotype', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:53,800 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoeuib.ttf', name='Segoe UI', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,803 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\seguisli.ttf', name='Segoe UI', style='italic', variant='normal', weight=350, stretch='normal', size='scalable')) = 11.0975
2025-10-08 10:27:53,804 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\cour.ttf', name='Courier New', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,804 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\gadugib.ttf', name='Gadugi', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,832 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\malgun.ttf', name='Malgun Gothic', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,834 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoesc.ttf', name='Segoe Script', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,835 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\msyhbd.ttc', name='Microsoft YaHei', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,836 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\SitkaVF-Italic.ttf', name='Sitka', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:53,836 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\Nirmala.ttc', name='Nirmala UI', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,837 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\lucon.ttf', name='Lucida Console', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,838 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoeprb.ttf', name='Segoe Print', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,838 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\micross.ttf', name='Microsoft Sans Serif', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,839 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\cambria.ttc', name='Cambria', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,839 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\webdings.ttf', name='Webdings', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,840 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\ebrima.ttf', name='Ebrima', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,841 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\corbell.ttf', name='Corbel', style='normal', variant='normal', weight=300, stretch='normal', size='scalable')) = 10.145
2025-10-08 10:27:53,841 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\times.ttf', name='Times New Roman', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,841 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\arialbi.ttf', name='Arial', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 7.698636363636363
2025-10-08 10:27:53,844 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\seguisb.ttf', name='Segoe UI', style='normal', variant='normal', weight=600, stretch='normal', size='scalable')) = 10.24
2025-10-08 10:27:53,844 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\taileb.ttf', name='Microsoft Tai Le', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,845 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\himalaya.ttf', name='Microsoft Himalaya', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,846 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\SimsunExtG.ttf', name='SimSun-ExtG', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,846 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\calibril.ttf', name='Calibri', style='normal', variant='normal', weight=300, stretch='normal', size='scalable')) = 10.145
2025-10-08 10:27:53,847 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\SegoeIcons.ttf', name='Segoe Fluent Icons', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,848 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\mingliu.ttc', name='MingLiU', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,849 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\verdanab.ttf', name='Verdana', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 3.9713636363636367
2025-10-08 10:27:53,849 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\YuGothB.ttc', name='Yu Gothic', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,850 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\framdit.ttf', name='Franklin Gothic Medium', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:53,851 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoescb.ttf', name='Segoe Script', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,852 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\gulim.ttc', name='Gulim', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,874 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\constanb.ttf', name='Constantia', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,888 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\gadugi.ttf', name='Gadugi', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,950 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\consolab.ttf', name='Consolas', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,951 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\trebucit.ttf', name='Trebuchet MS', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:53,952 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\pala.ttf', name='Palatino Linotype', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,952 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\timesbd.ttf', name='Times New Roman', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,953 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\georgia.ttf', name='Georgia', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,954 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\timesbi.ttf', name='Times New Roman', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:53,954 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\mmrtext.ttf', name='Myanmar Text', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,955 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\LeelUIsl.ttf', name='Leelawadee UI', style='normal', variant='normal', weight=350, stretch='normal', size='scalable')) = 10.0975
2025-10-08 10:27:53,955 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\constan.ttf', name='Constantia', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,956 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\constanz.ttf', name='Constantia', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:53,956 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\consola.ttf', name='Consolas', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,957 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\comici.ttf', name='Comic Sans MS', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:53,957 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\monbaiti.ttf', name='Mongolian Baiti', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,958 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\Candara.ttf', name='Candara', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,958 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\calibrii.ttf', name='Calibri', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:53,958 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\tahomabd.ttf', name='Tahoma', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,959 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\simsun.ttc', name='SimSun', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,959 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\msgothic.ttc', name='MS Gothic', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,960 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\constani.ttf', name='Constantia', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:53,960 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\corbeli.ttf', name='Corbel', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:53,961 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\Candarali.ttf', name='Candara', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:53,961 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\wingdng3.ttf', name='Wingdings 3', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,962 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\courbi.ttf', name='Courier New', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:53,962 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\seguibli.ttf', name='Segoe UI', style='italic', variant='normal', weight=900, stretch='normal', size='scalable')) = 11.525
2025-10-08 10:27:53,963 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\ariblk.ttf', name='Arial', style='normal', variant='normal', weight=900, stretch='normal', size='scalable')) = 6.888636363636364
2025-10-08 10:27:53,963 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\courbd.ttf', name='Courier New', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,964 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\Candarab.ttf', name='Candara', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,964 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\phagspab.ttf', name='Microsoft PhagsPa', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,965 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\Candaraz.ttf', name='Candara', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:53,965 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segmdl2.ttf', name='Segoe MDL2 Assets', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,966 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\consolaz.ttf', name='Consolas', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:53,966 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoeuii.ttf', name='Segoe UI', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:53,967 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\javatext.ttf', name='Javanese Text', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,967 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\timesi.ttf', name='Times New Roman', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:53,968 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\cambriab.ttf', name='Cambria', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,968 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\ebrimabd.ttf', name='Ebrima', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,968 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\verdanaz.ttf', name='Verdana', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 4.971363636363637
2025-10-08 10:27:53,969 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\ntailu.ttf', name='Microsoft New Tai Lue', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,969 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\cambriai.ttf', name='Cambria', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:53,970 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\seguiemj.ttf', name='Segoe UI Emoji', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,970 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\YuGothR.ttc', name='Yu Gothic', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,971 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\calibrib.ttf', name='Calibri', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,971 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\Gabriola.ttf', name='Gabriola', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,971 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\seguibl.ttf', name='Segoe UI', style='normal', variant='normal', weight=900, stretch='normal', size='scalable')) = 10.525
2025-10-08 10:27:53,972 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\arial.ttf', name='Arial', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 6.413636363636363
2025-10-08 10:27:53,973 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\trebuc.ttf', name='Trebuchet MS', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,973 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\YuGothM.ttc', name='Yu Gothic', style='normal', variant='normal', weight=500, stretch='normal', size='scalable')) = 10.145
2025-10-08 10:27:53,974 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\sylfaen.ttf', name='Sylfaen', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,974 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoepr.ttf', name='Segoe Print', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,975 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\msyh.ttc', name='Microsoft YaHei', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,977 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\SegUIVar.ttf', name='Segoe UI Variable', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,977 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\calibri.ttf', name='Calibri', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,978 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\trebucbd.ttf', name='Trebuchet MS', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,978 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\wingding.ttf', name='Wingdings', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,979 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\comicz.ttf', name='Comic Sans MS', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:53,980 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\cambriaz.ttf', name='Cambria', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:53,981 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\georgiab.ttf', name='Georgia', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:53,981 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\corbelz.ttf', name='Corbel', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:53,983 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\mingliub.ttc', name='MingLiU-ExtB', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:53,984 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\framd.ttf', name='Franklin Gothic Medium', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:54,008 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoeuil.ttf', name='Segoe UI', style='normal', variant='normal', weight=300, stretch='normal', size='scalable')) = 10.145
2025-10-08 10:27:54,009 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\comic.ttf', name='Comic Sans MS', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:54,010 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\Inkfree.ttf', name='Ink Free', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:54,011 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\seguili.ttf', name='Segoe UI', style='italic', variant='normal', weight=300, stretch='normal', size='scalable')) = 11.145
2025-10-08 10:27:54,011 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\symbol.ttf', name='Symbol', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:54,013 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\msyhl.ttc', name='Microsoft YaHei', style='normal', variant='normal', weight=290, stretch='normal', size='scalable')) = 10.1545
2025-10-08 10:27:54,013 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\msjhl.ttc', name='Microsoft JhengHei', style='normal', variant='normal', weight=290, stretch='normal', size='scalable')) = 10.1545
2025-10-08 10:27:54,014 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\seguihis.ttf', name='Segoe UI Historic', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:54,014 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\ntailub.ttf', name='Microsoft New Tai Lue', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:54,015 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\arialbd.ttf', name='Arial', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 6.698636363636363
2025-10-08 10:27:54,015 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\SansSerifCollection.ttf', name='Sans Serif Collection', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:54,038 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\consolai.ttf', name='Consolas', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:54,039 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\wingdng2.ttf', name='Wingdings 2', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:54,040 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\LeelaUIb.ttf', name='Leelawadee UI', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:54,041 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\simsunb.ttf', name='SimSun-ExtB', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:54,042 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\malgunbd.ttf', name='Malgun Gothic', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:54,044 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\corbelb.ttf', name='Corbel', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:54,044 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\taile.ttf', name='Microsoft Tai Le', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:54,045 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\trebucbi.ttf', name='Trebuchet MS', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:54,046 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\georgiaz.ttf', name='Georgia', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:54,068 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\palab.ttf', name='Palatino Linotype', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:54,071 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoeuisl.ttf', name='Segoe UI', style='normal', variant='normal', weight=350, stretch='normal', size='scalable')) = 10.0975
2025-10-08 10:27:54,071 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\SitkaVF.ttf', name='Sitka', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:54,072 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\corbel.ttf', name='Corbel', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:54,073 - matplotlib.font_manager - DEBUG - findfont: Matching sans\-serif:style=normal:variant=normal:weight=normal:stretch=normal:size=10.0 to DejaVu Sans ('C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSans.ttf') with score of 0.050000.
2025-10-08 10:27:54,139 - APP.ui.components.chart_tab - DEBUG - Đã khởi tạo Figure và FigureCanvasTkAgg.
2025-10-08 10:27:54,155 - PIL.PngImagePlugin - DEBUG - STREAM b'IHDR' 16 13
2025-10-08 10:27:54,156 - PIL.PngImagePlugin - DEBUG - STREAM b'sBIT' 41 4
2025-10-08 10:27:54,156 - PIL.PngImagePlugin - DEBUG - b'sBIT' 41 4 (unknown)
2025-10-08 10:27:54,156 - PIL.PngImagePlugin - DEBUG - STREAM b'pHYs' 57 9
2025-10-08 10:27:54,157 - PIL.PngImagePlugin - DEBUG - STREAM b'IDAT' 78 374
2025-10-08 10:27:54,174 - PIL.PngImagePlugin - DEBUG - STREAM b'IHDR' 16 13
2025-10-08 10:27:54,181 - PIL.PngImagePlugin - DEBUG - STREAM b'sBIT' 41 4
2025-10-08 10:27:54,188 - PIL.PngImagePlugin - DEBUG - b'sBIT' 41 4 (unknown)
2025-10-08 10:27:54,190 - PIL.PngImagePlugin - DEBUG - STREAM b'pHYs' 57 9
2025-10-08 10:27:54,190 - PIL.PngImagePlugin - DEBUG - STREAM b'IDAT' 78 286
2025-10-08 10:27:54,195 - PIL.PngImagePlugin - DEBUG - STREAM b'IHDR' 16 13
2025-10-08 10:27:54,195 - PIL.PngImagePlugin - DEBUG - STREAM b'sBIT' 41 4
2025-10-08 10:27:54,196 - PIL.PngImagePlugin - DEBUG - b'sBIT' 41 4 (unknown)
2025-10-08 10:27:54,196 - PIL.PngImagePlugin - DEBUG - STREAM b'pHYs' 57 9
2025-10-08 10:27:54,197 - PIL.PngImagePlugin - DEBUG - STREAM b'IDAT' 78 263
2025-10-08 10:27:54,201 - PIL.PngImagePlugin - DEBUG - STREAM b'IHDR' 16 13
2025-10-08 10:27:54,202 - PIL.PngImagePlugin - DEBUG - STREAM b'sBIT' 41 4
2025-10-08 10:27:54,218 - PIL.PngImagePlugin - DEBUG - b'sBIT' 41 4 (unknown)
2025-10-08 10:27:54,220 - PIL.PngImagePlugin - DEBUG - STREAM b'pHYs' 57 9
2025-10-08 10:27:54,220 - PIL.PngImagePlugin - DEBUG - STREAM b'IDAT' 78 387
2025-10-08 10:27:54,224 - PIL.PngImagePlugin - DEBUG - STREAM b'IHDR' 16 13
2025-10-08 10:27:54,224 - PIL.PngImagePlugin - DEBUG - STREAM b'sBIT' 41 4
2025-10-08 10:27:54,225 - PIL.PngImagePlugin - DEBUG - b'sBIT' 41 4 (unknown)
2025-10-08 10:27:54,226 - PIL.PngImagePlugin - DEBUG - STREAM b'pHYs' 57 9
2025-10-08 10:27:54,226 - PIL.PngImagePlugin - DEBUG - STREAM b'IDAT' 78 436
2025-10-08 10:27:54,229 - PIL.PngImagePlugin - DEBUG - STREAM b'IHDR' 16 13
2025-10-08 10:27:54,229 - PIL.PngImagePlugin - DEBUG - STREAM b'sBIT' 41 4
2025-10-08 10:27:54,231 - PIL.PngImagePlugin - DEBUG - b'sBIT' 41 4 (unknown)
2025-10-08 10:27:54,233 - PIL.PngImagePlugin - DEBUG - STREAM b'pHYs' 57 9
2025-10-08 10:27:54,233 - PIL.PngImagePlugin - DEBUG - STREAM b'IDAT' 78 351
2025-10-08 10:27:54,255 - PIL.PngImagePlugin - DEBUG - STREAM b'IHDR' 16 13
2025-10-08 10:27:54,255 - PIL.PngImagePlugin - DEBUG - STREAM b'sBIT' 41 4
2025-10-08 10:27:54,256 - PIL.PngImagePlugin - DEBUG - b'sBIT' 41 4 (unknown)
2025-10-08 10:27:54,256 - PIL.PngImagePlugin - DEBUG - STREAM b'pHYs' 57 9
2025-10-08 10:27:54,257 - PIL.PngImagePlugin - DEBUG - STREAM b'IDAT' 78 364
2025-10-08 10:27:54,262 - APP.ui.components.chart_tab - DEBUG - Đã khởi tạo NavigationToolbar2Tk.
2025-10-08 10:27:54,334 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:27:54,335 - APP.ui.components.chart_tab - DEBUG - Kết thúc hàm __init__ của ChartTab.
2025-10-08 10:27:54,593 - APP.ui.utils.ui_builder - DEBUG - Kết thúc build_ui.
2025-10-08 10:27:54,594 - APP.ui.components.history_manager - DEBUG - Bắt đầu liên kết các widget UI cho HistoryManager.
2025-10-08 10:27:54,594 - APP.ui.components.history_manager - DEBUG - Đã tạo md_manager cho history_list.
2025-10-08 10:27:54,595 - APP.ui.components.history_manager - DEBUG - Đã tạo json_manager cho json_list.
2025-10-08 10:27:54,595 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_update_model_list_worker' vào thread pool.
2025-10-08 10:27:54,596 - APP.ui.app_ui - DEBUG - Bắt đầu worker cập nhật danh sách mô hình AI.
2025-10-08 10:27:54,596 - APP.ui.app_ui - DEBUG - Bắt đầu áp dụng cấu hình lên UI.
2025-10-08 10:27:54,598 - APP.ui.app_ui - DEBUG - Bắt đầu quá trình tải file từ thư mục: C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots.
2025-10-08 10:27:54,611 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_scan_folder_worker' vào thread pool.
2025-10-08 10:27:54,613 - APP.ui.app_ui - DEBUG - Luồng quét thư mục bắt đầu cho: C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots.
2025-10-08 10:27:54,613 - APP.ui.app_ui - DEBUG - Symbol đã thay đổi thành: XAUUSD, đang đồng bộ hóa các thành phần.
2025-10-08 10:27:54,614 - APP.ui.components.history_manager - INFO - Bắt đầu làm mới tất cả danh sách lịch sử.
2025-10-08 10:27:54,615 - APP.ui.components.history_manager.FileListView - DEBUG - Yêu cầu làm mới danh sách cho 'report_*.md'
2025-10-08 10:27:54,637 - APP.ui.app_ui - INFO - Luồng quét đã hoàn tất, tìm thấy 4 file.
2025-10-08 10:27:54,643 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_refresh_worker' vào thread pool.
2025-10-08 10:27:54,644 - APP.ui.components.history_manager.FileListView - DEBUG - Yêu cầu làm mới danh sách cho 'ctx_*.json'
2025-10-08 10:27:54,644 - APP.ui.components.history_manager.FileListView - DEBUG - Worker bắt đầu quét tệp cho 'report_*.md'
2025-10-08 10:27:54,645 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_refresh_worker' vào thread pool.
2025-10-08 10:27:54,646 - APP.ui.components.history_manager.FileListView - DEBUG - Worker bắt đầu quét tệp cho 'ctx_*.json'
2025-10-08 10:27:54,646 - APP.ui.app_ui - DEBUG - Thông báo cho ChartTab để vẽ lại biểu đồ.
2025-10-08 10:27:54,647 - APP.ui.components.chart_tab - DEBUG - Đặt lại trạng thái và vẽ lại biểu đồ do hành động của người dùng.
2025-10-08 10:27:54,647 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:27:54,656 - APP.ui.app_ui - INFO - Chuyển đổi Autorun sang: Bật
2025-10-08 10:27:54,657 - APP.ui.app_ui - DEBUG - Lên lịch chạy tự động tiếp theo sau 60000ms.
2025-10-08 10:27:54,658 - APP.ui.components.prompt_manager - DEBUG - Yêu cầu tải prompts từ đĩa. Silent: True
2025-10-08 10:27:54,658 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_load_prompts_worker' vào thread pool.
2025-10-08 10:27:54,661 - APP.ui.components.prompt_manager - DEBUG - Worker bắt đầu đọc các file prompt.
2025-10-08 10:27:54,661 - APP.ui.components.history_manager - INFO - Bắt đầu làm mới tất cả danh sách lịch sử.
2025-10-08 10:27:54,663 - APP.ui.components.prompt_manager - DEBUG - Bắt đầu chuẩn hóa prompt. Độ dài raw: 4058
2025-10-08 10:27:54,663 - APP.ui.components.history_manager.FileListView - DEBUG - Yêu cầu làm mới danh sách cho 'report_*.md'
2025-10-08 10:27:54,664 - APP.ui.components.prompt_manager - DEBUG - Không thể phân tích raw text thành JSON.
2025-10-08 10:27:54,665 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_refresh_worker' vào thread pool.
2025-10-08 10:27:54,665 - APP.ui.components.prompt_manager - DEBUG - Không thể phân tích raw text thành Python literal.
2025-10-08 10:27:54,666 - APP.ui.components.prompt_manager - DEBUG - Không thể chuẩn hóa, trả về văn bản thô.
2025-10-08 10:27:54,671 - APP.ui.components.history_manager.FileListView - DEBUG - Worker bắt đầu quét tệp cho 'report_*.md'
2025-10-08 10:27:54,671 - APP.ui.components.history_manager.FileListView - DEBUG - Yêu cầu làm mới danh sách cho 'ctx_*.json'
2025-10-08 10:27:54,679 - APP.ui.components.prompt_manager - DEBUG - Bắt đầu chuẩn hóa prompt. Độ dài raw: 4058
2025-10-08 10:27:54,696 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_refresh_worker' vào thread pool.
2025-10-08 10:27:54,696 - APP.ui.components.prompt_manager - DEBUG - Không thể phân tích raw text thành JSON.
2025-10-08 10:27:54,697 - APP.ui.components.prompt_manager - DEBUG - Không thể phân tích raw text thành Python literal.
2025-10-08 10:27:54,698 - APP.ui.components.history_manager.FileListView - DEBUG - Worker bắt đầu quét tệp cho 'ctx_*.json'
2025-10-08 10:27:54,699 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:27:54,698 - APP.ui.components.prompt_manager - DEBUG - Không thể chuẩn hóa, trả về văn bản thô.
2025-10-08 10:27:54,725 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:27:54,726 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:27:54,726 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:27:54,727 - APP.services.te_service - INFO - Đăng nhập thành công vào Trading Economics API.
2025-10-08 10:27:54,727 - APP.services.news_service - DEBUG - Cấu hình NewsService đã được cập nhật.
2025-10-08 10:27:54,727 - APP.ui.app_ui - INFO - Đã áp dụng cấu hình lên UI thành công.
2025-10-08 10:27:54,728 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:27:54,732 - APP.ui.components.chart_tab - DEBUG - Đã populate 357 symbols.
2025-10-08 10:27:54,735 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:27:54,764 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_tree
2025-10-08 10:27:54,765 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_tree
2025-10-08 10:27:54,766 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_tree
2025-10-08 10:27:54,767 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_tree
2025-10-08 10:27:54,767 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:27:54,768 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: refresh_all_lists
2025-10-08 10:27:54,769 - APP.ui.components.history_manager - INFO - Bắt đầu làm mới tất cả danh sách lịch sử.
2025-10-08 10:27:54,769 - APP.ui.components.history_manager.FileListView - DEBUG - Yêu cầu làm mới danh sách cho 'report_*.md'
2025-10-08 10:27:54,770 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_refresh_worker' vào thread pool.
2025-10-08 10:27:54,771 - APP.ui.components.history_manager.FileListView - DEBUG - Yêu cầu làm mới danh sách cho 'ctx_*.json'
2025-10-08 10:27:54,771 - APP.ui.components.history_manager.FileListView - DEBUG - Worker bắt đầu quét tệp cho 'report_*.md'
2025-10-08 10:27:54,771 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_refresh_worker' vào thread pool.
2025-10-08 10:27:54,773 - APP.ui.components.history_manager.FileListView - DEBUG - Worker bắt đầu quét tệp cho 'ctx_*.json'
2025-10-08 10:27:54,773 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:27:54,773 - APP.ui.components.prompt_manager - DEBUG - Cập nhật UI với nội dung prompt đã tải.
2025-10-08 10:27:54,777 - APP.ui.components.prompt_manager - DEBUG - Kết thúc cập nhật UI cho prompts.
2025-10-08 10:27:54,778 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:27:54,781 - APP.ui.components.prompt_manager - DEBUG - Yêu cầu tải prompts từ đĩa. Silent: False
2025-10-08 10:27:54,783 - APP.services.gemini_service - INFO - Đã tìm thấy 41 model khả dụng.
2025-10-08 10:27:54,784 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_load_prompts_worker' vào thread pool.
2025-10-08 10:27:54,785 - APP.ui.components.prompt_manager - DEBUG - Worker bắt đầu đọc các file prompt.
2025-10-08 10:27:54,785 - APP.ui.app_ui - DEBUG - AppUI đã khởi tạo xong.
2025-10-08 10:27:54,786 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:27:54,786 - APP.ui.components.prompt_manager - DEBUG - Bắt đầu chuẩn hóa prompt. Độ dài raw: 4058
2025-10-08 10:27:54,787 - APP.ui.components.prompt_manager - DEBUG - Không thể phân tích raw text thành JSON.
2025-10-08 10:27:54,788 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:27:54,789 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:27:54,789 - APP.ui.components.prompt_manager - DEBUG - Không thể phân tích raw text thành Python literal.
2025-10-08 10:27:54,791 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:27:54,792 - APP.ui.components.prompt_manager - DEBUG - Không thể chuẩn hóa, trả về văn bản thô.
2025-10-08 10:27:54,794 - APP.ui.components.chart_tab - INFO - ChartTab đã bắt đầu làm mới dữ liệu.
2025-10-08 10:27:54,819 - APP.ui.components.prompt_manager - DEBUG - Bắt đầu chuẩn hóa prompt. Độ dài raw: 4058
2025-10-08 10:27:54,821 - APP.ui.components.prompt_manager - DEBUG - Không thể phân tích raw text thành JSON.
2025-10-08 10:27:54,823 - APP.ui.components.prompt_manager - DEBUG - Không thể phân tích raw text thành Python literal.
2025-10-08 10:27:54,849 - APP.ui.components.prompt_manager - DEBUG - Không thể chuẩn hóa, trả về văn bản thô.
2025-10-08 10:27:55,039 - APP.services.news_service - INFO - Luồng nền: Bắt đầu làm mới cache tin tức...
2025-10-08 10:27:55,051 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:27:55,051 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:27:55,058 - APP.ui.components.history_manager.FileListView - INFO - Tìm thấy 10 Báo cáo.
2025-10-08 10:27:55,061 - APP.ui.components.history_manager.FileListView - INFO - Tìm thấy 10 JSON.
2025-10-08 10:27:55,063 - APP.ui.components.history_manager.FileListView - INFO - Tìm thấy 10 Báo cáo.
2025-10-08 10:27:55,071 - APP.ui.components.history_manager.FileListView - INFO - Tìm thấy 10 Báo cáo.
2025-10-08 10:27:55,065 - APP.ui.components.history_manager.FileListView - INFO - Tìm thấy 10 JSON.
2025-10-08 10:27:55,066 - APP.ui.components.history_manager.FileListView - INFO - Tìm thấy 10 JSON.
2025-10-08 10:27:55,073 - APP.services.news_service - DEBUG - Đã xóa cache ID chống trùng lặp của tin tức.
2025-10-08 10:27:55,092 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui_success
2025-10-08 10:27:55,113 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:27:55,117 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-08 10:27:55,120 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:27:55,121 - APP.services.te_service - DEBUG - Đang thực hiện cuộc gọi API đến Trading Economics...
2025-10-08 10:27:55,121 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:27:55,124 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:27:55,124 - APP.services.te_service - WARNING - Bỏ qua xác minh SSL cho Trading Economics API.
2025-10-08 10:27:55,125 - APP.ui.components.prompt_manager - DEBUG - Cập nhật UI với nội dung prompt đã tải.
2025-10-08 10:27:55,130 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-08 10:27:55,132 - APP.ui.components.prompt_manager - DEBUG - Kết thúc cập nhật UI cho prompts.
2025-10-08 10:27:55,132 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:27:55,133 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:27:55,135 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:27:55,137 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:27:55,138 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:27:55,171 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:27:55,177 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:27:55,178 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:27:55,184 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:27:55,185 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:27:55,188 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:27:55,193 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:27:55,193 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:27:55,194 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:27:55,277 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:27:55,324 - APP.services.te_service - ERROR - Lỗi khi gọi TE API: HTTP Error 403: Forbidden
2025-10-08 10:27:55,330 - APP.services.te_service - DEBUG - Đã khôi phục context SSL mặc định.
2025-10-08 10:27:55,562 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:27:55,796 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:27:56,046 - matplotlib.font_manager - DEBUG - findfont: Matching sans\-serif:style=normal:variant=normal:weight=normal:stretch=normal:size=12.0.
2025-10-08 10:27:56,047 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSerif-Bold.ttf', name='DejaVu Serif', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,048 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXNonUniBolIta.ttf', name='STIXNonUnicode', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,048 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXNonUniBol.ttf', name='STIXNonUnicode', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,049 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\cmb10.ttf', name='cmb10', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,049 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSansMono-Bold.ttf', name='DejaVu Sans Mono', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,050 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXGeneral.ttf', name='STIXGeneral', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,050 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXSizFourSymBol.ttf', name='STIXSizeFourSym', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,051 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSans.ttf', name='DejaVu Sans', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 0.05
2025-10-08 10:27:56,051 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSansMono.ttf', name='DejaVu Sans Mono', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,051 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXSizFiveSymReg.ttf', name='STIXSizeFiveSym', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,052 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\cmsy10.ttf', name='cmsy10', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,053 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXSizThreeSymReg.ttf', name='STIXSizeThreeSym', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,053 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSans-Oblique.ttf', name='DejaVu Sans', style='oblique', variant='normal', weight=400, stretch='normal', size='scalable')) = 1.05
2025-10-08 10:27:56,054 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXSizThreeSymBol.ttf', name='STIXSizeThreeSym', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,054 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\cmmi10.ttf', name='cmmi10', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,055 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXSizOneSymBol.ttf', name='STIXSizeOneSym', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,056 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\cmss10.ttf', name='cmss10', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,056 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSans-BoldOblique.ttf', name='DejaVu Sans', style='oblique', variant='normal', weight=700, stretch='normal', size='scalable')) = 1.335
2025-10-08 10:27:56,057 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXSizTwoSymBol.ttf', name='STIXSizeTwoSym', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,058 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSans-Bold.ttf', name='DejaVu Sans', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 0.33499999999999996
2025-10-08 10:27:56,060 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXGeneralItalic.ttf', name='STIXGeneral', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,061 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSerif-Italic.ttf', name='DejaVu Serif', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,062 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXGeneralBol.ttf', name='STIXGeneral', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,062 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\cmtt10.ttf', name='cmtt10', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,063 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSansMono-BoldOblique.ttf', name='DejaVu Sans Mono', style='oblique', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,063 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSansDisplay.ttf', name='DejaVu Sans Display', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,064 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\cmr10.ttf', name='cmr10', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,064 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSerif-BoldItalic.ttf', name='DejaVu Serif', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,065 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSerifDisplay.ttf', name='DejaVu Serif Display', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,065 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\cmex10.ttf', name='cmex10', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,066 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXGeneralBolIta.ttf', name='STIXGeneral', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,066 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXNonUniIta.ttf', name='STIXNonUnicode', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,066 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXNonUni.ttf', name='STIXNonUnicode', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,067 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXSizFourSymReg.ttf', name='STIXSizeFourSym', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,067 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXSizTwoSymReg.ttf', name='STIXSizeTwoSym', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,068 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSansMono-Oblique.ttf', name='DejaVu Sans Mono', style='oblique', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,068 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXSizOneSymReg.ttf', name='STIXSizeOneSym', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,069 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSerif.ttf', name='DejaVu Serif', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,070 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\msyi.ttf', name='Microsoft Yi Baiti', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,070 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\tahoma.ttf', name='Tahoma', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,071 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\mmrtextb.ttf', name='Myanmar Text', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,071 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\YuGothL.ttc', name='Yu Gothic', style='normal', variant='normal', weight=300, stretch='normal', size='scalable')) = 10.145
2025-10-08 10:27:56,074 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\mvboli.ttf', name='MV Boli', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,074 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\LeelawUI.ttf', name='Leelawadee UI', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,075 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\palai.ttf', name='Palatino Linotype', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,076 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\calibrili.ttf', name='Calibri', style='italic', variant='normal', weight=300, stretch='normal', size='scalable')) = 11.145
2025-10-08 10:27:56,077 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\verdana.ttf', name='Verdana', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 3.6863636363636365
2025-10-08 10:27:56,077 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\couri.ttf', name='Courier New', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,098 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-08 10:27:56,103 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoeui.ttf', name='Segoe UI', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,103 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\seguisym.ttf', name='Segoe UI Symbol', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,111 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\msjhbd.ttc', name='Microsoft JhengHei', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,143 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\verdanai.ttf', name='Verdana', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 4.6863636363636365
2025-10-08 10:27:56,144 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\calibriz.ttf', name='Calibri', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,144 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\seguisbi.ttf', name='Segoe UI', style='italic', variant='normal', weight=600, stretch='normal', size='scalable')) = 11.24
2025-10-08 10:27:56,145 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\ariali.ttf', name='Arial', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 7.413636363636363
2025-10-08 10:27:56,146 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\msjh.ttc', name='Microsoft JhengHei', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,147 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\georgiai.ttf', name='Georgia', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,147 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\Candaral.ttf', name='Candara', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,148 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\phagspa.ttf', name='Microsoft PhagsPa', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,148 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\bahnschrift.ttf', name='Bahnschrift', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,149 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoeuiz.ttf', name='Segoe UI', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,150 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\impact.ttf', name='Impact', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,152 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\Candarai.ttf', name='Candara', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,153 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\corbelli.ttf', name='Corbel', style='italic', variant='normal', weight=300, stretch='normal', size='scalable')) = 11.145
2025-10-08 10:27:56,153 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\malgunsl.ttf', name='Malgun Gothic', style='normal', variant='normal', weight=300, stretch='normal', size='scalable')) = 10.145
2025-10-08 10:27:56,154 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\l_10646.ttf', name='Lucida Sans Unicode', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,154 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\comicbd.ttf', name='Comic Sans MS', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,155 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\palabi.ttf', name='Palatino Linotype', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,156 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoeuib.ttf', name='Segoe UI', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,156 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\seguisli.ttf', name='Segoe UI', style='italic', variant='normal', weight=350, stretch='normal', size='scalable')) = 11.0975
2025-10-08 10:27:56,157 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\cour.ttf', name='Courier New', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,158 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\gadugib.ttf', name='Gadugi', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,158 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\malgun.ttf', name='Malgun Gothic', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,159 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoesc.ttf', name='Segoe Script', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,159 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\msyhbd.ttc', name='Microsoft YaHei', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,160 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\SitkaVF-Italic.ttf', name='Sitka', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,161 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\Nirmala.ttc', name='Nirmala UI', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,161 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\lucon.ttf', name='Lucida Console', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,162 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoeprb.ttf', name='Segoe Print', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,163 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\micross.ttf', name='Microsoft Sans Serif', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,163 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\cambria.ttc', name='Cambria', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,164 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\webdings.ttf', name='Webdings', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,164 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\ebrima.ttf', name='Ebrima', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,165 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\corbell.ttf', name='Corbel', style='normal', variant='normal', weight=300, stretch='normal', size='scalable')) = 10.145
2025-10-08 10:27:56,166 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\times.ttf', name='Times New Roman', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,171 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\arialbi.ttf', name='Arial', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 7.698636363636363
2025-10-08 10:27:56,199 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\seguisb.ttf', name='Segoe UI', style='normal', variant='normal', weight=600, stretch='normal', size='scalable')) = 10.24
2025-10-08 10:27:56,202 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\taileb.ttf', name='Microsoft Tai Le', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,202 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\himalaya.ttf', name='Microsoft Himalaya', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,203 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\SimsunExtG.ttf', name='SimSun-ExtG', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,204 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\calibril.ttf', name='Calibri', style='normal', variant='normal', weight=300, stretch='normal', size='scalable')) = 10.145
2025-10-08 10:27:56,204 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\SegoeIcons.ttf', name='Segoe Fluent Icons', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,205 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\mingliu.ttc', name='MingLiU', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,205 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\verdanab.ttf', name='Verdana', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 3.9713636363636367
2025-10-08 10:27:56,206 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\YuGothB.ttc', name='Yu Gothic', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,207 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\framdit.ttf', name='Franklin Gothic Medium', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,207 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoescb.ttf', name='Segoe Script', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,208 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\gulim.ttc', name='Gulim', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,209 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\constanb.ttf', name='Constantia', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,209 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\gadugi.ttf', name='Gadugi', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,210 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\consolab.ttf', name='Consolas', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,211 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\trebucit.ttf', name='Trebuchet MS', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,211 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\pala.ttf', name='Palatino Linotype', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,211 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\timesbd.ttf', name='Times New Roman', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,212 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\georgia.ttf', name='Georgia', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,213 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\timesbi.ttf', name='Times New Roman', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,213 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\mmrtext.ttf', name='Myanmar Text', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,214 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\LeelUIsl.ttf', name='Leelawadee UI', style='normal', variant='normal', weight=350, stretch='normal', size='scalable')) = 10.0975
2025-10-08 10:27:56,214 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\constan.ttf', name='Constantia', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,215 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\constanz.ttf', name='Constantia', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,216 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\consola.ttf', name='Consolas', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,217 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\comici.ttf', name='Comic Sans MS', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,217 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\monbaiti.ttf', name='Mongolian Baiti', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,217 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\Candara.ttf', name='Candara', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,218 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\calibrii.ttf', name='Calibri', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,218 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\tahomabd.ttf', name='Tahoma', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,219 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\simsun.ttc', name='SimSun', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,220 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\msgothic.ttc', name='MS Gothic', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,220 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\constani.ttf', name='Constantia', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,221 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\corbeli.ttf', name='Corbel', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,221 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\Candarali.ttf', name='Candara', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,222 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\wingdng3.ttf', name='Wingdings 3', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,222 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\courbi.ttf', name='Courier New', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,223 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\seguibli.ttf', name='Segoe UI', style='italic', variant='normal', weight=900, stretch='normal', size='scalable')) = 11.525
2025-10-08 10:27:56,223 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\ariblk.ttf', name='Arial', style='normal', variant='normal', weight=900, stretch='normal', size='scalable')) = 6.888636363636364
2025-10-08 10:27:56,224 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\courbd.ttf', name='Courier New', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,224 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\Candarab.ttf', name='Candara', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,225 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\phagspab.ttf', name='Microsoft PhagsPa', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,227 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\Candaraz.ttf', name='Candara', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,227 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segmdl2.ttf', name='Segoe MDL2 Assets', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,228 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\consolaz.ttf', name='Consolas', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,228 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoeuii.ttf', name='Segoe UI', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,229 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\javatext.ttf', name='Javanese Text', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,234 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\timesi.ttf', name='Times New Roman', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,268 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\cambriab.ttf', name='Cambria', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,268 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\ebrimabd.ttf', name='Ebrima', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,269 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\verdanaz.ttf', name='Verdana', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 4.971363636363637
2025-10-08 10:27:56,270 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\ntailu.ttf', name='Microsoft New Tai Lue', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,270 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\cambriai.ttf', name='Cambria', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,271 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\seguiemj.ttf', name='Segoe UI Emoji', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,271 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\YuGothR.ttc', name='Yu Gothic', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,272 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\calibrib.ttf', name='Calibri', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,273 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\Gabriola.ttf', name='Gabriola', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,274 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\seguibl.ttf', name='Segoe UI', style='normal', variant='normal', weight=900, stretch='normal', size='scalable')) = 10.525
2025-10-08 10:27:56,274 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\arial.ttf', name='Arial', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 6.413636363636363
2025-10-08 10:27:56,275 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\trebuc.ttf', name='Trebuchet MS', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,275 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\YuGothM.ttc', name='Yu Gothic', style='normal', variant='normal', weight=500, stretch='normal', size='scalable')) = 10.145
2025-10-08 10:27:56,276 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\sylfaen.ttf', name='Sylfaen', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,276 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoepr.ttf', name='Segoe Print', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,277 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\msyh.ttc', name='Microsoft YaHei', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,277 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\SegUIVar.ttf', name='Segoe UI Variable', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,278 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\calibri.ttf', name='Calibri', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,279 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\trebucbd.ttf', name='Trebuchet MS', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,279 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\wingding.ttf', name='Wingdings', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,280 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\comicz.ttf', name='Comic Sans MS', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,280 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\cambriaz.ttf', name='Cambria', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,281 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\georgiab.ttf', name='Georgia', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,282 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\corbelz.ttf', name='Corbel', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,282 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\mingliub.ttc', name='MingLiU-ExtB', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,283 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\framd.ttf', name='Franklin Gothic Medium', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,283 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoeuil.ttf', name='Segoe UI', style='normal', variant='normal', weight=300, stretch='normal', size='scalable')) = 10.145
2025-10-08 10:27:56,284 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\comic.ttf', name='Comic Sans MS', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,285 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\Inkfree.ttf', name='Ink Free', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,286 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\seguili.ttf', name='Segoe UI', style='italic', variant='normal', weight=300, stretch='normal', size='scalable')) = 11.145
2025-10-08 10:27:56,286 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\symbol.ttf', name='Symbol', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,287 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\msyhl.ttc', name='Microsoft YaHei', style='normal', variant='normal', weight=290, stretch='normal', size='scalable')) = 10.1545
2025-10-08 10:27:56,288 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\msjhl.ttc', name='Microsoft JhengHei', style='normal', variant='normal', weight=290, stretch='normal', size='scalable')) = 10.1545
2025-10-08 10:27:56,288 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\seguihis.ttf', name='Segoe UI Historic', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,289 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\ntailub.ttf', name='Microsoft New Tai Lue', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,290 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\arialbd.ttf', name='Arial', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 6.698636363636363
2025-10-08 10:27:56,291 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\SansSerifCollection.ttf', name='Sans Serif Collection', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,291 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\consolai.ttf', name='Consolas', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,296 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\wingdng2.ttf', name='Wingdings 2', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,297 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\LeelaUIb.ttf', name='Leelawadee UI', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,298 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\simsunb.ttf', name='SimSun-ExtB', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,299 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\malgunbd.ttf', name='Malgun Gothic', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,299 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\corbelb.ttf', name='Corbel', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,300 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\taile.ttf', name='Microsoft Tai Le', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,301 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\trebucbi.ttf', name='Trebuchet MS', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,301 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\georgiaz.ttf', name='Georgia', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,302 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\palab.ttf', name='Palatino Linotype', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,302 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoeuisl.ttf', name='Segoe UI', style='normal', variant='normal', weight=350, stretch='normal', size='scalable')) = 10.0975
2025-10-08 10:27:56,332 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\SitkaVF.ttf', name='Sitka', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,332 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\corbel.ttf', name='Corbel', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,333 - matplotlib.font_manager - DEBUG - findfont: Matching sans\-serif:style=normal:variant=normal:weight=normal:stretch=normal:size=12.0 to DejaVu Sans ('C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSans.ttf') with score of 0.050000.
2025-10-08 10:27:56,525 - matplotlib.font_manager - DEBUG - findfont: Matching sans\-serif:style=normal:variant=normal:weight=bold:stretch=normal:size=9.0.
2025-10-08 10:27:56,525 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSerif-Bold.ttf', name='DejaVu Serif', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,526 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXNonUniBolIta.ttf', name='STIXNonUnicode', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,527 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXNonUniBol.ttf', name='STIXNonUnicode', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,527 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\cmb10.ttf', name='cmb10', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,527 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSansMono-Bold.ttf', name='DejaVu Sans Mono', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,528 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXGeneral.ttf', name='STIXGeneral', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,528 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXSizFourSymBol.ttf', name='STIXSizeFourSym', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,529 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSans.ttf', name='DejaVu Sans', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 0.33499999999999996
2025-10-08 10:27:56,529 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSansMono.ttf', name='DejaVu Sans Mono', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,530 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXSizFiveSymReg.ttf', name='STIXSizeFiveSym', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,530 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\cmsy10.ttf', name='cmsy10', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,531 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXSizThreeSymReg.ttf', name='STIXSizeThreeSym', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,532 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSans-Oblique.ttf', name='DejaVu Sans', style='oblique', variant='normal', weight=400, stretch='normal', size='scalable')) = 1.335
2025-10-08 10:27:56,533 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXSizThreeSymBol.ttf', name='STIXSizeThreeSym', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,534 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\cmmi10.ttf', name='cmmi10', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,534 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXSizOneSymBol.ttf', name='STIXSizeOneSym', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,534 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\cmss10.ttf', name='cmss10', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,535 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSans-BoldOblique.ttf', name='DejaVu Sans', style='oblique', variant='normal', weight=700, stretch='normal', size='scalable')) = 1.05
2025-10-08 10:27:56,536 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXSizTwoSymBol.ttf', name='STIXSizeTwoSym', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,537 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSans-Bold.ttf', name='DejaVu Sans', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 0.05
2025-10-08 10:27:56,537 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXGeneralItalic.ttf', name='STIXGeneral', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,538 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSerif-Italic.ttf', name='DejaVu Serif', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,539 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXGeneralBol.ttf', name='STIXGeneral', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,540 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\cmtt10.ttf', name='cmtt10', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,540 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSansMono-BoldOblique.ttf', name='DejaVu Sans Mono', style='oblique', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,541 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSansDisplay.ttf', name='DejaVu Sans Display', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,541 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\cmr10.ttf', name='cmr10', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,541 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSerif-BoldItalic.ttf', name='DejaVu Serif', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,543 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSerifDisplay.ttf', name='DejaVu Serif Display', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,543 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\cmex10.ttf', name='cmex10', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,544 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXGeneralBolIta.ttf', name='STIXGeneral', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,544 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXNonUniIta.ttf', name='STIXNonUnicode', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,571 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXNonUni.ttf', name='STIXNonUnicode', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,571 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXSizFourSymReg.ttf', name='STIXSizeFourSym', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,572 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXSizTwoSymReg.ttf', name='STIXSizeTwoSym', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,573 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSansMono-Oblique.ttf', name='DejaVu Sans Mono', style='oblique', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,576 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\STIXSizOneSymReg.ttf', name='STIXSizeOneSym', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,601 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSerif.ttf', name='DejaVu Serif', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,603 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\msyi.ttf', name='Microsoft Yi Baiti', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,604 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-08 10:27:56,606 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\tahoma.ttf', name='Tahoma', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,607 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\mmrtextb.ttf', name='Myanmar Text', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,608 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\YuGothL.ttc', name='Yu Gothic', style='normal', variant='normal', weight=300, stretch='normal', size='scalable')) = 10.43
2025-10-08 10:27:56,634 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\mvboli.ttf', name='MV Boli', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,635 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\LeelawUI.ttf', name='Leelawadee UI', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,637 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\palai.ttf', name='Palatino Linotype', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,638 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\calibrili.ttf', name='Calibri', style='italic', variant='normal', weight=300, stretch='normal', size='scalable')) = 11.43
2025-10-08 10:27:56,639 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\verdana.ttf', name='Verdana', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 3.9713636363636367
2025-10-08 10:27:56,639 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\couri.ttf', name='Courier New', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,671 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoeui.ttf', name='Segoe UI', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,671 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\seguisym.ttf', name='Segoe UI Symbol', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,672 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\msjhbd.ttc', name='Microsoft JhengHei', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,673 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\verdanai.ttf', name='Verdana', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 4.971363636363637
2025-10-08 10:27:56,673 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\calibriz.ttf', name='Calibri', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,673 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\seguisbi.ttf', name='Segoe UI', style='italic', variant='normal', weight=600, stretch='normal', size='scalable')) = 11.145
2025-10-08 10:27:56,675 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\ariali.ttf', name='Arial', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 7.698636363636363
2025-10-08 10:27:56,675 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\msjh.ttc', name='Microsoft JhengHei', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,676 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\georgiai.ttf', name='Georgia', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,677 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\Candaral.ttf', name='Candara', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,677 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\phagspa.ttf', name='Microsoft PhagsPa', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,677 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\bahnschrift.ttf', name='Bahnschrift', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,678 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoeuiz.ttf', name='Segoe UI', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,678 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\impact.ttf', name='Impact', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,680 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\Candarai.ttf', name='Candara', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,680 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\corbelli.ttf', name='Corbel', style='italic', variant='normal', weight=300, stretch='normal', size='scalable')) = 11.43
2025-10-08 10:27:56,681 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\malgunsl.ttf', name='Malgun Gothic', style='normal', variant='normal', weight=300, stretch='normal', size='scalable')) = 10.43
2025-10-08 10:27:56,681 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\l_10646.ttf', name='Lucida Sans Unicode', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,682 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\comicbd.ttf', name='Comic Sans MS', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,682 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\palabi.ttf', name='Palatino Linotype', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,682 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoeuib.ttf', name='Segoe UI', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,683 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\seguisli.ttf', name='Segoe UI', style='italic', variant='normal', weight=350, stretch='normal', size='scalable')) = 11.3825
2025-10-08 10:27:56,683 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\cour.ttf', name='Courier New', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,684 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\gadugib.ttf', name='Gadugi', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,684 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\malgun.ttf', name='Malgun Gothic', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,685 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoesc.ttf', name='Segoe Script', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,686 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\msyhbd.ttc', name='Microsoft YaHei', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,687 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\SitkaVF-Italic.ttf', name='Sitka', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,687 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\Nirmala.ttc', name='Nirmala UI', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,687 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\lucon.ttf', name='Lucida Console', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,688 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoeprb.ttf', name='Segoe Print', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,688 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\micross.ttf', name='Microsoft Sans Serif', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,689 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\cambria.ttc', name='Cambria', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,689 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\webdings.ttf', name='Webdings', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,691 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\ebrima.ttf', name='Ebrima', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,692 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\corbell.ttf', name='Corbel', style='normal', variant='normal', weight=300, stretch='normal', size='scalable')) = 10.43
2025-10-08 10:27:56,692 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\times.ttf', name='Times New Roman', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,693 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\arialbi.ttf', name='Arial', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 7.413636363636363
2025-10-08 10:27:56,693 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\seguisb.ttf', name='Segoe UI', style='normal', variant='normal', weight=600, stretch='normal', size='scalable')) = 10.145
2025-10-08 10:27:56,693 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\taileb.ttf', name='Microsoft Tai Le', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,694 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\himalaya.ttf', name='Microsoft Himalaya', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,694 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\SimsunExtG.ttf', name='SimSun-ExtG', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,695 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\calibril.ttf', name='Calibri', style='normal', variant='normal', weight=300, stretch='normal', size='scalable')) = 10.43
2025-10-08 10:27:56,695 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\SegoeIcons.ttf', name='Segoe Fluent Icons', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,697 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\mingliu.ttc', name='MingLiU', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,697 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\verdanab.ttf', name='Verdana', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 3.6863636363636365
2025-10-08 10:27:56,698 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\YuGothB.ttc', name='Yu Gothic', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,698 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\framdit.ttf', name='Franklin Gothic Medium', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,701 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoescb.ttf', name='Segoe Script', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,758 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\gulim.ttc', name='Gulim', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,760 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\constanb.ttf', name='Constantia', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,761 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\gadugi.ttf', name='Gadugi', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,763 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\consolab.ttf', name='Consolas', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,764 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\trebucit.ttf', name='Trebuchet MS', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,799 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\pala.ttf', name='Palatino Linotype', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,800 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\timesbd.ttf', name='Times New Roman', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,801 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\georgia.ttf', name='Georgia', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,802 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\timesbi.ttf', name='Times New Roman', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,802 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\mmrtext.ttf', name='Myanmar Text', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,803 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\LeelUIsl.ttf', name='Leelawadee UI', style='normal', variant='normal', weight=350, stretch='normal', size='scalable')) = 10.3825
2025-10-08 10:27:56,805 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\constan.ttf', name='Constantia', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,805 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\constanz.ttf', name='Constantia', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,806 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\consola.ttf', name='Consolas', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,807 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\comici.ttf', name='Comic Sans MS', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,808 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\monbaiti.ttf', name='Mongolian Baiti', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,808 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\Candara.ttf', name='Candara', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,809 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\calibrii.ttf', name='Calibri', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,809 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\tahomabd.ttf', name='Tahoma', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,811 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\simsun.ttc', name='SimSun', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,811 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\msgothic.ttc', name='MS Gothic', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,812 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\constani.ttf', name='Constantia', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,812 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\corbeli.ttf', name='Corbel', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,813 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\Candarali.ttf', name='Candara', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,813 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\wingdng3.ttf', name='Wingdings 3', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,814 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\courbi.ttf', name='Courier New', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,814 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\seguibli.ttf', name='Segoe UI', style='italic', variant='normal', weight=900, stretch='normal', size='scalable')) = 11.24
2025-10-08 10:27:56,815 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\ariblk.ttf', name='Arial', style='normal', variant='normal', weight=900, stretch='normal', size='scalable')) = 6.6036363636363635
2025-10-08 10:27:56,815 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\courbd.ttf', name='Courier New', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,816 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\Candarab.ttf', name='Candara', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,817 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\phagspab.ttf', name='Microsoft PhagsPa', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,817 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\Candaraz.ttf', name='Candara', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,818 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segmdl2.ttf', name='Segoe MDL2 Assets', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,818 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\consolaz.ttf', name='Consolas', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,819 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoeuii.ttf', name='Segoe UI', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,820 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\javatext.ttf', name='Javanese Text', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,820 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\timesi.ttf', name='Times New Roman', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,821 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\cambriab.ttf', name='Cambria', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,821 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\ebrimabd.ttf', name='Ebrima', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,822 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\verdanaz.ttf', name='Verdana', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 4.6863636363636365
2025-10-08 10:27:56,822 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\ntailu.ttf', name='Microsoft New Tai Lue', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,823 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\cambriai.ttf', name='Cambria', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,827 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\seguiemj.ttf', name='Segoe UI Emoji', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,828 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\YuGothR.ttc', name='Yu Gothic', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,828 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\calibrib.ttf', name='Calibri', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,829 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\Gabriola.ttf', name='Gabriola', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,830 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\seguibl.ttf', name='Segoe UI', style='normal', variant='normal', weight=900, stretch='normal', size='scalable')) = 10.24
2025-10-08 10:27:56,830 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\arial.ttf', name='Arial', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 6.698636363636363
2025-10-08 10:27:56,831 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\trebuc.ttf', name='Trebuchet MS', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,831 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\YuGothM.ttc', name='Yu Gothic', style='normal', variant='normal', weight=500, stretch='normal', size='scalable')) = 10.24
2025-10-08 10:27:56,832 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\sylfaen.ttf', name='Sylfaen', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,864 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoepr.ttf', name='Segoe Print', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,869 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\msyh.ttc', name='Microsoft YaHei', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,870 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\SegUIVar.ttf', name='Segoe UI Variable', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,870 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\calibri.ttf', name='Calibri', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,871 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\trebucbd.ttf', name='Trebuchet MS', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,872 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\wingding.ttf', name='Wingdings', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,873 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\comicz.ttf', name='Comic Sans MS', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,873 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\cambriaz.ttf', name='Cambria', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,874 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\georgiab.ttf', name='Georgia', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,875 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\corbelz.ttf', name='Corbel', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,876 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\mingliub.ttc', name='MingLiU-ExtB', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,876 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\framd.ttf', name='Franklin Gothic Medium', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,877 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoeuil.ttf', name='Segoe UI', style='normal', variant='normal', weight=300, stretch='normal', size='scalable')) = 10.43
2025-10-08 10:27:56,878 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\comic.ttf', name='Comic Sans MS', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,878 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\Inkfree.ttf', name='Ink Free', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,879 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\seguili.ttf', name='Segoe UI', style='italic', variant='normal', weight=300, stretch='normal', size='scalable')) = 11.43
2025-10-08 10:27:56,879 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\symbol.ttf', name='Symbol', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,880 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\msyhl.ttc', name='Microsoft YaHei', style='normal', variant='normal', weight=290, stretch='normal', size='scalable')) = 10.4395
2025-10-08 10:27:56,881 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\msjhl.ttc', name='Microsoft JhengHei', style='normal', variant='normal', weight=290, stretch='normal', size='scalable')) = 10.4395
2025-10-08 10:27:56,882 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\seguihis.ttf', name='Segoe UI Historic', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,882 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\ntailub.ttf', name='Microsoft New Tai Lue', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,883 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\arialbd.ttf', name='Arial', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 6.413636363636363
2025-10-08 10:27:56,884 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\SansSerifCollection.ttf', name='Sans Serif Collection', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,889 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\consolai.ttf', name='Consolas', style='italic', variant='normal', weight=400, stretch='normal', size='scalable')) = 11.335
2025-10-08 10:27:56,928 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\wingdng2.ttf', name='Wingdings 2', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,929 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\LeelaUIb.ttf', name='Leelawadee UI', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,929 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\simsunb.ttf', name='SimSun-ExtB', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,930 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\malgunbd.ttf', name='Malgun Gothic', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,930 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\corbelb.ttf', name='Corbel', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,931 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\taile.ttf', name='Microsoft Tai Le', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,932 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\trebucbi.ttf', name='Trebuchet MS', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,932 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\georgiaz.ttf', name='Georgia', style='italic', variant='normal', weight=700, stretch='normal', size='scalable')) = 11.05
2025-10-08 10:27:56,933 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\palab.ttf', name='Palatino Linotype', style='normal', variant='normal', weight=700, stretch='normal', size='scalable')) = 10.05
2025-10-08 10:27:56,934 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\segoeuisl.ttf', name='Segoe UI', style='normal', variant='normal', weight=350, stretch='normal', size='scalable')) = 10.3825
2025-10-08 10:27:56,934 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\SitkaVF.ttf', name='Sitka', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,935 - matplotlib.font_manager - DEBUG - findfont: score(FontEntry(fname='C:\\Windows\\Fonts\\corbel.ttf', name='Corbel', style='normal', variant='normal', weight=400, stretch='normal', size='scalable')) = 10.335
2025-10-08 10:27:56,935 - matplotlib.font_manager - DEBUG - findfont: Matching sans\-serif:style=normal:variant=normal:weight=bold:stretch=normal:size=9.0 to DejaVu Sans ('C:\\tool\\app_gemini-1\\.venv\\Lib\\site-packages\\matplotlib\\mpl-data\\fonts\\ttf\\DejaVuSans-Bold.ttf') with score of 0.050000.
2025-10-08 10:27:57,129 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:27:57,130 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:27:57,130 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:27:57,131 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:27:57,131 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:27:57,598 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-08 10:27:57,632 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:27:57,634 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:27:57,635 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:27:57,636 - APP.services.mt5_service - DEBUG - Current price (cp): 4040.784
2025-10-08 10:27:57,645 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 236, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:27:57,696 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 220, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:27:57,703 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:27:57,704 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:27:57,706 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:27:57,707 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:27:57,707 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:27:57,708 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:27:57,711 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:27:57,712 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:27:57,712 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:27:57,713 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:27:57,716 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:27:57,716 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:27:57,717 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:27:57,717 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:27:57,719 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:27:57,720 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:27:57,721 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:27:57,722 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:27:57,722 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-08 10:27:57,725 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:27:57,725 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:27:57,726 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:27:57,727 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:27:57,728 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:27:57,728 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:27:57,737 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:27:57.737754+07:00
2025-10-08 10:27:57,756 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:27:57.737754+07:00
2025-10-08 10:27:57,758 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:27:57.737754+07:00 trong DST: True
2025-10-08 10:27:57,758 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:27:57,759 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:27:57,759 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:27:57,761 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:27:57,766 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:27:57,785 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:27:57,786 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:27:57,788 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:27:57,790 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:27:57,790 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:27:57,790 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:27:57,791 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:27:57,791 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:27:57,822 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:27:57,823 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:27:57,827 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:27:57,853 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:27:57,854 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:27:57,854 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:27:57,855 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:27:57,880 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:27:57,881 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:27:57,882 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:27:57,883 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:27:57,883 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:27:57,884 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:27:57,888 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:27:57,921 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:27:57,922 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:27:57,922 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:27:57,923 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:27:57,923 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:27:57,924 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:27:57,924 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:27:57,924 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:27:57,925 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4040.784, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:27:57,925 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:27:57,926 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:27:57,926 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:27:57,926 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:27:57,927 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 44786.00000000006
2025-10-08 10:27:57,927 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 99903.00000000025
2025-10-08 10:27:57,928 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 28233.999999999924
2025-10-08 10:27:57,928 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 46355.000000000015
2025-10-08 10:27:57,929 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:27:57,929 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44786.00000000006}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99903.00000000025}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 28233.999999999924}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 46355.000000000015}]
2025-10-08 10:27:57,929 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:27:57,930 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:27:57,930 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:27:57,931 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:27:57,931 - APP.services.mt5_service - DEBUG - Position in day range: 1.0039985719385962
2025-10-08 10:27:57,932 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:27:57,932 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:27:57.932874+07:00
2025-10-08 10:27:57,933 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:27:57.932874+07:00
2025-10-08 10:27:57,934 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:27:57.932874+07:00 trong DST: True
2025-10-08 10:27:57,934 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:27:57,934 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:27:57,935 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 213
2025-10-08 10:27:57,935 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:27:57,935 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:27:57,936 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '7800', 'price': 4040.78, 'distance_pips': 0.4}, {'level': '7825', 'price': 4040.783, 'distance_pips': 0.15}, {'level': '7850', 'price': 4040.785, 'distance_pips': 0.1}, {'level': '7875', 'price': 4040.788, 'distance_pips': 0.35}]
2025-10-08 10:27:57,936 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:27:57,937 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:27:57,937 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:27:57,938 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:27:57,939 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.784
2025-10-08 10:27:57,939 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:27:57,939 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:27:57,941 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:27:57,941 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:27:57,942 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:27:57,943 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4040.784
2025-10-08 10:27:57,944 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:27:57,944 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:27:57,945 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:27:57,945 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:27:57,946 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:27:57,947 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4040.784
2025-10-08 10:27:57,947 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:27:57,948 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:27:57,970 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:27:57,978 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:27:57,978 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:27:57,981 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.784
2025-10-08 10:27:57,984 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:27:57,984 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:27:58,015 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:27:58,017 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:27:58,080 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:27:58,081 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:27:58,082 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:27:58,083 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:27:58,084 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:27:58,085 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:27:58,085 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:27:58,086 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:27:58,086 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:27:58,087 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:27:58,088 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:27:58,088 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:27:58,088 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:27:58,089 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:27:58,089 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:27:58,090 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:27:58,090 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:27:58,090 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:27:58,091 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:27:58,091 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:27:58,092 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:27:58,093 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:27:58,094 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:27:58,094 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:27:58,095 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:27:58,096 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:27:58,098 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:27:58,099 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:27:58,101 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:27:58,101 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:27:58,102 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:27:58,103 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4040.784, 'ask': 4040.821, 'last': 0.0, 'time': 1759919277}
2025-10-08 10:27:58,104 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:27:58,108 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:27:58,130 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:27:58,131 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:27:58,132 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:27:58,132 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:27:58,133 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:27:58,133 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:27:58,134 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4040.784
2025-10-08 10:27:58,134 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44786.00000000006}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99903.00000000025}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 28233.999999999924}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 46355.000000000015}]
2025-10-08 10:27:58,135 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:27:58,165 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:27:58,169 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:27:58,170 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:27:58,201 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:27:58,225 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:27:58,609 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-08 10:27:58,639 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-08 10:27:59,230 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-08 10:27:59,245 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): www.investing.com:443
2025-10-08 10:27:59,794 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:27:59,796 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:27:59,797 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:27:59,797 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:27:59,800 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:27:59,801 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:27:59,804 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:27:59,826 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:27:59,829 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:27:59,829 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:27:59,830 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:27:59,831 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:27:59,832 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:27:59,847 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:27:59,867 - urllib3.connectionpool - DEBUG - https://www.investing.com:443 "POST /economic-calendar/Service/getCalendarFilteredData HTTP/1.1" 200 None
2025-10-08 10:27:59,953 - APP.services.fmp_service - INFO - Lấy thành công 529 sự kiện từ investpy cho 7 ngày tới.
2025-10-08 10:27:59,960 - APP.services.news_service - WARNING - Không thể lấy tin tức từ Trading Economics: HTTP Error 403: Forbidden
2025-10-08 10:28:00,057 - APP.services.news_service - INFO - Cache được cập nhật với 190 sự kiện quan trọng.
2025-10-08 10:28:00,155 - APP.ui.app_ui - DEBUG - Callback nhận được 190 sự kiện tin tức mới.
2025-10-08 10:28:00,156 - APP.services.news_service - DEBUG - Callback cập nhật tin tức đã được gọi.
2025-10-08 10:28:00,330 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:28:00,333 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:00,335 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:00,335 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:00,336 - APP.services.mt5_service - DEBUG - Current price (cp): 4041.083
2025-10-08 10:28:00,342 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 237, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:00,376 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 220, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:00,376 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:00,377 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:00,379 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:00,379 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:00,380 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:00,380 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:00,383 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:00,383 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:00,384 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:00,384 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:00,386 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:00,386 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:00,387 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:00,389 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:00,394 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:00,409 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:00,410 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:00,410 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:00,413 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:00,413 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:00,414 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:00,414 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:00,414 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:00,415 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:00,416 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:00.415967+07:00
2025-10-08 10:28:00,416 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:00.415967+07:00
2025-10-08 10:28:00,416 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:00.415967+07:00 trong DST: True
2025-10-08 10:28:00,417 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:00,419 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:00,419 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:00,442 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:00,443 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:00,444 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:00,444 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:00,447 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:00,447 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:00,447 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:00,448 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:00,449 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:00,451 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:00,451 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:00,452 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:00,473 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:00,473 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:00,474 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:00,474 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:00,475 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:00,475 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:00,475 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:00,476 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:00,476 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:00,476 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:00,477 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:00,478 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:00,478 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:00,479 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:00,479 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:00,481 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:00,483 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:00,500 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:00,506 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:00,507 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:00,507 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4041.083, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:00,508 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:00,508 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:00,509 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:00,509 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:00,510 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 45085.00000000004
2025-10-08 10:28:00,510 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 100202.00000000022
2025-10-08 10:28:00,510 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 28532.9999999999
2025-10-08 10:28:00,514 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 46653.99999999999
2025-10-08 10:28:00,514 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:00,538 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 45085.00000000004}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 100202.00000000022}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 28532.9999999999}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 46653.99999999999}]
2025-10-08 10:28:00,539 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:00,540 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:00,540 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:00,541 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:00,541 - APP.services.mt5_service - DEBUG - Position in day range: 1.0093359514459146
2025-10-08 10:28:00,541 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:00,542 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:00.542010+07:00
2025-10-08 10:28:00,543 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:00.542010+07:00
2025-10-08 10:28:00,544 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:00.542010+07:00 trong DST: True
2025-10-08 10:28:00,545 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:00,545 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:00,548 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:00,563 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:00,563 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:00,564 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '800', 'price': 4041.08, 'distance_pips': 0.3}, {'level': '825', 'price': 4041.082, 'distance_pips': 0.05}, {'level': '850', 'price': 4041.085, 'distance_pips': 0.2}, {'level': '875', 'price': 4041.088, 'distance_pips': 0.45}]
2025-10-08 10:28:00,564 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:28:00,565 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:00,565 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:00,566 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:00,566 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4041.083
2025-10-08 10:28:00,567 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:00,567 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:00,568 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:00,568 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:00,569 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:00,569 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4041.083
2025-10-08 10:28:00,570 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:00,570 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:00,571 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:00,571 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:00,572 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:00,594 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4041.083
2025-10-08 10:28:00,601 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:00,602 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:00,603 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:00,603 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:00,604 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:00,604 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4041.083
2025-10-08 10:28:00,605 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:00,605 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:00,608 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:00,611 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:00,631 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:00,632 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:00,632 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:00,632 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:00,633 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:00,633 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:00,634 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:00,634 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:00,634 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:00,635 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:00,635 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:00,635 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:00,638 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:00,638 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:00,639 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:00,639 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:00,659 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:00,660 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:00,660 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:00,661 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:00,661 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:00,661 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:00,662 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:00,662 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:00,663 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:00,664 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:00,666 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:00,666 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:00,666 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:00,670 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:00,683 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4041.083, 'ask': 4041.12, 'last': 0.0, 'time': 1759919280}
2025-10-08 10:28:00,689 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:00,690 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:00,690 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:00,691 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:00,691 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:00,691 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:00,692 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:00,692 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:00,692 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:00,693 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4041.083
2025-10-08 10:28:00,693 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 45085.00000000004}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 100202.00000000022}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 28532.9999999999}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 46653.99999999999}]
2025-10-08 10:28:00,694 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:00,759 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:00,760 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:00,761 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:00,763 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:00,765 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:04,798 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:04,800 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:04,801 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:04,801 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:04,803 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:04,803 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:04,806 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:04,807 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:04,826 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:05,175 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:05,175 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:05,176 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:05,176 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:05,177 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:05,678 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:05,680 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:05,680 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:05,681 - APP.services.mt5_service - DEBUG - Current price (cp): 4040.567
2025-10-08 10:28:05,684 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 237, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:05,712 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 220, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:05,714 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:05,715 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:05,718 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:05,718 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:05,719 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:05,719 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:05,722 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:05,722 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:05,722 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:05,723 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:05,724 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:05,725 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:05,725 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:05,725 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:05,727 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:05,728 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:05,728 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:05,728 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:05,731 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:05,732 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:05,733 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:05,733 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:05,736 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:05,751 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:05,751 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:05.751765+07:00
2025-10-08 10:28:05,752 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:05.751765+07:00
2025-10-08 10:28:05,752 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:05.751765+07:00 trong DST: True
2025-10-08 10:28:05,753 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:05,753 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:05,753 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:05,755 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:05,755 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:05,756 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:05,757 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:05,760 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:05,760 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:05,760 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:05,761 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:05,761 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:05,761 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:05,763 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:05,764 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:05,764 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:05,765 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:05,765 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:05,784 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:05,785 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:05,785 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:05,785 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:05,786 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:05,786 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:05,786 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:05,787 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:05,787 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:05,788 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:05,788 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:05,789 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:05,790 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:05,790 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:05,792 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:05,794 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:05,820 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:05,820 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4040.567, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:05,821 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:05,822 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:05,822 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:05,823 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:05,823 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 44568.999999999956
2025-10-08 10:28:05,824 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 99686.00000000015
2025-10-08 10:28:05,826 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 28016.999999999825
2025-10-08 10:28:05,826 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 46137.99999999992
2025-10-08 10:28:05,827 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:05,847 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44568.999999999956}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99686.00000000015}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 28016.999999999825}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 46137.99999999992}]
2025-10-08 10:28:05,848 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:05,849 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:05,850 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:05,850 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:05,850 - APP.services.mt5_service - DEBUG - Position in day range: 1.0001249553730822
2025-10-08 10:28:05,851 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:05,851 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:05.851518+07:00
2025-10-08 10:28:05,851 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:05.851518+07:00
2025-10-08 10:28:05,852 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:05.851518+07:00 trong DST: True
2025-10-08 10:28:05,852 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:05,853 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:05,853 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:05,854 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:05,854 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:05,854 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '5600', 'price': 4040.56, 'distance_pips': 0.7}, {'level': '5625', 'price': 4040.562, 'distance_pips': 0.45}, {'level': '5650', 'price': 4040.565, 'distance_pips': 0.2}, {'level': '5675', 'price': 4040.568, 'distance_pips': 0.05}]
2025-10-08 10:28:05,855 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:28:05,855 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:05,856 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:05,859 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:05,876 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.567
2025-10-08 10:28:05,876 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:05,877 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:05,878 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:05,878 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:05,879 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:05,879 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4040.567
2025-10-08 10:28:05,879 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:05,880 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:05,881 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:05,881 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:05,881 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:05,882 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4040.567
2025-10-08 10:28:05,883 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:05,884 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:05,884 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:05,885 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:05,886 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:05,887 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.567
2025-10-08 10:28:05,888 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:05,889 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:05,896 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:05,911 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:05,912 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:05,912 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:05,913 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:05,913 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:05,913 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:05,914 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:05,914 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:05,914 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:05,915 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:05,915 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:05,916 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:05,916 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:05,916 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:05,916 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:05,917 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:05,917 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:05,918 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:05,921 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:05,921 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:05,943 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:05,944 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:05,944 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:05,945 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:05,945 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:05,946 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:05,947 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:05,948 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:05,949 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:05,950 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:05,952 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4040.567, 'ask': 4040.604, 'last': 0.0, 'time': 1759919285}
2025-10-08 10:28:05,956 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:05,972 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:05,973 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:05,973 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:05,974 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:05,974 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:05,975 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:05,975 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:05,975 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:05,976 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:05,976 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4040.567
2025-10-08 10:28:05,976 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44568.999999999956}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99686.00000000015}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 28016.999999999825}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 46137.99999999992}]
2025-10-08 10:28:05,977 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:06,004 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:06,005 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:06,005 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:06,006 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:06,007 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:09,781 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:28:09,802 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:09,813 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:09,813 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:09,814 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:09,816 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:09,817 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:28:09,817 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:09,820 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:09,820 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:09,824 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:09,825 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:09,827 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:09,827 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:09,878 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:09,940 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:10,381 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:10,383 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:10,385 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:10,385 - APP.services.mt5_service - DEBUG - Current price (cp): 4040.082
2025-10-08 10:28:10,389 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 237, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:10,420 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 221, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:10,422 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:10,425 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:10,427 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:10,429 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:10,429 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:10,430 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:10,434 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:10,434 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:10,436 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:10,436 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:10,440 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:10,441 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:10,442 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:10,442 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:10,445 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:10,452 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:10,475 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:10,479 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:10,482 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:10,511 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:10,512 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:10,534 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:10,535 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:10,537 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:10,538 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:10.538363+07:00
2025-10-08 10:28:10,541 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:10.538363+07:00
2025-10-08 10:28:10,543 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:10.538363+07:00 trong DST: True
2025-10-08 10:28:10,577 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:10,579 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:10,580 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:10,581 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:10,582 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:10,583 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:10,584 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:10,587 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:10,588 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:10,588 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:10,589 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:10,589 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:10,590 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:10,590 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:10,591 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:10,591 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:10,591 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:10,592 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:10,593 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:10,593 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:10,594 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:10,595 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:10,595 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:10,595 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:10,596 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:10,596 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:10,597 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:10,597 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:10,597 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:10,598 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:10,598 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:10,599 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:10,599 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:10,600 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:10,600 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:10,601 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4040.082, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:10,601 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:10,601 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:10,602 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:10,602 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:10,603 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 44083.99999999983
2025-10-08 10:28:10,603 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 99201.00000000001
2025-10-08 10:28:10,603 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27531.999999999698
2025-10-08 10:28:10,604 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45652.99999999979
2025-10-08 10:28:10,604 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:10,605 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44083.99999999983}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99201.00000000001}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27531.999999999698}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45652.99999999979}]
2025-10-08 10:28:10,605 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:10,606 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:10,607 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:10,608 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:10,630 - APP.services.mt5_service - DEBUG - Position in day range: 0.991467333095322
2025-10-08 10:28:10,631 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:10,632 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:10.631952+07:00
2025-10-08 10:28:10,632 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:10.631952+07:00
2025-10-08 10:28:10,632 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:10.631952+07:00 trong DST: True
2025-10-08 10:28:10,633 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:10,633 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:10,634 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:10,634 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:10,635 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:10,635 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '800', 'price': 4040.08, 'distance_pips': 0.2}, {'level': '825', 'price': 4040.082, 'distance_pips': 0.05}, {'level': '850', 'price': 4040.085, 'distance_pips': 0.3}, {'level': '875', 'price': 4040.088, 'distance_pips': 0.55}]
2025-10-08 10:28:10,636 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:28:10,636 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:10,636 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:10,637 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:10,660 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.082
2025-10-08 10:28:10,661 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:10,661 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:10,663 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:10,663 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:10,663 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:10,664 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4040.082
2025-10-08 10:28:10,665 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:10,665 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:10,666 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:10,666 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:10,667 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:10,668 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4040.082
2025-10-08 10:28:10,668 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:10,695 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:10,696 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:10,697 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:10,697 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:10,698 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.082
2025-10-08 10:28:10,698 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:10,699 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:10,701 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:10,702 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:10,721 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:10,722 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:10,723 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:10,724 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:10,724 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:10,724 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:10,725 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:10,726 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:10,726 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:10,727 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:10,727 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:10,728 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:10,728 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:10,729 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:10,729 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:10,729 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:10,730 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:10,730 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:10,730 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:10,733 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:10,756 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:10,757 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:10,757 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:10,758 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:10,758 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:10,759 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:10,760 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:10,761 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:10,761 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:10,761 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4040.082, 'ask': 4040.119, 'last': 0.0, 'time': 1759919290}
2025-10-08 10:28:10,786 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:10,787 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:10,787 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:10,788 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:10,788 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:10,789 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:10,789 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:10,790 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:10,791 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:10,792 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:10,792 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4040.082
2025-10-08 10:28:10,792 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44083.99999999983}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99201.00000000001}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27531.999999999698}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45652.99999999979}]
2025-10-08 10:28:10,793 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:10,891 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:10,892 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:10,892 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:10,894 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:10,895 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:14,815 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:14,818 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:14,818 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:14,820 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:14,822 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:14,824 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:14,842 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:14,849 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:14,849 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:14,850 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:14,850 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:14,852 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:14,852 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:14,906 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:15,354 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:15,355 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:15,356 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:15,356 - APP.services.mt5_service - DEBUG - Current price (cp): 4040.201
2025-10-08 10:28:15,361 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 239, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:15,390 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 221, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:15,392 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:15,393 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:15,395 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:15,396 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:15,396 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:15,396 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:15,399 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:15,400 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:15,400 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:15,401 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:15,402 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:15,403 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:15,403 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:15,404 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:15,406 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:15,406 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:15,406 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:15,407 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:15,409 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:15,409 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:15,410 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:15,410 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:15,411 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:15,411 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:15,411 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:15.411799+07:00
2025-10-08 10:28:15,412 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:15.411799+07:00
2025-10-08 10:28:15,412 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:15.411799+07:00 trong DST: True
2025-10-08 10:28:15,413 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:15,413 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:15,413 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:15,415 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:15,415 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:15,416 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:15,417 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:15,422 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:15,441 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:15,442 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:15,442 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:15,443 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:15,443 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:15,444 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:15,444 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:15,444 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:15,445 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:15,445 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:15,446 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:15,446 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:15,447 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:15,447 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:15,447 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:15,447 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:15,448 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:15,448 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:15,449 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:15,452 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:15,455 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:15,472 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:15,473 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:15,473 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:15,474 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:15,474 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:15,475 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:15,475 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4040.201, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:15,476 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:15,477 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:15,477 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:15,477 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:15,478 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 44202.99999999997
2025-10-08 10:28:15,478 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 99320.00000000016
2025-10-08 10:28:15,478 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27650.99999999984
2025-10-08 10:28:15,479 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45771.999999999935
2025-10-08 10:28:15,479 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:15,480 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44202.99999999997}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99320.00000000016}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27650.99999999984}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45771.999999999935}]
2025-10-08 10:28:15,480 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:15,481 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:15,484 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:15,484 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:15,508 - APP.services.mt5_service - DEBUG - Position in day range: 0.9935915744377022
2025-10-08 10:28:15,508 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:15,509 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:15.509367+07:00
2025-10-08 10:28:15,509 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:15.509367+07:00
2025-10-08 10:28:15,510 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:15.509367+07:00 trong DST: True
2025-10-08 10:28:15,510 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:15,511 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:15,511 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:15,512 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:15,514 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:15,515 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '2000', 'price': 4040.2, 'distance_pips': 0.1}, {'level': '2025', 'price': 4040.203, 'distance_pips': 0.15}, {'level': '2050', 'price': 4040.205, 'distance_pips': 0.4}, {'level': '2075', 'price': 4040.208, 'distance_pips': 0.65}]
2025-10-08 10:28:15,515 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:28:15,536 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:15,536 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:15,537 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:15,538 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.201
2025-10-08 10:28:15,539 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:15,539 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:15,540 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:15,541 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:15,541 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:15,541 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4040.201
2025-10-08 10:28:15,542 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:15,542 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:15,543 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:15,551 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:15,566 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:15,568 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4040.201
2025-10-08 10:28:15,569 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:15,569 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:15,570 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:15,570 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:15,571 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:15,571 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.201
2025-10-08 10:28:15,572 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:15,572 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:15,573 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:15,573 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:15,574 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:15,574 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:15,577 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:15,580 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:15,599 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:15,600 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:15,601 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:15,601 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:15,602 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:15,602 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:15,603 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:15,603 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:15,603 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:15,604 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:15,604 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:15,605 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:15,605 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:15,605 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:15,609 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:15,627 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:15,628 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:15,628 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:15,629 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:15,630 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:15,630 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:15,631 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:15,633 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:15,634 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:15,634 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4040.201, 'ask': 4040.238, 'last': 0.0, 'time': 1759919294}
2025-10-08 10:28:15,634 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:15,635 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:15,637 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:15,638 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:15,639 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:15,660 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:15,660 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:15,661 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:15,662 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:15,662 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:15,662 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:15,663 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4040.201
2025-10-08 10:28:15,663 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44202.99999999997}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99320.00000000016}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27650.99999999984}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45771.999999999935}]
2025-10-08 10:28:15,663 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:15,719 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:15,722 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:15,723 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:15,723 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:15,725 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:15,821 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:15,823 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:15,823 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:15,824 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:15,827 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:15,828 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:15,831 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:15,831 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:15,834 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:15,834 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:15,836 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:15,836 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:15,837 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:15,929 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:16,338 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:16,339 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:16,340 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:16,340 - APP.services.mt5_service - DEBUG - Current price (cp): 4040.178
2025-10-08 10:28:16,344 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 239, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:16,374 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:16,375 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:16,376 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:16,378 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:16,379 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:16,379 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:16,379 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:16,382 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:16,383 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:16,383 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:16,384 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:16,386 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:16,386 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:16,386 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:16,387 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:16,390 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:16,404 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:16,411 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:16,412 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:16,414 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:16,415 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:16,416 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:16,416 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:16,417 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:16,417 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:16,417 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:16.417832+07:00
2025-10-08 10:28:16,418 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:16.417832+07:00
2025-10-08 10:28:16,418 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:16.417832+07:00 trong DST: True
2025-10-08 10:28:16,419 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:16,419 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:16,420 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:16,422 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:16,425 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:16,443 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:16,443 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:16,446 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:16,446 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:16,447 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:16,447 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:16,448 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:16,448 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:16,448 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:16,449 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:16,449 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:16,450 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:16,450 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:16,451 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:16,452 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:16,453 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:16,453 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:16,472 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:16,472 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:16,473 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:16,473 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:16,474 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:16,474 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:16,475 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:16,475 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:16,476 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:16,476 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:16,477 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:16,478 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:16,478 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:16,478 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4040.178, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:16,479 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:16,479 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:16,480 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:16,480 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:16,480 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 44179.99999999983
2025-10-08 10:28:16,481 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 99297.00000000003
2025-10-08 10:28:16,483 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27627.9999999997
2025-10-08 10:28:16,509 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45748.999999999796
2025-10-08 10:28:16,510 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:16,511 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44179.99999999983}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99297.00000000003}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27627.9999999997}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45748.999999999796}]
2025-10-08 10:28:16,511 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:16,512 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:16,513 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:16,514 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:16,514 - APP.services.mt5_service - DEBUG - Position in day range: 0.9931810067832906
2025-10-08 10:28:16,515 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:16,516 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:16.516230+07:00
2025-10-08 10:28:16,532 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:16.516230+07:00
2025-10-08 10:28:16,532 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:16.516230+07:00 trong DST: True
2025-10-08 10:28:16,533 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:16,533 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:16,534 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:16,534 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:16,535 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:16,535 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '1700', 'price': 4040.17, 'distance_pips': 0.8}, {'level': '1725', 'price': 4040.173, 'distance_pips': 0.55}, {'level': '1750', 'price': 4040.175, 'distance_pips': 0.3}, {'level': '1775', 'price': 4040.178, 'distance_pips': 0.05}]
2025-10-08 10:28:16,535 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:28:16,536 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:16,536 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:16,536 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:16,537 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.178
2025-10-08 10:28:16,537 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:16,538 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:16,539 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:16,539 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:16,540 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:16,540 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4040.178
2025-10-08 10:28:16,541 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:16,541 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:16,542 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:16,542 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:16,543 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:16,543 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4040.178
2025-10-08 10:28:16,545 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:16,546 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:16,568 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:16,569 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:16,569 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:16,570 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.178
2025-10-08 10:28:16,571 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:16,571 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:16,572 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:16,572 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:16,573 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:16,573 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:16,574 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:16,574 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:16,574 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:16,575 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:16,601 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:16,602 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:16,602 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:16,602 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:16,603 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:16,603 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:16,604 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:16,604 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:16,604 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:16,605 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:16,605 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:16,606 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:16,608 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:16,609 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:16,609 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:16,632 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:16,633 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:16,634 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:16,634 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:16,635 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:16,636 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:16,637 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:16,638 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4040.178, 'ask': 4040.215, 'last': 0.0, 'time': 1759919295}
2025-10-08 10:28:16,638 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:16,640 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:16,645 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:16,665 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:16,666 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:16,666 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:16,667 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:16,667 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:16,668 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:16,668 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:16,669 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:16,670 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4040.178
2025-10-08 10:28:16,671 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44179.99999999983}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99297.00000000003}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27627.9999999997}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45748.999999999796}]
2025-10-08 10:28:16,672 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:16,701 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:16,702 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:16,721 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:16,723 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:16,725 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:16,825 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:16,829 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:16,829 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:16,830 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:16,832 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:16,833 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:16,836 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:16,836 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:16,840 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:16,841 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:16,842 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:16,842 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:16,843 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:16,932 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:17,344 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:17,346 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:17,346 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:17,347 - APP.services.mt5_service - DEBUG - Current price (cp): 4040.174
2025-10-08 10:28:17,350 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 239, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:17,379 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:17,381 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:17,382 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:17,386 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:17,386 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:17,386 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:17,387 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:17,394 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:17,409 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:17,409 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:17,410 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:17,411 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:17,412 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:17,412 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:17,413 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:17,415 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:17,415 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:17,415 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:17,416 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:17,418 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:17,419 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:17,419 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:17,421 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:17,421 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:17,421 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:17,422 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:17.422083+07:00
2025-10-08 10:28:17,422 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:17.422083+07:00
2025-10-08 10:28:17,423 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:17.422083+07:00 trong DST: True
2025-10-08 10:28:17,439 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:17,440 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:17,441 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:17,442 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:17,443 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:17,444 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:17,444 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:17,447 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:17,447 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:17,448 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:17,448 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:17,449 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:17,449 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:17,450 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:17,452 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:17,452 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:17,453 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:17,471 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:17,471 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:17,472 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:17,473 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:17,473 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:17,474 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:17,474 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:17,474 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:17,475 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:17,475 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:17,476 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:17,476 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:17,477 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:17,478 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:17,478 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:17,479 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:17,480 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:17,480 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:17,480 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4040.174, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:17,483 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:17,484 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:17,498 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:17,508 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:17,508 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 44175.99999999993
2025-10-08 10:28:17,509 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 99293.00000000012
2025-10-08 10:28:17,509 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27623.999999999796
2025-10-08 10:28:17,510 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45744.99999999989
2025-10-08 10:28:17,510 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:17,510 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44175.99999999993}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99293.00000000012}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27623.999999999796}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45744.99999999989}]
2025-10-08 10:28:17,511 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:17,511 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:17,512 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:17,512 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:17,515 - APP.services.mt5_service - DEBUG - Position in day range: 0.9931096037129602
2025-10-08 10:28:17,535 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:17,536 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:17.536440+07:00
2025-10-08 10:28:17,536 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:17.536440+07:00
2025-10-08 10:28:17,537 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:17.536440+07:00 trong DST: True
2025-10-08 10:28:17,537 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:17,538 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:17,538 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:17,538 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:17,539 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:17,539 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '1700', 'price': 4040.17, 'distance_pips': 0.4}, {'level': '1725', 'price': 4040.173, 'distance_pips': 0.15}, {'level': '1750', 'price': 4040.175, 'distance_pips': 0.1}, {'level': '1775', 'price': 4040.178, 'distance_pips': 0.35}]
2025-10-08 10:28:17,540 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:28:17,540 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:17,541 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:17,542 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:17,543 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.174
2025-10-08 10:28:17,543 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:17,543 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:17,553 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:17,566 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:17,567 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:17,567 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4040.174
2025-10-08 10:28:17,568 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:17,569 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:17,569 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:17,570 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:17,570 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:17,571 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4040.174
2025-10-08 10:28:17,572 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:17,573 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:17,574 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:17,574 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:17,575 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:17,576 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.174
2025-10-08 10:28:17,578 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:17,578 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:17,595 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:17,598 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:17,599 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:17,599 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:17,599 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:17,600 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:17,600 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:17,600 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:17,601 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:17,601 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:17,601 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:17,601 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:17,602 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:17,602 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:17,603 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:17,603 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:17,603 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:17,604 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:17,604 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:17,605 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:17,605 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:17,605 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:17,606 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:17,606 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:17,607 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:17,609 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:17,610 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:17,625 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:17,628 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:17,631 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4040.174, 'ask': 4040.211, 'last': 0.0, 'time': 1759919296}
2025-10-08 10:28:17,633 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:17,634 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:17,634 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:17,634 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:17,635 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:17,637 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:17,637 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:17,638 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:17,638 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:17,640 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:17,641 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:17,643 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:17,647 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4040.174
2025-10-08 10:28:17,655 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44175.99999999993}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99293.00000000012}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27623.999999999796}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45744.99999999989}]
2025-10-08 10:28:17,661 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:17,698 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:17,699 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:17,702 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:17,703 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:17,724 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:17,831 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:17,833 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:17,833 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:17,834 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:17,836 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:17,836 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:17,839 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:17,839 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:17,843 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:17,844 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:17,844 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:17,845 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:17,845 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:17,926 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:18,347 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:18,348 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:18,349 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:18,350 - APP.services.mt5_service - DEBUG - Current price (cp): 4040.177
2025-10-08 10:28:18,353 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 239, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:18,382 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:18,384 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:18,386 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:18,389 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:18,405 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:18,406 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:18,406 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:18,409 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:18,409 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:18,410 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:18,410 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:18,412 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:18,412 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:18,413 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:18,413 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:18,415 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:18,415 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:18,416 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:18,416 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:18,419 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:18,420 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:18,421 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:18,421 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:18,422 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:18,422 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:18,440 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:18.440479+07:00
2025-10-08 10:28:18,441 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:18.440479+07:00
2025-10-08 10:28:18,442 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:18.440479+07:00 trong DST: True
2025-10-08 10:28:18,442 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:18,443 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:18,443 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:18,444 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:18,445 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:18,446 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:18,447 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:18,450 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:18,450 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:18,451 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:18,452 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:18,453 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:18,453 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:18,454 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:18,457 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:18,472 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:18,473 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:18,474 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:18,474 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:18,474 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:18,475 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:18,475 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:18,475 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:18,476 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:18,476 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:18,476 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:18,477 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:18,478 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:18,478 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:18,479 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:18,479 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:18,480 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:18,480 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:18,481 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:18,481 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:18,482 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4040.177, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:18,484 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:18,485 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:18,485 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:18,510 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:18,511 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 44179.00000000009
2025-10-08 10:28:18,511 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 99296.00000000028
2025-10-08 10:28:18,511 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27626.999999999953
2025-10-08 10:28:18,512 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45748.000000000044
2025-10-08 10:28:18,513 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:18,514 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44179.00000000009}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99296.00000000028}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27626.999999999953}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45748.000000000044}]
2025-10-08 10:28:18,515 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:18,535 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:18,536 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:18,537 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:18,537 - APP.services.mt5_service - DEBUG - Position in day range: 0.993163156015712
2025-10-08 10:28:18,538 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:18,538 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:18.538362+07:00
2025-10-08 10:28:18,538 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:18.538362+07:00
2025-10-08 10:28:18,539 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:18.538362+07:00 trong DST: True
2025-10-08 10:28:18,539 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:18,540 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:18,540 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:18,540 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:18,541 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:18,542 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '1700', 'price': 4040.17, 'distance_pips': 0.7}, {'level': '1725', 'price': 4040.173, 'distance_pips': 0.45}, {'level': '1750', 'price': 4040.175, 'distance_pips': 0.2}, {'level': '1775', 'price': 4040.178, 'distance_pips': 0.05}]
2025-10-08 10:28:18,543 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:28:18,543 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:18,544 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:18,556 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:18,564 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.177
2025-10-08 10:28:18,565 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:18,565 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:18,566 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:18,567 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:18,567 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:18,568 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4040.177
2025-10-08 10:28:18,568 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:18,569 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:18,570 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:18,570 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:18,571 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:18,572 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4040.177
2025-10-08 10:28:18,572 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:18,573 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:18,574 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:18,574 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:18,575 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:18,577 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.177
2025-10-08 10:28:18,578 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:18,600 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:18,601 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:18,602 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:18,602 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:18,603 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:18,603 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:18,604 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:18,604 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:18,604 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:18,605 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:18,605 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:18,605 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:18,606 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:18,609 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:18,609 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:18,609 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:18,631 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:18,632 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:18,632 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:18,632 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:18,633 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:18,633 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:18,633 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:18,634 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:18,634 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:18,634 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:18,635 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:18,636 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:18,637 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:18,639 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:18,639 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:18,640 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:18,662 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:18,663 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4040.177, 'ask': 4040.214, 'last': 0.0, 'time': 1759919298}
2025-10-08 10:28:18,664 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:18,664 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:18,665 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:18,665 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:18,665 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:18,666 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:18,667 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:18,667 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:18,667 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:18,668 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4040.177
2025-10-08 10:28:18,668 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44179.00000000009}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99296.00000000028}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27626.999999999953}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45748.000000000044}]
2025-10-08 10:28:18,669 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:18,702 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:18,703 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:18,723 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:18,724 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:18,725 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:18,835 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:18,837 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:18,837 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:18,838 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:18,840 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:18,840 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:18,843 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:18,844 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:18,847 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:18,847 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:18,848 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:18,848 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:18,849 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:18,927 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:19,350 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:19,351 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:19,352 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:19,352 - APP.services.mt5_service - DEBUG - Current price (cp): 4040.214
2025-10-08 10:28:19,356 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 239, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:19,386 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:19,390 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:19,392 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:19,395 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:19,395 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:19,397 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:19,397 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:19,400 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:19,401 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:19,402 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:19,403 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:19,405 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:19,405 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:19,405 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:19,406 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:19,409 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:19,410 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:19,410 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:19,410 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:19,412 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:19,413 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:19,413 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:19,414 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:19,414 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:19,414 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:19,415 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:19.415266+07:00
2025-10-08 10:28:19,415 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:19.415266+07:00
2025-10-08 10:28:19,416 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:19.415266+07:00 trong DST: True
2025-10-08 10:28:19,417 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:19,417 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:19,417 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:19,418 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:19,419 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:19,421 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:19,422 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:19,427 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:19,446 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:19,446 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:19,447 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:19,447 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:19,448 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:19,448 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:19,450 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:19,453 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:19,471 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:19,472 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:19,473 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:19,474 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:19,475 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:19,476 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:19,477 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:19,477 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:19,478 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:19,479 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:19,480 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:19,480 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:19,481 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:19,484 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:19,506 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:19,507 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:19,508 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:19,509 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:19,510 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:19,510 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4040.214, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:19,511 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:19,511 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:19,512 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:19,514 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:19,515 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 44215.99999999989
2025-10-08 10:28:19,539 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 99333.00000000009
2025-10-08 10:28:19,540 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27663.99999999976
2025-10-08 10:28:19,541 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45784.999999999854
2025-10-08 10:28:19,542 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:19,542 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44215.99999999989}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99333.00000000009}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27663.99999999976}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45784.999999999854}]
2025-10-08 10:28:19,543 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:19,544 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:19,547 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:19,566 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:19,567 - APP.services.mt5_service - DEBUG - Position in day range: 0.9938236344162799
2025-10-08 10:28:19,568 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:19,568 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:19.568628+07:00
2025-10-08 10:28:19,569 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:19.568628+07:00
2025-10-08 10:28:19,570 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:19.568628+07:00 trong DST: True
2025-10-08 10:28:19,570 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:19,570 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:19,571 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:19,571 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:19,572 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:19,572 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '2100', 'price': 4040.21, 'distance_pips': 0.4}, {'level': '2125', 'price': 4040.213, 'distance_pips': 0.15}, {'level': '2150', 'price': 4040.215, 'distance_pips': 0.1}, {'level': '2175', 'price': 4040.218, 'distance_pips': 0.35}]
2025-10-08 10:28:19,573 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:28:19,573 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:19,574 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:19,574 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:19,575 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.214
2025-10-08 10:28:19,575 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:19,577 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:19,578 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:19,579 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:19,580 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:19,598 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4040.214
2025-10-08 10:28:19,599 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:19,600 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:19,601 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:19,601 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:19,602 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:19,603 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4040.214
2025-10-08 10:28:19,603 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:19,603 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:19,604 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:19,605 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:19,605 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:19,605 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.214
2025-10-08 10:28:19,606 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:19,630 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:19,632 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:19,632 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:19,633 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:19,633 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:19,634 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:19,634 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:19,634 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:19,635 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:19,635 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:19,635 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:19,636 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:19,636 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:19,637 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:19,640 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:19,641 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:19,663 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:19,664 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:19,665 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:19,665 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:19,666 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:19,666 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:19,666 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:19,667 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:19,667 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:19,668 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:19,668 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:19,671 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:19,674 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:19,697 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:19,698 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:19,698 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:19,698 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4040.214, 'ask': 4040.251, 'last': 0.0, 'time': 1759919299}
2025-10-08 10:28:19,701 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:19,703 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:19,703 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:19,719 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:19,721 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:19,721 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:19,721 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:19,722 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:19,722 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:19,723 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:19,723 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4040.214
2025-10-08 10:28:19,723 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44215.99999999989}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99333.00000000009}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27663.99999999976}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45784.999999999854}]
2025-10-08 10:28:19,724 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:19,797 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:19,798 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:19,799 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:19,801 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:19,802 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:19,839 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:19,849 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:19,849 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:19,850 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:19,851 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:19,852 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:19,855 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:19,855 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:19,881 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:19,881 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:19,882 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:19,883 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:19,883 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:19,906 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:20,384 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:20,386 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:20,386 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:20,387 - APP.services.mt5_service - DEBUG - Current price (cp): 4040.164
2025-10-08 10:28:20,390 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 234, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:20,419 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:20,421 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:20,422 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:20,425 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:20,425 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:20,426 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:20,426 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:20,429 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:20,430 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:20,430 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:20,430 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:20,432 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:20,433 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:20,433 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:20,434 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:20,436 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:20,436 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:20,436 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:20,437 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:20,439 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:20,440 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:20,440 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:20,440 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:20,441 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:20,441 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:20,441 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:20.441837+07:00
2025-10-08 10:28:20,442 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:20.441837+07:00
2025-10-08 10:28:20,442 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:20.441837+07:00 trong DST: True
2025-10-08 10:28:20,442 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:20,443 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:20,443 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:20,444 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:20,445 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:20,446 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:20,447 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:20,449 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:20,450 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:20,450 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:20,453 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:20,453 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:20,471 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:20,472 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:20,473 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:20,474 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:20,474 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:20,475 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:20,475 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:20,475 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:20,476 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:20,476 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:20,477 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:20,477 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:20,478 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:20,478 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:20,479 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:20,479 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:20,480 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:20,480 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:20,481 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:20,481 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:20,483 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:20,484 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:20,484 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:20,500 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4040.164, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:20,507 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:20,508 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:20,508 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:20,509 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:20,509 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 44166.00000000017
2025-10-08 10:28:20,509 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 99283.00000000035
2025-10-08 10:28:20,510 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27614.000000000033
2025-10-08 10:28:20,510 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45735.000000000124
2025-10-08 10:28:20,510 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:20,511 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44166.00000000017}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99283.00000000035}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27614.000000000033}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45735.000000000124}]
2025-10-08 10:28:20,511 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:20,512 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:20,512 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:20,514 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:20,515 - APP.services.mt5_service - DEBUG - Position in day range: 0.9929310960371344
2025-10-08 10:28:20,518 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:20,531 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:20.531285+07:00
2025-10-08 10:28:20,532 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:20.531285+07:00
2025-10-08 10:28:20,532 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:20.531285+07:00 trong DST: True
2025-10-08 10:28:20,533 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:20,533 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:20,534 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:20,534 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:20,534 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:20,535 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '1600', 'price': 4040.16, 'distance_pips': 0.4}, {'level': '1625', 'price': 4040.163, 'distance_pips': 0.15}, {'level': '1650', 'price': 4040.165, 'distance_pips': 0.1}, {'level': '1675', 'price': 4040.168, 'distance_pips': 0.35}]
2025-10-08 10:28:20,535 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:28:20,535 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:20,536 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:20,536 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:20,537 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.164
2025-10-08 10:28:20,537 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:20,538 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:20,539 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:20,539 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:20,540 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:20,540 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4040.164
2025-10-08 10:28:20,541 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:20,541 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:20,542 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:20,542 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:20,543 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:20,543 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4040.164
2025-10-08 10:28:20,544 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:20,546 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:20,548 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:20,570 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:20,570 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:20,571 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.164
2025-10-08 10:28:20,572 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:20,572 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:20,573 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:20,574 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:20,574 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:20,574 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:20,575 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:20,577 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:20,577 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:20,578 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:20,589 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:20,600 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:20,601 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:20,602 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:20,603 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:20,603 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:20,603 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:20,604 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:20,604 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:20,605 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:20,605 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:20,605 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:20,606 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:20,606 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:20,606 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:20,607 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:20,609 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:20,609 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:20,610 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:20,634 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:20,635 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:20,636 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:20,637 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:20,637 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4040.164, 'ask': 4040.201, 'last': 0.0, 'time': 1759919300}
2025-10-08 10:28:20,640 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:20,662 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:20,663 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:20,663 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:20,663 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:20,664 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:20,664 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:20,665 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:20,665 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:20,665 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:20,666 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4040.164
2025-10-08 10:28:20,666 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44166.00000000017}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99283.00000000035}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27614.000000000033}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45735.000000000124}]
2025-10-08 10:28:20,667 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:20,745 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:20,746 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:20,746 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:20,748 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:20,749 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:20,850 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:20,853 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:20,853 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:20,854 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:20,855 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:20,856 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:20,861 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:20,861 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:20,877 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:20,882 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:20,884 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:20,885 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:20,886 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:20,954 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:21,387 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:21,389 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:21,390 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:21,390 - APP.services.mt5_service - DEBUG - Current price (cp): 4040.022
2025-10-08 10:28:21,393 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 235, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:21,422 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:21,424 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:21,425 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:21,427 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:21,427 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:21,428 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:21,428 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:21,431 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:21,431 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:21,432 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:21,432 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:21,433 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:21,434 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:21,434 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:21,435 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:21,436 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:21,437 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:21,438 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:21,438 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:21,440 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:21,441 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:21,441 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:21,442 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:21,442 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:21,442 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:21,443 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:21.443303+07:00
2025-10-08 10:28:21,443 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:21.443303+07:00
2025-10-08 10:28:21,444 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:21.443303+07:00 trong DST: True
2025-10-08 10:28:21,444 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:21,444 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:21,445 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:21,446 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:21,446 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:21,447 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:21,448 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:21,450 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:21,451 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:21,451 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:21,452 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:21,453 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:21,472 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:21,473 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:21,474 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:21,475 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:21,475 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:21,476 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:21,476 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:21,476 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:21,477 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:21,477 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:21,477 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:21,478 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:21,478 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:21,479 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:21,480 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:21,481 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:21,481 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:21,483 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:21,484 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:21,484 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:21,485 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:21,508 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:21,509 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:21,510 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4040.022, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:21,510 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:21,510 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:21,511 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:21,511 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:21,511 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 44023.99999999988
2025-10-08 10:28:21,512 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 99141.00000000007
2025-10-08 10:28:21,512 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27471.999999999753
2025-10-08 10:28:21,513 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45592.99999999985
2025-10-08 10:28:21,515 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:21,515 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44023.99999999988}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99141.00000000007}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27471.999999999753}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45592.99999999985}]
2025-10-08 10:28:21,516 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:21,535 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:21,535 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:21,536 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:21,536 - APP.services.mt5_service - DEBUG - Position in day range: 0.9903962870403425
2025-10-08 10:28:21,537 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:21,537 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:21.537723+07:00
2025-10-08 10:28:21,538 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:21.537723+07:00
2025-10-08 10:28:21,538 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:21.537723+07:00 trong DST: True
2025-10-08 10:28:21,538 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:21,539 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:21,539 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:21,540 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:21,540 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:21,541 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '200', 'price': 4040.02, 'distance_pips': 0.2}, {'level': '225', 'price': 4040.023, 'distance_pips': 0.05}, {'level': '250', 'price': 4040.025, 'distance_pips': 0.3}, {'level': '275', 'price': 4040.028, 'distance_pips': 0.55}]
2025-10-08 10:28:21,541 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:28:21,541 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:21,542 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:21,542 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:21,543 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.022
2025-10-08 10:28:21,543 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:21,544 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:21,545 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:21,547 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:21,564 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:21,565 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4040.022
2025-10-08 10:28:21,566 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:21,566 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:21,567 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:21,567 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:21,568 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:21,568 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4040.022
2025-10-08 10:28:21,569 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:21,570 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:21,570 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:21,571 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:21,571 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:21,572 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.022
2025-10-08 10:28:21,572 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:21,573 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:21,573 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:21,574 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:21,574 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:21,575 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:21,576 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:21,577 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:21,578 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:21,579 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:21,595 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:21,597 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:21,600 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:21,601 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:21,602 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:21,603 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:21,603 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:21,604 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:21,604 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:21,604 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:21,605 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:21,605 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:21,605 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:21,609 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:21,618 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:21,630 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:21,631 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:21,632 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:21,633 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:21,635 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:21,637 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:21,637 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:21,637 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:21,638 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4040.022, 'ask': 4040.059, 'last': 0.0, 'time': 1759919300}
2025-10-08 10:28:21,645 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:21,662 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:21,662 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:21,663 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:21,664 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:21,664 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:21,665 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:21,665 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:21,666 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:21,666 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:21,666 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4040.022
2025-10-08 10:28:21,667 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44023.99999999988}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99141.00000000007}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27471.999999999753}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45592.99999999985}]
2025-10-08 10:28:21,667 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:21,712 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:21,722 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:21,723 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:21,724 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:21,725 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:21,854 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:21,857 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:21,857 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:21,858 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:21,860 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:21,861 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:21,864 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:21,882 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:21,887 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:21,890 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:21,890 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:21,891 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:21,896 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:21,931 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:22,408 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:22,409 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:22,410 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:22,410 - APP.services.mt5_service - DEBUG - Current price (cp): 4040.106
2025-10-08 10:28:22,414 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 235, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:22,442 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:22,444 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:22,445 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:22,448 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:22,448 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:22,448 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:22,449 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:22,455 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:22,471 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:22,472 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:22,472 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:22,474 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:22,474 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:22,475 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:22,475 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:22,477 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:22,478 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:22,478 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:22,479 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:22,481 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:22,483 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:22,483 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:22,484 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:22,505 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:22,505 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:22,506 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:22.506150+07:00
2025-10-08 10:28:22,506 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:22.506150+07:00
2025-10-08 10:28:22,507 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:22.506150+07:00 trong DST: True
2025-10-08 10:28:22,507 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:22,507 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:22,508 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:22,509 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:22,510 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:22,511 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:22,512 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:22,516 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:22,530 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:22,531 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:22,531 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:22,532 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:22,532 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:22,533 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:22,533 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:22,533 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:22,534 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:22,534 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:22,535 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:22,535 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:22,535 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:22,536 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:22,536 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:22,537 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:22,538 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:22,538 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:22,538 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:22,539 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:22,539 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:22,540 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:22,540 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:22,540 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:22,541 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:22,541 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:22,542 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:22,542 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4040.106, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:22,543 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:22,543 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:22,544 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:22,544 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:22,544 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 44108.000000000175
2025-10-08 10:28:22,545 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 99225.00000000036
2025-10-08 10:28:22,546 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27556.00000000004
2025-10-08 10:28:22,547 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45677.00000000013
2025-10-08 10:28:22,552 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:22,569 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44108.000000000175}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99225.00000000036}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27556.00000000004}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45677.00000000013}]
2025-10-08 10:28:22,570 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:22,570 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:22,571 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:22,571 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:22,572 - APP.services.mt5_service - DEBUG - Position in day range: 0.9918957515173201
2025-10-08 10:28:22,572 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:22,572 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:22.572614+07:00
2025-10-08 10:28:22,573 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:22.572614+07:00
2025-10-08 10:28:22,573 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:22.572614+07:00 trong DST: True
2025-10-08 10:28:22,574 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:22,574 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:22,574 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:22,575 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:22,575 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:22,576 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '1000', 'price': 4040.1, 'distance_pips': 0.6}, {'level': '1025', 'price': 4040.102, 'distance_pips': 0.35}, {'level': '1050', 'price': 4040.105, 'distance_pips': 0.1}, {'level': '1075', 'price': 4040.108, 'distance_pips': 0.15}]
2025-10-08 10:28:22,576 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:28:22,579 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:22,580 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:22,597 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:22,598 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.106
2025-10-08 10:28:22,599 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:22,599 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:22,600 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:22,600 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:22,601 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:22,601 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4040.106
2025-10-08 10:28:22,602 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:22,602 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:22,603 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:22,604 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:22,604 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:22,605 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4040.106
2025-10-08 10:28:22,605 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:22,606 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:22,607 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:22,615 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:22,626 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:22,630 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.106
2025-10-08 10:28:22,632 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:22,633 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:22,633 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:22,634 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:22,634 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:22,635 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:22,635 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:22,635 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:22,636 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:22,636 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:22,637 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:22,637 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:22,637 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:22,638 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:22,638 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:22,638 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:22,641 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:22,641 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:22,650 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:22,653 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:22,654 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:22,656 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:22,657 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:22,660 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:22,661 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:22,663 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:22,664 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:22,664 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:22,665 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:22,666 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:22,667 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:22,668 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:22,669 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4040.106, 'ask': 4040.143, 'last': 0.0, 'time': 1759919301}
2025-10-08 10:28:22,669 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:22,672 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:22,686 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:22,729 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:22,730 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:22,736 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:22,736 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:22,737 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:22,737 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:22,737 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:22,738 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:22,738 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4040.106
2025-10-08 10:28:22,738 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44108.000000000175}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99225.00000000036}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27556.00000000004}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45677.00000000013}]
2025-10-08 10:28:22,739 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:22,844 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:22,861 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:22,914 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:22,942 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:22,974 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:23,017 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:23,019 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:23,020 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:23,021 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:23,023 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:23,024 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:23,027 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:23,027 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:23,066 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:23,089 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:23,090 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:23,091 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:23,092 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:23,126 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:23,593 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:23,594 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:23,595 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:23,595 - APP.services.mt5_service - DEBUG - Current price (cp): 4040.03
2025-10-08 10:28:23,599 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 234, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:23,628 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:23,631 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:23,632 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:23,634 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:23,635 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:23,635 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:23,636 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:23,640 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:23,659 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:23,659 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:23,660 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:23,661 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:23,662 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:23,662 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:23,663 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:23,665 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:23,665 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:23,666 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:23,666 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:23,669 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:23,670 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:23,671 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:23,674 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:23,687 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:23,690 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:23,692 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:23.691962+07:00
2025-10-08 10:28:23,692 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:23.691962+07:00
2025-10-08 10:28:23,693 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:23.691962+07:00 trong DST: True
2025-10-08 10:28:23,693 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:23,693 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:23,694 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:23,695 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:23,696 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:23,697 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:23,697 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:23,700 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:23,700 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:23,701 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:23,703 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:23,703 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:23,704 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:23,704 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:23,707 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:23,722 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:23,723 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:23,724 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:23,724 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:23,724 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:23,725 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:23,725 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:23,726 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:23,726 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:23,727 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:23,727 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:23,728 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:23,728 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:23,728 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:23,729 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:23,729 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:23,729 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:23,730 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:23,730 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:23,731 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:23,731 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4040.03, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:23,734 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:23,734 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:23,735 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:23,735 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:23,754 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 44032.00000000015
2025-10-08 10:28:23,755 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 99149.00000000033
2025-10-08 10:28:23,756 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27480.00000000002
2025-10-08 10:28:23,756 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45601.00000000011
2025-10-08 10:28:23,757 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:23,757 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44032.00000000015}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99149.00000000033}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27480.00000000002}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45601.00000000011}]
2025-10-08 10:28:23,757 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:23,758 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:23,759 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:23,759 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:23,759 - APP.services.mt5_service - DEBUG - Position in day range: 0.9905390931810113
2025-10-08 10:28:23,760 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:23,760 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:23.760563+07:00
2025-10-08 10:28:23,760 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:23.760563+07:00
2025-10-08 10:28:23,761 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:23.760563+07:00 trong DST: True
2025-10-08 10:28:23,761 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:23,762 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:23,762 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:23,764 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:23,765 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:23,784 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '300', 'price': 4040.03, 'distance_pips': 0.0}, {'level': '325', 'price': 4040.033, 'distance_pips': 0.25}, {'level': '350', 'price': 4040.035, 'distance_pips': 0.5}, {'level': '375', 'price': 4040.038, 'distance_pips': 0.75}]
2025-10-08 10:28:23,785 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:28:23,785 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:23,786 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:23,786 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:23,787 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.03
2025-10-08 10:28:23,788 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:23,788 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:23,789 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:23,789 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:23,790 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:23,791 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4040.03
2025-10-08 10:28:23,791 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:23,793 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:23,793 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:23,794 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:23,795 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:23,798 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4040.03
2025-10-08 10:28:23,814 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:23,821 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:23,823 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:23,824 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:23,824 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:23,825 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.03
2025-10-08 10:28:23,827 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:23,829 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:23,851 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:23,852 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:23,853 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:23,853 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:23,854 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:23,854 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:23,854 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:23,854 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:23,855 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:23,855 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:23,855 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:23,856 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:23,857 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:23,859 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:23,859 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:23,864 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:23,882 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:23,882 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:23,883 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:23,883 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:23,883 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:23,884 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:23,884 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:23,884 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:23,885 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:23,885 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:23,886 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:23,887 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:23,891 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:23,893 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:23,913 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:23,915 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:23,916 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4040.03, 'ask': 4040.067, 'last': 0.0, 'time': 1759919302}
2025-10-08 10:28:23,916 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:23,917 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:23,917 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:23,918 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:23,918 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:23,919 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:23,922 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:23,922 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:23,942 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:23,942 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4040.03
2025-10-08 10:28:23,943 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44032.00000000015}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99149.00000000033}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27480.00000000002}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45601.00000000011}]
2025-10-08 10:28:23,944 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:24,012 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:24,013 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:24,015 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:24,016 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:24,018 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:24,038 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:24,041 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:24,041 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:24,041 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:24,043 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:24,065 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:24,068 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:24,068 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:24,073 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:24,074 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:24,074 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:24,075 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:24,100 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:24,124 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:24,601 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:24,603 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:24,604 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:24,605 - APP.services.mt5_service - DEBUG - Current price (cp): 4039.997
2025-10-08 10:28:24,610 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 235, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:24,640 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:24,641 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:24,642 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:24,644 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:24,644 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:24,645 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:24,645 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:24,649 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:24,649 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:24,649 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:24,650 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:24,652 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:24,652 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:24,652 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:24,653 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:24,656 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:24,656 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:24,656 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:24,656 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:24,659 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:24,659 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:24,660 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:24,660 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:24,661 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:24,661 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:24,662 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:24.662152+07:00
2025-10-08 10:28:24,662 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:24.662152+07:00
2025-10-08 10:28:24,663 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:24.662152+07:00 trong DST: True
2025-10-08 10:28:24,663 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:24,663 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:24,664 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:24,665 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:24,665 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:24,666 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:24,667 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:24,672 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:24,672 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:24,690 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:24,691 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:24,691 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:24,692 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:24,692 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:24,692 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:24,693 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:24,693 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:24,693 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:24,694 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:24,694 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:24,695 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:24,695 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:24,695 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:24,696 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:24,696 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:24,696 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:24,697 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:24,697 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:24,698 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:24,698 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:24,699 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:24,699 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:24,700 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:24,700 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:24,700 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:24,701 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4039.997, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:24,703 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:24,703 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:24,704 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:24,707 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:24,724 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 43998.999999999796
2025-10-08 10:28:24,725 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 99115.99999999999
2025-10-08 10:28:24,725 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27446.99999999966
2025-10-08 10:28:24,726 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45567.99999999975
2025-10-08 10:28:24,726 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:24,726 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43998.999999999796}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99115.99999999999}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27446.99999999966}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45567.99999999975}]
2025-10-08 10:28:24,727 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:24,727 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:24,728 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:24,728 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:24,729 - APP.services.mt5_service - DEBUG - Position in day range: 0.9899500178507658
2025-10-08 10:28:24,729 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:24,730 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:24.729959+07:00
2025-10-08 10:28:24,730 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:24.729959+07:00
2025-10-08 10:28:24,730 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:24.729959+07:00 trong DST: True
2025-10-08 10:28:24,731 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:24,731 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:24,731 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:24,732 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:24,735 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:24,737 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '9900', 'price': 4039.99, 'distance_pips': 0.7}, {'level': '9925', 'price': 4039.993, 'distance_pips': 0.45}, {'level': '9950', 'price': 4039.995, 'distance_pips': 0.2}, {'level': '9975', 'price': 4039.998, 'distance_pips': 0.05}]
2025-10-08 10:28:24,748 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:28:24,754 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:24,754 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:24,755 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:24,755 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.997
2025-10-08 10:28:24,756 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:24,756 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:24,757 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:24,758 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:24,758 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:24,758 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4039.997
2025-10-08 10:28:24,759 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:24,759 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:24,760 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:24,760 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:24,761 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:24,762 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4039.997
2025-10-08 10:28:24,762 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:24,763 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:24,765 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:24,766 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:24,766 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:24,769 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.997
2025-10-08 10:28:24,788 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:24,789 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:24,789 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:28:24,790 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:24,792 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:24,792 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:24,793 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:24,793 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:24,793 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:24,794 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:24,811 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:28:24,822 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:24,823 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:24,824 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:24,824 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:24,825 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:24,825 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:24,825 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:24,826 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:24,827 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:24,829 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:24,829 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:24,849 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:24,849 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:24,850 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:24,851 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:24,852 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:24,852 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:24,852 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:24,853 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:24,854 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:24,854 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:24,856 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:24,856 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:24,857 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4039.997, 'ask': 4040.034, 'last': 0.0, 'time': 1759919303}
2025-10-08 10:28:24,857 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:24,859 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:24,864 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:24,880 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:24,881 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:24,881 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:24,882 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:24,882 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:24,883 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:24,883 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:24,883 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:24,884 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4039.997
2025-10-08 10:28:24,884 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43998.999999999796}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99115.99999999999}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27446.99999999966}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45567.99999999975}]
2025-10-08 10:28:24,884 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:24,931 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:24,942 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:24,942 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:24,943 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:24,945 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:25,042 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:25,045 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:25,046 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:25,047 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:25,049 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:25,050 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:25,052 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:25,053 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:25,055 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:25,056 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:25,057 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:25,057 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:25,058 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:25,149 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:25,559 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:25,560 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:25,561 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:25,561 - APP.services.mt5_service - DEBUG - Current price (cp): 4039.976
2025-10-08 10:28:25,565 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 235, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:25,593 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:25,594 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:25,596 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:25,598 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:25,598 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:25,599 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:25,599 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:25,602 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:25,603 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:25,603 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:25,604 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:25,605 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:25,606 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:25,606 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:25,606 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:25,610 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:25,610 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:25,630 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:25,631 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:25,633 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:25,634 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:25,635 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:25,635 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:25,636 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:25,636 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:25,637 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:25.637143+07:00
2025-10-08 10:28:25,637 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:25.637143+07:00
2025-10-08 10:28:25,637 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:25.637143+07:00 trong DST: True
2025-10-08 10:28:25,638 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:25,638 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:25,640 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:25,641 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:25,644 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:25,662 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:25,663 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:25,665 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:25,666 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:25,666 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:25,667 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:25,667 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:25,668 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:25,668 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:25,668 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:25,669 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:25,671 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:25,672 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:25,693 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:25,694 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:25,694 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:25,695 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:25,695 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:25,696 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:25,696 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:25,697 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:25,698 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:25,698 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:25,698 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:25,699 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:25,699 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:25,700 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:25,700 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:25,701 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:25,703 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:25,703 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4039.976, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:25,725 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:25,726 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:25,727 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:25,727 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:25,728 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 43978.000000000065
2025-10-08 10:28:25,728 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 99095.00000000025
2025-10-08 10:28:25,728 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27425.99999999993
2025-10-08 10:28:25,729 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45547.00000000002
2025-10-08 10:28:25,729 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:25,729 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43978.000000000065}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99095.00000000025}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27425.99999999993}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45547.00000000002}]
2025-10-08 10:28:25,730 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:25,730 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:25,731 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:25,731 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:25,734 - APP.services.mt5_service - DEBUG - Position in day range: 0.9895751517315274
2025-10-08 10:28:25,735 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:25,736 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:25.736305+07:00
2025-10-08 10:28:25,757 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:25.736305+07:00
2025-10-08 10:28:25,758 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:25.736305+07:00 trong DST: True
2025-10-08 10:28:25,759 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:25,759 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:25,760 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:25,760 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:25,761 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:25,761 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '9700', 'price': 4039.97, 'distance_pips': 0.6}, {'level': '9725', 'price': 4039.973, 'distance_pips': 0.35}, {'level': '9750', 'price': 4039.975, 'distance_pips': 0.1}, {'level': '9775', 'price': 4039.978, 'distance_pips': 0.15}]
2025-10-08 10:28:25,762 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:28:25,762 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:25,765 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:25,766 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:25,767 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.976
2025-10-08 10:28:25,776 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:25,789 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:25,790 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:25,790 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:25,791 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:25,792 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4039.976
2025-10-08 10:28:25,792 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:25,792 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:25,793 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:25,811 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:25,824 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:25,825 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4039.976
2025-10-08 10:28:25,826 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:25,828 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:25,834 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:25,850 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:25,851 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:25,852 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.976
2025-10-08 10:28:25,853 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:25,853 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:25,854 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:25,854 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:25,855 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:25,855 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:25,855 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:25,856 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:25,856 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:25,857 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:25,857 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:25,860 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:25,860 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:25,885 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:25,886 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:25,886 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:25,887 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:25,887 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:25,888 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:25,888 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:25,889 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:25,889 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:25,890 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:25,891 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:25,892 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:25,896 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:25,915 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:25,916 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:25,917 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:25,918 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:25,919 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:25,921 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:25,921 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:25,922 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4039.976, 'ask': 4040.013, 'last': 0.0, 'time': 1759919304}
2025-10-08 10:28:25,927 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:25,948 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:25,949 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:25,949 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:25,949 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:25,950 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:25,950 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:25,951 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:25,953 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:25,954 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:25,972 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4039.976
2025-10-08 10:28:25,972 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43978.000000000065}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99095.00000000025}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27425.99999999993}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45547.00000000002}]
2025-10-08 10:28:25,973 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:26,048 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:26,048 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:26,049 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:26,050 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:26,051 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:26,052 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:26,054 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:26,054 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:26,055 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:26,057 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:26,057 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:26,059 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:26,060 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:26,102 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:26,102 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:26,103 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:26,103 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:26,104 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:26,162 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:26,605 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:26,607 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:26,607 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:26,608 - APP.services.mt5_service - DEBUG - Current price (cp): 4040.156
2025-10-08 10:28:26,612 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 236, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:26,640 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:26,643 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:26,644 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:26,647 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:26,648 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:26,648 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:26,649 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:26,652 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:26,652 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:26,652 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:26,653 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:26,655 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:26,655 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:26,655 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:26,656 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:26,658 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:26,658 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:26,659 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:26,659 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:26,661 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:26,662 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:26,662 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:26,663 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:26,663 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:26,663 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:26,664 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:26.664214+07:00
2025-10-08 10:28:26,664 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:26.664214+07:00
2025-10-08 10:28:26,664 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:26.664214+07:00 trong DST: True
2025-10-08 10:28:26,665 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:26,665 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:26,666 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:26,667 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:26,667 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:26,668 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:26,669 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:26,673 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:26,690 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:26,691 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:26,691 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:26,691 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:26,692 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:26,693 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:26,693 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:26,693 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:26,694 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:26,694 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:26,694 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:26,695 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:26,695 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:26,696 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:26,696 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:26,696 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:26,697 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:26,697 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:26,698 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:26,698 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:26,699 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:26,699 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:26,699 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:26,700 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:26,700 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:26,701 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:26,702 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:26,703 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4040.156, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:26,724 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:26,724 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:26,725 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:26,725 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:26,726 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 44157.9999999999
2025-10-08 10:28:26,726 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 99275.00000000009
2025-10-08 10:28:26,727 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27605.999999999767
2025-10-08 10:28:26,727 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45726.99999999986
2025-10-08 10:28:26,728 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:26,728 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44157.9999999999}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99275.00000000009}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27605.999999999767}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45726.99999999986}]
2025-10-08 10:28:26,729 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:26,729 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:26,730 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:26,730 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:26,731 - APP.services.mt5_service - DEBUG - Position in day range: 0.9927882898964656
2025-10-08 10:28:26,731 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:26,731 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:26.731716+07:00
2025-10-08 10:28:26,732 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:26.731716+07:00
2025-10-08 10:28:26,735 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:26.731716+07:00 trong DST: True
2025-10-08 10:28:26,751 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:26,752 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:26,752 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:26,753 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:26,753 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:26,754 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '1500', 'price': 4040.15, 'distance_pips': 0.6}, {'level': '1525', 'price': 4040.153, 'distance_pips': 0.35}, {'level': '1550', 'price': 4040.155, 'distance_pips': 0.1}, {'level': '1575', 'price': 4040.158, 'distance_pips': 0.15}]
2025-10-08 10:28:26,754 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:28:26,755 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:26,755 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:26,755 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:26,756 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.156
2025-10-08 10:28:26,757 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:26,757 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:26,758 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:26,758 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:26,758 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:26,759 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4040.156
2025-10-08 10:28:26,759 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:26,760 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:26,760 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:26,761 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:26,761 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:26,762 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4040.156
2025-10-08 10:28:26,763 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:26,765 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:26,766 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:26,788 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:26,789 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:26,790 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.156
2025-10-08 10:28:26,791 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:26,791 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:26,792 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:26,792 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:26,793 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:26,793 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:26,793 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:26,794 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:26,794 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:26,820 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:26,821 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:26,822 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:26,823 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:26,823 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:26,824 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:26,825 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:26,826 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:26,827 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:26,828 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:26,829 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:26,852 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:26,852 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:26,853 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:26,853 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:26,854 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:26,854 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:26,855 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:26,855 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:26,856 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:26,857 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:26,860 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:26,865 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:26,866 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:26,880 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4040.156, 'ask': 4040.193, 'last': 0.0, 'time': 1759919305}
2025-10-08 10:28:26,883 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:26,884 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:26,884 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:26,884 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:26,885 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:26,885 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:26,886 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:26,886 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:26,887 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:26,887 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:26,887 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4040.156
2025-10-08 10:28:26,891 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44157.9999999999}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99275.00000000009}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27605.999999999767}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45726.99999999986}]
2025-10-08 10:28:26,911 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:26,952 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:26,953 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:26,954 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:26,974 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:26,976 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:27,056 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:27,058 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:27,058 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:27,059 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:27,060 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:27,061 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:27,063 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:27,064 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:27,067 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:27,067 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:27,068 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:27,068 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:27,069 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:27,077 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:27,570 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:27,571 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:27,572 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:27,573 - APP.services.mt5_service - DEBUG - Current price (cp): 4040.039
2025-10-08 10:28:27,576 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 236, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:27,604 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:27,606 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:27,606 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:27,609 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:27,609 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:27,610 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:27,610 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:27,624 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:27,627 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:27,627 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:27,628 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:27,630 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:27,630 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:27,631 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:27,631 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:27,633 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:27,634 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:27,634 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:27,635 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:27,637 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:27,638 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:27,639 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:27,639 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:27,640 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:27,640 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:27,641 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:27.641297+07:00
2025-10-08 10:28:27,641 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:27.641297+07:00
2025-10-08 10:28:27,661 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:27.641297+07:00 trong DST: True
2025-10-08 10:28:27,662 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:27,663 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:27,664 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:27,665 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:27,666 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:27,667 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:27,668 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:27,671 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:27,672 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:27,672 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:27,673 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:27,691 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:27,692 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:27,693 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:27,693 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:27,694 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:27,694 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:27,694 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:27,695 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:27,695 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:27,696 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:27,696 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:27,697 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:27,697 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:27,698 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:27,698 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:27,699 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:27,699 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:27,699 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:27,700 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:27,700 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:27,701 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:27,702 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:27,703 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:27,703 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:27,704 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4040.039, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:27,704 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:27,711 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:27,717 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:27,722 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:27,723 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 44041.00000000017
2025-10-08 10:28:27,724 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 99158.00000000035
2025-10-08 10:28:27,725 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27489.000000000033
2025-10-08 10:28:27,726 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45610.000000000124
2025-10-08 10:28:27,726 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:27,727 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44041.00000000017}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99158.00000000035}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27489.000000000033}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45610.000000000124}]
2025-10-08 10:28:27,727 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:27,728 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:27,728 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:27,729 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:27,729 - APP.services.mt5_service - DEBUG - Position in day range: 0.9906997500892586
2025-10-08 10:28:27,729 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:27,730 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:27.730410+07:00
2025-10-08 10:28:27,730 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:27.730410+07:00
2025-10-08 10:28:27,731 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:27.730410+07:00 trong DST: True
2025-10-08 10:28:27,731 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:27,732 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:27,732 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:27,733 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:27,734 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:27,734 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '300', 'price': 4040.03, 'distance_pips': 0.9}, {'level': '325', 'price': 4040.033, 'distance_pips': 0.65}, {'level': '350', 'price': 4040.035, 'distance_pips': 0.4}, {'level': '375', 'price': 4040.038, 'distance_pips': 0.15}]
2025-10-08 10:28:27,735 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:28:27,735 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:27,735 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:27,741 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:27,743 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.039
2025-10-08 10:28:27,749 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:27,751 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:27,754 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:27,755 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:27,756 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:27,756 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4040.039
2025-10-08 10:28:27,757 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:27,757 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:27,758 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:27,758 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:27,759 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:27,759 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4040.039
2025-10-08 10:28:27,760 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:27,760 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:27,761 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:27,762 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:27,762 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:27,763 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.039
2025-10-08 10:28:27,763 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:27,764 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:27,765 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:27,765 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:27,766 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:27,766 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:27,766 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:27,767 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:27,767 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:27,771 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:27,772 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:27,774 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:27,780 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:27,788 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:27,789 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:27,790 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:27,790 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:27,790 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:27,791 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:27,792 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:27,792 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:27,793 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:27,793 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:27,794 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:27,794 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:27,795 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:27,795 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:27,797 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:27,804 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:27,823 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:27,825 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:27,826 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:27,827 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:27,827 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4040.039, 'ask': 4040.076, 'last': 0.0, 'time': 1759919307}
2025-10-08 10:28:27,830 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:27,830 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:27,836 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:27,837 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:27,843 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:27,849 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:27,849 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:27,850 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:27,851 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:27,852 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:27,852 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4040.039
2025-10-08 10:28:27,852 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44041.00000000017}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99158.00000000035}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27489.000000000033}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45610.000000000124}]
2025-10-08 10:28:27,853 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:27,919 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:27,920 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:27,921 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:27,923 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:27,924 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:28,059 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:28,062 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:28,062 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:28,063 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:28,065 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:28,065 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:28,068 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:28,068 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:28,073 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:28,074 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:28,075 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:28,075 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:28,076 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:28,126 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:28,577 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:28,578 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:28,579 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:28,579 - APP.services.mt5_service - DEBUG - Current price (cp): 4040.039
2025-10-08 10:28:28,583 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 236, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:28,610 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:28,613 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:28,614 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:28,616 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:28,616 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:28,616 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:28,617 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:28,620 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:28,620 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:28,621 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:28,621 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:28,623 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:28,623 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:28,623 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:28,624 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:28,626 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:28,626 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:28,627 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:28,627 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:28,629 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:28,630 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:28,630 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:28,630 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:28,631 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:28,631 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:28,631 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:28.631762+07:00
2025-10-08 10:28:28,632 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:28.631762+07:00
2025-10-08 10:28:28,632 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:28.631762+07:00 trong DST: True
2025-10-08 10:28:28,633 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:28,633 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:28,634 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:28,635 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:28,635 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:28,636 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:28,636 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:28,640 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:28,641 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:28,641 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:28,660 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:28,660 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:28,661 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:28,662 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:28,662 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:28,663 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:28,663 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:28,663 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:28,664 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:28,664 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:28,664 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:28,665 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:28,665 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:28,666 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:28,666 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:28,666 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:28,667 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:28,667 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:28,668 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:28,668 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:28,669 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:28,669 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:28,671 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:28,673 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:28,693 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:28,694 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4040.039, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:28,694 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:28,695 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:28,695 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:28,696 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:28,696 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 44041.00000000017
2025-10-08 10:28:28,697 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 99158.00000000035
2025-10-08 10:28:28,697 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27489.000000000033
2025-10-08 10:28:28,697 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45610.000000000124
2025-10-08 10:28:28,698 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:28,698 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44041.00000000017}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99158.00000000035}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27489.000000000033}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45610.000000000124}]
2025-10-08 10:28:28,699 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:28,699 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:28,700 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:28,700 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:28,701 - APP.services.mt5_service - DEBUG - Position in day range: 0.9906997500892586
2025-10-08 10:28:28,701 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:28,704 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:28.704256+07:00
2025-10-08 10:28:28,704 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:28.704256+07:00
2025-10-08 10:28:28,719 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:28.704256+07:00 trong DST: True
2025-10-08 10:28:28,720 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:28,720 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:28,721 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:28,721 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:28,722 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:28,722 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '300', 'price': 4040.03, 'distance_pips': 0.9}, {'level': '325', 'price': 4040.033, 'distance_pips': 0.65}, {'level': '350', 'price': 4040.035, 'distance_pips': 0.4}, {'level': '375', 'price': 4040.038, 'distance_pips': 0.15}]
2025-10-08 10:28:28,722 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:28:28,723 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:28,723 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:28,723 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:28,724 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.039
2025-10-08 10:28:28,725 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:28,725 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:28,726 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:28,726 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:28,727 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:28,727 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4040.039
2025-10-08 10:28:28,728 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:28,728 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:28,729 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:28,729 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:28,730 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:28,730 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4040.039
2025-10-08 10:28:28,731 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:28,731 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:28,732 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:28,732 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:28,734 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:28,735 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.039
2025-10-08 10:28:28,757 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:28,758 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:28,760 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:28,760 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:28,761 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:28,761 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:28,761 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:28,761 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:28,762 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:28,762 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:28,762 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:28,763 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:28,763 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:28,763 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:28,764 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:28,767 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:28,787 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:28,788 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:28,788 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:28,789 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:28,789 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:28,790 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:28,790 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:28,791 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:28,791 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:28,792 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:28,792 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:28,793 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:28,793 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:28,821 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:28,822 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:28,823 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:28,823 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:28,826 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:28,828 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4040.039, 'ask': 4040.076, 'last': 0.0, 'time': 1759919307}
2025-10-08 10:28:28,829 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:28,845 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:28,846 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:28,847 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:28,847 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:28,848 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:28,848 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:28,848 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:28,849 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:28,849 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4040.039
2025-10-08 10:28:28,849 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44041.00000000017}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99158.00000000035}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27489.000000000033}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45610.000000000124}]
2025-10-08 10:28:28,850 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:28,922 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:28,922 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:28,923 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:28,924 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:28,925 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:29,063 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:29,066 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:29,066 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:29,067 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:29,069 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:29,069 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:29,073 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:29,074 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:29,086 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:29,098 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:29,100 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:29,100 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:29,101 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:29,134 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:29,602 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:29,604 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:29,604 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:29,605 - APP.services.mt5_service - DEBUG - Current price (cp): 4040.015
2025-10-08 10:28:29,608 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 235, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:29,636 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:29,639 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:29,640 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:29,649 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:29,658 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:29,659 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:29,659 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:29,662 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:29,662 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:29,662 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:29,663 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:29,665 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:29,665 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:29,666 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:29,666 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:29,668 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:29,668 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:29,668 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:29,669 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:29,673 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:29,686 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:29,693 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:29,693 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:29,694 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:29,694 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:29,695 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:29.695223+07:00
2025-10-08 10:28:29,695 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:29.695223+07:00
2025-10-08 10:28:29,695 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:29.695223+07:00 trong DST: True
2025-10-08 10:28:29,696 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:29,696 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:29,697 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:29,698 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:29,699 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:29,700 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:29,701 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:29,704 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:29,705 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:29,723 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:29,723 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:29,724 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:29,724 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:29,724 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:29,725 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:29,725 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:29,726 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:29,726 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:29,726 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:29,727 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:29,727 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:29,727 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:29,728 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:29,728 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:29,728 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:29,729 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:29,730 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:29,730 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:29,731 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:29,731 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:29,732 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:29,732 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:29,733 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:29,735 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:29,735 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:29,735 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4040.015, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:29,736 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:29,747 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:29,758 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:29,760 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:29,760 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 44016.999999999825
2025-10-08 10:28:29,761 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 99134.00000000001
2025-10-08 10:28:29,761 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27464.99999999969
2025-10-08 10:28:29,762 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45585.99999999978
2025-10-08 10:28:29,762 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:29,763 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44016.999999999825}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99134.00000000001}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27464.99999999969}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45585.99999999978}]
2025-10-08 10:28:29,763 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:29,764 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:29,764 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:29,766 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:29,766 - APP.services.mt5_service - DEBUG - Position in day range: 0.9902713316672603
2025-10-08 10:28:29,767 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:29,769 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:29.767888+07:00
2025-10-08 10:28:29,784 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:29.767888+07:00
2025-10-08 10:28:29,785 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:29.767888+07:00 trong DST: True
2025-10-08 10:28:29,786 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:29,786 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:29,787 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:29,787 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:29,787 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:29,788 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '100', 'price': 4040.01, 'distance_pips': 0.5}, {'level': '125', 'price': 4040.013, 'distance_pips': 0.25}, {'level': '150', 'price': 4040.015, 'distance_pips': 0.0}, {'level': '175', 'price': 4040.018, 'distance_pips': 0.25}]
2025-10-08 10:28:29,788 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:28:29,789 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:29,789 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:29,789 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:29,790 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.015
2025-10-08 10:28:29,790 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:29,791 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:29,791 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:29,792 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:29,792 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:29,793 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4040.015
2025-10-08 10:28:29,794 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:29,794 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:29,800 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:29,819 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:29,820 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:29,821 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4040.015
2025-10-08 10:28:29,822 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:29,822 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:29,823 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:29,824 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:29,825 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:29,825 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.015
2025-10-08 10:28:29,828 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:29,831 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:29,851 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:29,851 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:29,852 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:29,852 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:29,853 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:29,853 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:29,853 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:29,853 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:29,854 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:29,854 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:29,854 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:29,855 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:29,855 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:29,855 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:29,856 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:29,856 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:29,856 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:29,857 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:29,859 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:29,860 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:29,883 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:29,883 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:29,884 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:29,884 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:29,885 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:29,885 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:29,886 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:29,887 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:29,889 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:29,889 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:29,891 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:29,913 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:29,914 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4040.015, 'ask': 4040.052, 'last': 0.0, 'time': 1759919309}
2025-10-08 10:28:29,914 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:29,915 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:29,915 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:29,915 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:29,916 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:29,916 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:29,917 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:29,917 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:29,917 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:29,918 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4040.015
2025-10-08 10:28:29,918 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44016.999999999825}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99134.00000000001}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27464.99999999969}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45585.99999999978}]
2025-10-08 10:28:29,919 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:29,984 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:29,985 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:29,985 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:29,986 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:29,988 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:30,068 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:30,070 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:30,070 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:30,071 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:30,073 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:30,074 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:30,078 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:30,079 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:30,101 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:30,102 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:30,102 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:30,103 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:30,103 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:30,197 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:30,604 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:30,606 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:30,607 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:30,607 - APP.services.mt5_service - DEBUG - Current price (cp): 4039.98
2025-10-08 10:28:30,610 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 236, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:30,639 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:30,641 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:30,641 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:30,643 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:30,644 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:30,644 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:30,645 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:30,648 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:30,649 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:30,649 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:30,650 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:30,651 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:30,652 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:30,652 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:30,653 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:30,655 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:30,655 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:30,656 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:30,656 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:30,659 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:30,659 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:30,660 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:30,660 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:30,661 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:30,662 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:30,662 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:30.662410+07:00
2025-10-08 10:28:30,662 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:30.662410+07:00
2025-10-08 10:28:30,663 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:30.662410+07:00 trong DST: True
2025-10-08 10:28:30,663 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:30,663 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:30,664 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:30,665 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:30,666 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:30,667 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:30,667 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:30,671 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:30,673 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:30,688 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:30,689 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:30,689 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:30,689 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:30,690 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:30,690 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:30,691 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:30,691 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:30,691 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:30,691 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:30,692 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:30,692 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:30,693 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:30,693 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:30,693 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:30,694 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:30,694 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:30,695 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:30,695 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:30,696 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:30,696 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:30,697 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:30,697 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:30,697 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:30,698 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:30,698 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:30,699 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4039.98, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:30,699 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:30,699 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:30,700 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:30,700 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:30,701 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 43981.99999999997
2025-10-08 10:28:30,703 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 99099.00000000016
2025-10-08 10:28:30,725 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27429.999999999836
2025-10-08 10:28:30,725 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45550.99999999993
2025-10-08 10:28:30,726 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:30,727 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43981.99999999997}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99099.00000000016}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27429.999999999836}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45550.99999999993}]
2025-10-08 10:28:30,727 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:30,728 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:30,728 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:30,728 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:30,729 - APP.services.mt5_service - DEBUG - Position in day range: 0.9896465548018578
2025-10-08 10:28:30,729 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:30,729 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:30.729909+07:00
2025-10-08 10:28:30,730 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:30.729909+07:00
2025-10-08 10:28:30,730 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:30.729909+07:00 trong DST: True
2025-10-08 10:28:30,731 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:30,731 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:30,731 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:30,734 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:30,734 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:30,735 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '9800', 'price': 4039.98, 'distance_pips': 0.0}, {'level': '9825', 'price': 4039.983, 'distance_pips': 0.25}, {'level': '9850', 'price': 4039.985, 'distance_pips': 0.5}, {'level': '9875', 'price': 4039.988, 'distance_pips': 0.75}]
2025-10-08 10:28:30,735 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:28:30,754 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:30,754 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:30,755 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:30,756 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.98
2025-10-08 10:28:30,756 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:30,757 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:30,758 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:30,758 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:30,758 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:30,759 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4039.98
2025-10-08 10:28:30,760 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:30,760 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:30,761 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:30,762 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:30,762 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:30,763 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4039.98
2025-10-08 10:28:30,763 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:30,764 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:30,765 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:30,766 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:30,766 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:30,767 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.98
2025-10-08 10:28:30,790 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:30,791 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:30,792 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:30,792 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:30,793 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:30,793 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:30,793 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:30,794 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:30,818 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:30,819 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:30,821 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:30,821 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:30,822 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:30,822 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:30,823 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:30,823 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:30,823 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:30,824 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:30,824 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:30,824 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:30,825 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:30,825 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:30,829 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:30,829 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:30,851 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:30,851 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:30,852 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:30,852 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:30,853 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:30,854 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:30,855 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:30,856 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:30,856 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:30,856 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4039.98, 'ask': 4040.017, 'last': 0.0, 'time': 1759919310}
2025-10-08 10:28:30,881 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:30,882 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:30,882 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:30,883 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:30,883 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:30,883 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:30,884 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:30,884 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:30,885 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:30,885 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:30,887 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4039.98
2025-10-08 10:28:30,887 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43981.99999999997}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99099.00000000016}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27429.999999999836}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45550.99999999993}]
2025-10-08 10:28:30,888 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:30,955 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:30,956 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:30,957 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:30,959 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:30,960 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:31,072 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:31,074 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:31,074 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:31,075 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:31,077 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:31,079 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:31,084 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:31,101 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:31,105 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:31,106 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:31,107 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:31,109 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:31,110 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:31,161 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:31,611 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:31,613 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:31,613 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:31,614 - APP.services.mt5_service - DEBUG - Current price (cp): 4039.412
2025-10-08 10:28:31,617 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 235, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:31,646 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:31,650 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:31,650 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:31,652 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:31,653 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:31,653 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:31,654 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:31,657 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:31,657 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:31,657 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:31,658 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:31,660 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:31,660 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:31,660 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:31,661 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:31,663 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:31,664 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:31,664 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:31,664 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:31,667 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:31,667 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:31,668 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:31,668 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:31,668 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:31,669 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:31,670 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:31.670369+07:00
2025-10-08 10:28:31,671 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:31.670369+07:00
2025-10-08 10:28:31,672 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:31.670369+07:00 trong DST: True
2025-10-08 10:28:31,673 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:31,673 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:31,674 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:31,695 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:31,696 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:31,697 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:31,698 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:31,700 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:31,700 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:31,703 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:31,703 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:31,706 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:31,707 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:31,708 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:31,712 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:31,715 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:31,717 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:31,721 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:31,722 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:31,723 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:31,723 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:31,723 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:31,724 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:31,724 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:31,724 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:31,725 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:31,725 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:31,726 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:31,726 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:31,727 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:31,727 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:31,728 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:31,728 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:31,728 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:31,729 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:31,729 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4039.412, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:31,730 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:31,730 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:31,730 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:31,731 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:31,731 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 43413.99999999976
2025-10-08 10:28:31,731 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 98530.99999999994
2025-10-08 10:28:31,732 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 26861.999999999625
2025-10-08 10:28:31,732 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 44982.999999999716
2025-10-08 10:28:31,732 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:31,734 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43413.99999999976}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98530.99999999994}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26861.999999999625}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44982.999999999716}]
2025-10-08 10:28:31,735 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:31,741 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:31,747 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:31,749 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:31,752 - APP.services.mt5_service - DEBUG - Position in day range: 0.9795073188147065
2025-10-08 10:28:31,756 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:31,758 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:31.757941+07:00
2025-10-08 10:28:31,758 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:31.757941+07:00
2025-10-08 10:28:31,759 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:31.757941+07:00 trong DST: True
2025-10-08 10:28:31,759 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:31,759 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:31,760 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:31,760 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:31,760 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:31,761 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4100', 'price': 4039.41, 'distance_pips': 0.2}, {'level': '4125', 'price': 4039.413, 'distance_pips': 0.05}, {'level': '4150', 'price': 4039.415, 'distance_pips': 0.3}, {'level': '4175', 'price': 4039.418, 'distance_pips': 0.55}]
2025-10-08 10:28:31,761 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:28:31,761 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:31,762 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:31,762 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:31,762 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.412
2025-10-08 10:28:31,763 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:31,763 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:31,765 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:31,766 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:31,767 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:31,774 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4039.412
2025-10-08 10:28:31,784 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:31,785 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:31,786 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:31,787 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:31,787 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:31,788 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4039.412
2025-10-08 10:28:31,788 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:31,789 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:31,789 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:31,790 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:31,791 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:31,792 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.412
2025-10-08 10:28:31,792 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:31,793 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:31,793 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:31,794 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:31,794 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:31,795 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:31,795 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:31,795 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:31,797 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:31,798 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:31,798 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:31,799 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:31,802 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:31,805 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:31,806 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:31,807 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:31,813 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:31,814 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:31,816 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:31,819 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:31,822 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:31,823 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:31,823 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:31,824 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:31,824 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:31,825 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:31,825 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:31,825 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:31,826 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:31,827 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:31,829 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:31,830 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:31,832 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:31,836 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4039.412, 'ask': 4039.449, 'last': 0.0, 'time': 1759919311}
2025-10-08 10:28:31,840 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:31,842 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:31,843 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:31,845 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:31,848 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:31,850 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:31,852 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:31,853 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:31,853 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:31,853 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:31,854 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4039.412
2025-10-08 10:28:31,854 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43413.99999999976}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98530.99999999994}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26861.999999999625}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44982.999999999716}]
2025-10-08 10:28:31,855 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:31,953 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:31,954 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:31,954 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:31,955 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:31,956 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:32,075 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:32,078 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:32,078 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:32,079 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:32,081 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:32,082 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:32,085 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:32,085 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:32,089 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:32,089 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:32,090 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:32,090 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:32,091 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:32,157 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:32,592 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:32,593 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:32,594 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:32,594 - APP.services.mt5_service - DEBUG - Current price (cp): 4039.412
2025-10-08 10:28:32,598 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 237, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:32,627 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:32,631 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:32,632 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:32,635 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:32,635 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:32,635 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:32,636 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:32,640 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:32,641 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:32,642 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:32,644 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:32,662 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:32,662 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:32,662 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:32,663 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:32,665 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:32,666 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:32,666 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:32,666 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:32,669 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:32,669 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:32,670 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:32,670 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:32,672 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:32,672 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:32,672 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:32.672910+07:00
2025-10-08 10:28:32,673 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:32.672910+07:00
2025-10-08 10:28:32,674 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:32.672910+07:00 trong DST: True
2025-10-08 10:28:32,691 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:32,692 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:32,693 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:32,694 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:32,694 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:32,695 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:32,696 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:32,698 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:32,698 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:32,699 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:32,699 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:32,700 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:32,700 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:32,700 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:32,701 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:32,701 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:32,703 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:32,704 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:32,704 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:32,714 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:32,717 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:32,720 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:32,721 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:32,722 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:32,723 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:32,723 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:32,724 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:32,724 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:32,725 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:32,725 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:32,725 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:32,726 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:32,726 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:32,726 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:32,727 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:32,727 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4039.412, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:32,727 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:32,728 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:32,728 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:32,728 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:32,729 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 43413.99999999976
2025-10-08 10:28:32,730 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 98530.99999999994
2025-10-08 10:28:32,730 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 26861.999999999625
2025-10-08 10:28:32,731 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 44982.999999999716
2025-10-08 10:28:32,731 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:32,731 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43413.99999999976}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98530.99999999994}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26861.999999999625}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44982.999999999716}]
2025-10-08 10:28:32,732 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:32,734 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:32,735 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:32,742 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:32,746 - APP.services.mt5_service - DEBUG - Position in day range: 0.9795073188147065
2025-10-08 10:28:32,757 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:32,757 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:32.757847+07:00
2025-10-08 10:28:32,758 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:32.757847+07:00
2025-10-08 10:28:32,758 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:32.757847+07:00 trong DST: True
2025-10-08 10:28:32,759 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:32,759 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:32,760 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:32,760 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:32,760 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:32,761 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4100', 'price': 4039.41, 'distance_pips': 0.2}, {'level': '4125', 'price': 4039.413, 'distance_pips': 0.05}, {'level': '4150', 'price': 4039.415, 'distance_pips': 0.3}, {'level': '4175', 'price': 4039.418, 'distance_pips': 0.55}]
2025-10-08 10:28:32,761 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:28:32,761 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:32,762 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:32,762 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:32,763 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.412
2025-10-08 10:28:32,764 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:32,765 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:32,766 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:32,825 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:32,851 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:32,902 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4039.412
2025-10-08 10:28:32,912 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:32,967 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:33,001 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:33,082 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:33,083 - APP.ui.components.chart_tab - DEBUG - Worker thông tin vẫn đang chạy, bỏ qua.
2025-10-08 10:28:33,135 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:33,136 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:33,137 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:33,138 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4039.412
2025-10-08 10:28:33,142 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:33,143 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:33,144 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:33,144 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:33,147 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:33,148 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:33,148 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:33,149 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:33,150 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:33,151 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.412
2025-10-08 10:28:33,151 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:33,152 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:33,152 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:33,153 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:33,153 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:33,153 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:33,154 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:33,154 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:33,155 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:33,155 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:33,156 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:33,156 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:33,156 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:33,157 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:33,157 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:33,157 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:33,169 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:33,172 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:33,197 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:33,198 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:33,290 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:33,376 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:33,390 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:33,453 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:33,510 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:33,555 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:33,556 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:33,557 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:33,564 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:33,578 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:33,600 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:33,602 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:33,604 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:33,604 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:33,605 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4039.412, 'ask': 4039.449, 'last': 0.0, 'time': 1759919312}
2025-10-08 10:28:33,635 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:33,637 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:33,639 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:33,641 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:33,665 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:33,666 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:33,668 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:33,669 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:33,673 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:33,697 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:33,699 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4039.412
2025-10-08 10:28:33,700 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43413.99999999976}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98530.99999999994}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26861.999999999625}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44982.999999999716}]
2025-10-08 10:28:33,704 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:33,835 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:33,835 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:33,836 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:33,836 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:33,838 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:34,138 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:34,140 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:34,141 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:34,141 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:34,143 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:34,144 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:34,148 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:34,165 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:34,169 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:34,170 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:34,172 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:34,173 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:34,173 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:34,243 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:34,675 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:34,677 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:34,677 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:34,678 - APP.services.mt5_service - DEBUG - Current price (cp): 4039.361
2025-10-08 10:28:34,682 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 237, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:34,715 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:34,717 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:34,719 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:34,721 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:34,722 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:34,722 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:34,724 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:34,727 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:34,728 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:34,730 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:34,732 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:34,737 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:34,761 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:34,762 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:34,763 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:34,766 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:34,792 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:34,793 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:34,793 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:34,824 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:34,825 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:34,825 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:34,852 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:34,853 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:34,854 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:34,854 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:34.854581+07:00
2025-10-08 10:28:34,855 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:34.854581+07:00
2025-10-08 10:28:34,855 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:34.854581+07:00 trong DST: True
2025-10-08 10:28:34,856 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:34,856 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:34,857 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:34,860 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:34,886 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:34,888 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:34,911 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:34,915 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:34,915 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:34,916 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:34,917 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:34,917 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:34,918 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:34,919 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:34,919 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:34,919 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:34,920 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:34,950 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:34,952 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:34,976 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:34,977 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:34,978 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:34,978 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:34,978 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:34,979 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:34,979 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:34,980 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:34,980 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:34,981 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:34,981 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:34,982 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:35,008 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:35,009 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:35,010 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:35,010 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:35,011 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4039.361, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:35,011 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:35,011 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:35,012 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:35,012 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:35,013 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 43362.999999999825
2025-10-08 10:28:35,014 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 98480.00000000001
2025-10-08 10:28:35,016 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 26810.999999999694
2025-10-08 10:28:35,016 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 44931.99999999979
2025-10-08 10:28:35,017 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:35,037 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43362.999999999825}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98480.00000000001}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26810.999999999694}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44931.99999999979}]
2025-10-08 10:28:35,038 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:35,040 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:35,041 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:35,042 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:35,042 - APP.services.mt5_service - DEBUG - Position in day range: 0.9785969296679745
2025-10-08 10:28:35,043 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:35,043 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:35.043722+07:00
2025-10-08 10:28:35,044 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:35.043722+07:00
2025-10-08 10:28:35,045 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:35.043722+07:00 trong DST: True
2025-10-08 10:28:35,072 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:35,073 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:35,074 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:35,074 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:35,074 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:35,075 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '3600', 'price': 4039.36, 'distance_pips': 0.1}, {'level': '3625', 'price': 4039.363, 'distance_pips': 0.15}, {'level': '3650', 'price': 4039.365, 'distance_pips': 0.4}, {'level': '3675', 'price': 4039.368, 'distance_pips': 0.65}]
2025-10-08 10:28:35,075 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:28:35,076 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:35,100 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:35,102 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:35,103 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.361
2025-10-08 10:28:35,104 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:35,104 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:35,106 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:35,106 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:35,107 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:35,138 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4039.361
2025-10-08 10:28:35,139 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:35,145 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:35,146 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:35,169 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:35,169 - APP.ui.components.chart_tab - DEBUG - Worker thông tin vẫn đang chạy, bỏ qua.
2025-10-08 10:28:35,178 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:35,195 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:35,196 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:35,198 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4039.361
2025-10-08 10:28:35,199 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:35,200 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:35,200 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:35,201 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:35,204 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:35,206 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:35,226 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:35,227 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:35,227 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:35,228 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.361
2025-10-08 10:28:35,229 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:35,229 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:35,231 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:35,231 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:35,232 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:35,232 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:35,233 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:35,234 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:35,234 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:35,235 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:35,257 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:35,259 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:35,259 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:35,260 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:35,261 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:35,262 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:35,262 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:35,263 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:35,298 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:35,299 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:35,320 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:35,323 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:35,324 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:35,324 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:35,325 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:35,325 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:35,325 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:35,326 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:35,329 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:35,343 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:35,357 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:35,388 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:35,430 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4039.361, 'ask': 4039.398, 'last': 0.0, 'time': 1759919314}
2025-10-08 10:28:35,432 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:35,435 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:35,464 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:35,527 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:35,633 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:35,634 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:35,634 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:35,635 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:35,635 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:35,635 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:35,636 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:35,636 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:35,636 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4039.361
2025-10-08 10:28:35,637 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43362.999999999825}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98480.00000000001}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26810.999999999694}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44931.99999999979}]
2025-10-08 10:28:35,637 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:35,826 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:35,826 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:35,827 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:35,828 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:35,829 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:36,198 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:36,201 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:36,201 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:36,202 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:36,204 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:36,204 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:36,207 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:36,218 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:36,227 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:36,228 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:36,229 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:36,230 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:36,231 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:36,231 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:36,732 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:36,734 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:36,734 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:36,735 - APP.services.mt5_service - DEBUG - Current price (cp): 4039.255
2025-10-08 10:28:36,739 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 239, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:36,767 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:36,771 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:36,772 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:36,774 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:36,774 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:36,775 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:36,775 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:36,779 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:36,779 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:36,779 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:36,780 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:36,782 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:36,782 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:36,782 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:36,783 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:36,785 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:36,785 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:36,785 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:36,786 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:36,788 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:36,789 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:36,789 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:36,790 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:36,790 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:36,791 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:36,791 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:36.791418+07:00
2025-10-08 10:28:36,792 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:36.791418+07:00
2025-10-08 10:28:36,793 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:36.791418+07:00 trong DST: True
2025-10-08 10:28:36,793 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:36,793 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:36,794 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:36,795 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:36,797 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:36,801 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:36,822 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:36,825 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:36,826 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:36,828 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:36,829 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:36,834 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:36,849 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:36,850 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:36,850 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:36,851 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:36,851 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:36,852 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:36,852 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:36,852 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:36,853 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:36,853 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:36,853 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:36,854 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:36,854 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:36,855 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:36,855 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:36,856 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:36,856 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:36,857 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:36,857 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:36,860 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:36,861 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:36,881 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:36,882 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:36,882 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4039.255, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:36,882 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:36,883 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:36,883 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:36,883 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:36,884 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 43257.00000000006
2025-10-08 10:28:36,884 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 98374.00000000025
2025-10-08 10:28:36,884 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 26704.999999999927
2025-10-08 10:28:36,885 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 44826.00000000002
2025-10-08 10:28:36,885 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:36,885 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43257.00000000006}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98374.00000000025}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26704.999999999927}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44826.00000000002}]
2025-10-08 10:28:36,886 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:36,886 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:36,888 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:36,888 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:36,889 - APP.services.mt5_service - DEBUG - Position in day range: 0.97670474830418
2025-10-08 10:28:36,889 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:36,890 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:36.890782+07:00
2025-10-08 10:28:36,891 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:36.890782+07:00
2025-10-08 10:28:36,892 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:36.890782+07:00 trong DST: True
2025-10-08 10:28:36,910 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:36,911 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:36,911 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:36,912 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:36,912 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:36,913 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '2500', 'price': 4039.25, 'distance_pips': 0.5}, {'level': '2525', 'price': 4039.253, 'distance_pips': 0.25}, {'level': '2550', 'price': 4039.255, 'distance_pips': 0.0}, {'level': '2575', 'price': 4039.258, 'distance_pips': 0.25}]
2025-10-08 10:28:36,913 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:28:36,913 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:36,914 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:36,914 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:36,915 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.255
2025-10-08 10:28:36,915 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:36,916 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:36,916 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:36,917 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:36,917 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:36,918 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4039.255
2025-10-08 10:28:36,918 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:36,919 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:36,919 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:36,920 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:36,920 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:36,922 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4039.255
2025-10-08 10:28:36,923 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:36,923 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:36,926 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:36,935 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:36,941 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:36,944 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.255
2025-10-08 10:28:36,944 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:36,945 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:36,945 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:36,946 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:36,946 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:36,947 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:36,947 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:36,947 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:36,947 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:36,948 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:36,948 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:36,948 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:36,949 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:36,949 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:36,949 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:36,950 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:36,950 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:36,950 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:36,951 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:36,953 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:36,953 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:36,953 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:36,954 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:36,975 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:36,975 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:36,976 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:36,976 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:36,977 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:36,978 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:36,978 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:36,980 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:36,980 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:36,981 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:36,981 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4039.255, 'ask': 4039.292, 'last': 0.0, 'time': 1759919316}
2025-10-08 10:28:36,984 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:36,985 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:36,985 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:37,005 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:37,005 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:37,006 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:37,006 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:37,007 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:37,007 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:37,008 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:37,008 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4039.255
2025-10-08 10:28:37,008 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43257.00000000006}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98374.00000000025}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26704.999999999927}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44826.00000000002}]
2025-10-08 10:28:37,009 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:37,011 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:37,012 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:37,012 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:37,013 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:37,015 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:37,203 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:37,205 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:37,205 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:37,206 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:37,208 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:37,210 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:37,220 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:37,234 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:37,234 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:37,236 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:37,237 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:37,257 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:37,257 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:37,331 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:37,760 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:37,761 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:37,762 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:37,762 - APP.services.mt5_service - DEBUG - Current price (cp): 4039.422
2025-10-08 10:28:37,766 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 240, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:37,795 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:37,803 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:37,804 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:37,807 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:37,808 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:37,809 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:37,809 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:37,812 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:37,813 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:37,814 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:37,814 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:37,816 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:37,817 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:37,817 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:37,817 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:37,820 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:37,821 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:37,821 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:37,822 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:37,824 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:37,824 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:37,825 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:37,825 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:37,826 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:37,826 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:37,826 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:37.826733+07:00
2025-10-08 10:28:37,829 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:37.826733+07:00
2025-10-08 10:28:37,829 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:37.826733+07:00 trong DST: True
2025-10-08 10:28:37,830 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:37,848 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:37,849 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:37,850 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:37,851 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:37,852 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:37,853 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:37,856 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:37,857 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:37,857 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:37,858 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:37,858 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:37,861 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:37,861 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:37,862 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:37,880 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:37,881 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:37,882 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:37,882 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:37,882 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:37,883 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:37,883 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:37,883 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:37,884 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:37,884 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:37,885 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:37,885 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:37,886 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:37,887 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:37,888 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:37,888 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:37,888 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:37,890 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:37,891 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:37,913 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:37,914 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4039.422, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:37,915 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:37,915 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:37,915 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:37,916 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:37,916 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 43423.99999999998
2025-10-08 10:28:37,917 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 98541.00000000016
2025-10-08 10:28:37,917 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 26871.999999999844
2025-10-08 10:28:37,917 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 44992.999999999935
2025-10-08 10:28:37,918 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:37,918 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43423.99999999998}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98541.00000000016}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26871.999999999844}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44992.999999999935}]
2025-10-08 10:28:37,919 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:37,920 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:37,922 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:37,922 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:37,923 - APP.services.mt5_service - DEBUG - Position in day range: 0.9796858264905405
2025-10-08 10:28:37,926 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:37,940 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:37.939964+07:00
2025-10-08 10:28:37,941 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:37.939964+07:00
2025-10-08 10:28:37,941 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:37.939964+07:00 trong DST: True
2025-10-08 10:28:37,942 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:37,942 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:37,943 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:37,943 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:37,944 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:37,944 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4200', 'price': 4039.42, 'distance_pips': 0.2}, {'level': '4225', 'price': 4039.423, 'distance_pips': 0.05}, {'level': '4250', 'price': 4039.425, 'distance_pips': 0.3}, {'level': '4275', 'price': 4039.428, 'distance_pips': 0.55}]
2025-10-08 10:28:37,945 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:28:37,945 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:37,946 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:37,946 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:37,947 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.422
2025-10-08 10:28:37,947 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:37,948 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:37,948 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:37,949 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:37,949 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:37,950 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4039.422
2025-10-08 10:28:37,951 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:37,951 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:37,953 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:37,954 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:37,955 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:37,957 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4039.422
2025-10-08 10:28:37,966 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:37,967 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:37,971 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:37,978 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:37,979 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:37,980 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.422
2025-10-08 10:28:37,980 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:37,981 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:37,981 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:37,982 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:37,982 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:37,985 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:38,007 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:38,008 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:38,008 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:38,009 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:38,010 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:38,010 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:38,010 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:38,011 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:38,011 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:38,012 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:38,012 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:38,012 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:38,013 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:38,013 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:38,013 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:38,015 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:38,016 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:38,017 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:38,035 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:38,037 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:38,038 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:38,038 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:38,039 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:38,040 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:38,041 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:38,042 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:38,042 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:38,042 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4039.422, 'ask': 4039.459, 'last': 0.0, 'time': 1759919317}
2025-10-08 10:28:38,045 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:38,047 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:38,048 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:38,048 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:38,069 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:38,069 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:38,070 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:38,070 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:38,071 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:38,071 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:38,071 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4039.422
2025-10-08 10:28:38,072 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43423.99999999998}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98541.00000000016}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26871.999999999844}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44992.999999999935}]
2025-10-08 10:28:38,072 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:38,102 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:38,103 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:38,103 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:38,105 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:38,106 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:38,206 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:38,208 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:38,209 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:38,209 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:38,211 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:38,212 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:38,215 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:38,215 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:38,219 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:38,219 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:38,220 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:38,221 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:38,221 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:38,311 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:38,723 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:38,724 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:38,725 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:38,725 - APP.services.mt5_service - DEBUG - Current price (cp): 4039.507
2025-10-08 10:28:38,729 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 241, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:38,759 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:38,763 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:38,764 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:38,775 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:38,784 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:38,784 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:38,785 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:38,788 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:38,788 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:38,789 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:38,789 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:38,792 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:38,792 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:38,793 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:38,793 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:38,797 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:38,821 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:38,824 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:38,825 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:38,837 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:38,850 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:38,851 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:38,852 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:38,852 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:38,852 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:38,853 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:38.853274+07:00
2025-10-08 10:28:38,853 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:38.853274+07:00
2025-10-08 10:28:38,854 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:38.853274+07:00 trong DST: True
2025-10-08 10:28:38,854 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:38,855 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:38,855 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:38,856 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:38,857 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:38,858 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:38,862 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:38,887 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:38,888 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:38,888 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:38,889 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:38,889 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:38,890 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:38,892 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:38,892 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:38,893 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:38,893 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:38,912 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:38,913 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:38,914 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:38,914 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:38,914 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:38,915 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:38,915 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:38,916 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:38,916 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:38,917 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:38,918 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:38,918 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:38,919 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:38,919 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:38,920 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:38,921 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:38,923 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:38,945 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:38,946 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4039.507, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:38,946 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:38,947 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:38,947 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:38,947 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:38,948 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 43509.000000000015
2025-10-08 10:28:38,948 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 98626.0000000002
2025-10-08 10:28:38,949 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 26956.99999999988
2025-10-08 10:28:38,949 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45077.99999999997
2025-10-08 10:28:38,949 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:38,950 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43509.000000000015}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98626.0000000002}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26956.99999999988}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45077.99999999997}]
2025-10-08 10:28:38,950 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:38,951 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:38,954 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:38,955 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:38,971 - APP.services.mt5_service - DEBUG - Position in day range: 0.9812031417350967
2025-10-08 10:28:38,971 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:38,971 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:38.971932+07:00
2025-10-08 10:28:38,972 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:38.971932+07:00
2025-10-08 10:28:38,972 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:38.971932+07:00 trong DST: True
2025-10-08 10:28:38,973 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:38,973 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:38,973 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:38,974 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:38,974 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:38,974 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '5000', 'price': 4039.5, 'distance_pips': 0.7}, {'level': '5025', 'price': 4039.503, 'distance_pips': 0.45}, {'level': '5050', 'price': 4039.505, 'distance_pips': 0.2}, {'level': '5075', 'price': 4039.508, 'distance_pips': 0.05}]
2025-10-08 10:28:38,975 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:28:38,975 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:38,976 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:38,976 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:38,977 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.507
2025-10-08 10:28:38,977 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:38,978 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:38,978 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:38,979 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:38,979 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:38,980 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4039.507
2025-10-08 10:28:38,980 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:38,980 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:38,981 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:38,982 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:38,982 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:38,983 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4039.507
2025-10-08 10:28:38,986 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:39,008 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:39,010 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:39,010 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:39,011 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:39,011 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.507
2025-10-08 10:28:39,012 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:39,012 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:39,013 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:39,015 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:39,016 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:39,017 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:39,038 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:39,039 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:39,039 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:39,040 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:39,041 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:39,041 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:39,041 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:39,042 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:39,042 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:39,043 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:39,043 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:39,043 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:39,044 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:39,044 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:39,045 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:39,045 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:39,048 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:39,072 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:39,073 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:39,074 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:39,074 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:39,075 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:39,076 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:39,077 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:39,104 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:39,105 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:39,105 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:39,105 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4039.507, 'ask': 4039.544, 'last': 0.0, 'time': 1759919318}
2025-10-08 10:28:39,108 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:39,111 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:39,131 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:39,132 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:39,132 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:39,133 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:39,133 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:39,134 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:39,134 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:39,135 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:39,135 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4039.507
2025-10-08 10:28:39,136 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43509.000000000015}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98626.0000000002}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26956.99999999988}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45077.99999999997}]
2025-10-08 10:28:39,136 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:39,173 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:39,173 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:39,193 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:39,194 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:39,195 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:39,249 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:39,257 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:39,258 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:39,258 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:39,261 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:39,261 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:39,264 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:39,288 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:39,295 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:39,295 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:39,296 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:39,298 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:39,317 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:39,318 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:39,829 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:39,834 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:39,835 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:39,835 - APP.services.mt5_service - DEBUG - Current price (cp): 4039.636
2025-10-08 10:28:39,841 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 238, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:39,874 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:28:39,877 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:39,879 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:39,879 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:28:39,879 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:39,883 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:39,883 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:39,884 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:39,884 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:39,888 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:39,888 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:39,889 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:39,918 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:39,921 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:39,922 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:39,922 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:39,944 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:39,947 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:39,947 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:39,948 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:39,948 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:39,951 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:39,951 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:39,952 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:39,991 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:39,992 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:39,992 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:39,993 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:39.992961+07:00
2025-10-08 10:28:39,993 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:39.992961+07:00
2025-10-08 10:28:39,994 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:39.992961+07:00 trong DST: True
2025-10-08 10:28:39,994 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:39,995 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:39,996 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:39,997 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:39,998 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:40,001 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:40,002 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:40,005 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:40,006 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:40,006 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:40,006 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:40,007 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:40,008 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:40,008 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:40,009 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:40,009 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:40,009 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:40,010 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:40,010 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:40,011 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:40,011 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:40,011 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:40,013 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:40,013 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:40,014 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:40,015 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:40,051 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:40,056 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:40,057 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:40,058 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:40,059 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:40,059 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:40,060 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:40,061 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:40,061 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:40,063 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4039.636, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:40,063 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:40,064 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:40,064 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:40,065 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:40,066 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 43637.99999999992
2025-10-08 10:28:40,066 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 98755.0000000001
2025-10-08 10:28:40,071 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27085.999999999785
2025-10-08 10:28:40,072 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45206.999999999876
2025-10-08 10:28:40,072 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:40,073 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43637.99999999992}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98755.0000000001}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27085.999999999785}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45206.999999999876}]
2025-10-08 10:28:40,073 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:40,074 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:40,075 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:40,075 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:40,076 - APP.services.mt5_service - DEBUG - Position in day range: 0.9835058907533027
2025-10-08 10:28:40,076 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:40,100 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:40.100447+07:00
2025-10-08 10:28:40,101 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:40.100447+07:00
2025-10-08 10:28:40,102 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:40.100447+07:00 trong DST: True
2025-10-08 10:28:40,103 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:40,103 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:40,106 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:40,107 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:40,111 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:40,137 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '6300', 'price': 4039.63, 'distance_pips': 0.6}, {'level': '6325', 'price': 4039.633, 'distance_pips': 0.35}, {'level': '6350', 'price': 4039.635, 'distance_pips': 0.1}, {'level': '6375', 'price': 4039.638, 'distance_pips': 0.15}]
2025-10-08 10:28:40,138 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:28:40,163 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:40,165 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:40,166 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:40,167 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.636
2025-10-08 10:28:40,169 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:40,170 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:40,199 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:40,200 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:40,204 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:40,232 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4039.636
2025-10-08 10:28:40,292 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:40,294 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:40,295 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:40,297 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:40,326 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:40,327 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4039.636
2025-10-08 10:28:40,336 - APP.ui.components.chart_tab - DEBUG - Worker thông tin vẫn đang chạy, bỏ qua.
2025-10-08 10:28:40,351 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:40,352 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:40,353 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:40,354 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:40,355 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:40,356 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:40,357 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:40,358 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.636
2025-10-08 10:28:40,388 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:40,414 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:40,415 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:40,416 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:40,417 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:40,419 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:40,459 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:40,459 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:40,460 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:40,461 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:40,461 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:40,462 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:40,462 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:40,464 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:40,464 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:40,465 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:40,465 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:40,466 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:40,466 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:40,466 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:40,467 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:40,467 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:40,467 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:40,468 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:40,468 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:40,468 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:40,469 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:40,469 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:40,470 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:40,470 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:40,471 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:40,471 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:40,472 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:40,473 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:40,474 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:40,475 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:40,475 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:40,476 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4039.636, 'ask': 4039.673, 'last': 0.0, 'time': 1759919319}
2025-10-08 10:28:40,478 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:40,479 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:40,479 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:40,480 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:40,480 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:40,573 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:40,607 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:40,742 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:40,744 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:40,745 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:40,745 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:40,746 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4039.636
2025-10-08 10:28:40,746 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43637.99999999992}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98755.0000000001}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27085.999999999785}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45206.999999999876}]
2025-10-08 10:28:40,747 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:40,964 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:40,965 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:40,965 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:40,966 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:40,968 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:41,357 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:41,360 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:41,360 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:41,361 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:41,362 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:41,363 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:41,366 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:41,366 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:41,384 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:41,387 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:41,388 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:41,388 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:41,389 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:41,472 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:41,890 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:41,894 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:41,894 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:41,895 - APP.services.mt5_service - DEBUG - Current price (cp): 4039.691
2025-10-08 10:28:41,899 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 238, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:41,928 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:41,934 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:41,934 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:41,937 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:41,938 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:41,938 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:41,939 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:41,942 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:41,943 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:41,943 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:41,944 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:41,946 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:41,946 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:41,946 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:41,947 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:41,949 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:41,949 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:41,949 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:41,950 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:41,954 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:41,954 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:41,955 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:41,973 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:41,974 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:41,975 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:41,975 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:41.975457+07:00
2025-10-08 10:28:41,977 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:41.975457+07:00
2025-10-08 10:28:41,977 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:41.975457+07:00 trong DST: True
2025-10-08 10:28:41,978 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:41,978 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:41,978 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:41,980 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:41,982 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:41,984 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:41,988 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:42,007 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:42,008 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:42,009 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:42,010 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:42,010 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:42,011 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:42,013 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:42,013 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:42,014 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:42,014 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:42,014 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:42,015 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:42,017 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:42,018 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:42,019 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:42,034 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:42,037 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:42,039 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:42,041 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:42,044 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:42,044 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:42,045 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:42,069 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:42,071 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:42,072 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:42,072 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:42,073 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:42,074 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:42,075 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4039.691, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:42,079 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:42,080 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:42,103 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:42,107 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:42,107 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 43692.99999999975
2025-10-08 10:28:42,107 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 98809.99999999994
2025-10-08 10:28:42,128 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27140.99999999962
2025-10-08 10:28:42,129 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45261.999999999716
2025-10-08 10:28:42,130 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:42,131 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43692.99999999975}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98809.99999999994}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27140.99999999962}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45261.999999999716}]
2025-10-08 10:28:42,131 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:42,132 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:42,132 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:42,133 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:42,134 - APP.services.mt5_service - DEBUG - Position in day range: 0.9844876829703652
2025-10-08 10:28:42,134 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:42,135 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:42.135029+07:00
2025-10-08 10:28:42,135 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:42.135029+07:00
2025-10-08 10:28:42,135 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:42.135029+07:00 trong DST: True
2025-10-08 10:28:42,136 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:42,136 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:42,136 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:42,137 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:42,137 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:42,137 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '6900', 'price': 4039.69, 'distance_pips': 0.1}, {'level': '6925', 'price': 4039.693, 'distance_pips': 0.15}, {'level': '6950', 'price': 4039.695, 'distance_pips': 0.4}, {'level': '6975', 'price': 4039.698, 'distance_pips': 0.65}]
2025-10-08 10:28:42,138 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:28:42,138 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:42,139 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:42,139 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:42,141 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.691
2025-10-08 10:28:42,164 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:42,167 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:42,168 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:42,169 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:42,199 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:42,200 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4039.691
2025-10-08 10:28:42,200 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:42,201 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:42,202 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:42,228 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:42,229 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:42,230 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4039.691
2025-10-08 10:28:42,231 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:42,232 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:42,262 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:42,264 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:42,289 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:42,290 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.691
2025-10-08 10:28:42,291 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:42,291 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:42,292 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:42,292 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:42,293 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:42,293 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:42,294 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:42,294 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:42,295 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:42,295 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:42,296 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:42,297 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:42,304 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:42,321 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:42,321 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:42,322 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:42,322 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:42,322 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:42,323 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:42,323 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:42,324 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:42,324 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:42,324 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:42,325 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:42,325 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:42,326 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:42,326 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:42,327 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:42,328 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:42,330 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:42,352 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:42,353 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:42,353 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4039.691, 'ask': 4039.728, 'last': 0.0, 'time': 1759919321}
2025-10-08 10:28:42,353 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:42,355 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:42,357 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:42,357 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:42,358 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:42,358 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:42,360 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:42,363 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:42,363 - APP.ui.components.chart_tab - DEBUG - Worker thông tin vẫn đang chạy, bỏ qua.
2025-10-08 10:28:42,380 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:42,381 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:42,381 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:42,382 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:42,382 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:42,383 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4039.691
2025-10-08 10:28:42,383 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43692.99999999975}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98809.99999999994}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27140.99999999962}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45261.999999999716}]
2025-10-08 10:28:42,384 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:42,384 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:42,386 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:42,389 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:42,389 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:42,483 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:42,484 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:42,485 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:42,486 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:42,487 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:42,488 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:43,383 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:43,386 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:43,386 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:43,387 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:43,388 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:43,389 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:43,392 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:43,393 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:43,445 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:43,447 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:43,450 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:43,508 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:43,615 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:43,657 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:44,210 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:44,212 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:44,212 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:44,213 - APP.services.mt5_service - DEBUG - Current price (cp): 4039.74
2025-10-08 10:28:44,216 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 239, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:44,246 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:44,251 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:44,252 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:44,254 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:44,255 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:44,255 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:44,255 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:44,258 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:44,259 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:44,259 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:44,260 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:44,262 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:44,263 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:44,263 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:44,264 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:44,266 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:44,267 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:44,267 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:44,276 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:44,281 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:44,288 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:44,288 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:44,289 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:44,289 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:44,289 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:44,290 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:44.290280+07:00
2025-10-08 10:28:44,290 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:44.290280+07:00
2025-10-08 10:28:44,291 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:44.290280+07:00 trong DST: True
2025-10-08 10:28:44,291 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:44,291 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:44,292 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:44,293 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:44,293 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:44,295 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:44,295 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:44,301 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:44,308 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:44,310 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:44,313 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:44,314 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:44,316 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:44,317 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:44,317 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:44,318 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:44,318 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:44,318 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:44,319 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:44,319 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:44,320 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:44,320 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:44,320 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:44,321 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:44,321 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:44,322 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:44,322 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:44,323 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:44,324 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:44,325 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:44,325 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:44,326 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:44,326 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:44,326 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:44,327 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:44,328 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4039.74, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:44,328 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:44,329 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:44,329 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:44,336 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:44,341 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 43741.99999999973
2025-10-08 10:28:44,345 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 98858.99999999993
2025-10-08 10:28:44,349 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27189.9999999996
2025-10-08 10:28:44,349 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45310.999999999694
2025-10-08 10:28:44,350 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:44,350 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43741.99999999973}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98858.99999999993}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27189.9999999996}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45310.999999999694}]
2025-10-08 10:28:44,350 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:44,351 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:44,351 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:44,352 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:44,352 - APP.services.mt5_service - DEBUG - Position in day range: 0.9853623705819321
2025-10-08 10:28:44,353 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:44,353 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:44.353556+07:00
2025-10-08 10:28:44,354 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:44.353556+07:00
2025-10-08 10:28:44,354 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:44.353556+07:00 trong DST: True
2025-10-08 10:28:44,354 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:44,354 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:44,355 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:44,355 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:44,356 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:44,356 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '7300', 'price': 4039.73, 'distance_pips': 1.0}, {'level': '7325', 'price': 4039.733, 'distance_pips': 0.75}, {'level': '7350', 'price': 4039.735, 'distance_pips': 0.5}, {'level': '7375', 'price': 4039.738, 'distance_pips': 0.25}]
2025-10-08 10:28:44,356 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:28:44,357 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:44,357 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:44,358 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:44,358 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.74
2025-10-08 10:28:44,359 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:44,359 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:44,360 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:44,364 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:44,367 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:44,370 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4039.74
2025-10-08 10:28:44,371 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:44,372 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:44,376 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:44,378 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:44,379 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:44,379 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4039.74
2025-10-08 10:28:44,380 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:44,380 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:44,381 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:44,381 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:44,382 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:44,382 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.74
2025-10-08 10:28:44,383 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:44,383 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:44,384 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:44,385 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:44,385 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:44,386 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:44,386 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:44,387 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:44,387 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:44,387 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:44,387 - APP.ui.components.chart_tab - DEBUG - Worker thông tin vẫn đang chạy, bỏ qua.
2025-10-08 10:28:44,388 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:44,388 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:44,388 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:44,389 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:44,389 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:44,390 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:44,391 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:44,392 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:44,393 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:44,400 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:44,404 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:44,408 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:44,410 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:44,411 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:44,413 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:44,414 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:44,414 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:44,415 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:44,417 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:44,417 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:44,418 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:44,418 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:44,419 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:44,419 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:44,420 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:44,422 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:44,423 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:44,427 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:44,427 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:44,434 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4039.74, 'ask': 4039.777, 'last': 0.0, 'time': 1759919323}
2025-10-08 10:28:44,443 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:44,444 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:44,444 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:44,445 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:44,445 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:44,446 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:44,446 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:44,446 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:44,447 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:44,447 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:44,448 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4039.74
2025-10-08 10:28:44,448 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43741.99999999973}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98858.99999999993}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27189.9999999996}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45310.999999999694}]
2025-10-08 10:28:44,448 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:44,518 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:44,726 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:44,726 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:44,726 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:44,728 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:44,729 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:45,391 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:45,393 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:45,393 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:45,394 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:45,395 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:45,396 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:45,398 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:45,399 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:45,420 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:45,422 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:45,423 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:45,423 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:45,440 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:45,450 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:45,943 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:45,944 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:45,945 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:45,945 - APP.services.mt5_service - DEBUG - Current price (cp): 4039.691
2025-10-08 10:28:45,949 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 239, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:45,977 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:45,979 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:45,985 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:46,002 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:46,004 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:46,005 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:46,005 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:46,009 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:46,009 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:46,009 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:46,010 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:46,012 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:46,012 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:46,013 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:46,013 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:46,015 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:46,016 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:46,016 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:46,016 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:46,022 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:46,038 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:46,038 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:46,039 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:46,039 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:46,040 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:46,040 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:46.040663+07:00
2025-10-08 10:28:46,041 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:46.040663+07:00
2025-10-08 10:28:46,041 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:46.040663+07:00 trong DST: True
2025-10-08 10:28:46,041 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:46,042 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:46,042 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:46,044 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:46,044 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:46,045 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:46,046 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:46,052 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:46,066 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:46,067 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:46,067 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:46,068 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:46,068 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:46,069 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:46,069 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:46,070 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:46,070 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:46,071 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:46,071 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:46,072 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:46,072 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:46,073 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:46,074 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:46,074 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:46,075 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:46,075 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:46,076 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:46,076 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:46,077 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:46,077 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:46,078 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:46,079 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:46,080 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:46,080 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:46,081 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:46,100 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4039.691, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:46,101 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:46,102 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:46,102 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:46,102 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:46,103 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 43692.99999999975
2025-10-08 10:28:46,103 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 98809.99999999994
2025-10-08 10:28:46,103 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27140.99999999962
2025-10-08 10:28:46,104 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45261.999999999716
2025-10-08 10:28:46,104 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:46,104 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43692.99999999975}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98809.99999999994}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27140.99999999962}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45261.999999999716}]
2025-10-08 10:28:46,105 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:46,105 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:46,106 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:46,106 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:46,107 - APP.services.mt5_service - DEBUG - Position in day range: 0.9844876829703652
2025-10-08 10:28:46,107 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:46,108 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:46.107951+07:00
2025-10-08 10:28:46,108 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:46.107951+07:00
2025-10-08 10:28:46,108 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:46.107951+07:00 trong DST: True
2025-10-08 10:28:46,109 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:46,109 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:46,110 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:46,110 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:46,111 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:46,111 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '6900', 'price': 4039.69, 'distance_pips': 0.1}, {'level': '6925', 'price': 4039.693, 'distance_pips': 0.15}, {'level': '6950', 'price': 4039.695, 'distance_pips': 0.4}, {'level': '6975', 'price': 4039.698, 'distance_pips': 0.65}]
2025-10-08 10:28:46,132 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:28:46,133 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:46,134 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:46,134 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:46,135 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.691
2025-10-08 10:28:46,136 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:46,136 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:46,137 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:46,137 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:46,138 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:46,138 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4039.691
2025-10-08 10:28:46,139 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:46,139 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:46,142 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:46,160 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:46,162 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:46,163 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4039.691
2025-10-08 10:28:46,163 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:46,164 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:46,165 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:46,165 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:46,165 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:46,166 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.691
2025-10-08 10:28:46,166 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:46,167 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:46,168 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:46,169 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:46,169 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:46,169 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:46,170 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:46,170 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:46,171 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:46,174 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:46,179 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:46,197 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:46,198 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:46,198 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:46,199 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:46,199 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:46,199 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:46,200 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:46,200 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:46,200 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:46,201 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:46,201 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:46,202 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:46,203 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:46,204 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:46,204 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:46,209 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:46,223 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:46,226 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:46,227 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:46,228 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:46,229 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:46,229 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4039.691, 'ask': 4039.728, 'last': 0.0, 'time': 1759919325}
2025-10-08 10:28:46,229 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:46,230 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:46,232 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:46,232 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:46,233 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:46,234 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:46,235 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:46,238 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:46,256 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:46,257 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:46,257 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:46,258 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4039.691
2025-10-08 10:28:46,258 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43692.99999999975}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98809.99999999994}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27140.99999999962}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45261.999999999716}]
2025-10-08 10:28:46,259 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:46,327 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:46,328 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:46,329 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:46,330 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:46,331 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:46,395 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:46,397 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:46,397 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:46,398 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:46,400 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:46,400 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:46,403 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:46,403 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:46,407 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:46,408 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:46,409 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:46,409 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:46,410 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:46,433 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:46,911 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:46,913 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:46,913 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:46,914 - APP.services.mt5_service - DEBUG - Current price (cp): 4039.74
2025-10-08 10:28:46,917 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 238, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:46,948 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:46,950 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:46,950 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:46,953 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:46,954 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:46,954 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:46,963 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:46,973 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:46,973 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:46,974 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:46,975 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:46,977 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:46,977 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:46,978 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:46,978 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:46,980 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:46,980 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:46,981 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:46,981 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:46,984 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:46,985 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:46,993 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:47,005 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:47,006 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:47,006 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:47,007 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:47.007298+07:00
2025-10-08 10:28:47,007 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:47.007298+07:00
2025-10-08 10:28:47,008 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:47.007298+07:00 trong DST: True
2025-10-08 10:28:47,008 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:47,008 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:47,009 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:47,010 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:47,011 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:47,012 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:47,013 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:47,016 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:47,017 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:47,034 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:47,035 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:47,035 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:47,036 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:47,036 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:47,037 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:47,037 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:47,038 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:47,038 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:47,038 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:47,039 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:47,039 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:47,040 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:47,041 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:47,041 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:47,043 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:47,043 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:47,044 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:47,044 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:47,045 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:47,045 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:47,046 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:47,050 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:47,084 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:47,085 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:47,086 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:47,086 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4039.74, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:47,087 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:47,088 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:47,088 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:47,089 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:47,090 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 43741.99999999973
2025-10-08 10:28:47,090 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 98858.99999999993
2025-10-08 10:28:47,091 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27189.9999999996
2025-10-08 10:28:47,091 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45310.999999999694
2025-10-08 10:28:47,092 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:47,092 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43741.99999999973}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98858.99999999993}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27189.9999999996}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45310.999999999694}]
2025-10-08 10:28:47,093 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:47,094 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:47,094 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:47,095 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:47,095 - APP.services.mt5_service - DEBUG - Position in day range: 0.9853623705819321
2025-10-08 10:28:47,096 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:47,096 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:47.096754+07:00
2025-10-08 10:28:47,097 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:47.096754+07:00
2025-10-08 10:28:47,097 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:47.096754+07:00 trong DST: True
2025-10-08 10:28:47,097 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:47,098 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:47,098 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:47,098 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:47,099 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:47,099 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '7300', 'price': 4039.73, 'distance_pips': 1.0}, {'level': '7325', 'price': 4039.733, 'distance_pips': 0.75}, {'level': '7350', 'price': 4039.735, 'distance_pips': 0.5}, {'level': '7375', 'price': 4039.738, 'distance_pips': 0.25}]
2025-10-08 10:28:47,100 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:28:47,100 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:47,100 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:47,101 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:47,101 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.74
2025-10-08 10:28:47,102 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:47,102 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:47,103 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:47,103 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:47,104 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:47,105 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4039.74
2025-10-08 10:28:47,105 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:47,105 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:47,106 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:47,107 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:47,107 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:47,108 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4039.74
2025-10-08 10:28:47,108 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:47,108 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:47,110 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:47,112 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:47,112 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:47,114 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.74
2025-10-08 10:28:47,122 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:47,127 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:47,136 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:47,137 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:47,137 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:47,138 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:47,138 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:47,139 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:47,139 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:47,140 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:47,140 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:47,143 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:47,166 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:47,168 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:47,168 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:47,169 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:47,169 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:47,170 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:47,170 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:47,170 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:47,173 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:47,198 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:47,198 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:47,199 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:47,200 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:47,200 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:47,200 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:47,201 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:47,204 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:47,228 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:47,230 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:47,231 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:47,231 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:47,232 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4039.74, 'ask': 4039.777, 'last': 0.0, 'time': 1759919326}
2025-10-08 10:28:47,236 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:47,260 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:47,261 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:47,262 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:47,263 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:47,273 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:47,289 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:47,290 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:47,291 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:47,291 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:47,292 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4039.74
2025-10-08 10:28:47,293 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43741.99999999973}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98858.99999999993}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27189.9999999996}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45310.999999999694}]
2025-10-08 10:28:47,294 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:47,321 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:47,322 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:47,322 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:47,323 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:47,325 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:47,399 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:47,402 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:47,402 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:47,403 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:47,405 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:47,405 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:47,408 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:47,409 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:47,412 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:47,413 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:47,414 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:47,414 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:47,414 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:47,427 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:47,915 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:47,917 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:47,918 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:47,918 - APP.services.mt5_service - DEBUG - Current price (cp): 4039.717
2025-10-08 10:28:47,922 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 238, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:47,950 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:47,953 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:47,954 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:47,957 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:47,957 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:47,958 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:47,959 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:47,961 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:47,962 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:47,962 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:47,963 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:47,964 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:47,965 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:47,965 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:47,966 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:47,967 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:47,968 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:47,968 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:47,969 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:47,971 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:47,972 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:47,972 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:47,973 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:47,973 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:47,974 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:47,974 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:47.974313+07:00
2025-10-08 10:28:47,974 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:47.974313+07:00
2025-10-08 10:28:47,975 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:47.974313+07:00 trong DST: True
2025-10-08 10:28:47,975 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:47,976 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:47,976 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:47,977 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:47,977 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:47,978 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:47,979 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:47,982 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:47,982 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:47,983 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:47,983 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:47,984 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:47,985 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:47,985 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:47,986 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:47,986 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:47,987 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:48,005 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:48,007 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:48,007 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:48,008 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:48,009 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:48,009 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:48,009 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:48,010 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:48,010 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:48,011 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:48,011 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:48,012 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:48,013 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:48,013 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:48,013 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:48,014 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:48,015 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:48,016 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:48,040 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4039.717, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:48,040 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:48,042 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:48,042 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:48,042 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:48,043 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 43719.00000000005
2025-10-08 10:28:48,043 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 98836.00000000023
2025-10-08 10:28:48,044 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27166.999999999916
2025-10-08 10:28:48,044 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45288.00000000001
2025-10-08 10:28:48,044 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:48,045 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43719.00000000005}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98836.00000000023}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27166.999999999916}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45288.00000000001}]
2025-10-08 10:28:48,045 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:48,046 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:48,047 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:48,047 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:48,048 - APP.services.mt5_service - DEBUG - Position in day range: 0.9849518029275286
2025-10-08 10:28:48,049 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:48,065 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:48.065900+07:00
2025-10-08 10:28:48,066 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:48.065900+07:00
2025-10-08 10:28:48,068 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:48.065900+07:00 trong DST: True
2025-10-08 10:28:48,068 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:48,069 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:48,069 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:48,070 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:48,070 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:48,071 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '7100', 'price': 4039.71, 'distance_pips': 0.7}, {'level': '7125', 'price': 4039.713, 'distance_pips': 0.45}, {'level': '7150', 'price': 4039.715, 'distance_pips': 0.2}, {'level': '7175', 'price': 4039.718, 'distance_pips': 0.05}]
2025-10-08 10:28:48,071 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:28:48,071 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:48,072 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:48,072 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:48,073 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.717
2025-10-08 10:28:48,073 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:48,074 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:48,075 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:48,075 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:48,076 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:48,076 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4039.717
2025-10-08 10:28:48,080 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:48,081 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:48,107 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:48,108 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:48,108 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:48,109 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4039.717
2025-10-08 10:28:48,110 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:48,111 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:48,117 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:48,133 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:48,134 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:48,135 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.717
2025-10-08 10:28:48,136 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:48,136 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:48,137 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:48,138 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:48,138 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:48,138 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:48,139 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:48,139 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:48,141 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:48,162 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:48,163 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:48,163 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:48,164 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:48,164 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:48,165 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:48,165 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:48,166 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:48,166 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:48,166 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:48,167 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:48,168 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:48,169 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:48,169 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:48,170 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:48,170 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:48,171 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:48,171 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:48,172 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:48,174 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:48,177 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:48,198 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:48,199 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:48,199 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:48,199 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4039.717, 'ask': 4039.754, 'last': 0.0, 'time': 1759919327}
2025-10-08 10:28:48,202 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:48,202 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:48,203 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:48,203 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:48,204 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:48,205 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:48,206 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:48,225 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:48,225 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:48,226 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:48,227 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4039.717
2025-10-08 10:28:48,227 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43719.00000000005}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98836.00000000023}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27166.999999999916}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45288.00000000001}]
2025-10-08 10:28:48,228 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:48,313 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:48,314 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:48,315 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:48,316 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:48,317 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:48,404 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:48,406 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:48,406 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:48,407 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:48,408 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:48,409 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:48,411 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:48,412 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:48,415 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:48,416 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:48,416 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:48,417 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:48,417 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:48,418 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:48,918 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:48,919 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:48,920 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:48,921 - APP.services.mt5_service - DEBUG - Current price (cp): 4039.753
2025-10-08 10:28:48,924 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 237, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:48,952 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:28:48,954 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:48,955 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:48,957 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:48,958 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:48,958 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:48,959 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:48,961 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:48,962 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:48,962 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:48,963 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:48,965 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:48,965 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:48,965 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:48,966 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:48,967 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:48,968 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:48,968 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:48,969 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:48,971 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:48,972 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:48,972 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:48,973 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:48,973 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:48,974 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:48,974 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:48.974295+07:00
2025-10-08 10:28:48,974 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:48.974295+07:00
2025-10-08 10:28:48,975 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:48.974295+07:00 trong DST: True
2025-10-08 10:28:48,975 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:48,975 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:48,976 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:48,977 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:48,977 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:48,979 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:48,979 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:48,981 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:48,982 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:48,983 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:48,984 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:48,984 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:48,985 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:48,985 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:48,986 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:48,988 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:49,003 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:49,004 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:49,004 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:49,005 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:49,005 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:49,006 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:49,006 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:49,006 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:49,007 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:49,007 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:49,008 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:49,008 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:49,009 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:49,009 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:49,010 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:49,010 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:49,010 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:49,011 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:49,012 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:49,012 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4039.753, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:49,013 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:49,013 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:49,013 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:49,014 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:49,014 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 43755.00000000011
2025-10-08 10:28:49,014 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 98872.00000000029
2025-10-08 10:28:49,015 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27202.999999999975
2025-10-08 10:28:49,015 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45324.000000000065
2025-10-08 10:28:49,015 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:49,016 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43755.00000000011}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98872.00000000029}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27202.999999999975}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45324.000000000065}]
2025-10-08 10:28:49,017 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:49,017 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:49,018 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:49,040 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:49,042 - APP.services.mt5_service - DEBUG - Position in day range: 0.9855944305605179
2025-10-08 10:28:49,042 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:49,043 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:49.043720+07:00
2025-10-08 10:28:49,044 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:49.043720+07:00
2025-10-08 10:28:49,044 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:49.043720+07:00 trong DST: True
2025-10-08 10:28:49,045 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:49,045 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:49,045 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:49,046 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:49,046 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:49,068 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '7500', 'price': 4039.75, 'distance_pips': 0.3}, {'level': '7525', 'price': 4039.753, 'distance_pips': 0.05}, {'level': '7550', 'price': 4039.755, 'distance_pips': 0.2}, {'level': '7575', 'price': 4039.758, 'distance_pips': 0.45}]
2025-10-08 10:28:49,068 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:28:49,069 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:49,070 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:49,070 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:49,072 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.753
2025-10-08 10:28:49,073 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:49,073 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:49,074 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:49,075 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:49,075 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:49,076 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4039.753
2025-10-08 10:28:49,078 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:49,079 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:49,080 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:49,080 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:49,081 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:49,103 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4039.753
2025-10-08 10:28:49,105 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:49,106 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:49,107 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:49,107 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:49,108 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:49,108 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.753
2025-10-08 10:28:49,109 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:49,109 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:49,110 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:49,111 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:49,117 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:49,134 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:49,135 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:49,136 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:49,136 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:49,137 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:49,137 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:49,137 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:49,137 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:49,138 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:49,138 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:49,139 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:49,139 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:49,140 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:49,141 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:49,141 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:49,141 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:49,142 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:49,142 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:49,161 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:49,162 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:49,162 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:49,163 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:49,163 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:49,164 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:49,165 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:49,166 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:49,167 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:49,168 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4039.753, 'ask': 4039.79, 'last': 0.0, 'time': 1759919328}
2025-10-08 10:28:49,168 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:49,168 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:49,170 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:49,171 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:49,171 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:49,172 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:49,173 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:49,174 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:49,174 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:49,181 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:49,183 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:49,185 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4039.753
2025-10-08 10:28:49,188 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43755.00000000011}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98872.00000000029}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27202.999999999975}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45324.000000000065}]
2025-10-08 10:28:49,192 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:49,205 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:49,211 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:49,224 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:49,228 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:49,229 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:51,408 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:51,410 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:51,410 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:51,411 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:51,413 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:51,413 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:51,417 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:51,434 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:51,445 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:51,446 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:51,447 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:51,448 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:51,448 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:51,535 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:51,950 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:51,951 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:51,952 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:51,952 - APP.services.mt5_service - DEBUG - Current price (cp): 4039.668
2025-10-08 10:28:51,956 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 235, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:51,984 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 221, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:51,986 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:51,987 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:51,993 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:51,993 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:51,994 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:51,994 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:51,997 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:51,998 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:51,998 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:51,998 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:52,000 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:52,001 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:52,001 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:52,002 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:52,004 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:52,004 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:52,005 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:52,005 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:52,007 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:52,008 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:52,008 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:52,009 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:52,010 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:52,010 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:52,011 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:52.011016+07:00
2025-10-08 10:28:52,011 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:52.011016+07:00
2025-10-08 10:28:52,011 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:52.011016+07:00 trong DST: True
2025-10-08 10:28:52,012 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:52,012 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:52,012 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:52,013 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:52,014 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:52,019 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:52,037 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:52,040 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:52,041 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:52,041 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:52,042 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:52,042 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:52,043 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:52,043 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:52,043 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:52,044 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:52,044 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:52,044 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:52,045 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:52,045 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:52,046 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:52,046 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:52,047 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:52,048 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:52,048 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:52,049 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:52,070 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:52,070 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:52,071 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:52,072 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:52,072 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:52,073 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:52,073 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:52,073 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:52,074 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:52,074 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4039.668, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:52,075 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:52,075 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:52,076 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:52,076 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:52,077 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 43670.00000000007
2025-10-08 10:28:52,078 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 98787.00000000026
2025-10-08 10:28:52,078 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27117.999999999938
2025-10-08 10:28:52,079 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45239.00000000003
2025-10-08 10:28:52,079 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:52,080 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43670.00000000007}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98787.00000000026}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27117.999999999938}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45239.00000000003}]
2025-10-08 10:28:52,081 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:52,082 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:52,093 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:52,096 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:52,098 - APP.services.mt5_service - DEBUG - Position in day range: 0.9840771153159616
2025-10-08 10:28:52,098 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:52,102 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:52.102406+07:00
2025-10-08 10:28:52,103 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:52.102406+07:00
2025-10-08 10:28:52,104 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:52.102406+07:00 trong DST: True
2025-10-08 10:28:52,105 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:52,105 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:52,105 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:52,106 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:52,106 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:52,107 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '6600', 'price': 4039.66, 'distance_pips': 0.8}, {'level': '6625', 'price': 4039.663, 'distance_pips': 0.55}, {'level': '6650', 'price': 4039.665, 'distance_pips': 0.3}, {'level': '6675', 'price': 4039.668, 'distance_pips': 0.05}]
2025-10-08 10:28:52,107 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:28:52,108 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:52,108 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:52,110 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:52,110 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.668
2025-10-08 10:28:52,112 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:52,116 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:52,118 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:52,121 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:52,122 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:52,124 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4039.668
2025-10-08 10:28:52,125 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:52,127 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:52,130 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:52,132 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:52,133 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:52,133 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4039.668
2025-10-08 10:28:52,134 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:52,134 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:52,135 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:52,136 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:52,136 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:52,137 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.668
2025-10-08 10:28:52,138 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:52,138 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:52,139 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:52,139 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:52,143 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:52,144 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:52,150 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:52,155 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:52,159 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:52,160 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:52,162 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:52,163 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:52,165 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:52,166 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:52,166 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:52,166 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:52,167 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:52,167 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:52,167 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:52,168 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:52,168 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:52,169 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:52,169 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:52,169 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:52,170 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:52,170 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:52,170 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:52,171 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:52,172 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:52,174 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:52,181 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:52,183 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:52,184 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:52,186 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4039.668, 'ask': 4039.705, 'last': 0.0, 'time': 1759919330}
2025-10-08 10:28:52,192 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:52,196 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:52,197 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:52,197 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:52,197 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:52,198 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:52,198 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:52,199 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:52,199 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:52,199 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:52,200 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4039.668
2025-10-08 10:28:52,200 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43670.00000000007}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98787.00000000026}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27117.999999999938}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45239.00000000003}]
2025-10-08 10:28:52,200 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:52,236 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:52,259 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:52,259 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:52,260 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:52,261 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:54,658 - APP.ui.app_ui - INFO - Autorun tick: Kích hoạt worker kiểm tra.
2025-10-08 10:28:54,658 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_autorun_tick_worker' vào thread pool.
2025-10-08 10:28:54,659 - APP.ui.app_ui - DEBUG - Autorun tick worker: Bắt đầu kiểm tra điều kiện.
2025-10-08 10:28:54,660 - APP.ui.app_ui - INFO - Autorun tick worker: Điều kiện hợp lệ, yêu cầu bắt đầu phân tích trên luồng UI.
2025-10-08 10:28:54,667 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: start_analysis
2025-10-08 10:28:54,668 - APP.ui.app_ui - INFO - Yêu cầu bắt đầu phân tích từ UI.
2025-10-08 10:28:54,686 - APP.ui.utils.ui_builder - DEBUG - Đã thay đổi trạng thái nút Start/Stop thành 'disabled'. Các điều khiển khác không bị ảnh hưởng.
2025-10-08 10:28:54,688 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:54,690 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:54,691 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:54,691 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:54,692 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:54,692 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:54,693 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:54,693 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:54,694 - APP.services.te_service - INFO - Đăng nhập thành công vào Trading Economics API.
2025-10-08 10:28:54,695 - APP.services.news_service - DEBUG - Cấu hình NewsService đã được cập nhật.
2025-10-08 10:28:54,696 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-08 10:28:54,696 - APP.ui.app_ui - INFO - Đã khởi tạo và bắt đầu luồng AnalysisWorker.
2025-10-08 10:28:54,697 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-08 10:28:54,701 - APP.services.gemini_service - INFO - Đã khởi tạo model 'models/gemini-2.5-flash' thành công.
2025-10-08 10:28:54,702 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 2: Xây dựng ngữ cảnh và kiểm tra điều kiện.
2025-10-08 10:28:54,705 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-RUN.
2025-10-08 10:28:54,705 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 3: Chuẩn bị và upload ảnh (song song).
2025-10-08 10:28:54,728 - APP.analysis.image_processor - DEBUG - Đang thử tải cache upload.
2025-10-08 10:28:54,732 - APP.analysis.image_processor - DEBUG - Đã tải cache upload với 4 mục.
2025-10-08 10:28:54,737 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_H1.png: 15022:1759914264:adcc044a34c2739b
2025-10-08 10:28:54,757 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_H1.png. Tên từ xa: files/jcq192qkqfx5
2025-10-08 10:28:54,758 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_H1.png, đang lấy thông tin file...
2025-10-08 10:28:54,761 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M1.png: 21123:1759914329:c9ca25adc2713e89
2025-10-08 10:28:54,764 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M1.png. Tên từ xa: files/zl0mc2r9tv6i
2025-10-08 10:28:54,764 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M15.png: 14475:1759914258:f522dd906714fb0b
2025-10-08 10:28:54,765 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M5.png: 22339:1759914253:ac9da090a54f8eec
2025-10-08 10:28:54,765 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M1.png, đang lấy thông tin file...
2025-10-08 10:28:54,792 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M15.png. Tên từ xa: files/4s2o4xrat6a8
2025-10-08 10:28:54,793 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M5.png. Tên từ xa: files/kis0no3da2v8
2025-10-08 10:28:54,821 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:54,821 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M15.png, đang lấy thông tin file...
2025-10-08 10:28:54,822 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M5.png, đang lấy thông tin file...
2025-10-08 10:28:54,879 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:28:54,913 - APP.analysis.image_processor - DEBUG - Đang lưu cache upload với 4 mục.
2025-10-08 10:28:54,916 - APP.analysis.image_processor - DEBUG - Đã lưu cache upload thành công.
2025-10-08 10:28:54,917 - APP.utils.threading_utils - DEBUG - Tác vụ song song '_execute_stage_3_logic' đã hoàn thành.
2025-10-08 10:28:54,924 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:55,025 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:55,125 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:55,226 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:55,227 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:55,328 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:28:55,329 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:55,329 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:55,431 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:55,432 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:55,475 - APP.services.mt5_service - DEBUG - Bắt đầu get_active_killzone cho 2025-10-08 10:28:54.705800 với timezone Asia/Ho_Chi_Minh
2025-10-08 10:28:55,476 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-08 10:28:54.705800+07:00, Target TZ: None
2025-10-08 10:28:55,476 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 10:28:54.705800+07:00
2025-10-08 10:28:55,477 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 10:28:54.705800+07:00 trong DST: True
2025-10-08 10:28:55,477 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:55,478 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:55,478 - APP.services.mt5_service - DEBUG - Không trong killzone nào.
2025-10-08 10:28:55,479 - APP.core.trading.conditions - INFO - Điều kiện NO-RUN được kích hoạt: Không chạy ngoài các Kill Zone đã định nghĩa.
2025-10-08 10:28:55,479 - APP.core.trading.conditions - INFO - Thoát sớm. Giai đoạn: no-run, Lý do: Không chạy ngoài các Kill Zone đã định nghĩa.
2025-10-08 10:28:55,480 - APP.persistence.log_handler - DEBUG - Đang chuẩn bị ghi log giao dịch. Giai đoạn: no-run, Thư mục con: None
2025-10-08 10:28:55,534 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:55,534 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:55,540 - APP.persistence.log_handler - DEBUG - Đã ghi log giao dịch thành công vào trade_log_20251008.jsonl.
2025-10-08 10:28:55,541 - APP.persistence.log_handler - DEBUG - Kết thúc hàm log_trade.
2025-10-08 10:28:55,541 - APP.core.analysis_worker - INFO - Giai đoạn 2 thoát sớm: Điều kiện No-Run: Không chạy ngoài các Kill Zone đã định nghĩa.
2025-10-08 10:28:55,542 - APP.utils.threading_utils - DEBUG - Tác vụ song song '_execute_stage_2_logic' đã hoàn thành.
2025-10-08 10:28:55,542 - APP.core.analysis_worker - WARNING - Một trong các giai đoạn song song đã thất bại. Dừng worker.
2025-10-08 10:28:55,543 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Thoát sớm do lỗi ở Giai đoạn 2 hoặc 3.
2025-10-08 10:28:55,543 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-08 10:28:55,544 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-08 10:28:55,635 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:55,636 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:55,637 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:55,638 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:55,638 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: _finalize_done
2025-10-08 10:28:55,639 - APP.ui.utils.ui_builder - DEBUG - Đã thay đổi trạng thái nút Start/Stop thành 'normal'. Các điều khiển khác không bị ảnh hưởng.
2025-10-08 10:28:55,640 - APP.ui.app_ui - DEBUG - Lên lịch chạy tự động tiếp theo sau 60000ms.
2025-10-08 10:28:56,412 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:28:56,416 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:28:56,417 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:28:56,460 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:28:56,469 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:28:56,470 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:56,474 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:28:56,474 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:56,557 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:28:56,558 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:28:56,560 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:28:56,560 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:28:56,561 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:28:56,569 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:57,067 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:28:57,072 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:28:57,075 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:28:57,126 - APP.services.mt5_service - DEBUG - Current price (cp): 4039.304
2025-10-08 10:28:57,137 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 239, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:57,201 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 220, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:28:57,203 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:28:57,208 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:28:57,217 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:28:57,218 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:57,219 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:28:57,220 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:28:57,224 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:28:57,226 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:57,227 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:28:57,228 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:28:57,232 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:28:57,232 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:57,234 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:28:57,275 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:28:57,277 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:28:57,278 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:28:57,279 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:28:57,281 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:28:57,284 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:57,286 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:28:57,287 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:28:57,288 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:28:57,290 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:28:57,291 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:57,292 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:57.292869+07:00
2025-10-08 10:28:57,293 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:57.292869+07:00
2025-10-08 10:28:57,295 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:57.292869+07:00 trong DST: True
2025-10-08 10:28:57,296 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:57,299 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:57,317 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:28:57,319 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:28:57,320 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:28:57,323 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:28:57,325 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:28:57,329 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:28:57,351 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:57,353 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:28:57,354 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:57,357 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:28:57,359 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:28:57,384 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:28:57,387 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:28:57,387 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:28:57,387 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:28:57,388 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:28:57,390 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:28:57,391 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:28:57,393 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:28:57,399 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:28:57,415 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:28:57,416 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:28:57,416 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:28:57,417 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:28:57,418 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:28:57,419 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:57,419 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:28:57,420 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:28:57,420 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:28:57,420 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:28:57,423 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:28:57,447 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:28:57,448 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:28:57,449 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4039.304, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:28:57,449 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:28:57,449 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:28:57,450 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:28:57,450 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:28:57,450 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 43306.00000000004
2025-10-08 10:28:57,451 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 98423.00000000023
2025-10-08 10:28:57,451 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 26753.999999999905
2025-10-08 10:28:57,451 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 44875.0
2025-10-08 10:28:57,453 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:28:57,456 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43306.00000000004}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98423.00000000023}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26753.999999999905}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44875.0}]
2025-10-08 10:28:57,472 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:28:57,473 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:28:57,474 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:28:57,474 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:28:57,475 - APP.services.mt5_service - DEBUG - Position in day range: 0.9775794359157469
2025-10-08 10:28:57,475 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:28:57,475 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:28:57.475770+07:00
2025-10-08 10:28:57,476 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:28:57.475770+07:00
2025-10-08 10:28:57,476 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:28:57.475770+07:00 trong DST: True
2025-10-08 10:28:57,476 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:28:57,477 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:28:57,477 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 212
2025-10-08 10:28:57,478 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:57,478 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:57,478 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '3000', 'price': 4039.3, 'distance_pips': 0.4}, {'level': '3025', 'price': 4039.303, 'distance_pips': 0.15}, {'level': '3050', 'price': 4039.305, 'distance_pips': 0.1}, {'level': '3075', 'price': 4039.308, 'distance_pips': 0.35}]
2025-10-08 10:28:57,479 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:28:57,480 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:57,480 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:57,480 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:57,481 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.304
2025-10-08 10:28:57,482 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:57,482 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:57,483 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:57,483 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:28:57,483 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:28:57,484 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4039.304
2025-10-08 10:28:57,485 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:57,486 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:28:57,487 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:57,487 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:28:57,487 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:28:57,509 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4039.304
2025-10-08 10:28:57,510 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:57,511 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:28:57,512 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:57,512 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:28:57,512 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:28:57,513 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.304
2025-10-08 10:28:57,513 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:28:57,514 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:28:57,515 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:28:57,516 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:28:57,517 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:57,517 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:57,518 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:57,520 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:57,539 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:57,541 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:57,542 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:57,542 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:57,542 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:57,543 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:57,543 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:28:57,544 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:28:57,544 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:28:57,545 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:28:57,545 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:28:57,545 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:28:57,546 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:28:57,546 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:28:57,546 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:57,547 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:57,548 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:28:57,549 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:28:57,550 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:28:57,572 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:28:57,573 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:57,575 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:28:57,576 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:57,577 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:28:57,577 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:28:57,577 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4039.304, 'ask': 4039.341, 'last': 0.0, 'time': 1759919336}
2025-10-08 10:28:57,580 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:28:57,581 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:28:57,589 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:28:57,600 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:28:57,602 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:57,602 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:57,602 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:57,603 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:28:57,603 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:28:57,604 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:28:57,604 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4039.304
2025-10-08 10:28:57,604 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43306.00000000004}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98423.00000000023}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26753.999999999905}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44875.0}]
2025-10-08 10:28:57,605 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:28:57,672 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:28:57,673 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:28:57,674 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:28:57,675 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:28:57,677 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:29:01,462 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:29:01,464 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:29:01,464 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:29:01,465 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:29:01,467 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:29:01,467 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:29:01,471 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:29:01,471 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:01,492 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:01,871 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:29:01,872 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:29:01,872 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:29:01,873 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:29:01,873 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:29:02,375 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:29:02,376 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:29:02,377 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:29:02,377 - APP.services.mt5_service - DEBUG - Current price (cp): 4039.336
2025-10-08 10:29:02,381 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 242, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:29:02,411 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 218, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:29:02,414 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:29:02,415 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:29:02,418 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:29:02,418 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:02,418 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:29:02,419 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:29:02,422 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:29:02,423 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:02,424 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:29:02,424 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:29:02,443 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:29:02,444 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:02,444 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:29:02,445 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:29:02,447 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:29:02,447 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:02,447 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:29:02,448 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:29:02,451 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:29:02,451 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:29:02,452 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:29:02,452 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:29:02,453 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:29:02,454 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:29:02,454 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:29:02.454515+07:00
2025-10-08 10:29:02,455 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:29:02.454515+07:00
2025-10-08 10:29:02,455 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:29:02.454515+07:00 trong DST: True
2025-10-08 10:29:02,456 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:29:02,456 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:29:02,456 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:29:02,460 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:29:02,478 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:29:02,480 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:29:02,480 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:29:02,483 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:29:02,483 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:29:02,484 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:29:02,485 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:29:02,485 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:29:02,486 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:29:02,486 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:29:02,487 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:29:02,487 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:29:02,509 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:29:02,510 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:29:02,512 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:29:02,513 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:29:02,514 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:29:02,514 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:29:02,514 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:29:02,515 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:29:02,516 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:29:02,517 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:29:02,519 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:29:02,519 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:29:02,530 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:29:02,541 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:29:02,542 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:29:02,543 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:29:02,543 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:29:02,544 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:29:02,544 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:29:02,545 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4039.336, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:29:02,545 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:29:02,546 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:29:02,546 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:29:02,546 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:29:02,574 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 43337.99999999974
2025-10-08 10:29:02,574 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 98454.99999999993
2025-10-08 10:29:02,575 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 26785.999999999603
2025-10-08 10:29:02,575 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 44906.999999999694
2025-10-08 10:29:02,576 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:29:02,576 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43337.99999999974}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98454.99999999993}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26785.999999999603}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44906.999999999694}]
2025-10-08 10:29:02,577 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:29:02,578 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:29:02,579 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:29:02,600 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:29:02,601 - APP.services.mt5_service - DEBUG - Position in day range: 0.9781506604783977
2025-10-08 10:29:02,601 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:29:02,602 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:29:02.602040+07:00
2025-10-08 10:29:02,602 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:29:02.602040+07:00
2025-10-08 10:29:02,602 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:29:02.602040+07:00 trong DST: True
2025-10-08 10:29:02,603 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:29:02,603 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:29:02,603 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 211
2025-10-08 10:29:02,604 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:02,604 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:02,605 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '3300', 'price': 4039.33, 'distance_pips': 0.6}, {'level': '3325', 'price': 4039.332, 'distance_pips': 0.35}, {'level': '3350', 'price': 4039.335, 'distance_pips': 0.1}, {'level': '3375', 'price': 4039.338, 'distance_pips': 0.15}]
2025-10-08 10:29:02,605 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:29:02,606 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:02,606 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:02,607 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:29:02,607 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.336
2025-10-08 10:29:02,608 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:02,609 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:29:02,611 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:02,611 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:29:02,631 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:29:02,632 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4039.336
2025-10-08 10:29:02,632 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:02,633 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:29:02,633 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:02,634 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:29:02,634 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:29:02,635 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4039.336
2025-10-08 10:29:02,635 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:02,636 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:29:02,637 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:02,637 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:29:02,638 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:29:02,638 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.336
2025-10-08 10:29:02,639 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:02,640 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:29:02,641 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:02,642 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:29:02,642 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:02,643 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:02,643 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:29:02,667 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:29:02,668 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:29:02,668 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:29:02,669 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:29:02,669 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:29:02,670 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:29:02,670 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:29:02,670 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:29:02,671 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:29:02,672 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:29:02,673 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:29:02,674 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:29:02,674 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:29:02,675 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:29:02,697 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:29:02,698 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:02,699 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:02,699 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:29:02,700 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:29:02,700 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:29:02,701 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:29:02,701 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:29:02,702 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:29:02,705 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:02,706 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4039.336, 'ask': 4039.373, 'last': 0.0, 'time': 1759919341}
2025-10-08 10:29:02,714 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:29:02,718 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:29:02,726 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:29:02,729 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:29:02,729 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:29:02,730 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:29:02,730 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:02,732 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:02,733 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:02,733 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:02,734 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:02,734 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:29:02,737 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4039.336
2025-10-08 10:29:02,738 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43337.99999999974}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98454.99999999993}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26785.999999999603}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44906.999999999694}]
2025-10-08 10:29:02,759 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:29:02,800 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:02,823 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:29:02,824 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:29:02,825 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:29:02,827 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:29:06,466 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:29:06,469 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:29:06,469 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:29:06,470 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:29:06,471 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:29:06,472 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:29:06,476 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:29:06,476 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:06,503 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:29:06,503 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:29:06,504 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:29:06,505 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:29:06,505 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:29:06,541 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:07,006 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:29:07,007 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:29:07,008 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:29:07,008 - APP.services.mt5_service - DEBUG - Current price (cp): 4038.817
2025-10-08 10:29:07,012 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 245, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:29:07,038 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 219, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:29:07,045 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:29:07,046 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:29:07,048 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:29:07,049 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:07,049 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:29:07,050 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:29:07,069 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:29:07,070 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:07,070 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:29:07,071 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:29:07,073 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:29:07,073 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:07,074 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:29:07,074 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:29:07,076 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:29:07,077 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:07,077 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:29:07,078 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:29:07,081 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:29:07,082 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:29:07,104 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:29:07,106 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:29:07,106 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:29:07,107 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:29:07,107 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:29:07.107910+07:00
2025-10-08 10:29:07,108 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:29:07.107910+07:00
2025-10-08 10:29:07,108 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:29:07.107910+07:00 trong DST: True
2025-10-08 10:29:07,109 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:29:07,109 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:29:07,109 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:29:07,112 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:29:07,112 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:29:07,116 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:29:07,132 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:29:07,137 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:29:07,138 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:29:07,138 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:29:07,139 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:29:07,139 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:29:07,139 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:29:07,140 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:29:07,140 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:29:07,143 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:29:07,143 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:29:07,143 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:29:07,144 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:29:07,144 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:29:07,196 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:29:07,198 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:29:07,287 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:29:07,341 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:29:07,373 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:29:07,402 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:29:07,435 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:29:07,477 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:29:07,519 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:29:07,519 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:29:07,520 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:29:07,521 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:29:07,522 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:29:07,523 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:29:07,523 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:29:07,524 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4038.817, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:29:07,525 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:29:07,525 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:29:07,526 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:29:07,526 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:29:07,527 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 42818.999999999956
2025-10-08 10:29:07,527 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 97936.00000000015
2025-10-08 10:29:07,527 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 26266.999999999825
2025-10-08 10:29:07,528 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 44387.99999999992
2025-10-08 10:29:07,528 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:29:07,529 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42818.999999999956}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97936.00000000015}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26266.999999999825}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44387.99999999992}]
2025-10-08 10:29:07,530 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:29:07,531 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:29:07,531 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:29:07,532 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:29:07,532 - APP.services.mt5_service - DEBUG - Position in day range: 0.9688861121028215
2025-10-08 10:29:07,533 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:29:07,533 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:29:07.533299+07:00
2025-10-08 10:29:07,533 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:29:07.533299+07:00
2025-10-08 10:29:07,534 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:29:07.533299+07:00 trong DST: True
2025-10-08 10:29:07,534 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:29:07,534 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:29:07,535 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 211
2025-10-08 10:29:07,535 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:07,536 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:07,536 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '8100', 'price': 4038.81, 'distance_pips': 0.7}, {'level': '8125', 'price': 4038.812, 'distance_pips': 0.45}, {'level': '8150', 'price': 4038.815, 'distance_pips': 0.2}, {'level': '8175', 'price': 4038.818, 'distance_pips': 0.05}]
2025-10-08 10:29:07,537 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:29:07,537 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:07,538 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:07,542 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:29:07,543 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.817
2025-10-08 10:29:07,544 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:07,577 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:29:07,602 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:07,605 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:29:07,607 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:29:07,609 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4038.817
2025-10-08 10:29:07,609 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:07,636 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:29:07,639 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:07,640 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:29:07,665 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:29:07,667 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4038.817
2025-10-08 10:29:07,668 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:07,668 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:29:07,669 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:07,670 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:29:07,671 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:29:07,672 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.817
2025-10-08 10:29:07,697 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:07,698 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:29:07,699 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:07,700 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:29:07,701 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:07,701 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:07,701 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:29:07,702 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:29:07,702 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:29:07,702 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:29:07,703 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:29:07,705 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:29:07,705 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:29:07,706 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:29:07,707 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:29:07,728 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:29:07,730 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:29:07,731 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:29:07,732 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:29:07,732 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:29:07,732 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:29:07,733 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:29:07,733 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:07,733 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:07,734 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:29:07,734 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:29:07,735 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:29:07,740 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:29:07,760 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:29:07,762 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:29:07,763 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:07,764 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:29:07,764 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4038.817, 'ask': 4038.854, 'last': 0.0, 'time': 1759919346}
2025-10-08 10:29:07,764 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:29:07,765 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:29:07,768 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:29:07,769 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:29:07,771 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:29:07,788 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:07,789 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:07,789 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:07,790 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:07,790 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:07,790 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:29:07,791 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4038.817
2025-10-08 10:29:07,792 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42818.999999999956}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97936.00000000015}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26266.999999999825}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44387.99999999992}]
2025-10-08 10:29:07,792 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:29:07,840 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:07,851 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:29:07,853 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:29:07,854 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:29:07,855 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:29:09,882 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:29:09,961 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:29:11,471 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:29:11,473 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:29:11,473 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:29:11,474 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:29:11,475 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:29:11,476 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:29:11,479 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:29:11,479 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:11,508 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:29:11,509 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:29:11,510 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:29:11,510 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:29:11,511 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:29:11,569 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:12,013 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:29:12,016 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:29:12,019 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:29:12,021 - APP.services.mt5_service - DEBUG - Current price (cp): 4038.771
2025-10-08 10:29:12,036 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 246, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:29:12,143 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 219, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:29:12,146 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:29:12,148 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:29:12,154 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:29:12,156 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:12,158 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:29:12,160 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:29:12,166 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:29:12,169 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:12,212 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:29:12,214 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:29:12,217 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:29:12,219 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:12,220 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:29:12,221 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:29:12,228 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:29:12,230 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:12,231 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:29:12,240 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:29:12,294 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:29:12,297 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:29:12,335 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:29:12,340 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:29:12,343 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:29:12,345 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:29:12,346 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:29:12.346793+07:00
2025-10-08 10:29:12,348 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:29:12.346793+07:00
2025-10-08 10:29:12,351 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:29:12.346793+07:00 trong DST: True
2025-10-08 10:29:12,353 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:29:12,354 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:29:12,355 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:29:12,359 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:29:12,364 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:29:12,372 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:29:12,399 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:29:12,478 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:29:12,484 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:29:12,510 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:29:12,511 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:29:12,511 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:29:12,512 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:29:12,513 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:29:12,514 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:29:12,514 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:29:12,525 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:29:12,540 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:29:12,541 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:29:12,542 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:29:12,543 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:29:12,543 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:29:12,543 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:29:12,544 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:29:12,544 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:29:12,545 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:29:12,546 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:29:12,546 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:29:12,547 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:29:12,549 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:29:12,571 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:29:12,573 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:29:12,574 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:29:12,574 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:29:12,575 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:29:12,575 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4038.771, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:29:12,575 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:29:12,576 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:29:12,576 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:29:12,577 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:29:12,577 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 42773.00000000014
2025-10-08 10:29:12,578 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 97890.00000000032
2025-10-08 10:29:12,578 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 26221.000000000004
2025-10-08 10:29:12,580 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 44342.000000000095
2025-10-08 10:29:12,604 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:29:12,604 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42773.00000000014}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97890.00000000032}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26221.000000000004}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44342.000000000095}]
2025-10-08 10:29:12,605 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:29:12,605 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:29:12,606 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:29:12,606 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:29:12,607 - APP.services.mt5_service - DEBUG - Position in day range: 0.9680649767940064
2025-10-08 10:29:12,607 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:29:12,608 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:29:12.608007+07:00
2025-10-08 10:29:12,608 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:29:12.608007+07:00
2025-10-08 10:29:12,609 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:29:12.608007+07:00 trong DST: True
2025-10-08 10:29:12,609 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:29:12,609 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:29:12,613 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 211
2025-10-08 10:29:12,630 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:12,632 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:12,633 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '7700', 'price': 4038.77, 'distance_pips': 0.1}, {'level': '7725', 'price': 4038.773, 'distance_pips': 0.15}, {'level': '7750', 'price': 4038.775, 'distance_pips': 0.4}, {'level': '7775', 'price': 4038.778, 'distance_pips': 0.65}]
2025-10-08 10:29:12,633 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:29:12,633 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:12,634 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:12,634 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:29:12,635 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.771
2025-10-08 10:29:12,635 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:12,636 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:29:12,636 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:12,637 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:29:12,637 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:29:12,638 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4038.771
2025-10-08 10:29:12,639 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:12,639 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:29:12,640 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:12,640 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:29:12,641 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:29:12,641 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4038.771
2025-10-08 10:29:12,642 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:12,644 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:29:12,645 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:12,645 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:29:12,645 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:29:12,659 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.771
2025-10-08 10:29:12,668 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:12,669 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:29:12,671 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:12,671 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:29:12,672 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:12,673 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:12,673 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:29:12,675 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:29:12,676 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:29:12,676 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:29:12,699 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:29:12,699 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:29:12,700 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:29:12,702 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:29:12,702 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:29:12,703 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:29:12,703 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:29:12,703 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:29:12,704 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:29:12,704 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:29:12,704 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:29:12,706 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:29:12,707 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:12,707 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:12,708 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:29:12,729 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:29:12,731 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:29:12,731 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:29:12,732 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:29:12,733 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:29:12,734 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:12,735 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:29:12,735 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:29:12,738 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4038.771, 'ask': 4038.808, 'last': 0.0, 'time': 1759919351}
2025-10-08 10:29:12,762 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:29:12,763 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:29:12,764 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:29:12,764 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:29:12,765 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:12,765 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:12,765 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:12,766 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:12,766 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:12,767 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:29:12,769 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4038.771
2025-10-08 10:29:12,770 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42773.00000000014}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97890.00000000032}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26221.000000000004}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44342.000000000095}]
2025-10-08 10:29:12,776 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:29:12,870 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:12,870 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:29:12,871 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:29:12,872 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:29:12,873 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:29:16,475 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:29:16,477 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:29:16,477 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:29:16,477 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:29:16,479 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:29:16,480 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:29:16,482 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:29:16,483 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:16,509 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:29:16,509 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:29:16,510 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:29:16,511 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:29:16,511 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:29:16,583 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:17,012 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:29:17,014 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:29:17,015 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:29:17,016 - APP.services.mt5_service - DEBUG - Current price (cp): 4038.567
2025-10-08 10:29:17,020 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 242, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:29:17,049 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 218, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:29:17,051 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:29:17,052 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:29:17,054 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:29:17,054 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:17,055 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:29:17,055 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:29:17,058 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:29:17,059 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:17,059 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:29:17,060 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:29:17,061 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:29:17,062 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:17,062 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:29:17,062 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:29:17,064 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:29:17,065 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:17,065 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:29:17,065 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:29:17,068 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:29:17,068 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:29:17,068 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:29:17,069 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:29:17,069 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:29:17,070 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:29:17,070 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:29:17.070587+07:00
2025-10-08 10:29:17,071 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:29:17.070587+07:00
2025-10-08 10:29:17,071 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:29:17.070587+07:00 trong DST: True
2025-10-08 10:29:17,072 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:29:17,072 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:29:17,072 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:29:17,073 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:29:17,074 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:29:17,075 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:29:17,075 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:29:17,079 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:29:17,080 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:29:17,082 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:29:17,083 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:29:17,085 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:29:17,102 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:29:17,103 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:29:17,104 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:29:17,104 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:29:17,105 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:29:17,105 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:29:17,105 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:29:17,106 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:29:17,106 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:29:17,106 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:29:17,107 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:29:17,107 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:29:17,107 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:29:17,108 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:29:17,108 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:29:17,109 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:29:17,109 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:29:17,110 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:29:17,110 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:29:17,111 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:29:17,111 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:29:17,111 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:29:17,112 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:29:17,113 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4038.567, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:29:17,114 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:29:17,114 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:29:17,121 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:29:17,135 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:29:17,135 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 42568.999999999956
2025-10-08 10:29:17,136 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 97686.00000000015
2025-10-08 10:29:17,137 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 26016.999999999825
2025-10-08 10:29:17,137 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 44137.99999999992
2025-10-08 10:29:17,137 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:29:17,138 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42568.999999999956}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97686.00000000015}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26016.999999999825}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44137.99999999992}]
2025-10-08 10:29:17,138 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:29:17,139 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:29:17,139 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:29:17,140 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:29:17,140 - APP.services.mt5_service - DEBUG - Position in day range: 0.96442342020707
2025-10-08 10:29:17,140 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:29:17,141 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:29:17.141062+07:00
2025-10-08 10:29:17,141 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:29:17.141062+07:00
2025-10-08 10:29:17,141 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:29:17.141062+07:00 trong DST: True
2025-10-08 10:29:17,142 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:29:17,143 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:29:17,143 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 211
2025-10-08 10:29:17,143 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:17,144 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:17,144 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '5600', 'price': 4038.56, 'distance_pips': 0.7}, {'level': '5625', 'price': 4038.562, 'distance_pips': 0.45}, {'level': '5650', 'price': 4038.565, 'distance_pips': 0.2}, {'level': '5675', 'price': 4038.568, 'distance_pips': 0.05}]
2025-10-08 10:29:17,147 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:29:17,166 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:17,167 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:17,167 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:29:17,168 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.567
2025-10-08 10:29:17,169 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:17,169 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:29:17,170 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:17,171 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:29:17,171 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:29:17,171 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4038.567
2025-10-08 10:29:17,172 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:17,172 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:29:17,173 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:17,175 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:29:17,175 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:29:17,179 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4038.567
2025-10-08 10:29:17,196 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:17,197 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:29:17,198 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:17,198 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:29:17,199 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:29:17,200 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.567
2025-10-08 10:29:17,200 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:17,201 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:29:17,202 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:17,202 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:29:17,203 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:17,203 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:17,203 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:29:17,204 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:29:17,205 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:29:17,206 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:29:17,207 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:29:17,229 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:29:17,230 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:29:17,231 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:29:17,231 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:29:17,232 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:29:17,233 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:29:17,233 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:29:17,233 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:29:17,234 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:29:17,234 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:29:17,235 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:29:17,235 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:17,237 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:17,238 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:29:17,265 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:29:17,265 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:29:17,266 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:29:17,268 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:29:17,290 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:29:17,292 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:17,293 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:29:17,293 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4038.567, 'ask': 4038.604, 'last': 0.0, 'time': 1759919356}
2025-10-08 10:29:17,293 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:29:17,294 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:29:17,297 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:29:17,297 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:29:17,298 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:29:17,298 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:17,300 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:17,300 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:17,322 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:17,323 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:17,323 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:29:17,324 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4038.567
2025-10-08 10:29:17,324 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42568.999999999956}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97686.00000000015}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26016.999999999825}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44137.99999999992}]
2025-10-08 10:29:17,325 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:29:17,376 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:17,383 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:29:17,383 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:29:17,384 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:29:17,386 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:29:21,478 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:29:21,480 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:29:21,481 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:29:21,481 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:29:21,484 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:29:21,484 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:29:21,488 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:29:21,489 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:21,509 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:21,882 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:29:21,883 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:29:21,884 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:29:21,884 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:29:21,885 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:29:22,386 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:29:22,387 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:29:22,388 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:29:22,388 - APP.services.mt5_service - DEBUG - Current price (cp): 4038.206
2025-10-08 10:29:22,392 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 242, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:29:22,419 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 217, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:29:22,424 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:29:22,425 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:29:22,427 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:29:22,432 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:22,443 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:29:22,444 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:29:22,448 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:29:22,449 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:22,450 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:29:22,450 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:29:22,452 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:29:22,452 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:22,453 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:29:22,453 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:29:22,456 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:29:22,456 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:22,457 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:29:22,457 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:29:22,462 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:29:22,478 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:29:22,479 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:29:22,480 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:29:22,481 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:29:22,481 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:29:22,481 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:29:22.481848+07:00
2025-10-08 10:29:22,482 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:29:22.481848+07:00
2025-10-08 10:29:22,483 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:29:22.481848+07:00 trong DST: True
2025-10-08 10:29:22,484 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:29:22,484 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:29:22,484 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:29:22,486 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:29:22,487 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:29:22,488 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:29:22,489 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:29:22,513 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:29:22,514 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:29:22,515 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:29:22,515 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:29:22,516 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:29:22,516 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:29:22,516 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:29:22,517 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:29:22,518 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:29:22,518 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:29:22,519 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:29:22,524 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:29:22,537 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:29:22,539 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:29:22,539 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:29:22,540 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:29:22,541 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:29:22,541 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:29:22,542 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:29:22,542 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:29:22,543 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:29:22,543 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:29:22,544 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:29:22,544 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:29:22,544 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:29:22,545 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:29:22,545 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:29:22,546 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:29:22,546 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4038.206, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:29:22,546 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:29:22,547 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:29:22,547 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:29:22,547 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:29:22,548 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 42208.00000000008
2025-10-08 10:29:22,549 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 97325.00000000028
2025-10-08 10:29:22,549 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 25655.99999999995
2025-10-08 10:29:22,550 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 43777.000000000044
2025-10-08 10:29:22,550 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:29:22,550 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42208.00000000008}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97325.00000000028}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25655.99999999995}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43777.000000000044}]
2025-10-08 10:29:22,551 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:29:22,553 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:29:22,575 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:29:22,575 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:29:22,576 - APP.services.mt5_service - DEBUG - Position in day range: 0.957979293109607
2025-10-08 10:29:22,576 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:29:22,577 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:29:22.577379+07:00
2025-10-08 10:29:22,577 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:29:22.577379+07:00
2025-10-08 10:29:22,578 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:29:22.577379+07:00 trong DST: True
2025-10-08 10:29:22,578 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:29:22,579 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:29:22,579 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 211
2025-10-08 10:29:22,581 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:22,581 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:22,581 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '2000', 'price': 4038.2, 'distance_pips': 0.6}, {'level': '2025', 'price': 4038.203, 'distance_pips': 0.35}, {'level': '2050', 'price': 4038.205, 'distance_pips': 0.1}, {'level': '2075', 'price': 4038.208, 'distance_pips': 0.15}]
2025-10-08 10:29:22,582 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:29:22,582 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:22,583 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:22,599 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:29:22,600 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.206
2025-10-08 10:29:22,602 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:22,602 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:29:22,604 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:22,604 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:29:22,605 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:29:22,605 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4038.206
2025-10-08 10:29:22,606 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:22,606 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:29:22,607 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:22,607 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:29:22,607 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:29:22,608 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4038.206
2025-10-08 10:29:22,609 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:22,609 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:29:22,610 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:22,610 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:29:22,611 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:29:22,611 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.206
2025-10-08 10:29:22,612 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:22,613 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:29:22,613 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:22,614 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:29:22,615 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:22,635 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:22,639 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:29:22,639 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:29:22,640 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:29:22,641 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:29:22,641 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:29:22,642 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:29:22,642 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:29:22,643 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:29:22,643 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:29:22,644 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:29:22,644 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:29:22,645 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:29:22,645 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:29:22,645 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:29:22,667 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:29:22,669 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:29:22,669 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:22,670 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:22,670 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:29:22,670 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:29:22,671 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:29:22,671 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:29:22,672 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:29:22,673 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:29:22,674 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:22,675 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:29:22,675 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:29:22,675 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4038.206, 'ask': 4038.243, 'last': 0.0, 'time': 1759919362}
2025-10-08 10:29:22,700 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:29:22,700 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:29:22,701 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:29:22,701 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:29:22,702 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:22,703 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:22,703 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:22,704 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:22,704 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:22,705 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:29:22,705 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4038.206
2025-10-08 10:29:22,706 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42208.00000000008}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97325.00000000028}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25655.99999999995}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43777.000000000044}]
2025-10-08 10:29:22,706 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:29:22,800 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:22,801 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:29:22,802 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:29:22,803 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:29:22,805 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:29:24,883 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:29:24,913 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:29:26,482 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:29:26,487 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:29:26,488 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:29:26,520 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:29:26,538 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:29:26,541 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:29:26,547 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:29:26,555 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:29:26,579 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:29:26,585 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:29:26,587 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:26,590 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:29:26,592 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:29:26,708 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:27,116 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:29:27,155 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:29:27,218 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:29:27,230 - APP.services.mt5_service - DEBUG - Current price (cp): 4038.316
2025-10-08 10:29:27,319 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 246, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:29:27,356 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 217, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:29:27,359 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:29:27,361 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:29:27,386 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:29:27,390 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:27,447 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:29:27,449 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:29:27,456 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:29:27,476 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:27,478 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:29:27,479 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:29:27,482 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:29:27,484 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:27,485 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:29:27,514 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:29:27,516 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:29:27,545 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:27,547 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:29:27,549 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:29:27,580 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:29:27,603 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:29:27,604 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:29:27,606 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:29:27,607 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:29:27,609 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:29:27,610 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:29:27.610331+07:00
2025-10-08 10:29:27,615 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:29:27.610331+07:00
2025-10-08 10:29:27,641 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:29:27.610331+07:00 trong DST: True
2025-10-08 10:29:27,674 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:29:27,701 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:29:27,710 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:29:27,735 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:29:27,761 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:29:27,763 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:29:27,763 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:29:27,771 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:29:27,796 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:29:27,813 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:29:27,838 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:29:27,839 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:29:27,839 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:29:27,841 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:29:27,847 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:29:27,857 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:29:27,859 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:29:27,861 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:29:27,909 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:29:27,917 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:29:27,934 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:29:27,937 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:29:27,940 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:29:28,032 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:29:28,046 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:29:28,110 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:29:28,182 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:29:28,234 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:29:28,280 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:29:28,335 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:29:28,351 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:29:28,413 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:29:28,469 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:29:28,533 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:29:28,547 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:29:28,607 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4038.316, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:29:28,628 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:29:28,667 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:29:28,712 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:29:28,783 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:29:28,876 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 42317.99999999975
2025-10-08 10:29:28,972 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 97434.99999999994
2025-10-08 10:29:29,095 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 25765.99999999962
2025-10-08 10:29:29,171 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 43886.999999999716
2025-10-08 10:29:29,231 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:29:29,275 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42317.99999999975}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97434.99999999994}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25765.99999999962}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43886.999999999716}]
2025-10-08 10:29:29,291 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:29:29,326 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:29:29,360 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:29:29,418 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:29:29,450 - APP.services.mt5_service - DEBUG - Position in day range: 0.9599428775437319
2025-10-08 10:29:29,454 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:29:29,479 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:29:29.479291+07:00
2025-10-08 10:29:29,482 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:29:29.479291+07:00
2025-10-08 10:29:29,486 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:29:29.479291+07:00 trong DST: True
2025-10-08 10:29:29,514 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:29:29,516 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:29:29,517 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 211
2025-10-08 10:29:29,539 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:29,541 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:29,542 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '3100', 'price': 4038.31, 'distance_pips': 0.6}, {'level': '3125', 'price': 4038.312, 'distance_pips': 0.35}, {'level': '3150', 'price': 4038.315, 'distance_pips': 0.1}, {'level': '3175', 'price': 4038.318, 'distance_pips': 0.15}]
2025-10-08 10:29:29,542 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:29:29,543 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:29,544 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:29,544 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:29:29,545 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.316
2025-10-08 10:29:29,545 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:29,546 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:29:29,575 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:29,578 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:29:29,579 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:29:29,580 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4038.316
2025-10-08 10:29:29,620 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:29,621 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:29:29,622 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:29,623 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:29:29,623 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:29:29,625 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4038.316
2025-10-08 10:29:29,626 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:29,626 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:29:29,627 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:29,628 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:29:29,628 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:29:29,629 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.316
2025-10-08 10:29:29,630 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:29,630 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:29:29,631 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:29,632 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:29:29,632 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:29,633 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:29,635 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:29:29,636 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:29:29,636 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:29:29,637 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:29:29,637 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:29:29,638 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:29:29,638 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:29:29,639 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:29:29,639 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:29:29,640 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:29:29,640 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:29:29,641 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:29:29,641 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:29:29,642 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:29:29,669 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:29:29,671 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:29:29,671 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:29,672 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:29,672 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:29:29,673 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:29:29,673 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:29:29,697 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:29:29,698 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:29:29,700 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:29:29,701 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:29,703 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:29:29,703 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:29:29,704 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4038.316, 'ask': 4038.353, 'last': 0.0, 'time': 1759919366}
2025-10-08 10:29:29,731 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:29:29,731 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:29:29,733 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:29:29,734 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:29:29,735 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:29,735 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:29,736 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:29,736 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:29,746 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:29,761 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:29:29,762 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4038.316
2025-10-08 10:29:29,762 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42317.99999999975}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97434.99999999994}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25765.99999999962}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43886.999999999716}]
2025-10-08 10:29:29,763 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:29:29,828 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:29,829 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:29:29,829 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:29:29,832 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:29:29,834 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:29:31,528 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:29:31,530 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:29:31,530 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:29:31,531 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:29:31,534 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:29:31,535 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:29:31,537 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:29:31,538 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:31,541 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:29:31,541 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:29:31,542 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:29:31,543 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:29:31,543 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:29:31,549 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:32,045 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:29:32,047 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:29:32,048 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:29:32,051 - APP.services.mt5_service - DEBUG - Current price (cp): 4038.457
2025-10-08 10:29:32,056 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 246, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:29:32,076 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 217, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:29:32,077 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:29:32,078 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:29:32,083 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:29:32,106 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:32,110 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:29:32,116 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:29:32,123 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:29:32,138 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:32,139 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:29:32,145 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:29:32,147 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:29:32,169 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:32,173 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:29:32,178 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:29:32,204 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:29:32,211 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:32,213 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:29:32,233 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:29:32,267 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:29:32,274 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:29:32,297 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:29:32,325 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:29:32,363 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:29:32,370 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:29:32,385 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:29:32.385758+07:00
2025-10-08 10:29:32,387 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:29:32.385758+07:00
2025-10-08 10:29:32,390 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:29:32.385758+07:00 trong DST: True
2025-10-08 10:29:32,392 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:29:32,436 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:29:32,440 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:29:32,443 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:29:32,451 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:29:32,456 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:29:32,482 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:29:32,485 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:29:32,487 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:29:32,512 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:29:32,513 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:29:32,518 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:29:32,521 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:29:32,545 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:29:32,548 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:29:32,553 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:29:32,554 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:29:32,557 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:29:32,576 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:29:32,580 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:29:32,583 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:29:32,607 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:29:32,608 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:29:32,615 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:29:32,618 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:29:32,638 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:29:32,639 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:29:32,640 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:29:32,641 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:29:32,642 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:29:32,646 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:29:32,646 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:29:32,647 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:29:32,647 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:29:32,669 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:29:32,669 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4038.457, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:29:32,670 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:29:32,671 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:29:32,672 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:29:32,672 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:29:32,673 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 42458.99999999983
2025-10-08 10:29:32,674 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 97576.00000000001
2025-10-08 10:29:32,674 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 25906.999999999698
2025-10-08 10:29:32,676 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 44027.99999999979
2025-10-08 10:29:32,677 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:29:32,677 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42458.99999999983}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97576.00000000001}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25906.999999999698}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44027.99999999979}]
2025-10-08 10:29:32,696 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:29:32,698 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:29:32,699 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:29:32,699 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:29:32,700 - APP.services.mt5_service - DEBUG - Position in day range: 0.962459835772937
2025-10-08 10:29:32,700 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:29:32,701 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:29:32.701083+07:00
2025-10-08 10:29:32,701 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:29:32.701083+07:00
2025-10-08 10:29:32,701 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:29:32.701083+07:00 trong DST: True
2025-10-08 10:29:32,702 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:29:32,702 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:29:32,703 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 211
2025-10-08 10:29:32,703 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:32,703 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:32,704 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4500', 'price': 4038.45, 'distance_pips': 0.7}, {'level': '4525', 'price': 4038.453, 'distance_pips': 0.45}, {'level': '4550', 'price': 4038.455, 'distance_pips': 0.2}, {'level': '4575', 'price': 4038.458, 'distance_pips': 0.05}]
2025-10-08 10:29:32,704 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:29:32,705 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:32,705 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:32,705 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:29:32,706 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.457
2025-10-08 10:29:32,707 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:32,707 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:29:32,708 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:32,709 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:29:32,709 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:29:32,710 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4038.457
2025-10-08 10:29:32,710 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:32,711 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:29:32,711 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:32,712 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:29:32,712 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:29:32,713 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4038.457
2025-10-08 10:29:32,714 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:32,714 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:29:32,715 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:32,715 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:29:32,716 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:29:32,716 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.457
2025-10-08 10:29:32,727 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:32,732 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:29:32,734 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:32,735 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:29:32,736 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:32,736 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:32,737 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:29:32,737 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:29:32,738 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:29:32,738 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:29:32,738 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:29:32,739 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:29:32,739 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:29:32,740 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:29:32,740 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:29:32,740 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:29:32,749 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:29:32,761 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:29:32,762 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:29:32,763 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:29:32,764 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:29:32,764 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:29:32,765 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:32,765 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:32,765 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:29:32,766 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:29:32,766 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:29:32,767 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:29:32,767 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:29:32,769 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:29:32,770 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:32,781 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:29:32,792 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4038.457, 'ask': 4038.494, 'last': 0.0, 'time': 1759919371}
2025-10-08 10:29:32,795 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:29:32,796 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:29:32,796 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:29:32,797 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:29:32,797 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:29:32,798 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:32,799 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:32,801 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:32,802 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:32,816 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:32,824 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:29:32,827 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4038.457
2025-10-08 10:29:32,828 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42458.99999999983}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97576.00000000001}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25906.999999999698}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44027.99999999979}]
2025-10-08 10:29:32,828 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:29:32,868 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:32,886 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:29:32,886 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:29:32,887 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:29:32,889 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:29:36,532 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:29:36,535 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:29:36,535 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:29:36,536 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:29:36,538 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:29:36,541 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:29:36,545 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:29:36,546 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:36,548 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:29:36,550 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:29:36,551 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:29:36,551 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:29:36,552 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:29:36,604 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:37,054 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:29:37,058 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:29:37,061 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:29:37,089 - APP.services.mt5_service - DEBUG - Current price (cp): 4039.291
2025-10-08 10:29:37,101 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 250, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:29:37,134 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 217, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:29:37,158 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:29:37,208 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:29:37,263 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:29:37,274 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:37,505 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:29:37,703 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:29:37,777 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:29:37,930 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:37,937 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:29:37,940 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:29:37,960 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:29:37,962 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:37,964 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:29:37,965 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:29:37,969 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:29:37,970 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:37,971 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:29:38,067 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:29:38,130 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:29:38,136 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:29:38,137 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:29:38,137 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:29:38,138 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:29:38,139 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:29:38,139 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:29:38.139623+07:00
2025-10-08 10:29:38,140 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:29:38.139623+07:00
2025-10-08 10:29:38,141 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:29:38.139623+07:00 trong DST: True
2025-10-08 10:29:38,141 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:29:38,142 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:29:38,142 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:29:38,144 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:29:38,145 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:29:38,147 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:29:38,147 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:29:38,152 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:29:38,153 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:29:38,153 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:29:38,154 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:29:38,155 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:29:38,155 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:29:38,156 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:29:38,156 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:29:38,157 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:29:38,157 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:29:38,157 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:29:38,158 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:29:38,158 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:29:38,159 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:29:38,159 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:29:38,160 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:29:38,162 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:29:38,163 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:29:38,165 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:29:38,168 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:29:38,190 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:29:38,192 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:29:38,193 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:29:38,193 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:29:38,194 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:29:38,195 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:29:38,195 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:29:38,196 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:29:38,196 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4039.291, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:29:38,197 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:29:38,197 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:29:38,198 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:29:38,198 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:29:38,199 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 43293.00000000012
2025-10-08 10:29:38,199 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 98410.0000000003
2025-10-08 10:29:38,200 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 26740.999999999985
2025-10-08 10:29:38,200 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 44862.00000000008
2025-10-08 10:29:38,201 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:29:38,201 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43293.00000000012}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98410.0000000003}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26740.999999999985}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44862.00000000008}]
2025-10-08 10:29:38,202 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:29:38,202 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:29:38,203 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:29:38,203 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:29:38,204 - APP.services.mt5_service - DEBUG - Position in day range: 0.9773473759371692
2025-10-08 10:29:38,204 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:29:38,205 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:29:38.205185+07:00
2025-10-08 10:29:38,205 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:29:38.205185+07:00
2025-10-08 10:29:38,206 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:29:38.205185+07:00 trong DST: True
2025-10-08 10:29:38,231 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:29:38,232 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:29:38,232 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 211
2025-10-08 10:29:38,233 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:38,234 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:38,234 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '2900', 'price': 4039.29, 'distance_pips': 0.1}, {'level': '2925', 'price': 4039.293, 'distance_pips': 0.15}, {'level': '2950', 'price': 4039.295, 'distance_pips': 0.4}, {'level': '2975', 'price': 4039.298, 'distance_pips': 0.65}]
2025-10-08 10:29:38,235 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:29:38,235 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:38,236 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:38,236 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:29:38,257 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.291
2025-10-08 10:29:38,272 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:38,273 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:29:38,275 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:38,276 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:29:38,277 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:29:38,278 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4039.291
2025-10-08 10:29:38,278 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:38,279 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:29:38,280 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:38,280 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:29:38,281 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:29:38,282 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4039.291
2025-10-08 10:29:38,282 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:38,283 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:29:38,285 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:38,285 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:29:38,286 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:29:38,287 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.291
2025-10-08 10:29:38,288 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:38,288 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:29:38,290 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:38,290 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:29:38,291 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:38,291 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:38,292 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:29:38,292 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:29:38,292 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:29:38,293 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:29:38,293 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:29:38,294 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:29:38,294 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:29:38,294 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:29:38,296 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:29:38,296 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:29:38,296 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:29:38,297 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:29:38,297 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:29:38,298 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:29:38,298 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:29:38,334 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:29:38,336 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:38,337 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:38,337 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:29:38,338 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:29:38,339 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:29:38,339 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:29:38,340 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:29:38,341 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:29:38,349 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:38,350 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:29:38,350 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:29:38,351 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4039.291, 'ask': 4039.328, 'last': 0.0, 'time': 1759919376}
2025-10-08 10:29:38,354 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:29:38,355 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:29:38,359 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:29:38,407 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:29:38,412 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:38,414 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:38,418 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:38,420 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:38,422 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:38,422 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:29:38,423 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4039.291
2025-10-08 10:29:38,423 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43293.00000000012}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98410.0000000003}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26740.999999999985}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44862.00000000008}]
2025-10-08 10:29:38,424 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:29:38,504 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:38,505 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:29:38,506 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:29:38,508 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:29:38,510 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:29:39,885 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:29:39,914 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:29:41,537 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:29:41,539 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:29:41,540 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:29:41,540 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:29:41,542 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:29:41,543 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:29:41,546 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:29:41,547 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:41,569 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:29:41,570 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:29:41,570 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:29:41,571 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:29:41,571 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:29:41,623 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:42,073 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:29:42,074 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:29:42,075 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:29:42,075 - APP.services.mt5_service - DEBUG - Current price (cp): 4040.331
2025-10-08 10:29:42,081 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 258, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:29:42,111 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 218, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:29:42,113 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:29:42,113 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:29:42,116 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:29:42,116 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:42,117 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:29:42,132 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:29:42,137 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:29:42,137 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:42,138 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:29:42,139 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:29:42,140 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:29:42,140 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:42,141 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:29:42,141 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:29:42,143 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:29:42,144 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:42,145 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:29:42,145 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:29:42,152 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:29:42,167 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:29:42,168 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:29:42,168 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:29:42,169 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:29:42,169 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:29:42,170 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:29:42.170154+07:00
2025-10-08 10:29:42,170 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:29:42.170154+07:00
2025-10-08 10:29:42,170 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:29:42.170154+07:00 trong DST: True
2025-10-08 10:29:42,171 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:29:42,171 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:29:42,172 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:29:42,173 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:29:42,174 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:29:42,175 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:29:42,181 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:29:42,201 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:29:42,202 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:29:42,202 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:29:42,202 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:29:42,203 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:29:42,204 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:29:42,204 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:29:42,204 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:29:42,205 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:29:42,205 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:29:42,206 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:29:42,206 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:29:42,208 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:29:42,208 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:29:42,208 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:29:42,231 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:29:42,233 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:29:42,233 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:29:42,234 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:29:42,235 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:29:42,235 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:29:42,236 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:29:42,236 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:29:42,236 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:29:42,237 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:29:42,240 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:29:42,240 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:29:42,261 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:29:42,262 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4040.331, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:29:42,262 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:29:42,262 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:29:42,263 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:29:42,264 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:29:42,264 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 44333.00000000008
2025-10-08 10:29:42,265 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 99450.00000000028
2025-10-08 10:29:42,265 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27780.99999999995
2025-10-08 10:29:42,266 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45902.000000000044
2025-10-08 10:29:42,267 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:29:42,268 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44333.00000000008}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99450.00000000028}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27780.99999999995}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45902.000000000044}]
2025-10-08 10:29:42,268 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:29:42,292 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:29:42,292 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:29:42,293 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:29:42,293 - APP.services.mt5_service - DEBUG - Position in day range: 0.9959121742234949
2025-10-08 10:29:42,294 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:29:42,294 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:29:42.294605+07:00
2025-10-08 10:29:42,295 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:29:42.294605+07:00
2025-10-08 10:29:42,295 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:29:42.294605+07:00 trong DST: True
2025-10-08 10:29:42,295 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:29:42,296 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:29:42,297 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 211
2025-10-08 10:29:42,298 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:42,298 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:42,299 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '3300', 'price': 4040.33, 'distance_pips': 0.1}, {'level': '3325', 'price': 4040.332, 'distance_pips': 0.15}, {'level': '3350', 'price': 4040.335, 'distance_pips': 0.4}, {'level': '3375', 'price': 4040.338, 'distance_pips': 0.65}]
2025-10-08 10:29:42,299 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:29:42,299 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:42,301 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:42,302 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:29:42,312 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.331
2025-10-08 10:29:42,315 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:42,316 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:29:42,321 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:42,322 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:29:42,322 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:29:42,323 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4040.331
2025-10-08 10:29:42,323 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:42,324 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:29:42,325 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:42,325 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:29:42,325 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:29:42,326 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4040.331
2025-10-08 10:29:42,326 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:42,327 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:29:42,327 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:42,328 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:29:42,328 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:29:42,329 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.331
2025-10-08 10:29:42,330 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:42,330 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:29:42,331 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:42,339 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:29:42,358 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:42,358 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:42,359 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:29:42,360 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:29:42,360 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:29:42,361 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:29:42,361 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:29:42,361 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:29:42,362 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:29:42,387 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:29:42,388 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:29:42,389 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:29:42,389 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:29:42,390 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:29:42,391 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:29:42,391 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:29:42,392 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:29:42,392 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:29:42,393 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:42,393 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:42,395 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:29:42,397 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:29:42,420 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:29:42,422 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:29:42,423 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:29:42,424 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:29:42,428 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:42,429 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4040.331, 'ask': 4040.368, 'last': 0.0, 'time': 1759919381}
2025-10-08 10:29:42,429 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:29:42,452 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:29:42,454 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:42,455 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:29:42,455 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:29:42,455 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:42,461 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:29:42,479 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:29:42,480 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:42,481 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:42,481 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:42,482 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:29:42,482 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4040.331
2025-10-08 10:29:42,482 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44333.00000000008}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99450.00000000028}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27780.99999999995}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45902.000000000044}]
2025-10-08 10:29:42,483 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:29:42,556 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:42,556 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:29:42,557 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:29:42,559 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:29:42,560 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:29:46,541 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:29:46,543 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:29:46,544 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:29:46,544 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:29:46,548 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:29:46,552 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:29:46,557 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:29:46,576 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:29:46,577 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:46,580 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:29:46,580 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:29:46,581 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:29:46,606 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:29:46,671 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:47,108 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:29:47,109 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:29:47,112 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:29:47,114 - APP.services.mt5_service - DEBUG - Current price (cp): 4040.118
2025-10-08 10:29:47,119 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 260, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:29:47,141 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 218, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:29:47,146 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:29:47,169 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:29:47,199 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:29:47,210 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:47,231 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:29:47,232 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:29:47,236 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:29:47,238 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:47,266 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:29:47,269 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:29:47,297 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:29:47,329 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:47,334 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:29:47,335 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:29:47,338 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:29:47,339 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:47,340 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:29:47,342 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:29:47,345 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:29:47,346 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:29:47,347 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:29:47,348 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:29:47,349 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:29:47,350 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:29:47,351 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:29:47.351478+07:00
2025-10-08 10:29:47,352 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:29:47.351478+07:00
2025-10-08 10:29:47,353 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:29:47.351478+07:00 trong DST: True
2025-10-08 10:29:47,355 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:29:47,356 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:29:47,357 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:29:47,361 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:29:47,363 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:29:47,368 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:29:47,368 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:29:47,419 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:29:47,420 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:29:47,423 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:29:47,424 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:29:47,453 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:29:47,454 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:29:47,455 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:29:47,456 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:29:47,481 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:29:47,481 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:29:47,482 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:29:47,482 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:29:47,483 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:29:47,483 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:29:47,483 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:29:47,484 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:29:47,485 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:29:47,486 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:29:47,486 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:29:47,488 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:29:47,514 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:29:47,516 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:29:47,518 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:29:47,561 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:29:47,562 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:29:47,563 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:29:47,563 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:29:47,564 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:29:47,564 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4040.118, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:29:47,564 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:29:47,565 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:29:47,565 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:29:47,566 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:29:47,566 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 44119.99999999989
2025-10-08 10:29:47,567 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 99237.00000000007
2025-10-08 10:29:47,567 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27567.999999999756
2025-10-08 10:29:47,567 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45688.99999999985
2025-10-08 10:29:47,568 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:29:47,568 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44119.99999999989}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99237.00000000007}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27567.999999999756}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45688.99999999985}]
2025-10-08 10:29:47,569 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:29:47,570 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:29:47,570 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:29:47,571 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:29:47,571 - APP.services.mt5_service - DEBUG - Position in day range: 0.9921099607283111
2025-10-08 10:29:47,571 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:29:47,572 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:29:47.572289+07:00
2025-10-08 10:29:47,572 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:29:47.572289+07:00
2025-10-08 10:29:47,573 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:29:47.572289+07:00 trong DST: True
2025-10-08 10:29:47,573 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:29:47,573 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:29:47,573 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 211
2025-10-08 10:29:47,574 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:47,574 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:47,575 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '1100', 'price': 4040.11, 'distance_pips': 0.8}, {'level': '1125', 'price': 4040.113, 'distance_pips': 0.55}, {'level': '1150', 'price': 4040.115, 'distance_pips': 0.3}, {'level': '1175', 'price': 4040.118, 'distance_pips': 0.05}]
2025-10-08 10:29:47,575 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:29:47,576 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:47,576 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:47,577 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:29:47,577 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.118
2025-10-08 10:29:47,578 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:47,578 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:29:47,579 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:47,579 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:29:47,580 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:29:47,580 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4040.118
2025-10-08 10:29:47,581 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:47,581 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:29:47,582 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:47,583 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:29:47,585 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:29:47,588 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4040.118
2025-10-08 10:29:47,609 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:47,609 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:29:47,610 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:47,611 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:29:47,611 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:29:47,612 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.118
2025-10-08 10:29:47,612 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:47,613 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:29:47,614 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:47,616 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:29:47,617 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:47,636 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:47,637 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:29:47,637 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:29:47,638 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:29:47,638 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:29:47,639 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:29:47,640 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:29:47,640 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:29:47,641 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:29:47,641 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:29:47,641 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:29:47,642 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:29:47,642 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:29:47,642 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:29:47,642 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:29:47,643 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:29:47,643 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:29:47,643 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:47,644 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:47,647 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:29:47,659 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:29:47,670 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:29:47,672 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:29:47,673 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:29:47,674 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:29:47,677 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:47,687 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4040.118, 'ask': 4040.155, 'last': 0.0, 'time': 1759919386}
2025-10-08 10:29:47,702 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:29:47,703 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:29:47,704 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:29:47,704 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:29:47,704 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:47,707 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:29:47,709 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:47,718 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:29:47,728 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:47,730 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:47,731 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:47,731 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:29:47,732 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4040.118
2025-10-08 10:29:47,732 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44119.99999999989}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99237.00000000007}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27567.999999999756}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45688.99999999985}]
2025-10-08 10:29:47,733 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:29:47,775 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:47,776 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:29:47,776 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:29:47,777 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:29:47,778 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:29:51,546 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:29:51,548 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:29:51,548 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:29:51,549 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:29:51,551 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:29:51,551 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:29:51,554 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:29:51,555 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:51,578 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:29:51,578 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:29:51,579 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:29:51,579 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:29:51,580 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:29:51,591 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:52,081 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:29:52,083 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:29:52,084 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:29:52,084 - APP.services.mt5_service - DEBUG - Current price (cp): 4040.969
2025-10-08 10:29:52,088 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 265, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:29:52,118 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 218, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:29:52,119 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:29:52,120 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:29:52,122 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:29:52,123 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:52,123 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:29:52,124 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:29:52,126 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:29:52,127 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:52,127 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:29:52,128 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:29:52,130 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:29:52,131 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:52,131 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:29:52,132 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:29:52,133 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:29:52,134 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:52,134 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:29:52,134 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:29:52,137 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:29:52,137 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:29:52,137 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:29:52,138 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:29:52,138 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:29:52,139 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:29:52,139 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:29:52.139357+07:00
2025-10-08 10:29:52,139 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:29:52.139357+07:00
2025-10-08 10:29:52,140 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:29:52.139357+07:00 trong DST: True
2025-10-08 10:29:52,140 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:29:52,141 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:29:52,141 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:29:52,142 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:29:52,142 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:29:52,144 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:29:52,144 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:29:52,152 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:29:52,169 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:29:52,170 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:29:52,170 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:29:52,171 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:29:52,171 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:29:52,172 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:29:52,172 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:29:52,172 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:29:52,173 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:29:52,173 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:29:52,174 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:29:52,174 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:29:52,174 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:29:52,175 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:29:52,175 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:29:52,198 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:29:52,199 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:29:52,200 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:29:52,201 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:29:52,201 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:29:52,202 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:29:52,202 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:29:52,203 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:29:52,203 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:29:52,204 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:29:52,204 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:29:52,205 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:29:52,205 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4040.969, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:29:52,206 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:29:52,206 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:29:52,217 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:29:52,233 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:29:52,234 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 44971.0
2025-10-08 10:29:52,234 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 100088.00000000019
2025-10-08 10:29:52,235 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 28418.99999999987
2025-10-08 10:29:52,235 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 46539.99999999996
2025-10-08 10:29:52,235 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:29:52,236 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44971.0}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 100088.00000000019}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 28418.99999999987}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 46539.99999999996}]
2025-10-08 10:29:52,237 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:29:52,238 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:29:52,241 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:29:52,260 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:29:52,261 - APP.services.mt5_service - DEBUG - Position in day range: 1.0073009639414514
2025-10-08 10:29:52,262 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:29:52,262 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:29:52.262724+07:00
2025-10-08 10:29:52,263 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:29:52.262724+07:00
2025-10-08 10:29:52,263 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:29:52.262724+07:00 trong DST: True
2025-10-08 10:29:52,264 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:29:52,264 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:29:52,265 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 211
2025-10-08 10:29:52,265 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:52,265 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:52,266 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '9600', 'price': 4040.96, 'distance_pips': 0.9}, {'level': '9625', 'price': 4040.963, 'distance_pips': 0.65}, {'level': '9650', 'price': 4040.965, 'distance_pips': 0.4}, {'level': '9675', 'price': 4040.968, 'distance_pips': 0.15}]
2025-10-08 10:29:52,267 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:29:52,268 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:52,269 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:52,269 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:29:52,296 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.969
2025-10-08 10:29:52,296 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:52,297 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:29:52,298 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:52,298 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:29:52,299 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:29:52,299 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4040.969
2025-10-08 10:29:52,300 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:52,304 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:29:52,315 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:52,328 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:29:52,329 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:29:52,330 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4040.969
2025-10-08 10:29:52,331 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:52,331 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:29:52,332 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:52,334 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:29:52,357 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:29:52,358 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.969
2025-10-08 10:29:52,360 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:52,360 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:29:52,361 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:52,362 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:29:52,362 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:52,363 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:52,363 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:29:52,390 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:29:52,392 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:29:52,393 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:29:52,394 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:29:52,448 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:29:52,450 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:29:52,450 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:29:52,451 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:29:52,451 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:29:52,452 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:29:52,452 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:29:52,453 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:29:52,453 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:29:52,453 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:29:52,454 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:29:52,454 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:52,454 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:52,455 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:29:52,455 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:29:52,456 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:29:52,456 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:29:52,460 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:29:52,485 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:29:52,487 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:52,488 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:29:52,488 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:29:52,489 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4040.969, 'ask': 4041.006, 'last': 0.0, 'time': 1759919391}
2025-10-08 10:29:52,514 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:29:52,514 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:29:52,515 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:29:52,515 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:29:52,516 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:52,516 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:52,517 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:52,517 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:52,518 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:52,518 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:29:52,518 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4040.969
2025-10-08 10:29:52,519 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44971.0}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 100088.00000000019}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 28418.99999999987}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 46539.99999999996}]
2025-10-08 10:29:52,520 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:29:52,548 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:52,548 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:29:52,549 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:29:52,551 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:29:52,565 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:29:54,888 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:29:54,983 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:29:55,641 - APP.ui.app_ui - INFO - Autorun tick: Kích hoạt worker kiểm tra.
2025-10-08 10:29:55,642 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_autorun_tick_worker' vào thread pool.
2025-10-08 10:29:55,643 - APP.ui.app_ui - DEBUG - Autorun tick worker: Bắt đầu kiểm tra điều kiện.
2025-10-08 10:29:55,644 - APP.ui.app_ui - INFO - Autorun tick worker: Điều kiện hợp lệ, yêu cầu bắt đầu phân tích trên luồng UI.
2025-10-08 10:29:55,687 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: start_analysis
2025-10-08 10:29:55,695 - APP.ui.app_ui - INFO - Yêu cầu bắt đầu phân tích từ UI.
2025-10-08 10:29:55,696 - APP.ui.utils.ui_builder - DEBUG - Đã thay đổi trạng thái nút Start/Stop thành 'disabled'. Các điều khiển khác không bị ảnh hưởng.
2025-10-08 10:29:55,697 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:29:55,697 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:29:55,698 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:29:55,698 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:29:55,699 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:29:55,700 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:29:55,700 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:29:55,701 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:29:55,701 - APP.services.te_service - INFO - Đăng nhập thành công vào Trading Economics API.
2025-10-08 10:29:55,702 - APP.services.news_service - DEBUG - Cấu hình NewsService đã được cập nhật.
2025-10-08 10:29:55,703 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-08 10:29:55,703 - APP.ui.app_ui - INFO - Đã khởi tạo và bắt đầu luồng AnalysisWorker.
2025-10-08 10:29:55,703 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-08 10:29:55,707 - APP.services.gemini_service - INFO - Đã khởi tạo model 'models/gemini-2.5-flash' thành công.
2025-10-08 10:29:55,708 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 2: Xây dựng ngữ cảnh và kiểm tra điều kiện.
2025-10-08 10:29:55,711 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-RUN.
2025-10-08 10:29:55,732 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 3: Chuẩn bị và upload ảnh (song song).
2025-10-08 10:29:55,733 - APP.analysis.image_processor - DEBUG - Đang thử tải cache upload.
2025-10-08 10:29:55,738 - APP.services.mt5_service - DEBUG - Bắt đầu get_active_killzone cho 2025-10-08 10:29:55.732329 với timezone Asia/Ho_Chi_Minh
2025-10-08 10:29:55,738 - APP.analysis.image_processor - DEBUG - Đã tải cache upload với 4 mục.
2025-10-08 10:29:55,739 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-08 10:29:55.732329+07:00, Target TZ: None
2025-10-08 10:29:55,741 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 10:29:55.732329+07:00
2025-10-08 10:29:55,741 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 10:29:55.732329+07:00 trong DST: True
2025-10-08 10:29:55,763 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:29:55,764 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:29:55,765 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_H1.png: 15022:1759914264:adcc044a34c2739b
2025-10-08 10:29:55,766 - APP.services.mt5_service - DEBUG - Không trong killzone nào.
2025-10-08 10:29:55,766 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M1.png: 21123:1759914329:c9ca25adc2713e89
2025-10-08 10:29:55,767 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M15.png: 14475:1759914258:f522dd906714fb0b
2025-10-08 10:29:55,767 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_H1.png. Tên từ xa: files/jcq192qkqfx5
2025-10-08 10:29:55,768 - APP.core.trading.conditions - INFO - Điều kiện NO-RUN được kích hoạt: Không chạy ngoài các Kill Zone đã định nghĩa.
2025-10-08 10:29:55,768 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M5.png: 22339:1759914253:ac9da090a54f8eec
2025-10-08 10:29:55,768 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M1.png. Tên từ xa: files/zl0mc2r9tv6i
2025-10-08 10:29:55,769 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M15.png. Tên từ xa: files/4s2o4xrat6a8
2025-10-08 10:29:55,769 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_H1.png, đang lấy thông tin file...
2025-10-08 10:29:55,771 - APP.core.trading.conditions - INFO - Thoát sớm. Giai đoạn: no-run, Lý do: Không chạy ngoài các Kill Zone đã định nghĩa.
2025-10-08 10:29:55,771 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M5.png. Tên từ xa: files/kis0no3da2v8
2025-10-08 10:29:55,772 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M1.png, đang lấy thông tin file...
2025-10-08 10:29:55,772 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M15.png, đang lấy thông tin file...
2025-10-08 10:29:55,792 - APP.persistence.log_handler - DEBUG - Đang chuẩn bị ghi log giao dịch. Giai đoạn: no-run, Thư mục con: None
2025-10-08 10:29:55,792 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M5.png, đang lấy thông tin file...
2025-10-08 10:29:55,827 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:55,889 - APP.persistence.log_handler - DEBUG - Đã ghi log giao dịch thành công vào trade_log_20251008.jsonl.
2025-10-08 10:29:55,890 - APP.persistence.log_handler - DEBUG - Kết thúc hàm log_trade.
2025-10-08 10:29:55,890 - APP.core.analysis_worker - INFO - Giai đoạn 2 thoát sớm: Điều kiện No-Run: Không chạy ngoài các Kill Zone đã định nghĩa.
2025-10-08 10:29:55,891 - APP.utils.threading_utils - DEBUG - Tác vụ song song '_execute_stage_2_logic' đã hoàn thành.
2025-10-08 10:29:55,909 - APP.analysis.image_processor - DEBUG - Đang lưu cache upload với 4 mục.
2025-10-08 10:29:55,911 - APP.analysis.image_processor - DEBUG - Đã lưu cache upload thành công.
2025-10-08 10:29:55,911 - APP.utils.threading_utils - DEBUG - Tác vụ song song '_execute_stage_3_logic' đã hoàn thành.
2025-10-08 10:29:55,912 - APP.core.analysis_worker - WARNING - Một trong các giai đoạn song song đã thất bại. Dừng worker.
2025-10-08 10:29:55,913 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Thoát sớm do lỗi ở Giai đoạn 2 hoặc 3.
2025-10-08 10:29:55,913 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-08 10:29:55,914 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-08 10:29:55,933 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:56,045 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:56,146 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:56,247 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:56,248 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:56,249 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:56,250 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:56,352 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:56,352 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:56,453 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:56,454 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:56,549 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:29:56,554 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:29:56,554 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:29:56,555 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:29:56,581 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:29:56,582 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:56,583 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:29:56,585 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:56,588 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:29:56,589 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:56,593 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:29:56,594 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:29:56,594 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:29:56,595 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:29:56,595 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:29:56,690 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:56,691 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:56,691 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: _finalize_done
2025-10-08 10:29:56,692 - APP.ui.utils.ui_builder - DEBUG - Đã thay đổi trạng thái nút Start/Stop thành 'normal'. Các điều khiển khác không bị ảnh hưởng.
2025-10-08 10:29:56,693 - APP.ui.app_ui - DEBUG - Lên lịch chạy tự động tiếp theo sau 60000ms.
2025-10-08 10:29:56,693 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:57,096 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:29:57,098 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:29:57,099 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:29:57,099 - APP.services.mt5_service - DEBUG - Current price (cp): 4040.432
2025-10-08 10:29:57,103 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 266, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:29:57,132 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 218, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:29:57,133 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:29:57,133 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:29:57,135 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:29:57,136 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:57,136 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:29:57,136 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:29:57,139 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:29:57,140 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:57,140 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:29:57,141 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:29:57,142 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:29:57,142 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:57,143 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:29:57,143 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:29:57,147 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:29:57,162 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:29:57,168 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:29:57,169 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:29:57,172 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:29:57,173 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:29:57,173 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:29:57,174 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:29:57,174 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:29:57,174 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:29:57,175 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:29:57.175196+07:00
2025-10-08 10:29:57,175 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:29:57.175196+07:00
2025-10-08 10:29:57,176 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:29:57.175196+07:00 trong DST: True
2025-10-08 10:29:57,179 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:29:57,200 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:29:57,201 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:29:57,202 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:29:57,203 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:29:57,204 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:29:57,204 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:29:57,209 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:29:57,227 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:29:57,229 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:29:57,230 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:29:57,231 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:29:57,231 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:29:57,232 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:29:57,232 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:29:57,232 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:29:57,233 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:29:57,233 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:29:57,234 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:29:57,234 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:29:57,235 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:29:57,235 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:29:57,236 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:29:57,236 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:29:57,236 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:29:57,237 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:29:57,237 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:29:57,238 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:29:57,240 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:29:57,267 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:29:57,268 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:29:57,307 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:29:57,308 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:29:57,309 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:29:57,309 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:29:57,310 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4040.432, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:29:57,310 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:29:57,311 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:29:57,311 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:29:57,312 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:29:57,312 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 44433.99999999974
2025-10-08 10:29:57,312 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 99550.99999999993
2025-10-08 10:29:57,313 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27881.999999999607
2025-10-08 10:29:57,313 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 46002.9999999997
2025-10-08 10:29:57,313 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:29:57,314 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44433.99999999974}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99550.99999999993}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27881.999999999607}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 46002.9999999997}]
2025-10-08 10:29:57,314 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:29:57,315 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:29:57,317 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:29:57,318 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:29:57,319 - APP.services.mt5_service - DEBUG - Position in day range: 0.9977151017493724
2025-10-08 10:29:57,319 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:29:57,319 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:29:57.319645+07:00
2025-10-08 10:29:57,320 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:29:57.319645+07:00
2025-10-08 10:29:57,320 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:29:57.319645+07:00 trong DST: True
2025-10-08 10:29:57,320 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:29:57,321 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:29:57,321 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 211
2025-10-08 10:29:57,321 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:57,322 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:57,322 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4300', 'price': 4040.43, 'distance_pips': 0.2}, {'level': '4325', 'price': 4040.433, 'distance_pips': 0.05}, {'level': '4350', 'price': 4040.435, 'distance_pips': 0.3}, {'level': '4375', 'price': 4040.438, 'distance_pips': 0.55}]
2025-10-08 10:29:57,322 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:29:57,323 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:57,323 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:57,324 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:29:57,325 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.432
2025-10-08 10:29:57,325 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:57,326 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:29:57,326 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:57,327 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:29:57,327 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:29:57,328 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4040.432
2025-10-08 10:29:57,329 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:57,329 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:29:57,330 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:57,330 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:29:57,331 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:29:57,331 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4040.432
2025-10-08 10:29:57,332 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:57,332 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:29:57,339 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:57,358 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:29:57,359 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:29:57,360 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.432
2025-10-08 10:29:57,360 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:29:57,360 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:29:57,361 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:29:57,362 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:29:57,362 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:57,362 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:57,363 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:29:57,366 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:29:57,377 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:29:57,378 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:29:57,379 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:29:57,382 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:29:57,386 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:29:57,387 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:29:57,387 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:29:57,387 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:29:57,388 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:29:57,388 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:29:57,388 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:29:57,389 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:29:57,389 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:29:57,390 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:29:57,390 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:57,391 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:57,392 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:29:57,392 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:29:57,393 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:29:57,393 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:29:57,397 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:29:57,440 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:29:57,442 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:29:57,442 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:29:57,443 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:57,445 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:29:57,446 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4040.432, 'ask': 4040.469, 'last': 0.0, 'time': 1759919396}
2025-10-08 10:29:57,446 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:29:57,446 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:29:57,447 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:29:57,447 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:57,447 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:57,448 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:57,448 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:29:57,448 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:29:57,449 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:29:57,449 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4040.432
2025-10-08 10:29:57,450 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44433.99999999974}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99550.99999999993}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27881.999999999607}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 46002.9999999997}]
2025-10-08 10:29:57,450 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:29:57,540 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:29:57,541 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:29:57,541 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:29:57,542 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:29:57,544 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:30:01,557 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:30:01,559 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:30:01,559 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:30:01,560 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:30:01,562 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:30:01,562 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:30:01,566 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:30:01,587 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:01,589 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:30:01,590 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:30:01,590 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:30:01,591 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:30:01,591 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:30:01,654 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:02,092 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:30:02,094 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:30:02,095 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:30:02,095 - APP.services.mt5_service - DEBUG - Current price (cp): 4040.655
2025-10-08 10:30:02,099 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 267, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:30:02,116 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 218, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:30:02,132 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:30:02,133 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:30:02,135 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:30:02,136 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:02,136 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:30:02,137 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:30:02,139 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:30:02,140 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:02,140 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:30:02,140 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:30:02,142 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:30:02,143 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:02,143 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:30:02,143 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:30:02,147 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:30:02,148 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:02,156 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:30:02,168 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:30:02,171 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:30:02,172 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:30:02,173 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:30:02,173 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:30:02,173 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:30:02,174 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:30:02,174 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:30:02.174729+07:00
2025-10-08 10:30:02,175 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:30:02.174729+07:00
2025-10-08 10:30:02,175 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:30:02.174729+07:00 trong DST: True
2025-10-08 10:30:02,176 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:30:02,176 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:30:02,177 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:30:02,179 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:30:02,202 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:30:02,204 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:30:02,205 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:30:02,208 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:30:02,209 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:30:02,210 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:30:02,211 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:30:02,211 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:30:02,230 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:30:02,231 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:30:02,232 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:30:02,232 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:30:02,233 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:30:02,233 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:30:02,233 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:30:02,234 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:30:02,234 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:30:02,235 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:30:02,235 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:30:02,236 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:30:02,236 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:30:02,237 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:30:02,237 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:30:02,238 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:30:02,238 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:30:02,239 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:30:02,239 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:30:02,242 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:30:02,252 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:30:02,266 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:30:02,267 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:30:02,267 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4040.655, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:30:02,268 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:30:02,268 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:30:02,268 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:30:02,269 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:30:02,269 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 44657.00000000015
2025-10-08 10:30:02,270 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 99774.00000000033
2025-10-08 10:30:02,297 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 28105.00000000002
2025-10-08 10:30:02,297 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 46226.00000000011
2025-10-08 10:30:02,298 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:30:02,298 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44657.00000000015}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99774.00000000033}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 28105.00000000002}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 46226.00000000011}]
2025-10-08 10:30:02,299 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:30:02,299 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:30:02,300 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:30:02,300 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:30:02,327 - APP.services.mt5_service - DEBUG - Position in day range: 1.00169582292039
2025-10-08 10:30:02,328 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:30:02,328 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:30:02.328381+07:00
2025-10-08 10:30:02,328 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:30:02.328381+07:00
2025-10-08 10:30:02,329 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:30:02.328381+07:00 trong DST: True
2025-10-08 10:30:02,329 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:30:02,329 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:30:02,330 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 210
2025-10-08 10:30:02,330 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:02,331 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:02,331 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '6500', 'price': 4040.65, 'distance_pips': 0.5}, {'level': '6525', 'price': 4040.653, 'distance_pips': 0.25}, {'level': '6550', 'price': 4040.655, 'distance_pips': 0.0}, {'level': '6575', 'price': 4040.658, 'distance_pips': 0.25}]
2025-10-08 10:30:02,332 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:30:02,332 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:02,335 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:02,336 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:30:02,340 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.655
2025-10-08 10:30:02,353 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:02,356 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:30:02,358 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:02,359 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:30:02,359 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:30:02,360 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4040.655
2025-10-08 10:30:02,360 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:02,361 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:30:02,361 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:02,361 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:30:02,362 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:30:02,362 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4040.655
2025-10-08 10:30:02,363 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:02,363 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:30:02,377 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:02,391 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:30:02,392 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:30:02,393 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.655
2025-10-08 10:30:02,394 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:02,394 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:30:02,396 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:02,420 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:30:02,421 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:02,421 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:02,422 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:30:02,422 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:30:02,423 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:30:02,423 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:30:02,423 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:30:02,423 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:30:02,424 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:30:02,424 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:30:02,425 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:30:02,425 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:30:02,426 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:30:02,426 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:30:02,453 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:30:02,453 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:30:02,454 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:30:02,454 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:30:02,455 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:02,455 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:02,455 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:30:02,456 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:30:02,456 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:30:02,456 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:30:02,457 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:30:02,458 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:30:02,460 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:02,483 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4040.655, 'ask': 4040.692, 'last': 0.0, 'time': 1759919401}
2025-10-08 10:30:02,485 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:30:02,485 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:30:02,485 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:30:02,486 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:30:02,488 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:30:02,488 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:02,490 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:30:02,515 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:02,516 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:02,516 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:02,517 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:02,517 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:30:02,518 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4040.655
2025-10-08 10:30:02,518 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44657.00000000015}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99774.00000000033}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 28105.00000000002}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 46226.00000000011}]
2025-10-08 10:30:02,518 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:30:02,587 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:02,588 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:30:02,588 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:30:02,589 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:30:02,591 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:30:06,561 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:30:06,563 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:30:06,563 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:30:06,564 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:30:06,565 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:30:06,566 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:30:06,569 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:30:06,570 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:06,593 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:30:06,594 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:30:06,595 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:30:06,595 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:30:06,596 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:30:06,638 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:07,097 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:30:07,099 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:30:07,100 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:30:07,100 - APP.services.mt5_service - DEBUG - Current price (cp): 4040.908
2025-10-08 10:30:07,104 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 269, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:30:07,127 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 218, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:30:07,134 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:30:07,135 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:30:07,138 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:30:07,138 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:07,139 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:30:07,139 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:30:07,142 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:30:07,142 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:07,142 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:30:07,143 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:30:07,145 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:30:07,145 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:07,146 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:30:07,147 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:30:07,152 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:30:07,170 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:07,171 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:30:07,171 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:30:07,175 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:30:07,175 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:30:07,176 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:30:07,176 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:30:07,178 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:30:07,178 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:30:07,179 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:30:07.179230+07:00
2025-10-08 10:30:07,179 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:30:07.179230+07:00
2025-10-08 10:30:07,180 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:30:07.179230+07:00 trong DST: True
2025-10-08 10:30:07,199 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:30:07,199 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:30:07,200 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:30:07,202 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:30:07,202 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:30:07,204 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:30:07,204 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:30:07,206 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:30:07,207 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:30:07,207 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:30:07,208 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:30:07,208 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:30:07,209 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:30:07,211 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:30:07,211 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:30:07,213 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:30:07,230 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:30:07,231 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:30:07,231 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:30:07,232 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:30:07,232 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:30:07,233 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:30:07,233 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:30:07,233 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:30:07,234 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:30:07,234 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:30:07,235 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:30:07,236 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:30:07,236 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:30:07,236 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:30:07,237 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:30:07,237 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:30:07,238 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:30:07,238 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:30:07,239 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:30:07,239 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4040.908, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:30:07,241 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:30:07,242 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:30:07,242 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:30:07,243 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:30:07,268 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 44909.999999999854
2025-10-08 10:30:07,269 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 100027.00000000004
2025-10-08 10:30:07,269 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 28357.99999999972
2025-10-08 10:30:07,270 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 46478.99999999981
2025-10-08 10:30:07,270 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:30:07,271 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44909.999999999854}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 100027.00000000004}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 28357.99999999972}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 46478.99999999981}]
2025-10-08 10:30:07,272 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:30:07,273 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:30:07,273 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:30:07,273 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:30:07,296 - APP.services.mt5_service - DEBUG - Position in day range: 1.0062120671188854
2025-10-08 10:30:07,297 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:30:07,298 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:30:07.298461+07:00
2025-10-08 10:30:07,298 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:30:07.298461+07:00
2025-10-08 10:30:07,299 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:30:07.298461+07:00 trong DST: True
2025-10-08 10:30:07,299 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:30:07,300 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:30:07,301 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 210
2025-10-08 10:30:07,302 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:07,303 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:07,325 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '9000', 'price': 4040.9, 'distance_pips': 0.8}, {'level': '9025', 'price': 4040.903, 'distance_pips': 0.55}, {'level': '9050', 'price': 4040.905, 'distance_pips': 0.3}, {'level': '9075', 'price': 4040.908, 'distance_pips': 0.05}]
2025-10-08 10:30:07,327 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:30:07,328 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:07,328 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:07,329 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:30:07,330 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.908
2025-10-08 10:30:07,330 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:07,331 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:30:07,331 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:07,332 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:30:07,333 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:30:07,335 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4040.908
2025-10-08 10:30:07,336 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:07,336 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:30:07,355 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:07,356 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:30:07,356 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:30:07,357 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4040.908
2025-10-08 10:30:07,358 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:07,358 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:30:07,359 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:07,359 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:30:07,360 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:30:07,362 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.908
2025-10-08 10:30:07,363 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:07,363 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:30:07,364 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:07,365 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:30:07,382 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:07,390 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:07,390 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:30:07,391 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:30:07,392 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:30:07,392 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:30:07,393 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:30:07,393 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:30:07,393 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:30:07,394 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:30:07,394 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:30:07,395 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:30:07,395 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:30:07,396 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:30:07,396 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:30:07,419 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:30:07,424 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:30:07,424 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:30:07,425 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:07,425 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:07,426 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:30:07,426 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:30:07,427 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:30:07,428 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:30:07,431 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:30:07,452 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:30:07,454 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:07,454 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:30:07,455 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4040.908, 'ask': 4040.945, 'last': 0.0, 'time': 1759919406}
2025-10-08 10:30:07,455 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:30:07,455 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:30:07,458 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:30:07,465 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:30:07,480 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:30:07,480 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:07,481 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:07,482 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:07,482 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:07,482 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:07,483 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:30:07,484 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4040.908
2025-10-08 10:30:07,485 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44909.999999999854}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 100027.00000000004}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 28357.99999999972}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 46478.99999999981}]
2025-10-08 10:30:07,485 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:30:07,524 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:07,544 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:30:07,545 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:30:07,547 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:30:07,549 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:30:09,890 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:30:09,955 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:30:11,565 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:30:11,567 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:30:11,567 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:30:11,568 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:30:11,570 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:30:11,571 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:30:11,575 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:30:11,596 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:11,599 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:30:11,600 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:30:11,601 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:30:11,601 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:30:11,602 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:30:11,659 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:12,103 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:30:12,104 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:30:12,105 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:30:12,105 - APP.services.mt5_service - DEBUG - Current price (cp): 4040.232
2025-10-08 10:30:12,109 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 266, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:30:12,137 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 218, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:30:12,142 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:30:12,143 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:30:12,146 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:30:12,146 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:12,147 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:30:12,148 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:30:12,153 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:30:12,166 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:12,167 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:30:12,168 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:30:12,170 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:30:12,170 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:12,170 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:30:12,171 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:30:12,174 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:30:12,174 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:12,175 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:30:12,175 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:30:12,179 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:30:12,180 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:30:12,183 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:30:12,192 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:30:12,195 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:30:12,199 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:30:12,200 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:30:12.200220+07:00
2025-10-08 10:30:12,200 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:30:12.200220+07:00
2025-10-08 10:30:12,201 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:30:12.200220+07:00 trong DST: True
2025-10-08 10:30:12,201 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:30:12,202 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:30:12,202 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:30:12,204 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:30:12,204 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:30:12,206 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:30:12,206 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:30:12,211 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:30:12,212 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:30:12,213 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:30:12,213 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:30:12,214 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:30:12,215 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:30:12,215 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:30:12,215 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:30:12,216 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:30:12,216 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:30:12,216 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:30:12,217 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:30:12,217 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:30:12,218 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:30:12,219 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:30:12,220 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:30:12,220 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:30:12,221 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:30:12,221 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:30:12,235 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:30:12,250 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:30:12,252 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:30:12,253 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:30:12,254 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:30:12,255 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:30:12,255 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:30:12,256 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:30:12,256 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:30:12,256 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4040.232, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:30:12,257 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:30:12,257 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:30:12,258 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:30:12,258 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:30:12,258 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 44233.99999999992
2025-10-08 10:30:12,259 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 99351.00000000012
2025-10-08 10:30:12,259 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27681.99999999979
2025-10-08 10:30:12,259 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45802.99999999988
2025-10-08 10:30:12,260 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:30:12,260 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44233.99999999992}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99351.00000000012}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27681.99999999979}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45802.99999999988}]
2025-10-08 10:30:12,261 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:30:12,261 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:30:12,262 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:30:12,262 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:30:12,262 - APP.services.mt5_service - DEBUG - Position in day range: 0.9941449482327744
2025-10-08 10:30:12,263 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:30:12,263 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:30:12.263577+07:00
2025-10-08 10:30:12,263 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:30:12.263577+07:00
2025-10-08 10:30:12,264 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:30:12.263577+07:00 trong DST: True
2025-10-08 10:30:12,264 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:30:12,264 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:30:12,265 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 210
2025-10-08 10:30:12,265 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:12,266 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:12,266 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '2300', 'price': 4040.23, 'distance_pips': 0.2}, {'level': '2325', 'price': 4040.233, 'distance_pips': 0.05}, {'level': '2350', 'price': 4040.235, 'distance_pips': 0.3}, {'level': '2375', 'price': 4040.238, 'distance_pips': 0.55}]
2025-10-08 10:30:12,266 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:30:12,267 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:12,267 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:12,268 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:30:12,268 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.232
2025-10-08 10:30:12,270 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:12,270 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:30:12,271 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:12,273 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:30:12,285 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:30:12,287 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4040.232
2025-10-08 10:30:12,290 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:12,293 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:30:12,294 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:12,295 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:30:12,295 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:30:12,296 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4040.232
2025-10-08 10:30:12,296 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:12,297 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:30:12,298 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:12,298 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:30:12,298 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:30:12,299 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.232
2025-10-08 10:30:12,299 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:12,300 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:30:12,300 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:12,301 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:30:12,303 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:12,304 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:12,304 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:30:12,305 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:30:12,308 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:30:12,311 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:30:12,315 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:30:12,316 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:30:12,324 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:30:12,325 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:30:12,326 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:30:12,327 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:30:12,328 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:30:12,329 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:30:12,329 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:30:12,329 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:30:12,330 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:30:12,330 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:30:12,330 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:12,331 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:12,331 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:30:12,332 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:30:12,332 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:30:12,332 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:30:12,333 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:30:12,359 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:30:12,361 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:12,362 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:30:12,362 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:30:12,363 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4040.232, 'ask': 4040.269, 'last': 0.0, 'time': 1759919411}
2025-10-08 10:30:12,365 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:30:12,384 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:30:12,386 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:30:12,386 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:30:12,387 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:12,387 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:12,388 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:12,388 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:12,389 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:12,389 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:30:12,389 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4040.232
2025-10-08 10:30:12,390 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44233.99999999992}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99351.00000000012}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27681.99999999979}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45802.99999999988}]
2025-10-08 10:30:12,390 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:30:12,461 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:12,462 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:30:12,463 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:30:12,464 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:30:12,467 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:30:16,570 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:30:16,573 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:30:16,573 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:30:16,573 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:30:16,576 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:30:16,607 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:30:16,607 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:30:16,612 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:30:16,616 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:30:16,641 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:30:16,642 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:16,643 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:30:16,644 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:30:16,702 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:17,162 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:30:17,164 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:30:17,167 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:30:17,168 - APP.services.mt5_service - DEBUG - Current price (cp): 4039.662
2025-10-08 10:30:17,173 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 268, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:30:17,233 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 218, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:30:17,244 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:30:17,259 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:30:17,273 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:30:17,301 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:17,330 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:30:17,332 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:30:17,367 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:30:17,397 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:17,432 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:30:17,437 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:30:17,442 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:30:17,448 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:17,499 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:30:17,690 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:30:17,781 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:30:17,946 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:17,954 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:30:17,969 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:30:17,975 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:30:18,030 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:30:18,033 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:30:18,035 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:30:18,038 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:30:18,040 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:30:18,042 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:30:18.042310+07:00
2025-10-08 10:30:18,044 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:30:18.042310+07:00
2025-10-08 10:30:18,045 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:30:18.042310+07:00 trong DST: True
2025-10-08 10:30:18,045 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:30:18,045 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:30:18,046 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:30:18,047 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:30:18,048 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:30:18,049 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:30:18,050 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:30:18,054 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:30:18,077 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:30:18,078 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:30:18,078 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:30:18,079 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:30:18,079 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:30:18,080 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:30:18,080 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:30:18,081 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:30:18,083 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:30:18,085 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:30:18,112 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:30:18,114 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:30:18,142 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:30:18,143 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:30:18,143 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:30:18,144 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:30:18,144 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:30:18,145 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:30:18,145 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:30:18,175 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:30:18,176 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:30:18,176 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:30:18,177 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:30:18,177 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:30:18,238 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:30:18,239 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:30:18,240 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:30:18,270 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4039.662, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:30:18,301 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:30:18,332 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:30:18,361 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:30:18,362 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:30:18,362 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 43663.99999999976
2025-10-08 10:30:18,363 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 98780.99999999994
2025-10-08 10:30:18,363 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27111.999999999625
2025-10-08 10:30:18,364 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45232.999999999716
2025-10-08 10:30:18,392 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:30:18,394 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43663.99999999976}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98780.99999999994}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27111.999999999625}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45232.999999999716}]
2025-10-08 10:30:18,395 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:30:18,418 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:30:18,420 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:30:18,421 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:30:18,421 - APP.services.mt5_service - DEBUG - Position in day range: 0.9839700107104581
2025-10-08 10:30:18,422 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:30:18,422 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:30:18.422684+07:00
2025-10-08 10:30:18,423 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:30:18.422684+07:00
2025-10-08 10:30:18,423 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:30:18.422684+07:00 trong DST: True
2025-10-08 10:30:18,424 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:30:18,424 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:30:18,425 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 210
2025-10-08 10:30:18,425 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:18,426 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:18,426 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '6600', 'price': 4039.66, 'distance_pips': 0.2}, {'level': '6625', 'price': 4039.663, 'distance_pips': 0.05}, {'level': '6650', 'price': 4039.665, 'distance_pips': 0.3}, {'level': '6675', 'price': 4039.668, 'distance_pips': 0.55}]
2025-10-08 10:30:18,426 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:30:18,427 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:18,454 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:18,455 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:30:18,456 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.662
2025-10-08 10:30:18,457 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:18,458 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:30:18,458 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:18,470 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:30:18,487 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:30:18,488 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4039.662
2025-10-08 10:30:18,489 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:18,489 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:30:18,530 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:18,531 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:30:18,532 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:30:18,534 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4039.662
2025-10-08 10:30:18,534 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:18,535 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:30:18,536 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:18,536 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:30:18,537 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:30:18,539 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.662
2025-10-08 10:30:18,540 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:18,540 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:30:18,541 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:18,544 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:30:18,545 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:18,545 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:18,546 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:30:18,547 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:30:18,547 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:30:18,548 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:30:18,548 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:30:18,551 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:30:18,552 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:30:18,584 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:30:18,614 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:30:18,676 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:30:18,689 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:30:18,690 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:30:18,692 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:30:18,694 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:30:18,694 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:30:18,695 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:30:18,696 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:18,696 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:18,697 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:30:18,697 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:30:18,697 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:30:18,698 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:30:18,699 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:30:18,701 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:30:18,702 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:18,703 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:30:18,703 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4039.662, 'ask': 4039.699, 'last': 0.0, 'time': 1759919416}
2025-10-08 10:30:18,703 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:30:18,704 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:30:18,708 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:30:18,733 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:30:18,736 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:30:18,736 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:18,737 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:18,739 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:18,739 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:18,740 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:18,769 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:30:18,770 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4039.662
2025-10-08 10:30:18,833 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43663.99999999976}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98780.99999999994}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27111.999999999625}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45232.999999999716}]
2025-10-08 10:30:18,863 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:30:18,873 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:18,873 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:30:18,874 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:30:18,876 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:30:18,879 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:30:21,574 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:30:21,576 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:30:21,577 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:30:21,577 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:30:21,579 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:30:21,580 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:30:21,586 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:30:21,608 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:30:21,609 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:21,613 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:30:21,640 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:30:21,641 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:30:21,641 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:30:21,705 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:22,143 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:30:22,146 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:30:22,151 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:30:22,153 - APP.services.mt5_service - DEBUG - Current price (cp): 4039.365
2025-10-08 10:30:22,163 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 274, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:30:22,214 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 219, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:30:22,233 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:30:22,236 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:30:22,240 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:30:22,268 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:22,270 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:30:22,302 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:30:22,334 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:30:22,357 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:22,358 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:30:22,359 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:30:22,361 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:30:22,362 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:22,362 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:30:22,364 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:30:22,367 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:30:22,391 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:22,392 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:30:22,392 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:30:22,395 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:30:22,396 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:30:22,396 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:30:22,397 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:30:22,397 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:30:22,398 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:30:22,420 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:30:22.420089+07:00
2025-10-08 10:30:22,421 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:30:22.420089+07:00
2025-10-08 10:30:22,421 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:30:22.420089+07:00 trong DST: True
2025-10-08 10:30:22,422 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:30:22,422 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:30:22,423 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:30:22,424 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:30:22,425 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:30:22,426 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:30:22,427 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:30:22,448 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:30:22,452 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:30:22,452 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:30:22,453 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:30:22,453 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:30:22,454 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:30:22,454 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:30:22,454 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:30:22,455 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:30:22,455 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:30:22,456 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:30:22,456 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:30:22,457 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:30:22,457 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:30:22,458 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:30:22,458 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:30:22,458 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:30:22,459 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:30:22,459 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:30:22,460 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:30:22,460 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:30:22,461 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:30:22,481 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:30:22,485 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:30:22,487 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:30:22,488 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:30:22,488 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:30:22,489 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:30:22,489 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4039.365, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:30:22,520 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:30:22,521 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:30:22,521 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:30:22,522 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:30:22,524 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 43366.99999999973
2025-10-08 10:30:22,546 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 98483.99999999993
2025-10-08 10:30:22,546 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 26814.9999999996
2025-10-08 10:30:22,547 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 44935.999999999694
2025-10-08 10:30:22,547 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:30:22,548 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43366.99999999973}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98483.99999999993}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26814.9999999996}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44935.999999999694}]
2025-10-08 10:30:22,548 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:30:22,549 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:30:22,550 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:30:22,550 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:30:22,550 - APP.services.mt5_service - DEBUG - Position in day range: 0.9786683327383048
2025-10-08 10:30:22,551 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:30:22,551 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:30:22.551790+07:00
2025-10-08 10:30:22,552 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:30:22.551790+07:00
2025-10-08 10:30:22,552 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:30:22.551790+07:00 trong DST: True
2025-10-08 10:30:22,553 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:30:22,553 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:30:22,556 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 210
2025-10-08 10:30:22,575 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:22,576 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:22,577 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '3600', 'price': 4039.36, 'distance_pips': 0.5}, {'level': '3625', 'price': 4039.363, 'distance_pips': 0.25}, {'level': '3650', 'price': 4039.365, 'distance_pips': 0.0}, {'level': '3675', 'price': 4039.368, 'distance_pips': 0.25}]
2025-10-08 10:30:22,577 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:30:22,578 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:22,578 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:22,579 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:30:22,579 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.365
2025-10-08 10:30:22,580 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:22,580 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:30:22,581 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:22,581 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:30:22,582 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:30:22,583 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4039.365
2025-10-08 10:30:22,584 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:22,612 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:30:22,613 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:22,614 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:30:22,614 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:30:22,615 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4039.365
2025-10-08 10:30:22,641 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:22,643 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:30:22,645 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:22,645 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:30:22,646 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:30:22,673 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.365
2025-10-08 10:30:22,674 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:22,675 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:30:22,676 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:22,676 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:30:22,677 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:22,677 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:22,678 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:30:22,678 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:30:22,704 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:30:22,705 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:30:22,706 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:30:22,706 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:30:22,707 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:30:22,707 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:30:22,708 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:30:22,708 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:30:22,708 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:30:22,709 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:30:22,729 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:30:22,737 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:30:22,738 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:30:22,739 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:30:22,739 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:22,739 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:22,740 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:30:22,740 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:30:22,766 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:30:22,767 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:30:22,768 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:30:22,770 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:30:22,771 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:30:22,772 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:22,772 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:30:22,802 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4039.365, 'ask': 4039.402, 'last': 0.0, 'time': 1759919421}
2025-10-08 10:30:22,832 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:30:22,832 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:30:22,834 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:30:22,834 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:30:22,861 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:22,861 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:22,862 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:22,862 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:22,863 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:22,863 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:30:22,864 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4039.365
2025-10-08 10:30:22,864 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43366.99999999973}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98483.99999999993}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26814.9999999996}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44935.999999999694}]
2025-10-08 10:30:22,865 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:30:22,964 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:22,967 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:30:22,968 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:30:22,969 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:30:22,971 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:30:24,891 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:30:24,978 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:30:26,578 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:30:26,581 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:30:26,581 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:30:26,582 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:30:26,584 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:30:26,588 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:30:26,594 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:30:26,613 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:26,615 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:30:26,623 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:30:26,624 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:30:26,624 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:30:26,625 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:30:26,684 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:27,139 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:30:27,152 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:30:27,158 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:30:27,164 - APP.services.mt5_service - DEBUG - Current price (cp): 4039.339
2025-10-08 10:30:27,173 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 279, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:30:27,204 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 220, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:30:27,217 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:30:27,219 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:30:27,221 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:30:27,221 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:27,223 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:30:27,224 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:30:27,228 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:30:27,231 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:27,231 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:30:27,233 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:30:27,236 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:30:27,238 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:27,238 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:30:27,240 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:30:27,296 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:30:27,299 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:27,342 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:30:27,344 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:30:27,347 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:30:27,348 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:30:27,350 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:30:27,351 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:30:27,352 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:30:27,353 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:30:27,353 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:30:27.353486+07:00
2025-10-08 10:30:27,356 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:30:27.353486+07:00
2025-10-08 10:30:27,360 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:30:27.353486+07:00 trong DST: True
2025-10-08 10:30:27,362 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:30:27,365 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:30:27,392 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:30:27,394 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:30:27,396 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:30:27,422 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:30:27,424 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:30:27,427 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:30:27,457 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:30:27,458 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:30:27,485 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:30:27,489 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:30:27,530 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:30:27,534 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:30:27,539 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:30:27,541 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:30:27,542 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:30:27,544 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:30:27,544 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:30:27,545 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:30:27,546 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:30:27,547 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:30:27,549 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:30:27,550 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:30:27,551 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:30:27,552 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:30:27,553 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:30:27,553 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:30:27,580 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:30:27,582 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:30:27,583 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:30:27,583 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:30:27,583 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:30:27,584 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:30:27,613 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:30:27,613 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4039.339, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:30:27,614 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:30:27,614 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:30:27,615 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:30:27,615 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:30:27,644 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 43340.99999999989
2025-10-08 10:30:27,645 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 98458.00000000009
2025-10-08 10:30:27,646 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 26788.99999999976
2025-10-08 10:30:27,647 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 44909.999999999854
2025-10-08 10:30:27,673 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:30:27,674 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43340.99999999989}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98458.00000000009}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26788.99999999976}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44909.999999999854}]
2025-10-08 10:30:27,674 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:30:27,675 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:30:27,676 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:30:27,676 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:30:27,676 - APP.services.mt5_service - DEBUG - Position in day range: 0.9782042127811496
2025-10-08 10:30:27,677 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:30:27,677 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:30:27.677533+07:00
2025-10-08 10:30:27,678 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:30:27.677533+07:00
2025-10-08 10:30:27,703 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:30:27.677533+07:00 trong DST: True
2025-10-08 10:30:27,704 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:30:27,705 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:30:27,706 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 210
2025-10-08 10:30:27,706 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:27,707 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:27,707 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '3300', 'price': 4039.33, 'distance_pips': 0.9}, {'level': '3325', 'price': 4039.332, 'distance_pips': 0.65}, {'level': '3350', 'price': 4039.335, 'distance_pips': 0.4}, {'level': '3375', 'price': 4039.338, 'distance_pips': 0.15}]
2025-10-08 10:30:27,708 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:30:27,708 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:27,709 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:27,710 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:30:27,736 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.339
2025-10-08 10:30:27,737 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:27,738 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:30:27,739 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:27,739 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:30:27,740 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:30:27,771 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4039.339
2025-10-08 10:30:27,772 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:27,798 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:30:27,800 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:27,801 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:30:27,801 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:30:27,861 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4039.339
2025-10-08 10:30:27,864 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:27,865 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:30:27,896 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:27,897 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:30:27,924 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:30:27,926 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.339
2025-10-08 10:30:27,926 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:27,927 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:30:27,957 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:27,958 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:30:27,959 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:27,986 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:27,989 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:30:27,990 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:30:27,990 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:30:27,991 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:30:28,020 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:30:28,020 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:30:28,021 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:30:28,021 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:30:28,021 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:30:28,022 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:30:28,022 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:30:28,047 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:30:28,048 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:30:28,049 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:30:28,049 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:30:28,050 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:30:28,050 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:28,050 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:28,051 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:30:28,052 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:30:28,052 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:30:28,052 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:30:28,082 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:30:28,084 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:30:28,113 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:28,114 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:30:28,114 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:30:28,114 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4039.339, 'ask': 4039.376, 'last': 0.0, 'time': 1759919426}
2025-10-08 10:30:28,118 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:30:28,139 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:30:28,140 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:30:28,140 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:30:28,141 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:28,141 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:28,142 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:28,142 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:28,143 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:28,143 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:30:28,144 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4039.339
2025-10-08 10:30:28,144 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43340.99999999989}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98458.00000000009}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26788.99999999976}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44909.999999999854}]
2025-10-08 10:30:28,145 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:30:28,215 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:28,217 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:30:28,218 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:30:28,219 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:30:28,220 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:30:31,582 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:30:31,585 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:30:31,585 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:30:31,587 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:30:31,590 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:30:31,590 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:30:31,595 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:30:31,611 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:31,616 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:30:31,623 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:30:31,624 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:30:31,624 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:30:31,625 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:30:31,712 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:32,126 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:30:32,127 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:30:32,128 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:30:32,128 - APP.services.mt5_service - DEBUG - Current price (cp): 4038.674
2025-10-08 10:30:32,132 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 283, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:30:32,161 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 221, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:30:32,167 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:30:32,168 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:30:32,171 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:30:32,171 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:32,171 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:30:32,172 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:30:32,175 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:30:32,176 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:32,176 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:30:32,177 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:30:32,180 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:30:32,204 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:32,205 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:30:32,205 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:30:32,207 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:30:32,208 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:32,208 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:30:32,208 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:30:32,234 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:30:32,234 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:30:32,235 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:30:32,235 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:30:32,236 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:30:32,236 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:30:32,236 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:30:32.236735+07:00
2025-10-08 10:30:32,237 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:30:32.236735+07:00
2025-10-08 10:30:32,237 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:30:32.236735+07:00 trong DST: True
2025-10-08 10:30:32,237 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:30:32,238 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:30:32,238 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:30:32,239 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:30:32,239 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:30:32,241 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:30:32,266 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:30:32,270 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:30:32,270 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:30:32,271 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:30:32,271 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:30:32,272 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:30:32,301 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:30:32,301 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:30:32,302 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:30:32,303 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:30:32,332 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:30:32,333 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:30:32,334 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:30:32,334 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:30:32,335 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:30:32,359 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:30:32,360 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:30:32,360 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:30:32,360 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:30:32,361 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:30:32,362 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:30:32,362 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:30:32,363 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:30:32,363 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:30:32,364 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:30:32,364 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:30:32,365 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:30:32,366 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:30:32,393 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:30:32,394 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4038.674, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:30:32,395 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:30:32,395 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:30:32,396 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:30:32,396 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:30:32,396 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 42675.99999999993
2025-10-08 10:30:32,397 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 97793.00000000012
2025-10-08 10:30:32,397 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 26123.999999999796
2025-10-08 10:30:32,397 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 44244.99999999989
2025-10-08 10:30:32,421 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:30:32,423 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42675.99999999993}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97793.00000000012}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26123.999999999796}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44244.99999999989}]
2025-10-08 10:30:32,424 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:30:32,424 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:30:32,425 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:30:32,425 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:30:32,426 - APP.services.mt5_service - DEBUG - Position in day range: 0.9663334523384511
2025-10-08 10:30:32,426 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:30:32,426 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:30:32.426826+07:00
2025-10-08 10:30:32,427 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:30:32.426826+07:00
2025-10-08 10:30:32,427 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:30:32.426826+07:00 trong DST: True
2025-10-08 10:30:32,428 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:30:32,428 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:30:32,428 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 210
2025-10-08 10:30:32,453 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:32,454 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:32,454 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '6700', 'price': 4038.67, 'distance_pips': 0.4}, {'level': '6725', 'price': 4038.673, 'distance_pips': 0.15}, {'level': '6750', 'price': 4038.675, 'distance_pips': 0.1}, {'level': '6775', 'price': 4038.678, 'distance_pips': 0.35}]
2025-10-08 10:30:32,455 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:30:32,455 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:32,456 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:32,456 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:30:32,457 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.674
2025-10-08 10:30:32,457 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:32,458 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:30:32,458 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:32,459 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:30:32,459 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:30:32,489 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4038.674
2025-10-08 10:30:32,490 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:32,490 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:30:32,521 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:32,521 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:30:32,522 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:30:32,551 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4038.674
2025-10-08 10:30:32,552 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:32,552 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:30:32,582 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:32,583 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:30:32,583 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:30:32,584 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.674
2025-10-08 10:30:32,597 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:32,614 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:30:32,615 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:32,615 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:30:32,616 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:32,616 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:32,645 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:30:32,645 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:30:32,646 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:30:32,646 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:30:32,646 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:30:32,647 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:30:32,675 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:30:32,676 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:30:32,676 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:30:32,677 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:30:32,677 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:30:32,678 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:30:32,678 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:30:32,678 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:30:32,707 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:30:32,708 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:30:32,709 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:32,709 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:32,709 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:30:32,710 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:30:32,739 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:30:32,740 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:30:32,770 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:30:32,771 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:30:32,789 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:32,800 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:30:32,800 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:30:32,800 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4038.674, 'ask': 4038.711, 'last': 0.0, 'time': 1759919431}
2025-10-08 10:30:32,803 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:30:32,833 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:30:32,834 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:30:32,834 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:30:32,835 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:32,835 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:32,858 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:32,859 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:32,859 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:32,860 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:30:32,860 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4038.674
2025-10-08 10:30:32,861 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42675.99999999993}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97793.00000000012}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26123.999999999796}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44244.99999999989}]
2025-10-08 10:30:32,861 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:30:32,933 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:32,935 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:30:32,935 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:30:32,937 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:30:32,939 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:30:36,588 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:30:36,590 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:30:36,590 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:30:36,591 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:30:36,593 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:30:36,593 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:30:36,596 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:30:36,597 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:36,625 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:30:36,626 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:30:36,626 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:30:36,627 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:30:36,627 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:30:36,665 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:37,129 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:30:37,131 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:30:37,138 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:30:37,139 - APP.services.mt5_service - DEBUG - Current price (cp): 4039.125
2025-10-08 10:30:37,143 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 290, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:30:37,200 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:30:37,205 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:30:37,206 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:30:37,209 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:30:37,219 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:37,221 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:30:37,223 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:30:37,228 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:30:37,229 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:37,234 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:30:37,237 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:30:37,239 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:30:37,275 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:37,311 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:30:37,315 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:30:37,319 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:30:37,321 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:37,321 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:30:37,328 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:30:37,332 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:30:37,334 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:30:37,334 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:30:37,359 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:30:37,360 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:30:37,362 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:30:37,363 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:30:37.363031+07:00
2025-10-08 10:30:37,364 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:30:37.363031+07:00
2025-10-08 10:30:37,366 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:30:37.363031+07:00 trong DST: True
2025-10-08 10:30:37,366 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:30:37,394 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:30:37,396 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:30:37,399 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:30:37,427 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:30:37,488 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:30:37,518 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:30:37,546 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:30:37,547 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:30:37,547 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:30:37,548 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:30:37,548 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:30:37,550 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:30:37,550 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:30:37,551 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:30:37,551 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:30:37,552 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:30:37,553 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:30:37,553 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:30:37,583 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:30:37,584 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:30:37,584 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:30:37,611 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:30:37,612 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:30:37,612 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:30:37,613 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:30:37,614 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:30:37,614 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:30:37,614 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:30:37,615 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:30:37,615 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:30:37,616 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:30:37,641 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:30:37,642 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:30:37,642 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:30:37,643 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4039.125, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:30:37,644 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:30:37,644 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:30:37,644 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:30:37,645 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:30:37,645 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 43126.99999999995
2025-10-08 10:30:37,646 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 98244.00000000015
2025-10-08 10:30:37,646 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 26574.999999999818
2025-10-08 10:30:37,647 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 44695.99999999991
2025-10-08 10:30:37,647 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:30:37,648 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43126.99999999995}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98244.00000000015}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26574.999999999818}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44695.99999999991}]
2025-10-08 10:30:37,678 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:30:37,701 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:30:37,702 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:30:37,703 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:30:37,703 - APP.services.mt5_service - DEBUG - Position in day range: 0.9743841485183873
2025-10-08 10:30:37,704 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:30:37,704 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:30:37.704608+07:00
2025-10-08 10:30:37,705 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:30:37.704608+07:00
2025-10-08 10:30:37,705 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:30:37.704608+07:00 trong DST: True
2025-10-08 10:30:37,705 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:30:37,706 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:30:37,706 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 210
2025-10-08 10:30:37,707 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:37,707 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:37,709 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '1200', 'price': 4039.12, 'distance_pips': 0.5}, {'level': '1225', 'price': 4039.122, 'distance_pips': 0.25}, {'level': '1250', 'price': 4039.125, 'distance_pips': 0.0}, {'level': '1275', 'price': 4039.128, 'distance_pips': 0.25}]
2025-10-08 10:30:37,710 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:30:37,738 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:37,740 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:37,771 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:30:37,784 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.125
2025-10-08 10:30:37,785 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:37,786 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:30:37,787 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:37,787 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:30:37,788 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:30:37,788 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4039.125
2025-10-08 10:30:37,789 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:37,789 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:30:37,790 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:37,791 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:30:37,792 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:30:37,792 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4039.125
2025-10-08 10:30:37,793 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:37,793 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:30:37,794 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:37,795 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:30:37,795 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:30:37,796 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.125
2025-10-08 10:30:37,796 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:37,797 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:30:37,797 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:37,798 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:30:37,798 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:37,799 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:37,799 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:30:37,799 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:30:37,800 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:30:37,800 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:30:37,801 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:30:37,802 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:30:37,802 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:30:37,803 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:30:37,804 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:30:37,845 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:30:37,845 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:30:37,848 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:30:37,848 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:30:37,849 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:30:37,849 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:30:37,850 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:30:37,850 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:37,851 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:37,851 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:30:37,851 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:30:37,852 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:30:37,853 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:30:37,854 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:30:37,855 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:30:37,857 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:37,858 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:30:37,858 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4039.125, 'ask': 4039.162, 'last': 0.0, 'time': 1759919436}
2025-10-08 10:30:37,858 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:30:37,859 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:30:37,861 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:30:37,862 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:30:37,862 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:30:37,863 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:37,864 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:37,865 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:37,866 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:37,906 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:37,907 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:30:37,910 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4039.125
2025-10-08 10:30:37,911 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43126.99999999995}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98244.00000000015}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26574.999999999818}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44695.99999999991}]
2025-10-08 10:30:37,912 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:30:37,954 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:37,958 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:30:37,958 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:30:37,959 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:30:37,970 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:30:39,894 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:30:39,978 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:30:41,592 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:30:41,594 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:30:41,594 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:30:41,595 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:30:41,596 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:30:41,597 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:30:41,601 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:30:41,601 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:41,604 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:30:41,605 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:30:41,606 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:30:41,606 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:30:41,607 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:30:41,696 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:42,110 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:30:42,115 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:30:42,125 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:30:42,126 - APP.services.mt5_service - DEBUG - Current price (cp): 4038.993
2025-10-08 10:30:42,134 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 293, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:30:42,171 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:30:42,174 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:30:42,176 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:30:42,179 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:30:42,189 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:42,194 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:30:42,196 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:30:42,200 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:30:42,201 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:42,201 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:30:42,204 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:30:42,210 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:30:42,256 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:42,258 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:30:42,261 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:30:42,265 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:30:42,266 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:42,268 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:30:42,269 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:30:42,272 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:30:42,331 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:30:42,362 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:30:42,372 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:30:42,399 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:30:42,445 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:30:42,447 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:30:42.447414+07:00
2025-10-08 10:30:42,451 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:30:42.447414+07:00
2025-10-08 10:30:42,453 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:30:42.447414+07:00 trong DST: True
2025-10-08 10:30:42,455 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:30:42,457 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:30:42,458 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:30:42,460 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:30:42,465 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:30:42,553 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:30:42,581 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:30:42,587 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:30:42,614 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:30:42,615 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:30:42,620 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:30:42,628 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:30:42,752 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:30:42,803 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:30:42,850 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:30:42,857 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:30:42,858 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:30:42,859 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:30:42,859 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:30:42,861 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:30:42,862 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:30:42,862 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:30:42,862 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:30:42,863 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:30:42,864 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:30:42,865 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:30:42,866 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:30:42,878 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:30:42,882 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:30:42,950 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:30:42,951 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:30:42,952 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:30:42,953 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:30:42,953 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:30:42,954 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:30:42,954 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4038.993, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:30:42,954 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:30:42,955 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:30:42,955 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:30:42,955 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:30:42,956 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 42994.99999999989
2025-10-08 10:30:42,957 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 98112.00000000007
2025-10-08 10:30:42,958 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 26442.999999999756
2025-10-08 10:30:42,958 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 44563.99999999985
2025-10-08 10:30:42,958 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:30:42,959 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42994.99999999989}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98112.00000000007}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26442.999999999756}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44563.99999999985}]
2025-10-08 10:30:42,959 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:30:42,960 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:30:42,961 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:30:42,961 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:30:42,962 - APP.services.mt5_service - DEBUG - Position in day range: 0.9720278471974293
2025-10-08 10:30:42,966 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:30:42,967 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:30:42.967189+07:00
2025-10-08 10:30:42,969 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:30:42.967189+07:00
2025-10-08 10:30:42,990 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:30:42.967189+07:00 trong DST: True
2025-10-08 10:30:42,991 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:30:42,992 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:30:42,993 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 210
2025-10-08 10:30:42,993 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:42,994 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:42,994 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '9900', 'price': 4038.99, 'distance_pips': 0.3}, {'level': '9925', 'price': 4038.993, 'distance_pips': 0.05}, {'level': '9950', 'price': 4038.995, 'distance_pips': 0.2}, {'level': '9975', 'price': 4038.998, 'distance_pips': 0.45}]
2025-10-08 10:30:42,995 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:30:42,995 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:42,996 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:42,997 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:30:42,999 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.993
2025-10-08 10:30:43,000 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:43,022 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:30:43,024 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:43,025 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:30:43,025 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:30:43,026 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4038.993
2025-10-08 10:30:43,027 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:43,027 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:30:43,030 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:43,031 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:30:43,034 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:30:43,044 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4038.993
2025-10-08 10:30:43,054 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:43,055 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:30:43,056 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:43,057 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:30:43,057 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:30:43,058 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.993
2025-10-08 10:30:43,058 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:43,059 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:30:43,060 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:43,062 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:30:43,066 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:43,090 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:43,094 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:30:43,095 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:30:43,118 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:30:43,119 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:30:43,120 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:30:43,120 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:30:43,120 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:30:43,121 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:30:43,147 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:30:43,150 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:30:43,151 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:30:43,151 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:30:43,151 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:30:43,152 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:30:43,153 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:30:43,154 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:30:43,158 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:43,178 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:43,180 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:30:43,181 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:30:43,181 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:30:43,182 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:30:43,183 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:30:43,207 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:30:43,208 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:43,209 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:30:43,209 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:30:43,210 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4038.993, 'ask': 4039.03, 'last': 0.0, 'time': 1759919441}
2025-10-08 10:30:43,213 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:30:43,213 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:30:43,214 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:30:43,215 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:30:43,217 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:43,218 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:43,218 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:43,238 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:43,238 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:43,239 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:30:43,239 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4038.993
2025-10-08 10:30:43,240 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42994.99999999989}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98112.00000000007}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26442.999999999756}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 44563.99999999985}]
2025-10-08 10:30:43,240 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:30:43,322 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:43,323 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:30:43,324 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:30:43,325 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:30:43,329 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:30:46,595 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:30:46,597 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:30:46,598 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:30:46,598 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:30:46,600 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:30:46,601 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:30:46,604 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:30:46,626 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:46,627 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:30:46,631 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:30:46,632 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:30:46,632 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:30:46,633 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:30:46,697 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:47,134 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:30:47,136 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:30:47,136 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:30:47,137 - APP.services.mt5_service - DEBUG - Current price (cp): 4039.745
2025-10-08 10:30:47,141 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 301, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:30:47,166 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 222, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:30:47,173 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:30:47,174 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:30:47,176 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:30:47,176 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:47,177 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:30:47,177 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:30:47,181 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:30:47,201 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:47,201 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:30:47,202 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:30:47,204 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:30:47,204 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:47,204 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:30:47,205 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:30:47,207 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:30:47,207 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:47,208 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:30:47,208 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:30:47,210 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:30:47,211 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:30:47,212 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:30:47,233 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:30:47,234 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:30:47,234 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:30:47,235 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:30:47.235193+07:00
2025-10-08 10:30:47,235 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:30:47.235193+07:00
2025-10-08 10:30:47,236 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:30:47.235193+07:00 trong DST: True
2025-10-08 10:30:47,236 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:30:47,236 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:30:47,237 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:30:47,238 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:30:47,238 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:30:47,241 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:30:47,265 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:30:47,269 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:30:47,270 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:30:47,271 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:30:47,272 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:30:47,272 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:30:47,274 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:30:47,301 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:30:47,302 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:30:47,303 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:30:47,303 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:30:47,304 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:30:47,305 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:30:47,330 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:30:47,331 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:30:47,331 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:30:47,331 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:30:47,332 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:30:47,332 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:30:47,333 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:30:47,335 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:30:47,360 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:30:47,361 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:30:47,362 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:30:47,363 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:30:47,363 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:30:47,364 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:30:47,364 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:30:47,365 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:30:47,371 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4039.745, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:30:47,396 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:30:47,397 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:30:47,397 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:30:47,398 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:30:47,422 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 43746.99999999984
2025-10-08 10:30:47,423 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 98864.00000000003
2025-10-08 10:30:47,423 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27194.99999999971
2025-10-08 10:30:47,424 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45315.9999999998
2025-10-08 10:30:47,424 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:30:47,425 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43746.99999999984}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98864.00000000003}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27194.99999999971}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45315.9999999998}]
2025-10-08 10:30:47,426 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:30:47,426 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:30:47,427 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:30:47,427 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:30:47,427 - APP.services.mt5_service - DEBUG - Position in day range: 0.9854516244198491
2025-10-08 10:30:47,428 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:30:47,428 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:30:47.428803+07:00
2025-10-08 10:30:47,429 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:30:47.428803+07:00
2025-10-08 10:30:47,429 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:30:47.428803+07:00 trong DST: True
2025-10-08 10:30:47,430 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:30:47,430 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:30:47,452 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 210
2025-10-08 10:30:47,454 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:47,454 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:47,455 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '7400', 'price': 4039.74, 'distance_pips': 0.5}, {'level': '7425', 'price': 4039.743, 'distance_pips': 0.25}, {'level': '7450', 'price': 4039.745, 'distance_pips': 0.0}, {'level': '7475', 'price': 4039.748, 'distance_pips': 0.25}]
2025-10-08 10:30:47,455 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:30:47,456 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:47,456 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:47,457 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:30:47,458 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.745
2025-10-08 10:30:47,458 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:47,459 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:30:47,459 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:47,460 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:30:47,460 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:30:47,487 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4039.745
2025-10-08 10:30:47,488 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:47,488 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:30:47,489 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:47,490 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:30:47,490 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:30:47,492 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4039.745
2025-10-08 10:30:47,522 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:47,523 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:30:47,549 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:47,549 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:30:47,550 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:30:47,550 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.745
2025-10-08 10:30:47,551 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:47,552 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:30:47,552 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:47,553 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:30:47,554 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:47,555 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:47,581 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:30:47,582 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:30:47,583 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:30:47,583 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:30:47,583 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:30:47,584 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:30:47,584 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:30:47,585 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:30:47,585 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:30:47,585 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:30:47,586 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:30:47,586 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:30:47,610 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:30:47,611 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:30:47,612 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:30:47,612 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:30:47,612 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:47,613 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:47,613 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:30:47,614 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:30:47,614 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:30:47,615 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:30:47,616 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:30:47,644 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:30:47,646 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:30:47,646 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:30:47,647 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:47,649 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:30:47,671 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4039.745, 'ask': 4039.782, 'last': 0.0, 'time': 1759919446}
2025-10-08 10:30:47,672 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:30:47,672 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:30:47,673 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:30:47,673 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:47,673 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:47,674 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:47,674 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:47,675 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:47,675 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:30:47,675 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4039.745
2025-10-08 10:30:47,676 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43746.99999999984}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98864.00000000003}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27194.99999999971}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45315.9999999998}]
2025-10-08 10:30:47,676 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:30:47,729 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:47,734 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:30:47,735 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:30:47,736 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:30:47,737 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:30:51,599 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:30:51,601 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:30:51,602 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:30:51,602 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:30:51,604 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:30:51,605 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:30:51,608 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:30:51,609 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:51,624 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:30:51,630 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:30:51,634 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:30:51,635 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:30:51,636 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:30:51,683 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:52,137 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:30:52,144 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:30:52,145 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:30:52,147 - APP.services.mt5_service - DEBUG - Current price (cp): 4040.694
2025-10-08 10:30:52,156 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 304, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:30:52,231 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 223, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:30:52,259 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:30:52,332 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:30:52,391 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:30:52,486 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:52,584 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:30:52,593 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:30:52,596 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:30:52,597 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:52,597 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:30:52,598 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:30:52,600 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:30:52,600 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:52,601 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:30:52,601 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:30:52,603 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:30:52,604 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:52,604 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:30:52,604 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:30:52,607 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:30:52,608 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:30:52,608 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:30:52,609 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:30:52,609 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:30:52,610 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:30:52,610 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:30:52.610492+07:00
2025-10-08 10:30:52,610 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:30:52.610492+07:00
2025-10-08 10:30:52,611 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:30:52.610492+07:00 trong DST: True
2025-10-08 10:30:52,611 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:30:52,612 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:30:52,612 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:30:52,613 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:30:52,613 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:30:52,615 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:30:52,679 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:30:52,689 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:30:52,697 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:30:52,699 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:30:52,700 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:30:52,700 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:30:52,701 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:30:52,701 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:30:52,701 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:30:52,702 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:30:52,703 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:30:52,704 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:30:52,705 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:30:52,705 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:30:52,706 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:30:52,706 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:30:52,706 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:30:52,707 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:30:52,708 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:30:52,708 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:30:52,709 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:30:52,709 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:30:52,710 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:30:52,710 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:30:52,711 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:30:52,711 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:30:52,712 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:30:52,713 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:30:52,714 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:30:52,728 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4040.694, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:30:52,735 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:30:52,736 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:30:52,736 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:30:52,737 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:30:52,737 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 44695.99999999991
2025-10-08 10:30:52,737 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 99813.0000000001
2025-10-08 10:30:52,738 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 28143.999999999778
2025-10-08 10:30:52,738 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 46264.99999999987
2025-10-08 10:30:52,739 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:30:52,739 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44695.99999999991}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99813.0000000001}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 28143.999999999778}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 46264.99999999987}]
2025-10-08 10:30:52,740 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:30:52,740 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:30:52,742 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:30:52,742 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:30:52,744 - APP.services.mt5_service - DEBUG - Position in day range: 1.002392002856123
2025-10-08 10:30:52,745 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:30:52,745 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:30:52.745769+07:00
2025-10-08 10:30:52,764 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:30:52.745769+07:00
2025-10-08 10:30:52,766 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:30:52.745769+07:00 trong DST: True
2025-10-08 10:30:52,766 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:30:52,767 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:30:52,767 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 210
2025-10-08 10:30:52,768 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:52,768 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:52,770 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '6900', 'price': 4040.69, 'distance_pips': 0.4}, {'level': '6925', 'price': 4040.693, 'distance_pips': 0.15}, {'level': '6950', 'price': 4040.695, 'distance_pips': 0.1}, {'level': '6975', 'price': 4040.698, 'distance_pips': 0.35}]
2025-10-08 10:30:52,770 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:30:52,770 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:52,771 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:52,772 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:30:52,772 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.694
2025-10-08 10:30:52,773 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:52,795 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:30:52,797 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:52,797 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:30:52,798 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:30:52,798 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4040.694
2025-10-08 10:30:52,799 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:52,799 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:30:52,800 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:52,801 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:30:52,801 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:30:52,802 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4040.694
2025-10-08 10:30:52,802 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:52,803 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:30:52,804 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:52,805 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:30:52,806 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:30:52,834 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.694
2025-10-08 10:30:52,835 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:52,835 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:30:52,837 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:52,862 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:30:52,863 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:52,863 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:52,864 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:30:52,864 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:30:52,864 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:30:52,865 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:30:52,865 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:30:52,865 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:30:52,866 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:30:52,866 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:30:52,867 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:30:52,867 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:30:52,870 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:30:52,893 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:30:52,894 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:30:52,895 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:30:52,896 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:30:52,896 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:30:52,896 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:52,897 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:52,897 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:30:52,898 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:30:52,898 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:30:52,899 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:30:52,902 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:30:52,927 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:30:52,928 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:52,929 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:30:52,929 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:30:52,929 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4040.694, 'ask': 4040.731, 'last': 0.0, 'time': 1759919451}
2025-10-08 10:30:52,933 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:30:52,953 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:30:52,954 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:30:52,955 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:30:52,955 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:52,956 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:52,956 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:52,956 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:52,957 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:52,957 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:30:52,958 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4040.694
2025-10-08 10:30:52,958 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44695.99999999991}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99813.0000000001}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 28143.999999999778}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 46264.99999999987}]
2025-10-08 10:30:52,959 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:30:52,997 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:53,016 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:30:53,017 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:30:53,018 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:30:53,019 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:30:54,895 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:30:54,947 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:30:56,603 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:30:56,605 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:30:56,605 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:30:56,606 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:30:56,608 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:30:56,608 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:30:56,612 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:30:56,637 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:56,638 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:30:56,639 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:30:56,639 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:30:56,639 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:30:56,640 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:30:56,661 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:56,886 - APP.ui.app_ui - INFO - Autorun tick: Kích hoạt worker kiểm tra.
2025-10-08 10:30:56,886 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_autorun_tick_worker' vào thread pool.
2025-10-08 10:30:56,887 - APP.ui.app_ui - DEBUG - Autorun tick worker: Bắt đầu kiểm tra điều kiện.
2025-10-08 10:30:57,141 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:30:57,143 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:30:57,144 - APP.ui.app_ui - INFO - Autorun tick worker: Điều kiện hợp lệ, yêu cầu bắt đầu phân tích trên luồng UI.
2025-10-08 10:30:57,145 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:30:57,145 - APP.services.mt5_service - DEBUG - Current price (cp): 4041.157
2025-10-08 10:30:57,151 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 306, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:30:57,204 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 223, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:30:57,205 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: start_analysis
2025-10-08 10:30:57,206 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:30:57,206 - APP.ui.app_ui - INFO - Yêu cầu bắt đầu phân tích từ UI.
2025-10-08 10:30:57,207 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:30:57,208 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:30:57,209 - APP.ui.utils.ui_builder - DEBUG - Đã thay đổi trạng thái nút Start/Stop thành 'disabled'. Các điều khiển khác không bị ảnh hưởng.
2025-10-08 10:30:57,209 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:57,209 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:30:57,210 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:30:57,210 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:30:57,211 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:30:57,215 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:30:57,235 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:30:57,236 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:57,237 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:30:57,237 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:30:57,237 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:30:57,238 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:30:57,240 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:30:57,240 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:30:57,241 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:57,241 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:30:57,242 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:30:57,242 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:30:57,245 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:30:57,271 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:30:57,272 - APP.services.te_service - INFO - Đăng nhập thành công vào Trading Economics API.
2025-10-08 10:30:57,272 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:30:57,273 - APP.services.news_service - DEBUG - Cấu hình NewsService đã được cập nhật.
2025-10-08 10:30:57,273 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:30:57,297 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:30:57,298 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-08 10:30:57,298 - APP.ui.app_ui - INFO - Đã khởi tạo và bắt đầu luồng AnalysisWorker.
2025-10-08 10:30:57,300 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:30:57,301 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-08 10:30:57,302 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:30:57,304 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:30:57,334 - APP.services.gemini_service - INFO - Đã khởi tạo model 'models/gemini-2.5-flash' thành công.
2025-10-08 10:30:57,335 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:30:57,360 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 2: Xây dựng ngữ cảnh và kiểm tra điều kiện.
2025-10-08 10:30:57,361 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:30:57,362 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 3: Chuẩn bị và upload ảnh (song song).
2025-10-08 10:30:57,362 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-RUN.
2025-10-08 10:30:57,363 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:30:57,364 - APP.analysis.image_processor - DEBUG - Đang thử tải cache upload.
2025-10-08 10:30:57,365 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:30:57.365254+07:00
2025-10-08 10:30:57,367 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:30:57.365254+07:00
2025-10-08 10:30:57,370 - APP.analysis.image_processor - DEBUG - Đã tải cache upload với 4 mục.
2025-10-08 10:30:57,373 - APP.services.mt5_service - DEBUG - Bắt đầu get_active_killzone cho 2025-10-08 10:30:57.364309 với timezone Asia/Ho_Chi_Minh
2025-10-08 10:30:57,393 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:30:57.365254+07:00 trong DST: True
2025-10-08 10:30:57,394 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-08 10:30:57.364309+07:00, Target TZ: None
2025-10-08 10:30:57,395 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:30:57,396 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 10:30:57.364309+07:00
2025-10-08 10:30:57,396 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_H1.png: 15022:1759914264:adcc044a34c2739b
2025-10-08 10:30:57,397 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:30:57,398 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 10:30:57.364309+07:00 trong DST: True
2025-10-08 10:30:57,398 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M1.png: 21123:1759914329:c9ca25adc2713e89
2025-10-08 10:30:57,398 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M15.png: 14475:1759914258:f522dd906714fb0b
2025-10-08 10:30:57,399 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M5.png: 22339:1759914253:ac9da090a54f8eec
2025-10-08 10:30:57,399 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_H1.png. Tên từ xa: files/jcq192qkqfx5
2025-10-08 10:30:57,401 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:57,418 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M1.png. Tên từ xa: files/zl0mc2r9tv6i
2025-10-08 10:30:57,420 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:30:57,420 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:30:57,421 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M15.png. Tên từ xa: files/4s2o4xrat6a8
2025-10-08 10:30:57,422 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M5.png. Tên từ xa: files/kis0no3da2v8
2025-10-08 10:30:57,422 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_H1.png, đang lấy thông tin file...
2025-10-08 10:30:57,422 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M1.png, đang lấy thông tin file...
2025-10-08 10:30:57,423 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:30:57,424 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:30:57,424 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M15.png, đang lấy thông tin file...
2025-10-08 10:30:57,425 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M5.png, đang lấy thông tin file...
2025-10-08 10:30:57,429 - APP.services.mt5_service - DEBUG - Không trong killzone nào.
2025-10-08 10:30:57,458 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:30:57,462 - APP.core.trading.conditions - INFO - Điều kiện NO-RUN được kích hoạt: Không chạy ngoài các Kill Zone đã định nghĩa.
2025-10-08 10:30:57,465 - APP.core.trading.conditions - INFO - Thoát sớm. Giai đoạn: no-run, Lý do: Không chạy ngoài các Kill Zone đã định nghĩa.
2025-10-08 10:30:57,467 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:30:57,467 - APP.persistence.log_handler - DEBUG - Đang chuẩn bị ghi log giao dịch. Giai đoạn: no-run, Thư mục con: None
2025-10-08 10:30:57,468 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:30:57,471 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:30:57,472 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:30:57,472 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:30:57,473 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:30:57,473 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:30:57,474 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:30:57,474 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:30:57,475 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:30:57,475 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:30:57,475 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:30:57,476 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:30:57,476 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:30:57,477 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:30:57,477 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:30:57,478 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:30:57,479 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:30:57,480 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:30:57,480 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:30:57,481 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:30:57,481 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:30:57,482 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:30:57,482 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:30:57,482 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:30:57,483 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:30:57,483 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:30:57,484 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:30:57,484 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:30:57,485 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:30:57,485 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4041.157, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:30:57,486 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:30:57,486 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:30:57,487 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:30:57,487 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:30:57,487 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 45159.0000000001
2025-10-08 10:30:57,487 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 100276.00000000029
2025-10-08 10:30:57,488 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 28606.99999999997
2025-10-08 10:30:57,488 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 46728.000000000065
2025-10-08 10:30:57,488 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:30:57,489 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 45159.0000000001}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 100276.00000000029}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 28606.99999999997}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 46728.000000000065}]
2025-10-08 10:30:57,490 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:30:57,490 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:30:57,491 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:30:57,492 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:30:57,492 - APP.services.mt5_service - DEBUG - Position in day range: 1.0106569082470582
2025-10-08 10:30:57,518 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:30:57,520 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:30:57.520346+07:00
2025-10-08 10:30:57,520 - APP.analysis.image_processor - DEBUG - Đang lưu cache upload với 4 mục.
2025-10-08 10:30:57,521 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:30:57.520346+07:00
2025-10-08 10:30:57,522 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:30:57.520346+07:00 trong DST: True
2025-10-08 10:30:57,522 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:30:57,523 - APP.analysis.image_processor - DEBUG - Đã lưu cache upload thành công.
2025-10-08 10:30:57,523 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:30:57,524 - APP.utils.threading_utils - DEBUG - Tác vụ song song '_execute_stage_3_logic' đã hoàn thành.
2025-10-08 10:30:57,524 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 210
2025-10-08 10:30:57,525 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:57,535 - APP.persistence.log_handler - DEBUG - Đã ghi log giao dịch thành công vào trade_log_20251008.jsonl.
2025-10-08 10:30:57,547 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:57,549 - APP.persistence.log_handler - DEBUG - Kết thúc hàm log_trade.
2025-10-08 10:30:57,549 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:57,550 - APP.core.analysis_worker - INFO - Giai đoạn 2 thoát sớm: Điều kiện No-Run: Không chạy ngoài các Kill Zone đã định nghĩa.
2025-10-08 10:30:57,550 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '1500', 'price': 4041.15, 'distance_pips': 0.7}, {'level': '1525', 'price': 4041.153, 'distance_pips': 0.45}, {'level': '1550', 'price': 4041.155, 'distance_pips': 0.2}, {'level': '1575', 'price': 4041.158, 'distance_pips': 0.05}]
2025-10-08 10:30:57,551 - APP.utils.threading_utils - DEBUG - Tác vụ song song '_execute_stage_2_logic' đã hoàn thành.
2025-10-08 10:30:57,551 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:30:57,552 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:57,553 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:57,553 - APP.core.analysis_worker - WARNING - Một trong các giai đoạn song song đã thất bại. Dừng worker.
2025-10-08 10:30:57,553 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:30:57,554 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Thoát sớm do lỗi ở Giai đoạn 2 hoặc 3.
2025-10-08 10:30:57,555 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4041.157
2025-10-08 10:30:57,555 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-08 10:30:57,556 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:57,577 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-08 10:30:57,579 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:30:57,580 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:57,581 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:30:57,581 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:30:57,581 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4041.157
2025-10-08 10:30:57,582 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:57,582 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:30:57,583 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:57,583 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:30:57,584 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:30:57,585 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4041.157
2025-10-08 10:30:57,585 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:57,586 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:30:57,587 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:57,587 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:30:57,589 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:30:57,613 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4041.157
2025-10-08 10:30:57,615 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:30:57,615 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:30:57,616 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:30:57,616 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:30:57,617 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:57,619 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:57,643 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:30:57,644 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:30:57,645 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:30:57,645 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:30:57,645 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:30:57,646 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:30:57,646 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:30:57,646 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:30:57,647 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:30:57,647 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:30:57,648 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:30:57,648 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:30:57,649 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:57,649 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:30:57,652 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:30:57,676 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:30:57,676 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:30:57,677 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:57,677 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:57,678 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:30:57,678 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:30:57,679 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:30:57,679 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:30:57,680 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:30:57,680 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:30:57,683 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:30:57,683 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:30:57,704 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:57,707 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:30:57,707 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:30:57,708 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4041.157, 'ask': 4041.194, 'last': 0.0, 'time': 1759919456}
2025-10-08 10:30:57,708 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:30:57,709 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:30:57,709 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:57,710 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:57,710 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:57,710 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:30:57,711 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:30:57,711 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:30:57,713 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4041.157
2025-10-08 10:30:57,735 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 45159.0000000001}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 100276.00000000029}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 28606.99999999997}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 46728.000000000065}]
2025-10-08 10:30:57,736 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:30:57,768 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:57,869 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:57,871 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:57,872 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:57,874 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:57,976 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:57,976 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:58,077 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:58,078 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:58,178 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:58,179 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:58,280 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:58,281 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:58,282 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: _finalize_done
2025-10-08 10:30:58,282 - APP.ui.utils.ui_builder - DEBUG - Đã thay đổi trạng thái nút Start/Stop thành 'normal'. Các điều khiển khác không bị ảnh hưởng.
2025-10-08 10:30:58,283 - APP.ui.app_ui - DEBUG - Lên lịch chạy tự động tiếp theo sau 60000ms.
2025-10-08 10:30:58,283 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:30:58,284 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:30:58,284 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:30:58,285 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:30:58,286 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:31:01,607 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:31:01,609 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:31:01,609 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:31:01,610 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:31:01,612 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:31:01,612 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:31:01,618 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:31:01,630 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:31:01,639 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:01,641 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:31:01,643 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:31:01,644 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:31:01,645 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:31:01,712 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:02,145 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:31:02,147 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:31:02,147 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:31:02,148 - APP.services.mt5_service - DEBUG - Current price (cp): 4041.372
2025-10-08 10:31:02,155 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 309, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:31:02,189 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 223, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:31:02,189 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:31:02,190 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:31:02,192 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:31:02,192 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:02,193 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:31:02,193 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:31:02,196 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:31:02,197 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:02,197 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:31:02,198 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:31:02,199 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:31:02,200 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:02,200 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:31:02,200 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:31:02,203 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:31:02,203 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:02,204 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:31:02,204 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:31:02,206 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:31:02,207 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:31:02,207 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:31:02,208 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:31:02,208 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:31:02,209 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:31:02,209 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:31:02.209456+07:00
2025-10-08 10:31:02,209 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:31:02.209456+07:00
2025-10-08 10:31:02,210 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:31:02.209456+07:00 trong DST: True
2025-10-08 10:31:02,210 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:31:02,211 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:31:02,211 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:31:02,212 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:31:02,213 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:31:02,215 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:31:02,220 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:31:02,235 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:31:02,237 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:31:02,237 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:31:02,238 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:31:02,238 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:31:02,239 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:31:02,239 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:31:02,239 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:31:02,240 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:31:02,240 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:31:02,241 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:31:02,241 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:31:02,242 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:31:02,242 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:31:02,244 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:31:02,245 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:31:02,246 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:31:02,266 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:31:02,269 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:31:02,270 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:31:02,271 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:31:02,272 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:31:02,272 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:31:02,273 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:31:02,273 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:31:02,273 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:31:02,274 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:31:02,279 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:31:02,285 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4041.372, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:31:02,287 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:31:02,292 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:31:02,293 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:31:02,294 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:31:02,299 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 45373.999999999796
2025-10-08 10:31:02,300 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 100490.99999999999
2025-10-08 10:31:02,302 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 28821.99999999966
2025-10-08 10:31:02,302 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 46942.99999999975
2025-10-08 10:31:02,303 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:31:02,303 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 45373.999999999796}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 100490.99999999999}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 28821.99999999966}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 46942.99999999975}]
2025-10-08 10:31:02,304 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:31:02,304 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:31:02,305 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:31:02,305 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:31:02,306 - APP.services.mt5_service - DEBUG - Position in day range: 1.0144948232773991
2025-10-08 10:31:02,306 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:31:02,307 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:31:02.307848+07:00
2025-10-08 10:31:02,308 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:31:02.307848+07:00
2025-10-08 10:31:02,309 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:31:02.307848+07:00 trong DST: True
2025-10-08 10:31:02,316 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:31:02,317 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:31:02,318 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 209
2025-10-08 10:31:02,320 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:02,322 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:02,329 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '3700', 'price': 4041.37, 'distance_pips': 0.2}, {'level': '3725', 'price': 4041.372, 'distance_pips': 0.05}, {'level': '3750', 'price': 4041.375, 'distance_pips': 0.3}, {'level': '3775', 'price': 4041.378, 'distance_pips': 0.55}]
2025-10-08 10:31:02,330 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:31:02,330 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:02,331 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:02,331 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:31:02,332 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4041.372
2025-10-08 10:31:02,332 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:02,333 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:31:02,333 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:02,334 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:31:02,334 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:31:02,335 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4041.372
2025-10-08 10:31:02,335 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:02,336 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:31:02,337 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:02,339 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:31:02,339 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:31:02,344 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4041.372
2025-10-08 10:31:02,349 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:02,351 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:31:02,354 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:02,364 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:31:02,365 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:31:02,365 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4041.372
2025-10-08 10:31:02,366 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:02,366 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:31:02,367 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:02,367 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:31:02,369 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:02,370 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:02,370 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:31:02,376 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:31:02,381 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:31:02,385 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:31:02,387 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:31:02,394 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:31:02,395 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:31:02,395 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:31:02,395 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:31:02,396 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:31:02,396 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:31:02,396 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:31:02,397 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:31:02,397 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:31:02,398 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:31:02,398 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:31:02,398 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:02,399 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:02,400 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:31:02,401 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:31:02,402 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:31:02,413 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:31:02,417 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:31:02,419 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:31:02,422 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:02,424 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:31:02,424 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:31:02,425 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4041.372, 'ask': 4041.409, 'last': 0.0, 'time': 1759919461}
2025-10-08 10:31:02,427 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:31:02,428 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:31:02,428 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:31:02,429 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:31:02,429 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:02,430 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:02,430 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:02,430 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:02,432 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:02,432 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:31:02,433 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4041.372
2025-10-08 10:31:02,433 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 45373.999999999796}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 100490.99999999999}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 28821.99999999966}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 46942.99999999975}]
2025-10-08 10:31:02,434 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:31:02,456 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:02,457 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:31:02,457 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:31:02,459 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:31:02,461 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:31:06,611 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:31:06,613 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:31:06,614 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:31:06,614 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:31:06,616 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:31:06,617 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:31:06,621 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:31:06,641 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:31:06,641 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:06,643 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:31:06,647 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:31:06,648 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:31:06,649 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:31:06,717 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:07,150 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:31:07,152 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:31:07,153 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:31:07,153 - APP.services.mt5_service - DEBUG - Current price (cp): 4040.014
2025-10-08 10:31:07,158 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 314, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:31:07,189 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 224, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:31:07,191 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:31:07,192 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:31:07,195 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:31:07,195 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:07,196 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:31:07,196 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:31:07,199 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:31:07,200 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:07,200 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:31:07,200 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:31:07,202 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:31:07,203 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:07,203 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:31:07,204 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:31:07,205 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:31:07,206 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:07,206 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:31:07,206 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:31:07,209 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:31:07,209 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:31:07,210 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:31:07,210 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:31:07,210 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:31:07,211 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:31:07,211 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:31:07.211492+07:00
2025-10-08 10:31:07,211 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:31:07.211492+07:00
2025-10-08 10:31:07,212 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:31:07.211492+07:00 trong DST: True
2025-10-08 10:31:07,212 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:31:07,233 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:31:07,234 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:31:07,236 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:31:07,236 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:31:07,238 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:31:07,238 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:31:07,241 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:31:07,242 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:31:07,242 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:31:07,242 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:31:07,243 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:31:07,243 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:31:07,268 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:31:07,269 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:31:07,269 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:31:07,270 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:31:07,270 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:31:07,271 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:31:07,272 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:31:07,272 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:31:07,273 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:31:07,273 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:31:07,273 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:31:07,274 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:31:07,300 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:31:07,301 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:31:07,301 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:31:07,303 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:31:07,303 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:31:07,304 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:31:07,336 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:31:07,337 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:31:07,362 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:31:07,363 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:31:07,364 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4040.014, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:31:07,364 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:31:07,365 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:31:07,365 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:31:07,365 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:31:07,366 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 44016.00000000007
2025-10-08 10:31:07,366 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 99133.00000000026
2025-10-08 10:31:07,367 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27463.99999999994
2025-10-08 10:31:07,367 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45585.00000000004
2025-10-08 10:31:07,367 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:31:07,368 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44016.00000000007}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99133.00000000026}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27463.99999999994}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45585.00000000004}]
2025-10-08 10:31:07,368 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:31:07,369 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:31:07,372 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:31:07,393 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:31:07,393 - APP.services.mt5_service - DEBUG - Position in day range: 0.9902534808996819
2025-10-08 10:31:07,394 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:31:07,394 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:31:07.394455+07:00
2025-10-08 10:31:07,394 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:31:07.394455+07:00
2025-10-08 10:31:07,395 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:31:07.394455+07:00 trong DST: True
2025-10-08 10:31:07,395 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:31:07,396 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:31:07,396 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 209
2025-10-08 10:31:07,396 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:07,397 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:07,397 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '100', 'price': 4040.01, 'distance_pips': 0.4}, {'level': '125', 'price': 4040.013, 'distance_pips': 0.15}, {'level': '150', 'price': 4040.015, 'distance_pips': 0.1}, {'level': '175', 'price': 4040.018, 'distance_pips': 0.35}]
2025-10-08 10:31:07,398 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:31:07,399 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:07,399 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:07,399 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:31:07,415 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.014
2025-10-08 10:31:07,424 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:07,425 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:31:07,426 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:07,427 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:31:07,427 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:31:07,427 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4040.014
2025-10-08 10:31:07,428 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:07,429 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:31:07,430 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:07,430 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:31:07,431 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:31:07,455 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4040.014
2025-10-08 10:31:07,458 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:07,458 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:31:07,459 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:07,460 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:31:07,460 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:31:07,461 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.014
2025-10-08 10:31:07,461 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:07,461 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:31:07,462 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:07,465 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:31:07,486 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:07,486 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:07,487 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:31:07,488 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:31:07,488 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:31:07,489 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:31:07,489 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:31:07,490 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:31:07,490 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:31:07,490 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:31:07,491 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:31:07,491 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:31:07,492 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:31:07,492 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:31:07,493 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:31:07,493 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:31:07,493 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:31:07,522 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:31:07,523 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:07,523 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:07,524 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:31:07,524 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:31:07,525 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:31:07,525 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:31:07,528 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:31:07,551 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:31:07,552 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:07,553 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:31:07,553 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4040.014, 'ask': 4040.051, 'last': 0.0, 'time': 1759919466}
2025-10-08 10:31:07,553 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:31:07,554 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:31:07,556 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:31:07,558 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:31:07,559 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:07,580 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:07,581 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:31:07,581 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:07,581 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:07,582 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:07,582 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:31:07,583 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4040.014
2025-10-08 10:31:07,583 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44016.00000000007}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99133.00000000026}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27463.99999999994}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45585.00000000004}]
2025-10-08 10:31:07,584 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:31:07,654 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:07,655 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:31:07,656 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:31:07,657 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:31:07,659 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:31:09,896 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:31:09,965 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:31:11,616 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:31:11,618 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:31:11,619 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:31:11,621 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:31:11,625 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:31:11,625 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:31:11,631 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:31:11,644 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:31:11,649 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:11,678 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:31:11,709 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:31:11,710 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:31:11,711 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:31:11,781 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:12,213 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:31:12,217 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:31:12,217 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:31:12,218 - APP.services.mt5_service - DEBUG - Current price (cp): 4039.97
2025-10-08 10:31:12,223 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 317, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:31:12,240 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 224, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:31:12,241 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:31:12,241 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:31:12,243 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:31:12,244 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:12,245 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:31:12,246 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:31:12,268 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:31:12,268 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:12,269 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:31:12,269 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:31:12,272 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:31:12,273 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:12,273 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:31:12,273 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:31:12,276 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:31:12,303 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:12,303 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:31:12,304 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:31:12,325 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:31:12,332 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:31:12,333 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:31:12,333 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:31:12,334 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:31:12,334 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:31:12,334 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:31:12.334824+07:00
2025-10-08 10:31:12,335 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:31:12.334824+07:00
2025-10-08 10:31:12,335 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:31:12.334824+07:00 trong DST: True
2025-10-08 10:31:12,336 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:31:12,336 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:31:12,337 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:31:12,338 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:31:12,339 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:31:12,341 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:31:12,341 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:31:12,353 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:31:12,364 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:31:12,365 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:31:12,366 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:31:12,367 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:31:12,368 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:31:12,368 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:31:12,369 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:31:12,369 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:31:12,369 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:31:12,370 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:31:12,371 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:31:12,372 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:31:12,373 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:31:12,383 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:31:12,395 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:31:12,396 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:31:12,398 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:31:12,400 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:31:12,402 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:31:12,402 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:31:12,403 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:31:12,403 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:31:12,404 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:31:12,404 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:31:12,405 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:31:12,405 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:31:12,406 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:31:12,406 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4039.97, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:31:12,407 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:31:12,407 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:31:12,408 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:31:12,408 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:31:12,409 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 43971.99999999975
2025-10-08 10:31:12,409 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 99088.99999999994
2025-10-08 10:31:12,410 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27419.999999999618
2025-10-08 10:31:12,411 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45540.99999999971
2025-10-08 10:31:12,412 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:31:12,413 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43971.99999999975}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99088.99999999994}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27419.999999999618}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45540.99999999971}]
2025-10-08 10:31:12,414 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:31:12,415 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:31:12,416 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:31:12,417 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:31:12,417 - APP.services.mt5_service - DEBUG - Position in day range: 0.9894680471260238
2025-10-08 10:31:12,417 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:31:12,418 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:31:12.418365+07:00
2025-10-08 10:31:12,419 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:31:12.418365+07:00
2025-10-08 10:31:12,420 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:31:12.418365+07:00 trong DST: True
2025-10-08 10:31:12,421 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:31:12,421 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:31:12,421 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 209
2025-10-08 10:31:12,422 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:12,423 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:12,423 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '9700', 'price': 4039.97, 'distance_pips': 0.0}, {'level': '9725', 'price': 4039.973, 'distance_pips': 0.25}, {'level': '9750', 'price': 4039.975, 'distance_pips': 0.5}, {'level': '9775', 'price': 4039.978, 'distance_pips': 0.75}]
2025-10-08 10:31:12,424 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:31:12,424 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:12,425 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:12,427 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:31:12,428 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.97
2025-10-08 10:31:12,428 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:12,429 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:31:12,430 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:12,430 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:31:12,430 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:31:12,433 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4039.97
2025-10-08 10:31:12,433 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:12,435 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:31:12,441 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:12,442 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:31:12,444 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:31:12,446 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4039.97
2025-10-08 10:31:12,447 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:12,449 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:31:12,451 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:12,454 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:31:12,456 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:31:12,457 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.97
2025-10-08 10:31:12,457 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:12,458 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:31:12,459 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:12,459 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:31:12,460 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:12,460 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:12,460 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:31:12,461 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:31:12,461 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:31:12,462 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:31:12,462 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:31:12,462 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:31:12,463 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:31:12,463 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:31:12,463 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:31:12,464 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:31:12,464 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:31:12,465 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:31:12,465 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:31:12,465 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:31:12,466 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:31:12,466 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:31:12,466 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:12,467 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:12,467 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:31:12,468 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:31:12,468 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:31:12,468 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:31:12,469 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:31:12,479 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:31:12,482 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:31:12,483 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:31:12,485 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:12,492 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:31:12,500 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4039.97, 'ask': 4040.007, 'last': 0.0, 'time': 1759919472}
2025-10-08 10:31:12,503 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:31:12,504 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:31:12,505 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:31:12,505 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:12,506 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:12,506 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:12,506 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:12,507 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:12,507 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:31:12,507 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4039.97
2025-10-08 10:31:12,508 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43971.99999999975}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99088.99999999994}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27419.999999999618}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45540.99999999971}]
2025-10-08 10:31:12,508 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:31:12,511 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:12,511 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:31:12,512 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:31:12,513 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:31:12,514 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:31:16,623 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:31:16,625 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:31:16,625 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:31:16,626 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:31:16,628 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:31:16,629 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:31:16,633 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:31:16,633 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:16,637 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:31:16,638 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:16,638 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:31:16,683 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:31:16,768 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:31:16,857 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:31:17,427 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:31:17,430 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:31:17,431 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:31:17,431 - APP.services.mt5_service - DEBUG - Current price (cp): 4040.016
2025-10-08 10:31:17,445 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 318, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:31:17,493 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 224, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:31:17,531 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:31:17,539 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:31:17,548 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:31:17,548 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:17,549 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:31:17,550 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:31:17,553 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:31:17,605 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:17,607 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:31:17,611 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:31:17,616 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:31:17,617 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:17,618 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:31:17,619 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:31:17,637 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:31:17,665 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:17,669 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:31:17,670 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:31:17,675 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:31:17,676 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:31:17,677 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:31:17,678 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:31:17,680 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:31:17,681 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:31:17,759 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:31:17.759673+07:00
2025-10-08 10:31:17,764 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:31:17.759673+07:00
2025-10-08 10:31:17,769 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:31:17.759673+07:00 trong DST: True
2025-10-08 10:31:17,772 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:31:17,772 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:31:17,773 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:31:17,775 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:31:17,818 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:31:17,824 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:31:17,825 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:31:17,830 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:31:17,831 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:31:17,831 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:31:17,832 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:31:17,832 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:31:17,833 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:31:17,834 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:31:17,834 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:31:17,836 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:31:17,837 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:31:17,838 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:31:17,896 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:31:17,897 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:31:17,905 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:31:17,956 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:31:17,958 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:31:17,959 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:31:17,961 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:31:17,962 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:31:17,990 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:31:18,055 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:31:18,064 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:31:18,066 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:31:18,067 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:31:18,073 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:31:18,075 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:31:18,076 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:31:18,080 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:31:18,082 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4040.016, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:31:18,084 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:31:18,086 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:31:18,118 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:31:18,132 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:31:18,142 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 44018.00000000003
2025-10-08 10:31:18,144 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 99135.00000000022
2025-10-08 10:31:18,150 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 27465.999999999894
2025-10-08 10:31:18,183 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45586.999999999985
2025-10-08 10:31:18,206 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:31:18,210 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44018.00000000003}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99135.00000000022}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27465.999999999894}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45586.999999999985}]
2025-10-08 10:31:18,211 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:31:18,211 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:31:18,212 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:31:18,213 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:31:18,240 - APP.services.mt5_service - DEBUG - Position in day range: 0.990289182434847
2025-10-08 10:31:18,244 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:31:18,334 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:31:18.334470+07:00
2025-10-08 10:31:18,377 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:31:18.334470+07:00
2025-10-08 10:31:18,389 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:31:18.334470+07:00 trong DST: True
2025-10-08 10:31:18,397 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:31:18,398 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:31:18,410 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 209
2025-10-08 10:31:18,416 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:18,418 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:18,421 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '100', 'price': 4040.01, 'distance_pips': 0.6}, {'level': '125', 'price': 4040.013, 'distance_pips': 0.35}, {'level': '150', 'price': 4040.015, 'distance_pips': 0.1}, {'level': '175', 'price': 4040.018, 'distance_pips': 0.15}]
2025-10-08 10:31:18,445 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:31:18,455 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:18,476 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:18,482 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:31:18,522 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.016
2025-10-08 10:31:18,553 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:18,584 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:31:18,645 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:18,727 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:31:18,730 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:31:18,732 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4040.016
2025-10-08 10:31:18,733 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:18,734 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:31:18,795 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:18,820 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:31:18,884 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:31:18,972 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4040.016
2025-10-08 10:31:18,979 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:18,981 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:31:18,983 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:18,987 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:31:18,990 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:31:19,130 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4040.016
2025-10-08 10:31:19,265 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:19,354 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:31:19,443 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:19,534 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:31:19,757 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:19,865 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:19,991 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:31:20,083 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:31:20,174 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:31:20,265 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:31:20,390 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:31:20,455 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:31:20,570 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:31:20,616 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:31:20,707 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:31:20,773 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:31:20,849 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:31:20,897 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:31:20,924 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:31:20,927 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:31:20,929 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:31:20,930 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:31:20,960 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:20,994 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:21,009 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:31:21,068 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:31:21,073 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:31:21,087 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:31:21,145 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:31:21,208 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:31:21,212 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:21,214 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:31:21,215 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:31:21,217 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4040.016, 'ask': 4040.053, 'last': 0.0, 'time': 1759919476}
2025-10-08 10:31:21,255 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:31:21,261 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:31:21,262 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:31:21,263 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:31:21,264 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:21,265 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:21,265 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:21,266 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:21,266 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:21,266 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:31:21,267 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4040.016
2025-10-08 10:31:21,267 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 44018.00000000003}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 99135.00000000022}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 27465.999999999894}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45586.999999999985}]
2025-10-08 10:31:21,268 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:31:21,306 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:21,334 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:31:21,334 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:31:21,335 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:31:21,337 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:31:21,628 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:31:21,631 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:31:21,631 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:31:21,632 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:31:21,634 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:31:21,635 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:31:21,639 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:31:21,639 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:21,643 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:31:21,643 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:31:21,644 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:31:21,644 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:31:21,645 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:31:21,646 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:22,146 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:31:22,148 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:31:22,152 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:31:22,157 - APP.services.mt5_service - DEBUG - Current price (cp): 4039.504
2025-10-08 10:31:22,164 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 325, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:31:22,210 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 224, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:31:22,212 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:31:22,223 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:31:22,238 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:31:22,280 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:22,337 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:31:22,347 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:31:22,352 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:31:22,352 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:22,364 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:31:22,386 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:31:22,426 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:31:22,429 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:22,431 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:31:22,432 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:31:22,465 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:31:22,475 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:22,478 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:31:22,480 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:31:22,485 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:31:22,486 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:31:22,488 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:31:22,489 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:31:22,491 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:31:22,492 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:31:22,494 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:31:22.494368+07:00
2025-10-08 10:31:22,535 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:31:22.494368+07:00
2025-10-08 10:31:22,537 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:31:22.494368+07:00 trong DST: True
2025-10-08 10:31:22,540 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:31:22,542 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:31:22,544 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:31:22,546 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:31:22,547 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:31:22,550 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:31:22,551 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:31:22,556 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:31:22,583 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:31:22,584 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:31:22,584 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:31:22,585 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:31:22,585 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:31:22,586 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:31:22,587 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:31:22,587 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:31:22,588 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:31:22,588 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:31:22,594 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:31:22,595 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:31:22,596 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:31:22,597 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:31:22,598 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:31:22,598 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:31:22,599 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:31:22,599 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:31:22,600 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:31:22,600 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:31:22,601 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:31:22,601 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:31:22,601 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:31:22,602 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:31:22,604 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:31:22,604 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:31:22,605 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:31:22,605 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4039.504, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:31:22,605 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:31:22,606 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:31:22,606 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:31:22,606 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:31:22,607 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 43505.999999999854
2025-10-08 10:31:22,608 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 98623.00000000004
2025-10-08 10:31:22,608 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 26953.999999999724
2025-10-08 10:31:22,609 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 45074.99999999982
2025-10-08 10:31:22,609 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:31:22,610 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43505.999999999854}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98623.00000000004}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26953.999999999724}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45074.99999999982}]
2025-10-08 10:31:22,610 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:31:22,611 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:31:22,611 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:31:22,612 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:31:22,612 - APP.services.mt5_service - DEBUG - Position in day range: 0.9811495894323449
2025-10-08 10:31:22,613 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:31:22,614 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:31:22.614530+07:00
2025-10-08 10:31:22,615 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:31:22.614530+07:00
2025-10-08 10:31:22,615 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:31:22.614530+07:00 trong DST: True
2025-10-08 10:31:22,615 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:31:22,616 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:31:22,616 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 209
2025-10-08 10:31:22,616 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:22,617 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:22,643 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '5000', 'price': 4039.5, 'distance_pips': 0.4}, {'level': '5025', 'price': 4039.503, 'distance_pips': 0.15}, {'level': '5050', 'price': 4039.505, 'distance_pips': 0.1}, {'level': '5075', 'price': 4039.508, 'distance_pips': 0.35}]
2025-10-08 10:31:22,644 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:31:22,644 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:22,644 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:22,645 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:31:22,646 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.504
2025-10-08 10:31:22,646 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:22,646 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:31:22,647 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:22,648 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:31:22,648 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:31:22,649 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4039.504
2025-10-08 10:31:22,650 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:22,650 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:31:22,651 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:22,678 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:31:22,680 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:31:22,681 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4039.504
2025-10-08 10:31:22,682 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:22,682 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:31:22,708 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:22,709 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:31:22,709 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:31:22,710 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4039.504
2025-10-08 10:31:22,711 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:22,711 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:31:22,712 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:22,712 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:31:22,713 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:22,713 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:22,741 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:31:22,744 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:31:22,744 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:31:22,770 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:31:22,771 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:31:22,772 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:31:22,773 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:31:22,773 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:31:22,774 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:31:22,775 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:31:22,803 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:31:22,836 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:31:22,846 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:31:22,852 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:31:22,854 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:31:22,855 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:31:22,856 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:22,856 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:22,858 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:31:22,858 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:31:22,859 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:31:22,859 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:31:22,860 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:31:22,861 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:31:22,867 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:22,868 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:31:22,868 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:31:22,869 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4039.504, 'ask': 4039.541, 'last': 0.0, 'time': 1759919481}
2025-10-08 10:31:22,876 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:31:22,878 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:31:22,879 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:31:22,880 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:31:22,881 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:22,881 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:22,882 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:22,882 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:22,883 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:22,883 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:31:22,883 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4039.504
2025-10-08 10:31:22,884 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 43505.999999999854}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 98623.00000000004}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 26953.999999999724}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 45074.99999999982}]
2025-10-08 10:31:22,884 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:31:22,939 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:22,940 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:31:22,941 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:31:22,942 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:31:22,951 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:31:24,942 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:31:24,956 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:31:26,634 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:31:26,639 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:31:26,639 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:31:26,647 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:31:26,650 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:31:26,678 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:31:26,680 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:31:26,681 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:31:26,685 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:31:26,707 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:31:26,709 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:26,709 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:31:26,711 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:31:26,755 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:27,217 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:31:27,232 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:31:27,245 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:31:27,258 - APP.services.mt5_service - DEBUG - Current price (cp): 4038.423
2025-10-08 10:31:27,267 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 340, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:31:27,305 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 226, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:31:27,338 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:31:27,363 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:31:27,368 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:31:27,369 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:27,398 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:31:27,400 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:31:27,431 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:31:27,460 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:27,462 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:31:27,491 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:31:27,495 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:31:27,525 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:27,551 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:31:27,582 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:31:27,613 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:31:27,648 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:27,677 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:31:27,680 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:31:27,712 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:31:27,740 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:31:27,742 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:31:27,756 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:31:27,785 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:31:27,837 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:31:27,867 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:31:27.867567+07:00
2025-10-08 10:31:27,915 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:31:27.867567+07:00
2025-10-08 10:31:27,929 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:31:27.867567+07:00 trong DST: True
2025-10-08 10:31:27,930 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:31:27,931 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:31:27,940 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:31:27,942 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:31:27,948 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:31:27,951 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:31:27,955 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:31:27,959 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:31:27,963 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:31:27,989 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:31:27,992 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:31:27,993 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:31:28,191 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:31:28,301 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:31:28,397 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:31:28,461 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:31:28,471 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:31:28,474 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:31:28,475 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:31:28,476 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:31:28,477 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:31:28,478 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:31:28,480 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:31:28,481 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:31:28,482 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:31:28,483 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:31:28,484 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:31:28,485 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:31:28,487 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:31:28,586 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:31:28,587 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:31:28,588 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:31:28,615 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:31:28,617 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:31:28,618 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:31:28,618 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4038.423, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:31:28,619 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:31:28,619 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:31:28,651 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:31:28,677 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:31:28,677 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 42424.99999999972
2025-10-08 10:31:28,678 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 97541.99999999991
2025-10-08 10:31:28,678 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 25872.999999999593
2025-10-08 10:31:28,679 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 43993.99999999969
2025-10-08 10:31:28,679 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:31:28,680 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42424.99999999972}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97541.99999999991}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25872.999999999593}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43993.99999999969}]
2025-10-08 10:31:28,680 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:31:28,681 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:31:28,681 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:31:28,682 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:31:28,683 - APP.services.mt5_service - DEBUG - Position in day range: 0.9618529096751129
2025-10-08 10:31:28,710 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:31:28,712 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:31:28.712381+07:00
2025-10-08 10:31:28,713 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:31:28.712381+07:00
2025-10-08 10:31:28,713 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:31:28.712381+07:00 trong DST: True
2025-10-08 10:31:28,723 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:31:28,739 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:31:28,741 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 209
2025-10-08 10:31:28,741 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:28,741 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:28,742 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4200', 'price': 4038.42, 'distance_pips': 0.3}, {'level': '4225', 'price': 4038.423, 'distance_pips': 0.05}, {'level': '4250', 'price': 4038.425, 'distance_pips': 0.2}, {'level': '4275', 'price': 4038.428, 'distance_pips': 0.45}]
2025-10-08 10:31:28,743 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:31:28,743 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:28,743 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:28,744 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:31:28,745 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.423
2025-10-08 10:31:28,745 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:28,775 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:31:28,803 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:28,851 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:31:28,853 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:31:28,854 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4038.423
2025-10-08 10:31:28,855 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:28,856 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:31:28,857 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:28,857 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:31:28,858 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:31:28,859 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4038.423
2025-10-08 10:31:28,860 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:28,860 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:31:28,861 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:28,862 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:31:28,862 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:31:28,864 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.423
2025-10-08 10:31:28,865 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:28,865 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:31:28,866 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:28,867 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:31:28,868 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:28,869 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:28,870 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:31:28,882 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:31:28,917 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:31:28,925 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:31:28,926 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:31:28,927 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:31:28,929 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:31:28,930 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:31:28,930 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:31:28,931 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:31:28,932 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:31:28,932 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:31:28,971 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:31:28,979 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:31:28,980 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:31:28,982 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:31:29,039 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:29,097 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:29,164 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:31:29,166 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:31:29,167 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:31:29,168 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:31:29,169 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:31:29,170 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:31:29,172 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:29,173 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:31:29,173 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:31:29,174 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4038.423, 'ask': 4038.46, 'last': 0.0, 'time': 1759919486}
2025-10-08 10:31:29,176 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:31:29,177 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:31:29,178 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:31:29,178 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:31:29,178 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:29,179 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:29,180 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:29,180 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:29,181 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:29,181 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:31:29,182 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4038.423
2025-10-08 10:31:29,182 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42424.99999999972}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97541.99999999991}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25872.999999999593}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43993.99999999969}]
2025-10-08 10:31:29,182 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:31:29,265 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:29,265 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:31:29,266 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:31:29,267 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:31:29,269 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:31:31,649 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:31:31,651 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:31:31,651 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:31:31,653 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:31:31,655 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:31:31,655 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:31:31,668 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:31:31,681 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:31:31,682 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:31,683 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:31:31,694 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:31,704 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:31:31,733 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:31:31,749 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:31:32,302 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:31:32,306 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:31:32,308 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:31:32,333 - APP.services.mt5_service - DEBUG - Current price (cp): 4037.705
2025-10-08 10:31:32,342 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 347, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:31:32,396 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 226, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:31:32,400 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:31:32,411 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:31:32,414 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:31:32,415 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:32,416 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:31:32,417 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:31:32,423 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:31:32,424 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:32,427 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:31:32,429 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:31:32,432 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:31:32,433 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:32,460 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:31:32,461 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:31:32,463 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:31:32,463 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:32,464 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:31:32,491 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:31:32,495 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:31:32,496 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:31:32,523 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:31:32,523 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:31:32,524 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:31:32,524 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:31:32,525 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:31:32.525287+07:00
2025-10-08 10:31:32,526 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:31:32.525287+07:00
2025-10-08 10:31:32,526 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:31:32.525287+07:00 trong DST: True
2025-10-08 10:31:32,547 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:31:32,548 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:31:32,549 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:31:32,551 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:31:32,552 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:31:32,553 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:31:32,554 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:31:32,559 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:31:32,561 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:31:32,582 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:31:32,583 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:31:32,584 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:31:32,585 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:31:32,586 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:31:32,588 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:31:32,588 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:31:32,589 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:31:32,592 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:31:32,615 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:31:32,616 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:31:32,617 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:31:32,617 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:31:32,618 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:31:32,618 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:31:32,619 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:31:32,620 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:31:32,620 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:31:32,621 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:31:32,645 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:31:32,646 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:31:32,647 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:31:32,647 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:31:32,648 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:31:32,648 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:31:32,649 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:31:32,650 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4037.705, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:31:32,650 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:31:32,651 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:31:32,651 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:31:32,678 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:31:32,678 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 41706.999999999876
2025-10-08 10:31:32,679 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 96824.00000000007
2025-10-08 10:31:32,680 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 25154.999999999745
2025-10-08 10:31:32,680 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 43275.99999999984
2025-10-08 10:31:32,681 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:31:32,681 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41706.999999999876}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96824.00000000007}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25154.999999999745}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43275.99999999984}]
2025-10-08 10:31:32,682 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:31:32,683 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:31:32,684 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:31:32,704 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:31:32,705 - APP.services.mt5_service - DEBUG - Position in day range: 0.9490360585505173
2025-10-08 10:31:32,706 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:31:32,706 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:31:32.706827+07:00
2025-10-08 10:31:32,707 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:31:32.706827+07:00
2025-10-08 10:31:32,707 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:31:32.706827+07:00 trong DST: True
2025-10-08 10:31:32,708 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:31:32,708 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:31:32,709 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 209
2025-10-08 10:31:32,709 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:32,709 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:32,710 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '7000', 'price': 4037.7, 'distance_pips': 0.5}, {'level': '7025', 'price': 4037.703, 'distance_pips': 0.25}, {'level': '7050', 'price': 4037.705, 'distance_pips': 0.0}, {'level': '7075', 'price': 4037.708, 'distance_pips': 0.25}]
2025-10-08 10:31:32,710 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:31:32,711 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:32,711 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:32,712 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:31:32,712 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.705
2025-10-08 10:31:32,713 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:32,713 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:31:32,714 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:32,739 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:31:32,740 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:31:32,742 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4037.705
2025-10-08 10:31:32,742 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:32,743 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:31:32,744 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:32,744 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:31:32,745 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:31:32,747 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4037.705
2025-10-08 10:31:32,773 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:32,774 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:31:32,775 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:32,776 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:31:32,776 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:31:32,804 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.705
2025-10-08 10:31:32,807 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:32,808 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:31:32,811 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:32,836 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:31:32,838 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:32,839 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:32,841 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:31:32,842 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:31:32,843 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:31:32,867 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:31:32,867 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:31:32,868 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:31:32,869 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:31:32,869 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:31:32,870 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:31:32,870 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:31:32,871 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:31:32,874 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:31:32,900 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:31:32,901 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:31:32,902 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:31:32,902 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:31:32,902 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:32,903 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:32,903 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:31:32,904 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:31:32,905 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:31:32,926 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:31:32,930 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:31:32,932 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:31:32,935 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:32,945 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:31:32,955 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:31:32,957 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4037.705, 'ask': 4037.742, 'last': 0.0, 'time': 1759919492}
2025-10-08 10:31:32,959 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:31:32,960 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:31:32,960 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:31:32,961 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:31:32,962 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:32,962 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:32,962 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:32,963 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:32,963 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:32,964 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:31:32,976 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4037.705
2025-10-08 10:31:32,988 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41706.999999999876}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96824.00000000007}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25154.999999999745}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43275.99999999984}]
2025-10-08 10:31:32,989 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:31:33,056 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:33,057 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:31:33,057 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:31:33,063 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:31:33,066 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:31:36,654 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:31:36,657 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:31:36,657 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:31:36,658 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:31:36,660 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:31:36,661 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:31:36,667 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:31:36,691 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:36,693 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:31:36,694 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:31:36,695 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:31:36,695 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:31:36,696 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:31:36,788 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:37,197 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:31:37,198 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:31:37,199 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:31:37,199 - APP.services.mt5_service - DEBUG - Current price (cp): 4037.801
2025-10-08 10:31:37,204 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 350, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:31:37,231 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 227, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:31:37,241 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:31:37,241 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:31:37,245 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:31:37,245 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:37,271 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:31:37,272 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:31:37,276 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:31:37,301 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:37,302 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:31:37,302 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:31:37,305 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:31:37,307 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:37,308 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:31:37,341 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:31:37,345 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:31:37,345 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:37,346 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:31:37,347 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:31:37,349 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:31:37,350 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:31:37,376 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:31:37,378 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:31:37,379 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:31:37,379 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:31:37,380 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:31:37.380080+07:00
2025-10-08 10:31:37,380 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:31:37.380080+07:00
2025-10-08 10:31:37,380 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:31:37.380080+07:00 trong DST: True
2025-10-08 10:31:37,381 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:31:37,383 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:31:37,385 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:31:37,387 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:31:37,387 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:31:37,388 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:31:37,389 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:31:37,391 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:31:37,392 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:31:37,392 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:31:37,393 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:31:37,393 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:31:37,393 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:31:37,394 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:31:37,394 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:31:37,395 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:31:37,395 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:31:37,395 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:31:37,396 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:31:37,396 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:31:37,397 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:31:37,397 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:31:37,398 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:31:37,398 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:31:37,399 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:31:37,399 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:31:37,400 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:31:37,400 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:31:37,400 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:31:37,401 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:31:37,401 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:31:37,401 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:31:37,403 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:31:37,404 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:31:37,404 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:31:37,405 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4037.801, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:31:37,405 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:31:37,431 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:31:37,432 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:31:37,432 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:31:37,433 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 41802.99999999988
2025-10-08 10:31:37,435 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 96920.00000000007
2025-10-08 10:31:37,436 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 25250.99999999975
2025-10-08 10:31:37,437 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 43371.99999999984
2025-10-08 10:31:37,460 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:31:37,461 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41802.99999999988}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96920.00000000007}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25250.99999999975}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43371.99999999984}]
2025-10-08 10:31:37,462 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:31:37,462 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:31:37,463 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:31:37,463 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:31:37,464 - APP.services.mt5_service - DEBUG - Position in day range: 0.950749732238486
2025-10-08 10:31:37,464 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:31:37,466 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:31:37.465924+07:00
2025-10-08 10:31:37,467 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:31:37.465924+07:00
2025-10-08 10:31:37,487 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:31:37.465924+07:00 trong DST: True
2025-10-08 10:31:37,488 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:31:37,489 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:31:37,489 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 209
2025-10-08 10:31:37,490 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:37,490 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:37,491 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '8000', 'price': 4037.8, 'distance_pips': 0.1}, {'level': '8025', 'price': 4037.803, 'distance_pips': 0.15}, {'level': '8050', 'price': 4037.805, 'distance_pips': 0.4}, {'level': '8075', 'price': 4037.808, 'distance_pips': 0.65}]
2025-10-08 10:31:37,491 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:31:37,492 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:37,492 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:37,493 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:31:37,494 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.801
2025-10-08 10:31:37,494 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:37,494 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:31:37,495 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:37,498 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:31:37,544 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:31:37,547 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4037.801
2025-10-08 10:31:37,547 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:37,548 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:31:37,549 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:37,549 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:31:37,550 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:31:37,551 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4037.801
2025-10-08 10:31:37,551 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:37,552 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:31:37,553 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:37,554 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:31:37,555 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:31:37,555 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.801
2025-10-08 10:31:37,556 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:37,557 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:31:37,558 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:37,560 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:31:37,561 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:37,588 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:37,588 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:31:37,589 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:31:37,592 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:31:37,592 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:31:37,593 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:31:37,593 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:31:37,594 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:31:37,594 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:31:37,594 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:31:37,595 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:31:37,627 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:31:37,627 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:31:37,628 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:31:37,628 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:31:37,628 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:31:37,629 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:31:37,629 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:37,630 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:37,630 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:31:37,631 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:31:37,633 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:31:37,633 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:31:37,635 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:31:37,636 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:31:37,637 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:37,638 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:31:37,638 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4037.801, 'ask': 4037.838, 'last': 0.0, 'time': 1759919496}
2025-10-08 10:31:37,638 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:31:37,639 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:31:37,641 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:31:37,641 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:31:37,642 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:31:37,642 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:37,643 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:37,644 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:37,644 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:37,645 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:37,645 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:31:37,645 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4037.801
2025-10-08 10:31:37,645 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41802.99999999988}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96920.00000000007}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25250.99999999975}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43371.99999999984}]
2025-10-08 10:31:37,646 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:31:37,692 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:37,698 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:31:37,699 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:31:37,700 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:31:37,701 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:31:39,991 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:31:40,076 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:31:41,679 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:31:41,799 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:31:41,799 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:31:41,860 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:31:41,864 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:31:41,867 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:31:41,873 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:31:41,879 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:31:41,879 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:31:41,923 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:41,985 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:31:41,988 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:31:41,989 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:31:42,086 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:42,524 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:31:42,697 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:31:42,807 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:31:42,932 - APP.services.mt5_service - DEBUG - Current price (cp): 4038.198
2025-10-08 10:31:43,169 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 359, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:31:43,323 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 228, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:31:43,383 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:31:43,483 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:31:43,532 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:31:43,637 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:43,700 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:31:43,703 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:31:43,711 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:31:43,734 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:43,772 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:31:43,928 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:31:43,953 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:31:43,962 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:44,022 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:31:44,163 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:31:44,245 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:31:44,297 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:44,308 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:31:44,423 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:31:44,526 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:31:44,611 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:31:44,663 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:31:44,700 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:31:44,709 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:31:44,711 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:31:44,776 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:31:44.776146+07:00
2025-10-08 10:31:44,793 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:31:44.776146+07:00
2025-10-08 10:31:44,850 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:31:44.776146+07:00 trong DST: True
2025-10-08 10:31:44,858 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:31:44,861 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:31:44,863 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:31:44,866 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:31:44,867 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:31:44,943 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:31:44,952 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:31:45,016 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:31:45,026 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:31:45,078 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:31:45,119 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:31:45,169 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:31:45,171 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:31:45,233 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:31:45,268 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:31:45,419 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:31:45,425 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:31:45,426 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:31:45,427 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:31:45,510 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:31:45,538 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:31:45,621 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:31:45,649 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:31:45,650 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:31:45,652 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:31:45,775 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:31:45,836 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:31:45,855 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:31:46,022 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:31:46,080 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:31:46,097 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:31:46,191 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:31:46,205 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:31:46,213 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:31:46,263 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:31:46,287 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4038.198, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:31:46,300 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:31:46,420 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:31:46,426 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:31:46,431 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:31:46,433 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 42199.99999999982
2025-10-08 10:31:46,455 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 97317.0
2025-10-08 10:31:46,526 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 25647.999999999683
2025-10-08 10:31:46,573 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 43768.999999999774
2025-10-08 10:31:46,585 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:31:46,589 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42199.99999999982}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97317.0}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25647.999999999683}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43768.999999999774}]
2025-10-08 10:31:46,618 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:31:46,619 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:31:46,620 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:31:46,620 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:31:46,621 - APP.services.mt5_service - DEBUG - Position in day range: 0.9578364869689382
2025-10-08 10:31:46,645 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:31:46,650 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:31:46.650627+07:00
2025-10-08 10:31:46,651 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:31:46.650627+07:00
2025-10-08 10:31:46,651 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:31:46.650627+07:00 trong DST: True
2025-10-08 10:31:46,652 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:31:46,707 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:31:46,713 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 209
2025-10-08 10:31:46,739 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:46,743 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:46,797 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '1900', 'price': 4038.19, 'distance_pips': 0.8}, {'level': '1925', 'price': 4038.193, 'distance_pips': 0.55}, {'level': '1950', 'price': 4038.195, 'distance_pips': 0.3}, {'level': '1975', 'price': 4038.198, 'distance_pips': 0.05}]
2025-10-08 10:31:46,834 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:31:46,836 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:46,837 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:46,837 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:31:46,839 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.198
2025-10-08 10:31:46,897 - APP.ui.components.chart_tab - DEBUG - Worker thông tin vẫn đang chạy, bỏ qua.
2025-10-08 10:31:46,898 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:46,902 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:31:46,929 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:31:46,929 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:31:46,930 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:46,933 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:31:46,933 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:31:46,962 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:31:46,963 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:31:46,974 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4038.198
2025-10-08 10:31:46,979 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:31:46,982 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:46,983 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:46,984 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:31:46,987 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:47,005 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:47,019 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:31:47,208 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:31:47,270 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4038.198
2025-10-08 10:31:47,322 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:47,432 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:31:47,484 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:47,589 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:31:47,661 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:31:47,665 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.198
2025-10-08 10:31:47,729 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:47,923 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:31:48,191 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:48,272 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:31:48,452 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:48,669 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:48,945 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:31:49,042 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:31:49,074 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:31:49,079 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:31:49,089 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:31:49,095 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:31:49,098 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:31:49,099 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:31:49,102 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:31:49,134 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:31:49,182 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:31:49,274 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:31:49,336 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:31:49,386 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:31:49,390 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:31:49,392 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:31:49,400 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:49,401 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:49,402 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:31:49,402 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:31:49,403 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:31:49,445 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:31:49,538 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:31:49,553 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:31:49,555 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:49,556 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:31:49,557 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:31:49,559 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4038.198, 'ask': 4038.235, 'last': 0.0, 'time': 1759919501}
2025-10-08 10:31:49,573 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:31:49,634 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:31:49,638 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:31:49,639 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:31:49,641 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:49,643 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:49,644 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:49,645 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:49,646 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:49,647 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:31:49,647 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4038.198
2025-10-08 10:31:49,647 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42199.99999999982}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97317.0}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25647.999999999683}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43768.999999999774}]
2025-10-08 10:31:49,648 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:31:49,652 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:49,665 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:31:49,666 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:31:49,745 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:31:49,753 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:31:51,932 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:31:51,935 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:31:51,936 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:31:51,936 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:31:51,938 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:31:51,940 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:31:51,961 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:31:51,967 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:31:51,979 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:31:51,985 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:51,986 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:31:51,990 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:31:51,991 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:31:52,009 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:52,493 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:31:52,501 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:31:52,506 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:31:52,512 - APP.services.mt5_service - DEBUG - Current price (cp): 4038.323
2025-10-08 10:31:52,519 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 361, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:31:52,555 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 228, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:31:52,557 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:31:52,564 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:31:52,568 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:31:52,570 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:52,575 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:31:52,576 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:31:52,579 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:31:52,589 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:52,615 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:31:52,617 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:31:52,618 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:31:52,619 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:52,619 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:31:52,620 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:31:52,623 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:31:52,627 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:52,644 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:31:52,647 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:31:52,650 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:31:52,650 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:31:52,651 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:31:52,652 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:31:52,653 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:31:52,679 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:31:52,680 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:31:52.680022+07:00
2025-10-08 10:31:52,680 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:31:52.680022+07:00
2025-10-08 10:31:52,681 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:31:52.680022+07:00 trong DST: True
2025-10-08 10:31:52,681 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:31:52,681 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:31:52,682 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:31:52,683 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:31:52,684 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:31:52,710 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:31:52,711 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:31:52,714 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:31:52,739 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:31:52,740 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:31:52,740 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:31:52,741 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:31:52,741 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:31:52,742 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:31:52,743 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:31:52,743 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:31:52,744 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:31:52,744 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:31:52,746 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:31:52,773 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:31:52,775 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:31:52,776 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:31:52,776 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:31:52,777 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:31:52,777 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:31:52,808 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:31:52,822 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:31:52,822 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:31:52,824 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:31:52,824 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:31:52,825 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:31:52,825 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:31:52,827 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:31:52,828 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:31:52,828 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:31:52,829 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4038.323, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:31:52,829 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:31:52,830 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:31:52,830 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:31:52,831 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:31:52,831 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 42324.99999999982
2025-10-08 10:31:52,832 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 97442.0
2025-10-08 10:31:52,834 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 25772.999999999683
2025-10-08 10:31:52,834 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 43893.999999999774
2025-10-08 10:31:52,835 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:31:52,835 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42324.99999999982}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97442.0}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25772.999999999683}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43893.999999999774}]
2025-10-08 10:31:52,836 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:31:52,839 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:31:52,839 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:31:52,839 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:31:52,840 - APP.services.mt5_service - DEBUG - Position in day range: 0.960067832916814
2025-10-08 10:31:52,840 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:31:52,841 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:31:52.841128+07:00
2025-10-08 10:31:52,841 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:31:52.841128+07:00
2025-10-08 10:31:52,865 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:31:52.841128+07:00 trong DST: True
2025-10-08 10:31:52,868 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:31:52,869 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:31:52,869 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 209
2025-10-08 10:31:52,870 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:52,870 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:52,871 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '3200', 'price': 4038.32, 'distance_pips': 0.3}, {'level': '3225', 'price': 4038.323, 'distance_pips': 0.05}, {'level': '3250', 'price': 4038.325, 'distance_pips': 0.2}, {'level': '3275', 'price': 4038.328, 'distance_pips': 0.45}]
2025-10-08 10:31:52,897 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:31:52,897 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:52,898 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:52,899 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:31:52,900 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.323
2025-10-08 10:31:52,901 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:52,902 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:31:52,933 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:52,934 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:31:52,961 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:31:52,962 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4038.323
2025-10-08 10:31:52,962 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:52,963 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:31:52,964 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:52,965 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:31:52,965 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:31:52,982 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4038.323
2025-10-08 10:31:52,994 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:52,995 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:31:52,996 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:52,996 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:31:52,997 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:31:53,025 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.323
2025-10-08 10:31:53,025 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:53,026 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:31:53,027 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:53,028 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:31:53,056 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:53,056 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:53,057 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:31:53,057 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:31:53,058 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:31:53,059 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:31:53,089 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:31:53,090 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:31:53,116 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:31:53,117 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:31:53,118 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:31:53,118 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:31:53,120 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:31:53,121 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:31:53,121 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:31:53,151 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:31:53,151 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:31:53,152 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:31:53,181 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:53,181 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:53,182 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:31:53,182 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:31:53,183 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:31:53,183 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:31:53,184 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:31:53,214 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:31:53,226 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:53,243 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4038.323, 'ask': 4038.36, 'last': 0.0, 'time': 1759919512}
2025-10-08 10:31:53,244 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:31:53,244 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:31:53,245 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:53,245 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:53,246 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:53,246 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:53,247 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:53,247 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:31:53,249 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4038.323
2025-10-08 10:31:53,252 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42324.99999999982}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97442.0}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25772.999999999683}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43893.999999999774}]
2025-10-08 10:31:53,268 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:31:53,268 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:31:53,269 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:31:53,271 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:31:53,272 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:31:53,292 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:53,301 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:31:53,303 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:31:53,305 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:31:53,312 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:31:55,088 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:31:55,149 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:31:56,938 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:31:56,942 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:31:56,942 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:31:56,943 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:31:56,945 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:31:56,950 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:31:56,954 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:31:56,974 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:31:56,978 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:31:56,982 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:31:56,982 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:56,983 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:31:56,985 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:31:57,026 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:57,486 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:31:57,489 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:31:57,490 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:31:57,492 - APP.services.mt5_service - DEBUG - Current price (cp): 4038.221
2025-10-08 10:31:57,506 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 365, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:31:57,555 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 229, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:31:57,611 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:31:57,669 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:31:57,672 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:31:57,675 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:57,678 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:31:57,684 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:31:57,741 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:31:57,743 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:57,771 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:31:57,774 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:31:57,778 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:31:57,868 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:57,914 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:31:57,923 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:31:57,927 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:31:57,961 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:31:57,965 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:31:57,966 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:31:57,997 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:31:58,021 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:31:58,023 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:31:58,023 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:31:58,024 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:31:58,024 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:31:58,025 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:31:58.025218+07:00
2025-10-08 10:31:58,025 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:31:58.025218+07:00
2025-10-08 10:31:58,026 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:31:58.025218+07:00 trong DST: True
2025-10-08 10:31:58,026 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:31:58,027 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:31:58,027 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:31:58,029 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:31:58,057 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:31:58,121 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:31:58,133 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:31:58,137 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:31:58,138 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:31:58,138 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:31:58,139 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:31:58,141 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:31:58,141 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:31:58,142 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:31:58,142 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:31:58,143 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:31:58,143 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:31:58,144 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:31:58,144 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:31:58,145 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:31:58,146 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:31:58,146 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:31:58,147 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:31:58,147 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:31:58,148 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:31:58,148 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:31:58,149 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:31:58,150 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:31:58,150 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:31:58,151 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:31:58,152 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:31:58,153 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:31:58,154 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:31:58,183 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:31:58,183 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:31:58,184 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4038.221, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:31:58,211 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:31:58,212 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:31:58,212 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:31:58,213 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:31:58,213 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 42222.999999999956
2025-10-08 10:31:58,214 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 97340.00000000015
2025-10-08 10:31:58,214 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 25670.99999999982
2025-10-08 10:31:58,214 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 43791.99999999991
2025-10-08 10:31:58,215 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:31:58,215 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42222.999999999956}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97340.00000000015}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25670.99999999982}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43791.99999999991}]
2025-10-08 10:31:58,245 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:31:58,272 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:31:58,273 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:31:58,273 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:31:58,274 - APP.services.mt5_service - DEBUG - Position in day range: 0.9582470546233498
2025-10-08 10:31:58,276 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:31:58,276 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:31:58.276577+07:00
2025-10-08 10:31:58,277 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:31:58.276577+07:00
2025-10-08 10:31:58,277 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:31:58.276577+07:00 trong DST: True
2025-10-08 10:31:58,277 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:31:58,278 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:31:58,279 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 209
2025-10-08 10:31:58,303 - APP.ui.app_ui - INFO - Autorun tick: Kích hoạt worker kiểm tra.
2025-10-08 10:31:58,304 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:58,305 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_autorun_tick_worker' vào thread pool.
2025-10-08 10:31:58,306 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:58,306 - APP.ui.app_ui - DEBUG - Autorun tick worker: Bắt đầu kiểm tra điều kiện.
2025-10-08 10:31:58,306 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '2200', 'price': 4038.22, 'distance_pips': 0.1}, {'level': '2225', 'price': 4038.223, 'distance_pips': 0.15}, {'level': '2250', 'price': 4038.225, 'distance_pips': 0.4}, {'level': '2275', 'price': 4038.228, 'distance_pips': 0.65}]
2025-10-08 10:31:58,308 - APP.ui.app_ui - INFO - Autorun tick worker: Điều kiện hợp lệ, yêu cầu bắt đầu phân tích trên luồng UI.
2025-10-08 10:31:58,308 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:31:58,309 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:58,337 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:58,337 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:31:58,339 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.221
2025-10-08 10:31:58,340 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:58,364 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: start_analysis
2025-10-08 10:31:58,366 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:31:58,367 - APP.ui.app_ui - INFO - Yêu cầu bắt đầu phân tích từ UI.
2025-10-08 10:31:58,369 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:58,370 - APP.ui.utils.ui_builder - DEBUG - Đã thay đổi trạng thái nút Start/Stop thành 'disabled'. Các điều khiển khác không bị ảnh hưởng.
2025-10-08 10:31:58,371 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:31:58,372 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:31:58,372 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:31:58,431 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:31:58,432 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4038.221
2025-10-08 10:31:58,433 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:31:58,434 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:58,461 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:31:58,462 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:31:58,463 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:31:58,463 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:58,464 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:31:58,464 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:31:58,465 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:31:58,465 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:31:58,494 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:31:58,495 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4038.221
2025-10-08 10:31:58,496 - APP.services.te_service - INFO - Đăng nhập thành công vào Trading Economics API.
2025-10-08 10:31:58,496 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:58,497 - APP.services.news_service - DEBUG - Cấu hình NewsService đã được cập nhật.
2025-10-08 10:31:58,498 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:31:58,529 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:58,530 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:31:58,531 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-08 10:31:58,531 - APP.ui.app_ui - INFO - Đã khởi tạo và bắt đầu luồng AnalysisWorker.
2025-10-08 10:31:58,532 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:31:58,534 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-08 10:31:58,536 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.221
2025-10-08 10:31:58,537 - APP.services.gemini_service - INFO - Đã khởi tạo model 'models/gemini-2.5-flash' thành công.
2025-10-08 10:31:58,537 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:31:58,538 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:31:58,540 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:31:58,568 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 2: Xây dựng ngữ cảnh và kiểm tra điều kiện.
2025-10-08 10:31:58,574 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:31:58,576 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-RUN.
2025-10-08 10:31:58,577 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 3: Chuẩn bị và upload ảnh (song song).
2025-10-08 10:31:58,577 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:58,579 - APP.analysis.image_processor - DEBUG - Đang thử tải cache upload.
2025-10-08 10:31:58,580 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:58,582 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:31:58,583 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:31:58,584 - APP.services.mt5_service - DEBUG - Bắt đầu get_active_killzone cho 2025-10-08 10:31:58.577965 với timezone Asia/Ho_Chi_Minh
2025-10-08 10:31:58,584 - APP.analysis.image_processor - DEBUG - Đã tải cache upload với 4 mục.
2025-10-08 10:31:58,584 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:31:58,585 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-08 10:31:58.577965+07:00, Target TZ: None
2025-10-08 10:31:58,586 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:31:58,586 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 10:31:58.577965+07:00
2025-10-08 10:31:58,588 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_H1.png: 15022:1759914264:adcc044a34c2739b
2025-10-08 10:31:58,588 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:31:58,589 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 10:31:58.577965+07:00 trong DST: True
2025-10-08 10:31:58,589 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_H1.png. Tên từ xa: files/jcq192qkqfx5
2025-10-08 10:31:58,590 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:31:58,591 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:31:58,592 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M1.png: 21123:1759914329:c9ca25adc2713e89
2025-10-08 10:31:58,594 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:31:58,616 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:31:58,618 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_H1.png, đang lấy thông tin file...
2025-10-08 10:31:58,618 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M15.png: 14475:1759914258:f522dd906714fb0b
2025-10-08 10:31:58,618 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M1.png. Tên từ xa: files/zl0mc2r9tv6i
2025-10-08 10:31:58,620 - APP.services.mt5_service - DEBUG - Không trong killzone nào.
2025-10-08 10:31:58,620 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M5.png: 22339:1759914253:ac9da090a54f8eec
2025-10-08 10:31:58,620 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:31:58,647 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:58,648 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M15.png. Tên từ xa: files/4s2o4xrat6a8
2025-10-08 10:31:58,648 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M1.png, đang lấy thông tin file...
2025-10-08 10:31:58,648 - APP.core.trading.conditions - INFO - Điều kiện NO-RUN được kích hoạt: Không chạy ngoài các Kill Zone đã định nghĩa.
2025-10-08 10:31:58,649 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M5.png. Tên từ xa: files/kis0no3da2v8
2025-10-08 10:31:58,649 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:31:58,650 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M15.png, đang lấy thông tin file...
2025-10-08 10:31:58,651 - APP.core.trading.conditions - INFO - Thoát sớm. Giai đoạn: no-run, Lý do: Không chạy ngoài các Kill Zone đã định nghĩa.
2025-10-08 10:31:58,652 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M5.png, đang lấy thông tin file...
2025-10-08 10:31:58,652 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:31:58,654 - APP.persistence.log_handler - DEBUG - Đang chuẩn bị ghi log giao dịch. Giai đoạn: no-run, Thư mục con: None
2025-10-08 10:31:58,656 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:31:58,680 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:31:58,682 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:31:58,683 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:31:58,683 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:31:58,684 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:31:58,684 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:58,684 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:58,687 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:31:58,708 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:31:58,711 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:31:58,711 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:31:58,713 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:31:58,788 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:58,795 - APP.persistence.log_handler - DEBUG - Đã ghi log giao dịch thành công vào trade_log_20251008.jsonl.
2025-10-08 10:31:58,799 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:31:58,801 - APP.persistence.log_handler - DEBUG - Kết thúc hàm log_trade.
2025-10-08 10:31:58,802 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:58,804 - APP.core.analysis_worker - INFO - Giai đoạn 2 thoát sớm: Điều kiện No-Run: Không chạy ngoài các Kill Zone đã định nghĩa.
2025-10-08 10:31:58,804 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:31:58,804 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:31:58,807 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4038.221, 'ask': 4038.258, 'last': 0.0, 'time': 1759919517}
2025-10-08 10:31:58,808 - APP.utils.threading_utils - DEBUG - Tác vụ song song '_execute_stage_2_logic' đã hoàn thành.
2025-10-08 10:31:58,848 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:31:58,850 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:31:58,852 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:31:58,856 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:31:58,858 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:58,859 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:58,859 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:58,860 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:31:58,860 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:31:58,861 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:31:58,861 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4038.221
2025-10-08 10:31:58,861 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42222.999999999956}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97340.00000000015}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25670.99999999982}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43791.99999999991}]
2025-10-08 10:31:58,863 - APP.analysis.image_processor - DEBUG - Đang lưu cache upload với 4 mục.
2025-10-08 10:31:58,863 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:31:58,866 - APP.analysis.image_processor - DEBUG - Đã lưu cache upload thành công.
2025-10-08 10:31:58,867 - APP.utils.threading_utils - DEBUG - Tác vụ song song '_execute_stage_3_logic' đã hoàn thành.
2025-10-08 10:31:58,867 - APP.core.analysis_worker - WARNING - Một trong các giai đoạn song song đã thất bại. Dừng worker.
2025-10-08 10:31:58,868 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Thoát sớm do lỗi ở Giai đoạn 2 hoặc 3.
2025-10-08 10:31:58,868 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-08 10:31:58,869 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-08 10:31:58,906 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:59,028 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:59,129 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:59,130 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:59,131 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:59,132 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:59,233 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:59,234 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:59,335 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:59,336 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:59,441 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:59,444 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:59,545 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:59,546 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:31:59,546 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:31:59,547 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:31:59,548 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:31:59,550 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:59,551 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:31:59,551 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: _finalize_done
2025-10-08 10:31:59,552 - APP.ui.utils.ui_builder - DEBUG - Đã thay đổi trạng thái nút Start/Stop thành 'normal'. Các điều khiển khác không bị ảnh hưởng.
2025-10-08 10:31:59,553 - APP.ui.app_ui - DEBUG - Lên lịch chạy tự động tiếp theo sau 60000ms.
2025-10-08 10:32:01,944 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:32:01,946 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:32:01,947 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:32:01,947 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:32:01,949 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:32:01,950 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:32:01,953 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:32:01,953 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:01,977 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:32:02,710 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:32:02,710 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:32:02,711 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:32:02,711 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:32:02,712 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:32:03,213 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:32:03,215 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:32:03,215 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:32:03,216 - APP.services.mt5_service - DEBUG - Current price (cp): 4038.01
2025-10-08 10:32:03,224 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 367, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:32:03,259 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 229, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:32:03,260 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:32:03,261 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:32:03,263 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:32:03,263 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:03,263 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:32:03,264 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:32:03,267 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:32:03,268 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:03,268 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:32:03,269 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:32:03,270 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:32:03,270 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:03,271 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:32:03,271 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:32:03,274 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:32:03,274 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:03,275 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:32:03,275 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:32:03,278 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:32:03,278 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:32:03,279 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:32:03,305 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:32:03,306 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:32:03,306 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:32:03,307 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:32:03.307029+07:00
2025-10-08 10:32:03,307 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:32:03.307029+07:00
2025-10-08 10:32:03,308 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:32:03.307029+07:00 trong DST: True
2025-10-08 10:32:03,308 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:32:03,308 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:32:03,309 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:32:03,310 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:32:03,336 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:32:03,337 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:32:03,338 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:32:03,340 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:32:03,341 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:32:03,367 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:32:03,367 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:32:03,368 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:32:03,368 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:32:03,368 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:32:03,369 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:32:03,369 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:32:03,370 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:32:03,370 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:32:03,371 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:32:03,371 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:32:03,372 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:32:03,372 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:32:03,373 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:32:03,401 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:32:03,401 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:32:03,401 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:32:03,402 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:32:03,403 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:32:03,403 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:32:03,403 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:32:03,404 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:32:03,404 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:32:03,429 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:32:03,430 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:32:03,430 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:32:03,430 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4038.01, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:32:03,431 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:32:03,431 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:32:03,431 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:32:03,432 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:32:03,432 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 42012.00000000017
2025-10-08 10:32:03,432 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 97129.00000000036
2025-10-08 10:32:03,433 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 25460.000000000036
2025-10-08 10:32:03,434 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 43581.00000000013
2025-10-08 10:32:03,434 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:32:03,435 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42012.00000000017}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97129.00000000036}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25460.000000000036}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43581.00000000013}]
2025-10-08 10:32:03,457 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:32:03,458 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:32:03,459 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:32:03,459 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:32:03,459 - APP.services.mt5_service - DEBUG - Position in day range: 0.9544805426633394
2025-10-08 10:32:03,460 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:32:03,460 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:32:03.460668+07:00
2025-10-08 10:32:03,461 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:32:03.460668+07:00
2025-10-08 10:32:03,461 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:32:03.460668+07:00 trong DST: True
2025-10-08 10:32:03,461 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:32:03,462 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:32:03,462 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 208
2025-10-08 10:32:03,463 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:03,463 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:03,464 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '100', 'price': 4038.01, 'distance_pips': 0.0}, {'level': '125', 'price': 4038.013, 'distance_pips': 0.25}, {'level': '150', 'price': 4038.015, 'distance_pips': 0.5}, {'level': '175', 'price': 4038.018, 'distance_pips': 0.75}]
2025-10-08 10:32:03,464 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:32:03,465 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:03,465 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:03,465 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:32:03,466 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.01
2025-10-08 10:32:03,466 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:03,491 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:32:03,492 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:03,493 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:32:03,493 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:32:03,494 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4038.01
2025-10-08 10:32:03,494 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:03,495 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:32:03,496 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:03,496 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:32:03,497 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:32:03,498 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4038.01
2025-10-08 10:32:03,558 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:03,559 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:32:03,588 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:03,590 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:32:03,590 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:32:03,591 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.01
2025-10-08 10:32:03,619 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:03,620 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:32:03,621 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:03,622 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:32:03,622 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:03,623 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:03,649 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:32:03,650 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:32:03,650 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:32:03,651 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:32:03,651 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:32:03,651 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:32:03,652 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:32:03,652 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:32:03,653 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:32:03,653 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:32:03,653 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:32:03,654 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:32:03,684 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:32:03,685 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:32:03,715 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:32:03,744 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:32:03,744 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:03,745 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:03,746 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:32:03,746 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:32:03,747 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:32:03,778 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:32:03,804 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:32:03,806 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:32:03,807 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:03,808 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:32:03,808 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:32:03,808 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4038.01, 'ask': 4038.047, 'last': 0.0, 'time': 1759919522}
2025-10-08 10:32:03,817 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:32:03,820 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:32:03,821 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:32:03,822 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:32:03,823 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:03,823 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:03,824 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:03,825 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:03,827 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:03,828 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:32:03,828 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4038.01
2025-10-08 10:32:03,829 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42012.00000000017}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97129.00000000036}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25460.000000000036}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43581.00000000013}]
2025-10-08 10:32:03,830 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:32:03,905 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:32:03,911 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:32:03,912 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:32:03,913 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:32:03,915 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:32:06,948 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:32:06,950 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:32:06,950 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:32:06,951 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:32:06,952 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:32:06,953 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:32:06,956 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:32:06,956 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:06,981 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:32:06,983 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:32:06,983 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:32:06,984 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:32:06,984 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:32:07,028 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:32:07,485 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:32:07,487 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:32:07,488 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:32:07,488 - APP.services.mt5_service - DEBUG - Current price (cp): 4038.17
2025-10-08 10:32:07,493 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 372, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:32:07,528 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 230, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:32:07,529 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:32:07,530 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:32:07,533 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:32:07,534 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:07,534 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:32:07,552 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:32:07,556 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:32:07,556 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:07,556 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:32:07,557 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:32:07,559 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:32:07,559 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:07,559 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:32:07,560 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:32:07,563 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:32:07,585 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:07,587 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:32:07,587 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:32:07,590 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:32:07,591 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:32:07,592 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:32:07,595 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:32:07,615 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:32:07,616 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:32:07,617 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:32:07.617452+07:00
2025-10-08 10:32:07,618 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:32:07.617452+07:00
2025-10-08 10:32:07,618 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:32:07.617452+07:00 trong DST: True
2025-10-08 10:32:07,618 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:32:07,619 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:32:07,619 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:32:07,620 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:32:07,621 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:32:07,622 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:32:07,622 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:32:07,650 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:32:07,650 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:32:07,651 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:32:07,652 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:32:07,653 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:32:07,653 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:32:07,654 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:32:07,680 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:32:07,681 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:32:07,681 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:32:07,682 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:32:07,682 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:32:07,683 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:32:07,683 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:32:07,684 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:32:07,684 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:32:07,685 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:32:07,685 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:32:07,713 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:32:07,714 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:32:07,715 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:32:07,715 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:32:07,716 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:32:07,720 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:32:07,748 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:32:07,749 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:32:07,749 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:32:07,750 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:32:07,750 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4038.17, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:32:07,751 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:32:07,751 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:32:07,755 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:32:07,757 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:32:07,758 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 42172.00000000002
2025-10-08 10:32:07,759 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 97289.00000000022
2025-10-08 10:32:07,761 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 25619.99999999989
2025-10-08 10:32:07,787 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 43740.999999999985
2025-10-08 10:32:07,787 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:32:07,788 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42172.00000000002}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97289.00000000022}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25619.99999999989}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43740.999999999985}]
2025-10-08 10:32:07,788 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:32:07,789 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:32:07,790 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:32:07,790 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:32:07,791 - APP.services.mt5_service - DEBUG - Position in day range: 0.9573366654766178
2025-10-08 10:32:07,791 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:32:07,793 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:32:07.793062+07:00
2025-10-08 10:32:07,793 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:32:07.793062+07:00
2025-10-08 10:32:07,794 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:32:07.793062+07:00 trong DST: True
2025-10-08 10:32:07,794 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:32:07,794 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:32:07,795 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 208
2025-10-08 10:32:07,795 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:07,796 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:07,796 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '1700', 'price': 4038.17, 'distance_pips': 0.0}, {'level': '1725', 'price': 4038.173, 'distance_pips': 0.25}, {'level': '1750', 'price': 4038.175, 'distance_pips': 0.5}, {'level': '1775', 'price': 4038.178, 'distance_pips': 0.75}]
2025-10-08 10:32:07,796 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:32:07,797 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:07,797 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:07,797 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:32:07,798 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.17
2025-10-08 10:32:07,799 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:07,799 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:32:07,800 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:07,800 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:32:07,801 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:32:07,801 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4038.17
2025-10-08 10:32:07,802 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:07,802 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:32:07,803 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:07,804 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:32:07,804 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:32:07,805 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4038.17
2025-10-08 10:32:07,805 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:07,805 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:32:07,806 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:07,807 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:32:07,807 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:32:07,808 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.17
2025-10-08 10:32:07,808 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:07,809 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:32:07,810 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:07,810 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:32:07,811 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:07,841 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:07,844 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:32:07,870 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:32:07,871 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:32:07,871 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:32:07,871 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:32:07,872 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:32:07,872 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:32:07,873 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:32:07,874 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:32:07,964 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:32:07,964 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:32:07,966 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:32:07,966 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:32:07,972 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:32:07,973 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:32:07,974 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:32:07,974 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:07,975 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:07,976 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:32:07,976 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:32:07,977 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:32:07,977 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:32:07,979 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:32:07,980 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:32:07,981 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:07,982 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:32:07,982 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4038.17, 'ask': 4038.207, 'last': 0.0, 'time': 1759919527}
2025-10-08 10:32:07,982 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:32:07,983 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:32:07,986 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:32:07,987 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:32:07,987 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:32:07,988 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:07,989 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:07,989 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:07,989 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:07,990 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:07,990 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:32:07,991 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4038.17
2025-10-08 10:32:07,991 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42172.00000000002}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97289.00000000022}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25619.99999999989}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43740.999999999985}]
2025-10-08 10:32:07,991 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:32:08,065 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:32:08,067 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:32:08,067 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:32:08,069 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:32:08,070 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:32:10,149 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:32:10,207 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:32:11,952 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:32:11,954 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:32:11,954 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:32:11,955 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:32:11,957 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:32:11,957 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:32:11,962 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:32:11,987 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:11,989 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:32:11,990 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:32:11,991 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:32:11,993 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:32:11,993 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:32:12,014 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:32:12,495 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:32:12,496 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:32:12,497 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:32:12,497 - APP.services.mt5_service - DEBUG - Current price (cp): 4038.126
2025-10-08 10:32:12,507 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 368, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:32:12,560 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 230, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:32:12,561 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:32:12,562 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:32:12,567 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:32:12,582 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:12,582 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:32:12,583 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:32:12,586 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:32:12,586 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:12,587 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:32:12,587 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:32:12,589 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:32:12,590 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:12,590 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:32:12,591 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:32:12,594 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:32:12,615 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:12,616 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:32:12,617 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:32:12,621 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:32:12,621 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:32:12,622 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:32:12,622 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:32:12,623 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:32:12,623 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:32:12,623 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:32:12.623817+07:00
2025-10-08 10:32:12,624 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:32:12.623817+07:00
2025-10-08 10:32:12,626 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:32:12.623817+07:00 trong DST: True
2025-10-08 10:32:12,648 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:32:12,649 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:32:12,649 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:32:12,651 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:32:12,652 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:32:12,654 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:32:12,654 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:32:12,676 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:32:12,679 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:32:12,679 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:32:12,680 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:32:12,680 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:32:12,681 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:32:12,682 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:32:12,682 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:32:12,683 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:32:12,683 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:32:12,684 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:32:12,685 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:32:12,685 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:32:12,685 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:32:12,688 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:32:12,712 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:32:12,713 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:32:12,714 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:32:12,714 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:32:12,715 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:32:12,715 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:32:12,716 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:32:12,716 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:32:12,719 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:32:12,719 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:32:12,720 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:32:12,721 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:32:12,721 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:32:12,722 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4038.126, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:32:12,725 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:32:12,774 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:32:12,775 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:32:12,775 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:32:12,776 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 42128.00000000015
2025-10-08 10:32:12,776 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 97245.00000000035
2025-10-08 10:32:12,776 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 25576.000000000022
2025-10-08 10:32:12,777 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 43697.00000000012
2025-10-08 10:32:12,777 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:32:12,778 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42128.00000000015}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97245.00000000035}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25576.000000000022}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43697.00000000012}]
2025-10-08 10:32:12,778 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:32:12,779 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:32:12,779 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:32:12,791 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:32:12,793 - APP.services.mt5_service - DEBUG - Position in day range: 0.9565512317029679
2025-10-08 10:32:12,795 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:32:12,798 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:32:12.798384+07:00
2025-10-08 10:32:12,800 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:32:12.798384+07:00
2025-10-08 10:32:12,802 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:32:12.798384+07:00 trong DST: True
2025-10-08 10:32:12,804 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:32:12,805 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:32:12,806 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 208
2025-10-08 10:32:12,806 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:12,806 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:12,807 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '1200', 'price': 4038.12, 'distance_pips': 0.6}, {'level': '1225', 'price': 4038.122, 'distance_pips': 0.35}, {'level': '1250', 'price': 4038.125, 'distance_pips': 0.1}, {'level': '1275', 'price': 4038.128, 'distance_pips': 0.15}]
2025-10-08 10:32:12,807 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:32:12,808 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:12,808 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:12,808 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:32:12,809 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.126
2025-10-08 10:32:12,810 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:12,810 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:32:12,829 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:12,833 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:32:12,836 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:32:12,836 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4038.126
2025-10-08 10:32:12,837 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:12,838 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:32:12,838 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:12,839 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:32:12,839 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:32:12,840 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4038.126
2025-10-08 10:32:12,840 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:12,841 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:32:12,842 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:12,842 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:32:12,855 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:32:12,857 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.126
2025-10-08 10:32:12,861 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:12,867 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:32:12,869 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:12,870 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:32:12,870 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:12,871 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:12,871 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:32:12,871 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:32:12,872 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:32:12,872 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:32:12,873 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:32:12,873 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:32:12,874 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:32:12,874 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:32:12,906 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:32:12,909 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:32:12,911 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:32:12,912 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:32:12,912 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:32:12,913 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:32:12,913 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:32:12,914 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:32:12,914 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:12,915 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:12,915 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:32:12,916 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:32:12,916 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:32:12,917 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:32:12,917 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:32:12,918 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:32:12,919 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:12,920 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:32:12,921 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4038.126, 'ask': 4038.163, 'last': 0.0, 'time': 1759919532}
2025-10-08 10:32:12,921 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:32:12,922 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:32:12,924 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:32:12,924 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:32:12,924 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:32:12,925 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:12,925 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:12,925 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:12,926 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:12,926 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:12,927 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:32:12,927 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4038.126
2025-10-08 10:32:12,927 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42128.00000000015}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97245.00000000035}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25576.000000000022}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43697.00000000012}]
2025-10-08 10:32:12,928 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:32:13,013 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:32:13,014 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:32:13,014 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:32:13,015 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:32:13,017 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:32:16,956 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:32:16,958 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:32:16,958 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:32:16,959 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:32:16,961 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:32:16,961 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:32:16,964 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:32:16,983 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:16,987 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:32:16,988 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:32:16,989 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:32:16,989 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:32:16,990 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:32:17,032 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:32:17,491 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:32:17,492 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:32:17,493 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:32:17,494 - APP.services.mt5_service - DEBUG - Current price (cp): 4038.302
2025-10-08 10:32:17,499 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 362, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:32:17,534 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 230, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:32:17,535 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:32:17,536 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:32:17,537 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:32:17,538 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:17,538 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:32:17,539 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:32:17,542 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:32:17,542 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:17,543 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:32:17,543 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:32:17,545 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:32:17,545 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:17,546 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:32:17,546 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:32:17,549 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:32:17,549 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:17,549 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:32:17,550 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:32:17,602 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:32:17,603 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:32:17,604 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:32:17,604 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:32:17,605 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:32:17,606 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:32:17,606 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:32:17.606740+07:00
2025-10-08 10:32:17,607 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:32:17.606740+07:00
2025-10-08 10:32:17,607 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:32:17.606740+07:00 trong DST: True
2025-10-08 10:32:17,608 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:32:17,608 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:32:17,609 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:32:17,610 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:32:17,611 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:32:17,613 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:32:17,614 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:32:17,617 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:32:17,618 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:32:17,618 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:32:17,618 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:32:17,619 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:32:17,619 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:32:17,619 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:32:17,620 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:32:17,620 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:32:17,621 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:32:17,621 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:32:17,621 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:32:17,621 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:32:17,622 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:32:17,622 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:32:17,622 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:32:17,623 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:32:17,623 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:32:17,626 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:32:17,627 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:32:17,628 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:32:17,628 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:32:17,641 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:32:17,648 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:32:17,649 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:32:17,649 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:32:17,650 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:32:17,650 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:32:17,651 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4038.302, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:32:17,651 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:32:17,651 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:32:17,652 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:32:17,652 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:32:17,652 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 42304.00000000009
2025-10-08 10:32:17,653 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 97421.00000000028
2025-10-08 10:32:17,653 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 25751.999999999953
2025-10-08 10:32:17,653 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 43873.000000000044
2025-10-08 10:32:17,654 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:32:17,654 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42304.00000000009}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97421.00000000028}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25751.999999999953}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43873.000000000044}]
2025-10-08 10:32:17,656 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:32:17,658 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:32:17,658 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:32:17,658 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:32:17,659 - APP.services.mt5_service - DEBUG - Position in day range: 0.9596929667975757
2025-10-08 10:32:17,659 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:32:17,659 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:32:17.659894+07:00
2025-10-08 10:32:17,660 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:32:17.659894+07:00
2025-10-08 10:32:17,660 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:32:17.659894+07:00 trong DST: True
2025-10-08 10:32:17,660 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:32:17,661 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:32:17,661 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 208
2025-10-08 10:32:17,662 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:17,662 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:17,663 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '3000', 'price': 4038.3, 'distance_pips': 0.2}, {'level': '3025', 'price': 4038.303, 'distance_pips': 0.05}, {'level': '3050', 'price': 4038.305, 'distance_pips': 0.3}, {'level': '3075', 'price': 4038.308, 'distance_pips': 0.55}]
2025-10-08 10:32:17,663 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:32:17,669 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:17,694 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:17,706 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:32:17,747 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.302
2025-10-08 10:32:17,803 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:17,840 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:32:17,879 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:17,923 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:32:17,924 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:32:17,925 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4038.302
2025-10-08 10:32:17,926 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:17,926 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:32:17,927 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:17,927 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:32:17,928 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:32:17,929 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4038.302
2025-10-08 10:32:17,929 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:17,930 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:32:17,931 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:17,931 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:32:17,932 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:32:17,933 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.302
2025-10-08 10:32:17,934 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:17,934 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:32:17,935 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:17,935 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:32:17,937 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:17,938 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:17,939 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:32:17,939 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:32:17,940 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:32:17,941 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:32:17,941 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:32:17,942 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:32:17,943 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:32:17,943 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:32:17,944 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:32:17,944 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:32:17,945 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:32:17,945 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:32:17,946 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:32:17,946 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:32:17,946 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:32:17,947 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:32:17,947 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:17,948 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:17,948 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:32:17,949 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:32:18,055 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:32:18,057 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:32:18,059 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:32:18,073 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:32:18,074 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:18,075 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:32:18,075 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:32:18,079 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4038.302, 'ask': 4038.339, 'last': 0.0, 'time': 1759919536}
2025-10-08 10:32:18,082 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:32:18,083 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:32:18,084 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:32:18,084 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:32:18,085 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:18,085 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:18,086 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:18,086 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:18,086 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:18,087 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:32:18,087 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4038.302
2025-10-08 10:32:18,088 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42304.00000000009}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97421.00000000028}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25751.999999999953}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43873.000000000044}]
2025-10-08 10:32:18,088 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:32:18,136 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:32:18,146 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:32:18,147 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:32:18,148 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:32:18,150 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:32:21,960 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:32:21,962 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:32:21,962 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:32:21,963 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:32:21,965 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:32:21,966 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:32:21,970 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:32:21,989 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:21,990 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:32:21,991 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:32:21,992 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:32:21,992 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:32:21,992 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:32:22,058 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:32:22,494 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:32:22,495 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:32:22,496 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:32:22,496 - APP.services.mt5_service - DEBUG - Current price (cp): 4038.362
2025-10-08 10:32:22,502 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 348, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:32:22,535 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 230, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:32:22,536 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:32:22,536 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:32:22,539 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:32:22,539 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:22,539 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:32:22,540 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:32:22,543 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:32:22,543 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:22,544 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:32:22,544 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:32:22,546 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:32:22,546 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:22,546 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:32:22,547 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:32:22,549 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:32:22,549 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:22,550 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:32:22,550 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:32:22,552 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:32:22,553 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:32:22,553 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:32:22,553 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:32:22,554 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:32:22,554 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:32:22,555 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:32:22.555031+07:00
2025-10-08 10:32:22,555 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:32:22.555031+07:00
2025-10-08 10:32:22,555 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:32:22.555031+07:00 trong DST: True
2025-10-08 10:32:22,556 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:32:22,556 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:32:22,557 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:32:22,558 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:32:22,558 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:32:22,559 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:32:22,560 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:32:22,564 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:32:22,564 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:32:22,567 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:32:22,584 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:32:22,584 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:32:22,585 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:32:22,586 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:32:22,586 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:32:22,586 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:32:22,587 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:32:22,587 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:32:22,587 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:32:22,588 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:32:22,588 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:32:22,588 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:32:22,589 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:32:22,589 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:32:22,590 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:32:22,590 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:32:22,591 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:32:22,591 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:32:22,592 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:32:22,592 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:32:22,593 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:32:22,593 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:32:22,596 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:32:22,596 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:32:22,596 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:32:22,615 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4038.362, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:32:22,616 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:32:22,616 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:32:22,617 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:32:22,617 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:32:22,617 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 42364.00000000003
2025-10-08 10:32:22,618 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 97481.00000000022
2025-10-08 10:32:22,618 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 25811.999999999898
2025-10-08 10:32:22,618 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 43932.99999999999
2025-10-08 10:32:22,619 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:32:22,619 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42364.00000000003}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97481.00000000022}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25811.999999999898}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43932.99999999999}]
2025-10-08 10:32:22,619 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:32:22,620 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:32:22,621 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:32:22,621 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:32:22,621 - APP.services.mt5_service - DEBUG - Position in day range: 0.9607640128525551
2025-10-08 10:32:22,622 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:32:22,622 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:32:22.622760+07:00
2025-10-08 10:32:22,623 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:32:22.622760+07:00
2025-10-08 10:32:22,623 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:32:22.622760+07:00 trong DST: True
2025-10-08 10:32:22,624 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:32:22,624 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:32:22,649 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 208
2025-10-08 10:32:22,650 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:22,650 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:22,651 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '3600', 'price': 4038.36, 'distance_pips': 0.2}, {'level': '3625', 'price': 4038.363, 'distance_pips': 0.05}, {'level': '3650', 'price': 4038.365, 'distance_pips': 0.3}, {'level': '3675', 'price': 4038.368, 'distance_pips': 0.55}]
2025-10-08 10:32:22,651 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:32:22,651 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:22,652 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:22,652 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:32:22,653 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.362
2025-10-08 10:32:22,653 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:22,654 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:32:22,655 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:22,655 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:32:22,656 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:32:22,679 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4038.362
2025-10-08 10:32:22,680 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:22,681 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:32:22,681 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:22,682 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:32:22,682 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:32:22,683 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4038.362
2025-10-08 10:32:22,683 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:22,684 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:32:22,685 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:22,685 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:32:22,686 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:32:22,687 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.362
2025-10-08 10:32:22,689 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:22,689 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:32:22,715 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:22,716 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:32:22,717 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:22,717 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:22,718 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:32:22,718 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:32:22,740 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:32:22,744 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:32:22,744 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:32:22,745 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:32:22,745 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:32:22,745 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:32:22,746 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:32:22,746 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:32:22,746 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:32:22,747 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:32:22,747 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:32:22,747 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:32:22,748 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:32:22,748 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:32:22,748 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:22,774 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:22,774 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:32:22,775 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:32:22,775 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:32:22,776 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:32:22,777 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:32:22,778 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:32:22,779 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:22,780 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:32:22,780 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:32:22,781 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4038.362, 'ask': 4038.399, 'last': 0.0, 'time': 1759919542}
2025-10-08 10:32:22,805 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:32:22,806 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:32:22,807 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:32:22,807 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:32:22,807 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:22,808 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:22,808 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:22,809 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:22,809 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:22,810 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:32:22,810 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4038.362
2025-10-08 10:32:22,810 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42364.00000000003}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97481.00000000022}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25811.999999999898}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43932.99999999999}]
2025-10-08 10:32:22,811 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:32:22,874 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:32:22,876 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:32:22,878 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:32:22,899 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:32:22,901 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:32:25,151 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:32:25,209 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:32:26,965 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:32:26,967 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:32:26,967 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:32:26,968 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:32:26,970 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:32:26,971 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:32:26,978 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:32:26,996 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:26,997 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:32:26,998 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:32:26,998 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:32:26,999 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:32:27,000 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:32:27,022 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:32:27,502 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:32:27,504 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:32:27,504 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:32:27,505 - APP.services.mt5_service - DEBUG - Current price (cp): 4038.262
2025-10-08 10:32:27,511 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 349, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:32:27,562 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 231, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:32:27,581 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:32:27,582 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:32:27,584 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:32:27,585 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:27,585 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:32:27,587 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:32:27,591 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:32:27,591 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:27,591 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:32:27,592 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:32:27,595 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:32:27,617 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:27,618 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:32:27,620 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:32:27,622 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:32:27,623 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:27,623 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:32:27,624 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:32:27,650 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:32:27,651 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:32:27,653 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:32:27,653 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:32:27,654 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:32:27,654 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:32:27,654 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:32:27.654854+07:00
2025-10-08 10:32:27,655 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:32:27.654854+07:00
2025-10-08 10:32:27,656 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:32:27.654854+07:00 trong DST: True
2025-10-08 10:32:27,681 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:32:27,682 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:32:27,682 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:32:27,683 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:32:27,684 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:32:27,685 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:32:27,685 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:32:27,691 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:32:27,711 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:32:27,712 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:32:27,713 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:32:27,713 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:32:27,714 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:32:27,714 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:32:27,715 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:32:27,715 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:32:27,716 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:32:27,716 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:32:27,717 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:32:27,717 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:32:27,718 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:32:27,746 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:32:27,772 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:32:27,774 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:32:27,775 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:32:27,778 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:32:27,780 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:32:27,781 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:32:27,806 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:32:27,809 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:32:27,851 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:32:27,852 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:32:27,853 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:32:27,854 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:32:27,855 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:32:27,855 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4038.262, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:32:27,856 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:32:27,856 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:32:27,856 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:32:27,857 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:32:27,857 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 42264.000000000124
2025-10-08 10:32:27,858 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 97381.0000000003
2025-10-08 10:32:27,858 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 25711.99999999999
2025-10-08 10:32:27,858 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 43833.00000000008
2025-10-08 10:32:27,859 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:32:27,860 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42264.000000000124}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97381.0000000003}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25711.99999999999}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43833.00000000008}]
2025-10-08 10:32:27,861 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:32:27,862 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:32:27,862 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:32:27,863 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:32:27,863 - APP.services.mt5_service - DEBUG - Position in day range: 0.9589789360942561
2025-10-08 10:32:27,863 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:32:27,864 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:32:27.864082+07:00
2025-10-08 10:32:27,864 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:32:27.864082+07:00
2025-10-08 10:32:27,865 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:32:27.864082+07:00 trong DST: True
2025-10-08 10:32:27,865 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:32:27,865 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:32:27,866 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 208
2025-10-08 10:32:27,866 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:27,867 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:27,867 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '2600', 'price': 4038.26, 'distance_pips': 0.2}, {'level': '2625', 'price': 4038.263, 'distance_pips': 0.05}, {'level': '2650', 'price': 4038.265, 'distance_pips': 0.3}, {'level': '2675', 'price': 4038.268, 'distance_pips': 0.55}]
2025-10-08 10:32:27,868 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:32:27,868 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:27,869 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:27,869 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:32:27,870 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.262
2025-10-08 10:32:27,871 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:27,871 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:32:27,872 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:27,872 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:32:27,872 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:32:27,900 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4038.262
2025-10-08 10:32:27,901 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:27,904 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:32:27,936 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:27,967 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:32:27,971 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:32:27,998 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4038.262
2025-10-08 10:32:28,037 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:28,037 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:32:28,038 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:28,039 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:32:28,040 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:32:28,040 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.262
2025-10-08 10:32:28,041 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:28,042 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:32:28,043 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:28,044 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:32:28,045 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:28,046 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:28,046 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:32:28,046 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:32:28,047 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:32:28,047 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:32:28,047 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:32:28,047 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:32:28,048 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:32:28,048 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:32:28,049 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:32:28,049 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:32:28,050 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:32:28,050 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:32:28,050 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:32:28,051 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:32:28,051 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:32:28,052 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:32:28,053 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:28,053 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:28,054 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:32:28,054 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:32:28,055 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:32:28,055 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:32:28,056 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:32:28,057 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:32:28,058 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:28,059 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:32:28,059 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4038.262, 'ask': 4038.299, 'last': 0.0, 'time': 1759919546}
2025-10-08 10:32:28,059 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:32:28,060 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:32:28,062 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:32:28,066 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:32:28,092 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:32:28,093 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:28,119 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:28,120 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:28,120 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:28,121 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:28,121 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:32:28,121 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4038.262
2025-10-08 10:32:28,122 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42264.000000000124}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97381.0000000003}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25711.99999999999}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43833.00000000008}]
2025-10-08 10:32:28,122 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:32:28,153 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:32:28,154 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:32:28,155 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:32:28,158 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:32:28,183 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:32:31,969 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:32:31,971 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:32:31,971 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:32:31,972 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:32:31,974 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:32:31,974 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:32:31,978 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:32:31,997 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:32,000 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:32:32,001 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:32:32,002 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:32:32,002 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:32:32,019 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:32:32,057 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:32:32,521 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:32:32,523 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:32:32,523 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:32:32,524 - APP.services.mt5_service - DEBUG - Current price (cp): 4038.16
2025-10-08 10:32:32,530 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 340, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:32:32,563 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 231, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:32:32,586 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:32:32,587 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:32:32,590 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:32:32,591 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:32,591 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:32:32,592 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:32:32,595 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:32:32,617 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:32,618 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:32:32,620 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:32:32,622 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:32:32,623 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:32,623 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:32:32,624 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:32:32,626 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:32:32,649 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:32,649 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:32:32,651 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:32:32,654 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:32:32,654 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:32:32,655 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:32:32,655 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:32:32,656 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:32:32,680 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:32:32,681 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:32:32.681279+07:00
2025-10-08 10:32:32,681 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:32:32.681279+07:00
2025-10-08 10:32:32,682 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:32:32.681279+07:00 trong DST: True
2025-10-08 10:32:32,682 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:32:32,683 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:32:32,683 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:32:32,685 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:32:32,685 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:32:32,686 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:32:32,687 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:32:32,711 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:32:32,711 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:32:32,712 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:32:32,712 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:32:32,713 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:32:32,713 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:32:32,713 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:32:32,714 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:32:32,714 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:32:32,714 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:32:32,715 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:32:32,716 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:32:32,716 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:32:32,716 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:32:32,717 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:32:32,717 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:32:32,718 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:32:32,718 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:32:32,719 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:32:32,735 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:32:32,744 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:32:32,745 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:32:32,746 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:32:32,746 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:32:32,747 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:32:32,747 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:32:32,748 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:32:32,748 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:32:32,749 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4038.16, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:32:32,749 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:32:32,750 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:32:32,753 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:32:32,754 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:32:32,777 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 42161.9999999998
2025-10-08 10:32:32,777 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 97279.0
2025-10-08 10:32:32,778 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 25609.999999999673
2025-10-08 10:32:32,778 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 43730.99999999977
2025-10-08 10:32:32,779 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:32:32,779 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42161.9999999998}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97279.0}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25609.999999999673}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43730.99999999977}]
2025-10-08 10:32:32,780 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:32:32,780 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:32:32,798 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:32:32,803 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:32:32,803 - APP.services.mt5_service - DEBUG - Position in day range: 0.9571581578007838
2025-10-08 10:32:32,804 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:32:32,804 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:32:32.804495+07:00
2025-10-08 10:32:32,805 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:32:32.804495+07:00
2025-10-08 10:32:32,805 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:32:32.804495+07:00 trong DST: True
2025-10-08 10:32:32,806 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:32:32,806 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:32:32,806 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 208
2025-10-08 10:32:32,807 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:32,807 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:32,807 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '1600', 'price': 4038.16, 'distance_pips': 0.0}, {'level': '1625', 'price': 4038.163, 'distance_pips': 0.25}, {'level': '1650', 'price': 4038.165, 'distance_pips': 0.5}, {'level': '1675', 'price': 4038.168, 'distance_pips': 0.75}]
2025-10-08 10:32:32,808 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:32:32,808 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:32,809 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:32,809 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:32:32,810 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.16
2025-10-08 10:32:32,812 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:32,812 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:32:32,838 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:32,840 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:32:32,840 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:32:32,841 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4038.16
2025-10-08 10:32:32,842 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:32,842 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:32:32,842 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:32,843 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:32:32,844 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:32:32,869 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4038.16
2025-10-08 10:32:32,871 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:32,871 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:32:32,873 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:32,873 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:32:32,873 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:32:32,874 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4038.16
2025-10-08 10:32:32,899 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:32,901 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:32:32,902 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:32,903 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:32:32,903 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:32,903 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:32,904 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:32:32,904 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:32:32,905 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:32:32,905 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:32:32,906 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:32:32,908 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:32:32,909 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:32:32,933 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:32:32,934 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:32:32,935 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:32:32,936 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:32:32,936 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:32:32,937 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:32:32,965 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:32:32,966 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:32:32,967 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:32:32,967 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:32,968 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:32,968 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:32:32,969 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:32:32,971 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:32:32,972 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:32:32,998 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:32:33,002 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:32:33,026 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:33,036 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4038.16, 'ask': 4038.197, 'last': 0.0, 'time': 1759919552}
2025-10-08 10:32:33,037 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:32:33,038 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:32:33,038 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:32:33,040 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:32:33,041 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:32:33,041 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:32:33,042 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:33,042 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:33,043 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:33,044 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:33,044 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:33,044 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:32:33,045 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4038.16
2025-10-08 10:32:33,045 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 42161.9999999998}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 97279.0}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25609.999999999673}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43730.99999999977}]
2025-10-08 10:32:33,046 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:32:33,102 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:32:33,102 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:32:33,103 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:32:33,104 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:32:33,105 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:32:36,973 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:32:36,975 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:32:36,976 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:32:36,977 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:32:36,978 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:32:36,979 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:32:36,985 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:32:37,010 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:32:37,011 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:37,012 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:32:37,013 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:32:37,014 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:32:37,014 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:32:37,054 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:32:37,515 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:32:37,517 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:32:37,518 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:32:37,518 - APP.services.mt5_service - DEBUG - Current price (cp): 4037.77
2025-10-08 10:32:37,523 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 342, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:32:37,548 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 231, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:32:37,553 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:32:37,554 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:32:37,556 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:32:37,557 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:37,557 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:32:37,558 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:32:37,561 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:32:37,562 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:37,562 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:32:37,563 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:32:37,565 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:32:37,566 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:37,566 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:32:37,567 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:32:37,572 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:32:37,587 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:37,589 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:32:37,589 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:32:37,592 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:32:37,593 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:32:37,594 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:32:37,599 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:32:37,616 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:32:37,616 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:32:37,617 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:32:37.617243+07:00
2025-10-08 10:32:37,617 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:32:37.617243+07:00
2025-10-08 10:32:37,618 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:32:37.617243+07:00 trong DST: True
2025-10-08 10:32:37,618 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:32:37,619 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:32:37,619 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:32:37,620 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:32:37,621 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:32:37,622 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:32:37,622 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:32:37,626 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:32:37,646 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:32:37,649 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:32:37,650 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:32:37,651 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:32:37,651 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:32:37,652 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:32:37,652 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:32:37,653 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:32:37,653 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:32:37,654 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:32:37,654 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:32:37,654 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:32:37,655 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:32:37,655 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:32:37,656 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:32:37,656 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:32:37,656 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:32:37,657 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:32:37,667 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:32:37,683 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:32:37,684 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:32:37,685 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:32:37,685 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:32:37,686 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:32:37,687 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:32:37,689 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:32:37,693 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:32:37,694 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4037.77, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:32:37,718 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:32:37,726 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:32:37,729 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:32:37,744 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:32:37,746 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 41771.999999999935
2025-10-08 10:32:37,747 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 96889.00000000012
2025-10-08 10:32:37,747 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 25219.9999999998
2025-10-08 10:32:37,747 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 43340.99999999989
2025-10-08 10:32:37,748 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:32:37,748 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41771.999999999935}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96889.00000000012}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25219.9999999998}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43340.99999999989}]
2025-10-08 10:32:37,749 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:32:37,750 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:32:37,751 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:32:37,752 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:32:37,753 - APP.services.mt5_service - DEBUG - Position in day range: 0.9501963584434137
2025-10-08 10:32:37,754 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:32:37,757 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:32:37.756998+07:00
2025-10-08 10:32:37,757 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:32:37.756998+07:00
2025-10-08 10:32:37,758 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:32:37.756998+07:00 trong DST: True
2025-10-08 10:32:37,758 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:32:37,760 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:32:37,761 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 208
2025-10-08 10:32:37,780 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:37,788 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:37,789 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '7700', 'price': 4037.77, 'distance_pips': 0.0}, {'level': '7725', 'price': 4037.773, 'distance_pips': 0.25}, {'level': '7750', 'price': 4037.775, 'distance_pips': 0.5}, {'level': '7775', 'price': 4037.778, 'distance_pips': 0.75}]
2025-10-08 10:32:37,789 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:32:37,790 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:37,790 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:37,791 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:32:37,791 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.77
2025-10-08 10:32:37,792 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:37,792 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:32:37,793 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:37,793 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:32:37,794 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:32:37,794 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4037.77
2025-10-08 10:32:37,795 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:37,795 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:32:37,796 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:37,796 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:32:37,797 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:32:37,797 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4037.77
2025-10-08 10:32:37,798 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:37,798 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:32:37,799 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:37,800 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:32:37,800 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:32:37,801 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.77
2025-10-08 10:32:37,801 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:37,802 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:32:37,802 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:37,803 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:32:37,803 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:37,804 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:37,804 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:32:37,804 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:32:37,805 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:32:37,805 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:32:37,805 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:32:37,806 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:32:37,806 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:32:37,806 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:32:37,807 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:32:37,807 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:32:37,807 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:32:37,808 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:32:37,808 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:32:37,808 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:32:37,809 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:32:37,809 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:32:37,810 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:37,810 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:37,811 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:32:37,811 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:32:37,812 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:32:37,812 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:32:37,813 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:32:37,850 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:32:37,854 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:32:37,857 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:37,857 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:32:37,858 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4037.77, 'ask': 4037.807, 'last': 0.0, 'time': 1759919557}
2025-10-08 10:32:37,860 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:32:37,861 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:32:37,861 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:32:37,862 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:32:37,862 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:37,863 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:37,863 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:37,864 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:37,864 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:37,865 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:32:37,865 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4037.77
2025-10-08 10:32:37,866 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41771.999999999935}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96889.00000000012}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25219.9999999998}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43340.99999999989}]
2025-10-08 10:32:37,866 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:32:37,949 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:32:37,949 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:32:37,950 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:32:37,951 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:32:37,952 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:32:40,153 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:32:40,159 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:32:41,977 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:32:41,980 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:32:41,980 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:32:41,980 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:32:41,982 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:32:41,983 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:32:41,986 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:32:41,986 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:42,008 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:32:42,009 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:32:42,010 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:32:42,010 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:32:42,011 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:32:42,064 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:32:42,512 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:32:42,514 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:32:42,514 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:32:42,515 - APP.services.mt5_service - DEBUG - Current price (cp): 4037.639
2025-10-08 10:32:42,519 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 339, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:32:42,541 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 231, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:32:42,551 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:32:42,552 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:32:42,554 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:32:42,555 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:42,555 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:32:42,556 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:32:42,559 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:32:42,559 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:42,559 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:32:42,560 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:32:42,561 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:32:42,562 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:42,562 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:32:42,564 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:32:42,570 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:32:42,585 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:42,587 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:32:42,587 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:32:42,591 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:32:42,593 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:32:42,593 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:32:42,594 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:32:42,594 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:32:42,597 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:32:42,614 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:32:42.614436+07:00
2025-10-08 10:32:42,616 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:32:42.614436+07:00
2025-10-08 10:32:42,616 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:32:42.614436+07:00 trong DST: True
2025-10-08 10:32:42,617 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:32:42,618 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:32:42,619 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:32:42,621 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:32:42,621 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:32:42,623 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:32:42,623 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:32:42,627 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:32:42,648 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:32:42,650 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:32:42,651 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:32:42,651 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:32:42,652 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:32:42,652 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:32:42,653 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:32:42,653 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:32:42,654 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:32:42,654 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:32:42,655 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:32:42,655 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:32:42,656 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:32:42,656 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:32:42,656 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:32:42,657 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:32:42,684 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:32:42,685 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:32:42,687 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:32:42,687 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:32:42,700 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:32:42,716 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:32:42,717 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:32:42,718 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:32:42,719 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:32:42,719 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:32:42,720 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:32:42,721 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4037.639, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:32:42,723 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:32:42,746 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:32:42,747 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:32:42,748 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:32:42,749 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 41641.00000000007
2025-10-08 10:32:42,749 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 96758.00000000026
2025-10-08 10:32:42,750 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 25088.99999999994
2025-10-08 10:32:42,751 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 43210.00000000004
2025-10-08 10:32:42,753 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:32:42,753 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41641.00000000007}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96758.00000000026}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25088.99999999994}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43210.00000000004}]
2025-10-08 10:32:42,773 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:32:42,775 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:32:42,776 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:32:42,777 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:32:42,777 - APP.services.mt5_service - DEBUG - Position in day range: 0.9478579078900424
2025-10-08 10:32:42,777 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:32:42,778 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:32:42.778248+07:00
2025-10-08 10:32:42,778 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:32:42.778248+07:00
2025-10-08 10:32:42,778 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:32:42.778248+07:00 trong DST: True
2025-10-08 10:32:42,779 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:32:42,779 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:32:42,780 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 208
2025-10-08 10:32:42,781 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:42,781 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:42,783 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '6300', 'price': 4037.63, 'distance_pips': 0.9}, {'level': '6325', 'price': 4037.633, 'distance_pips': 0.65}, {'level': '6350', 'price': 4037.635, 'distance_pips': 0.4}, {'level': '6375', 'price': 4037.638, 'distance_pips': 0.15}]
2025-10-08 10:32:42,784 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:32:42,784 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:42,785 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:42,805 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:32:42,807 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.639
2025-10-08 10:32:42,807 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:42,808 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:32:42,809 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:42,810 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:32:42,810 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:32:42,811 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4037.639
2025-10-08 10:32:42,811 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:42,812 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:32:42,816 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:42,839 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:32:42,841 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:32:42,842 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4037.639
2025-10-08 10:32:42,842 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:42,843 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:32:42,844 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:42,844 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:32:42,848 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:32:42,880 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.639
2025-10-08 10:32:42,904 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:42,906 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:32:42,920 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:42,938 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:32:42,962 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:42,963 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:42,964 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:32:42,964 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:32:42,965 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:32:42,965 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:32:42,965 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:32:42,966 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:32:42,966 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:32:42,967 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:32:42,967 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:32:42,967 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:32:42,968 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:32:42,968 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:32:42,968 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:32:42,969 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:32:42,970 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:32:42,971 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:32:42,974 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:42,975 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:42,976 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:32:42,998 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:32:42,999 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:32:43,000 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:32:43,001 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:32:43,004 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:32:43,025 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:43,026 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:32:43,026 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:32:43,027 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4037.639, 'ask': 4037.676, 'last': 0.0, 'time': 1759919561}
2025-10-08 10:32:43,029 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:32:43,029 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:32:43,030 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:32:43,030 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:32:43,031 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:43,031 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:43,032 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:43,035 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:43,036 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:43,037 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:32:43,054 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4037.639
2025-10-08 10:32:43,058 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41641.00000000007}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96758.00000000026}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25088.99999999994}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43210.00000000004}]
2025-10-08 10:32:43,059 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:32:43,062 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:32:43,080 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:32:43,093 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:32:43,096 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:32:43,125 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:32:46,981 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:32:46,984 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:32:46,984 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:32:46,985 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:32:46,986 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:32:46,987 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:32:46,991 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:32:46,991 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:47,013 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:32:47,014 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:32:47,015 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:32:47,016 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:32:47,016 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:32:47,060 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:32:47,517 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:32:47,519 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:32:47,520 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:32:47,520 - APP.services.mt5_service - DEBUG - Current price (cp): 4037.346
2025-10-08 10:32:47,524 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 339, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:32:47,550 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 232, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:32:47,558 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:32:47,558 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:32:47,561 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:32:47,561 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:47,562 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:32:47,562 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:32:47,566 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:32:47,567 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:47,585 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:32:47,586 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:32:47,588 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:32:47,589 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:47,589 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:32:47,590 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:32:47,592 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:32:47,592 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:47,592 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:32:47,593 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:32:47,595 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:32:47,596 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:32:47,597 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:32:47,597 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:32:47,598 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:32:47,618 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:32:47,619 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:32:47.619228+07:00
2025-10-08 10:32:47,620 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:32:47.619228+07:00
2025-10-08 10:32:47,620 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:32:47.619228+07:00 trong DST: True
2025-10-08 10:32:47,621 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:32:47,621 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:32:47,621 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:32:47,622 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:32:47,623 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:32:47,624 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:32:47,625 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:32:47,629 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:32:47,649 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:32:47,650 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:32:47,650 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:32:47,651 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:32:47,651 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:32:47,652 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:32:47,652 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:32:47,652 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:32:47,653 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:32:47,653 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:32:47,654 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:32:47,654 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:32:47,655 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:32:47,655 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:32:47,655 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:32:47,656 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:32:47,656 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:32:47,657 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:32:47,658 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:32:47,658 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:32:47,659 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:32:47,659 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:32:47,681 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:32:47,681 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:32:47,683 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:32:47,684 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:32:47,684 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:32:47,685 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4037.346, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:32:47,685 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:32:47,686 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:32:47,687 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:32:47,687 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:32:47,687 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 41347.999999999956
2025-10-08 10:32:47,688 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 96465.00000000015
2025-10-08 10:32:47,690 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 24795.99999999982
2025-10-08 10:32:47,690 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 42916.99999999991
2025-10-08 10:32:47,690 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:32:47,691 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41347.999999999956}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96465.00000000015}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24795.99999999982}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42916.99999999991}]
2025-10-08 10:32:47,709 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:32:47,711 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:32:47,712 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:32:47,713 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:32:47,713 - APP.services.mt5_service - DEBUG - Position in day range: 0.9426276329882195
2025-10-08 10:32:47,714 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:32:47,714 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:32:47.714404+07:00
2025-10-08 10:32:47,714 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:32:47.714404+07:00
2025-10-08 10:32:47,715 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:32:47.714404+07:00 trong DST: True
2025-10-08 10:32:47,715 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:32:47,715 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:32:47,716 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 208
2025-10-08 10:32:47,716 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:47,717 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:47,718 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '3400', 'price': 4037.34, 'distance_pips': 0.6}, {'level': '3425', 'price': 4037.343, 'distance_pips': 0.35}, {'level': '3450', 'price': 4037.345, 'distance_pips': 0.1}, {'level': '3475', 'price': 4037.348, 'distance_pips': 0.15}]
2025-10-08 10:32:47,718 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:32:47,719 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:47,719 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:47,719 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:32:47,722 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.346
2025-10-08 10:32:47,739 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:47,740 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:32:47,741 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:47,742 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:32:47,742 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:32:47,743 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4037.346
2025-10-08 10:32:47,744 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:47,744 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:32:47,745 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:47,745 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:32:47,746 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:32:47,746 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4037.346
2025-10-08 10:32:47,747 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:47,747 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:32:47,748 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:47,749 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:32:47,749 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:32:47,750 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.346
2025-10-08 10:32:47,751 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:47,752 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:32:47,753 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:47,754 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:32:47,777 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:47,778 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:47,779 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:32:47,780 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:32:47,780 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:32:47,781 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:32:47,781 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:32:47,782 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:32:47,808 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:32:47,809 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:32:47,810 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:32:47,810 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:32:47,811 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:32:47,811 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:32:47,812 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:32:47,812 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:32:47,812 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:32:47,817 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:32:47,841 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:47,843 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:47,843 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:32:47,844 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:32:47,844 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:32:47,844 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:32:47,846 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:32:47,870 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:32:47,871 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:47,872 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:32:47,872 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4037.346, 'ask': 4037.383, 'last': 0.0, 'time': 1759919567}
2025-10-08 10:32:47,872 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:32:47,873 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:32:47,875 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:32:47,875 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:32:47,879 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:32:47,895 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:47,896 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:47,897 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:47,897 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:47,898 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:47,898 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:32:47,898 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4037.346
2025-10-08 10:32:47,899 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41347.999999999956}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96465.00000000015}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24795.99999999982}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42916.99999999991}]
2025-10-08 10:32:47,899 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:32:47,996 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:32:47,997 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:32:47,997 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:32:47,998 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:32:47,999 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:32:51,985 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:32:51,988 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:32:51,988 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:32:51,989 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:32:51,990 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:32:51,991 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:32:51,994 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:32:51,994 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:52,013 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:32:52,378 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:32:52,379 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:32:52,379 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:32:52,380 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:32:52,380 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:32:52,881 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:32:52,883 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:32:52,883 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:32:52,884 - APP.services.mt5_service - DEBUG - Current price (cp): 4037.112
2025-10-08 10:32:52,888 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 347, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:32:52,920 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 233, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:32:52,921 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:32:52,923 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:32:52,925 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:32:52,925 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:52,926 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:32:52,926 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:32:52,929 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:32:52,930 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:52,930 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:32:52,931 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:32:52,933 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:32:52,933 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:52,933 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:32:52,934 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:32:52,936 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:32:52,936 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:52,936 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:32:52,937 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:32:52,940 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:32:52,941 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:32:52,942 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:32:52,951 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:32:52,953 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:32:52,954 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:32:52,955 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:32:52.955539+07:00
2025-10-08 10:32:52,958 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:32:52.955539+07:00
2025-10-08 10:32:52,961 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:32:52.955539+07:00 trong DST: True
2025-10-08 10:32:52,961 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:32:52,962 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:32:52,963 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:32:52,964 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:32:52,964 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:32:52,966 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:32:52,966 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:32:52,969 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:32:52,969 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:32:52,970 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:32:52,970 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:32:52,971 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:32:52,971 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:32:52,972 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:32:52,972 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:32:52,973 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:32:52,973 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:32:52,974 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:32:52,974 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:32:52,979 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:32:52,981 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:32:52,982 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:32:52,983 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:32:52,991 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:32:52,992 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:32:52,993 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:32:52,993 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:32:52,994 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:32:52,994 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:32:52,994 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:32:52,995 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:32:52,995 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:32:52,996 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:32:52,996 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:32:52,996 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:32:52,997 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4037.112, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:32:52,997 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:32:52,997 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:32:52,998 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:32:52,998 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:32:52,999 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 41114.00000000003
2025-10-08 10:32:52,999 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 96231.00000000022
2025-10-08 10:32:53,000 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 24561.999999999898
2025-10-08 10:32:53,000 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 42682.99999999999
2025-10-08 10:32:53,000 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:32:53,001 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41114.00000000003}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96231.00000000022}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24561.999999999898}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42682.99999999999}]
2025-10-08 10:32:53,002 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:32:53,004 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:32:53,015 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:32:53,027 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:32:53,028 - APP.services.mt5_service - DEBUG - Position in day range: 0.9384505533737975
2025-10-08 10:32:53,028 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:32:53,029 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:32:53.029292+07:00
2025-10-08 10:32:53,029 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:32:53.029292+07:00
2025-10-08 10:32:53,030 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:32:53.029292+07:00 trong DST: True
2025-10-08 10:32:53,030 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:32:53,030 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:32:53,031 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 208
2025-10-08 10:32:53,031 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:53,031 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:53,032 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '1100', 'price': 4037.11, 'distance_pips': 0.2}, {'level': '1125', 'price': 4037.113, 'distance_pips': 0.05}, {'level': '1150', 'price': 4037.115, 'distance_pips': 0.3}, {'level': '1175', 'price': 4037.118, 'distance_pips': 0.55}]
2025-10-08 10:32:53,032 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019042624}
2025-10-08 10:32:53,035 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:53,044 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:53,055 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:32:53,056 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.112
2025-10-08 10:32:53,057 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:53,058 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:32:53,058 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:53,059 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:32:53,059 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:32:53,060 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4037.112
2025-10-08 10:32:53,060 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:53,060 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:32:53,061 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:53,062 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:32:53,062 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:32:53,063 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4037.112
2025-10-08 10:32:53,064 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:53,065 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:32:53,078 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:53,086 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:32:53,090 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:32:53,091 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.112
2025-10-08 10:32:53,092 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:53,092 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:32:53,093 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:53,094 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:32:53,094 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:53,095 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:53,095 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:32:53,108 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:32:53,122 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:32:53,123 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:32:53,124 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:32:53,124 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:32:53,125 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:32:53,125 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:32:53,126 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:32:53,126 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:32:53,128 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:32:53,136 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:32:53,145 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:32:53,151 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:32:53,152 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:32:53,153 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:32:53,154 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:53,154 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:53,154 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:32:53,155 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:32:53,155 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:32:53,155 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:32:53,156 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:32:53,157 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:32:53,184 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:53,185 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:32:53,185 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:32:53,186 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4037.112, 'ask': 4037.149, 'last': 0.0, 'time': 1759919572}
2025-10-08 10:32:53,188 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:32:53,189 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:32:53,189 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:32:53,210 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:32:53,211 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:53,212 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:53,212 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:53,212 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:53,213 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:53,213 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:32:53,213 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4037.112
2025-10-08 10:32:53,214 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41114.00000000003}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96231.00000000022}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24561.999999999898}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42682.99999999999}]
2025-10-08 10:32:53,214 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:32:53,310 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:32:53,311 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:32:53,311 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:32:53,312 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:32:53,313 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:32:55,154 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:32:55,252 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:32:56,989 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:32:56,992 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:32:56,992 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:32:56,992 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:32:56,994 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:32:56,995 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:32:56,998 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:32:57,022 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:57,023 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:32:57,024 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:32:57,025 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:32:57,025 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:32:57,026 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:32:57,065 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:32:57,527 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:32:57,528 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:32:57,529 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:32:57,529 - APP.services.mt5_service - DEBUG - Current price (cp): 4037.022
2025-10-08 10:32:57,535 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 350, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:32:57,567 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 233, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:32:57,568 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:32:57,568 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:32:57,570 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:32:57,570 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:57,571 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:32:57,571 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:32:57,574 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:32:57,575 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:57,576 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:32:57,577 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:32:57,579 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:32:57,579 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:57,579 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:32:57,580 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:32:57,582 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:32:57,582 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:32:57,583 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:32:57,583 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:32:57,585 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:32:57,586 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:32:57,586 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:32:57,587 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:32:57,587 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:32:57,587 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:32:57,588 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:32:57.588231+07:00
2025-10-08 10:32:57,588 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:32:57.588231+07:00
2025-10-08 10:32:57,589 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:32:57.588231+07:00 trong DST: True
2025-10-08 10:32:57,589 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:32:57,589 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:32:57,589 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:32:57,591 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:32:57,591 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7051609358705
2025-10-08 10:32:57,592 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 114 rates.
2025-10-08 10:32:57,593 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.737809922998
2025-10-08 10:32:57,595 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7051609358705, 'asia': 4036.737809922998, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:32:57,597 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:32:57,598 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.820115318389
2025-10-08 10:32:57,598 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:32:57,619 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4035.696424193012
2025-10-08 10:32:57,620 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:32:57,620 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.940137089311
2025-10-08 10:32:57,621 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:32:57,621 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.9521456342427
2025-10-08 10:32:57,621 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:32:57,622 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.2836893908075
2025-10-08 10:32:57,622 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:32:57,622 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.26095928964
2025-10-08 10:32:57,623 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:32:57,623 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.7874843404393
2025-10-08 10:32:57,623 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:32:57,624 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1188410798195
2025-10-08 10:32:57,624 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.820115318389, 'ema200': 4035.696424193012}, 'M5': {'ema50': 4031.940137089311, 'ema200': 4009.9521456342427}, 'M15': {'ema50': 4014.2836893908075, 'ema200': 3980.26095928964}, 'H1': {'ema50': 3974.7874843404393, 'ema200': 3912.1188410798195}}
2025-10-08 10:32:57,625 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:32:57,626 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.0845046690705904, TRs count: 179
2025-10-08 10:32:57,626 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:32:57,627 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5142562819872358, TRs count: 119
2025-10-08 10:32:57,629 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:32:57,629 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:32:57,630 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:32:57,632 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:32:57,653 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.0845046690705904, 'M1': 1.5142562819872358, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:32:57,654 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:32:57,655 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4037.022, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:32:57,656 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:32:57,656 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:32:57,657 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:32:57,657 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:32:57,659 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 41023.99999999988
2025-10-08 10:32:57,660 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 96141.00000000007
2025-10-08 10:32:57,660 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 24471.999999999753
2025-10-08 10:32:57,661 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 42592.99999999985
2025-10-08 10:32:57,687 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:32:57,688 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41023.99999999988}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96141.00000000007}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24471.999999999753}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42592.99999999985}]
2025-10-08 10:32:57,688 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:32:57,689 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:32:57,691 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:32:57,692 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:32:57,692 - APP.services.mt5_service - DEBUG - Position in day range: 0.9368439842913243
2025-10-08 10:32:57,693 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:32:57,694 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:32:57.694033+07:00
2025-10-08 10:32:57,710 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:32:57.694033+07:00
2025-10-08 10:32:57,711 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:32:57.694033+07:00 trong DST: True
2025-10-08 10:32:57,712 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:32:57,713 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:32:57,713 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 208
2025-10-08 10:32:57,714 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:57,714 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:57,714 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '200', 'price': 4037.02, 'distance_pips': 0.2}, {'level': '225', 'price': 4037.023, 'distance_pips': 0.05}, {'level': '250', 'price': 4037.025, 'distance_pips': 0.3}, {'level': '275', 'price': 4037.028, 'distance_pips': 0.55}]
2025-10-08 10:32:57,715 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1995443019190053}
2025-10-08 10:32:57,715 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:57,716 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:57,716 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:32:57,717 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.022
2025-10-08 10:32:57,717 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:57,717 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:32:57,718 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:57,719 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:32:57,719 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:32:57,720 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4037.022
2025-10-08 10:32:57,720 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:57,722 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:32:57,723 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:57,747 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:32:57,748 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:32:57,749 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4037.022
2025-10-08 10:32:57,750 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:57,750 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:32:57,751 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:57,751 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:32:57,753 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:32:57,755 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.022
2025-10-08 10:32:57,755 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:32:57,785 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:32:57,832 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:32:57,833 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:32:57,834 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:57,834 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:57,835 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:32:57,835 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:32:57,836 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:32:57,836 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:32:57,836 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:32:57,837 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:32:57,837 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:32:57,838 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:32:57,838 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:32:57,839 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:32:57,839 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:32:57,839 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:32:57,840 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:32:57,840 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:32:57,841 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:32:57,841 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:32:57,841 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:57,842 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:57,842 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:32:57,843 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:32:57,843 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:32:57,844 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:32:57,848 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:32:57,876 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:32:57,952 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:57,953 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:32:57,954 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:32:57,954 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4037.022, 'ask': 4037.059, 'last': 0.0, 'time': 1759919577}
2025-10-08 10:32:57,957 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:32:57,958 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:32:57,959 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:32:57,960 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:32:57,961 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:57,961 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:57,961 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:57,962 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:32:57,962 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:32:57,962 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:32:57,963 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4037.022
2025-10-08 10:32:57,964 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41023.99999999988}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96141.00000000007}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24471.999999999753}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42592.99999999985}]
2025-10-08 10:32:57,968 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:32:58,063 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:32:58,063 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:32:58,064 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:32:58,067 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:32:58,069 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:32:59,554 - APP.ui.app_ui - INFO - Autorun tick: Kích hoạt worker kiểm tra.
2025-10-08 10:32:59,555 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_autorun_tick_worker' vào thread pool.
2025-10-08 10:32:59,555 - APP.ui.app_ui - DEBUG - Autorun tick worker: Bắt đầu kiểm tra điều kiện.
2025-10-08 10:32:59,557 - APP.ui.app_ui - INFO - Autorun tick worker: Điều kiện hợp lệ, yêu cầu bắt đầu phân tích trên luồng UI.
2025-10-08 10:32:59,584 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: start_analysis
2025-10-08 10:32:59,586 - APP.ui.app_ui - INFO - Yêu cầu bắt đầu phân tích từ UI.
2025-10-08 10:32:59,587 - APP.ui.utils.ui_builder - DEBUG - Đã thay đổi trạng thái nút Start/Stop thành 'disabled'. Các điều khiển khác không bị ảnh hưởng.
2025-10-08 10:32:59,587 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:32:59,588 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:32:59,589 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:32:59,589 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:32:59,589 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:32:59,590 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:32:59,591 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:32:59,591 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:32:59,592 - APP.services.te_service - INFO - Đăng nhập thành công vào Trading Economics API.
2025-10-08 10:32:59,592 - APP.services.news_service - DEBUG - Cấu hình NewsService đã được cập nhật.
2025-10-08 10:32:59,593 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-08 10:32:59,593 - APP.ui.app_ui - INFO - Đã khởi tạo và bắt đầu luồng AnalysisWorker.
2025-10-08 10:32:59,594 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-08 10:32:59,595 - APP.services.gemini_service - INFO - Đã khởi tạo model 'models/gemini-2.5-flash' thành công.
2025-10-08 10:32:59,596 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 2: Xây dựng ngữ cảnh và kiểm tra điều kiện.
2025-10-08 10:32:59,623 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-RUN.
2025-10-08 10:32:59,625 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 3: Chuẩn bị và upload ảnh (song song).
2025-10-08 10:32:59,625 - APP.analysis.image_processor - DEBUG - Đang thử tải cache upload.
2025-10-08 10:32:59,647 - APP.services.mt5_service - DEBUG - Bắt đầu get_active_killzone cho 2025-10-08 10:32:59.623984 với timezone Asia/Ho_Chi_Minh
2025-10-08 10:32:59,662 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-08 10:32:59.623984+07:00, Target TZ: None
2025-10-08 10:32:59,685 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 10:32:59.623984+07:00
2025-10-08 10:32:59,686 - APP.analysis.image_processor - DEBUG - Đã tải cache upload với 4 mục.
2025-10-08 10:32:59,687 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 10:32:59.623984+07:00 trong DST: True
2025-10-08 10:32:59,687 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:32:59,688 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:32:59,689 - APP.services.mt5_service - DEBUG - Không trong killzone nào.
2025-10-08 10:32:59,690 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_H1.png: 15022:1759914264:adcc044a34c2739b
2025-10-08 10:32:59,718 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:32:59,718 - APP.core.trading.conditions - INFO - Điều kiện NO-RUN được kích hoạt: Không chạy ngoài các Kill Zone đã định nghĩa.
2025-10-08 10:32:59,719 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_H1.png. Tên từ xa: files/jcq192qkqfx5
2025-10-08 10:32:59,719 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M1.png: 21123:1759914329:c9ca25adc2713e89
2025-10-08 10:32:59,734 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M5.png: 22339:1759914253:ac9da090a54f8eec
2025-10-08 10:32:59,721 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M15.png: 14475:1759914258:f522dd906714fb0b
2025-10-08 10:32:59,743 - APP.core.trading.conditions - INFO - Thoát sớm. Giai đoạn: no-run, Lý do: Không chạy ngoài các Kill Zone đã định nghĩa.
2025-10-08 10:32:59,743 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_H1.png, đang lấy thông tin file...
2025-10-08 10:32:59,743 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M1.png. Tên từ xa: files/zl0mc2r9tv6i
2025-10-08 10:32:59,744 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M5.png. Tên từ xa: files/kis0no3da2v8
2025-10-08 10:32:59,744 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M15.png. Tên từ xa: files/4s2o4xrat6a8
2025-10-08 10:32:59,745 - APP.persistence.log_handler - DEBUG - Đang chuẩn bị ghi log giao dịch. Giai đoạn: no-run, Thư mục con: None
2025-10-08 10:32:59,746 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M1.png, đang lấy thông tin file...
2025-10-08 10:32:59,749 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M5.png, đang lấy thông tin file...
2025-10-08 10:32:59,749 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M15.png, đang lấy thông tin file...
2025-10-08 10:32:59,832 - APP.persistence.log_handler - DEBUG - Đã ghi log giao dịch thành công vào trade_log_20251008.jsonl.
2025-10-08 10:32:59,833 - APP.persistence.log_handler - DEBUG - Kết thúc hàm log_trade.
2025-10-08 10:32:59,834 - APP.core.analysis_worker - INFO - Giai đoạn 2 thoát sớm: Điều kiện No-Run: Không chạy ngoài các Kill Zone đã định nghĩa.
2025-10-08 10:32:59,834 - APP.utils.threading_utils - DEBUG - Tác vụ song song '_execute_stage_2_logic' đã hoàn thành.
2025-10-08 10:32:59,841 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:32:59,877 - APP.analysis.image_processor - DEBUG - Đang lưu cache upload với 4 mục.
2025-10-08 10:32:59,907 - APP.analysis.image_processor - DEBUG - Đã lưu cache upload thành công.
2025-10-08 10:32:59,908 - APP.utils.threading_utils - DEBUG - Tác vụ song song '_execute_stage_3_logic' đã hoàn thành.
2025-10-08 10:32:59,919 - APP.core.analysis_worker - WARNING - Một trong các giai đoạn song song đã thất bại. Dừng worker.
2025-10-08 10:32:59,932 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Thoát sớm do lỗi ở Giai đoạn 2 hoặc 3.
2025-10-08 10:32:59,932 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-08 10:32:59,933 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-08 10:32:59,966 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:00,068 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:00,170 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:00,170 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:00,171 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:00,172 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:00,273 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:00,273 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:00,420 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:00,469 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:00,650 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:00,672 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:00,775 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:00,777 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:00,777 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: _finalize_done
2025-10-08 10:33:00,779 - APP.ui.utils.ui_builder - DEBUG - Đã thay đổi trạng thái nút Start/Stop thành 'normal'. Các điều khiển khác không bị ảnh hưởng.
2025-10-08 10:33:00,780 - APP.ui.app_ui - DEBUG - Lên lịch chạy tự động tiếp theo sau 60000ms.
2025-10-08 10:33:01,993 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:33:01,996 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:33:01,996 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:33:01,997 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:33:01,998 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:33:01,999 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:33:02,002 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:33:02,023 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:02,030 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:33:02,031 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:33:02,031 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:33:02,032 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:33:02,033 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:33:02,119 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:02,557 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:33:02,559 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:33:02,560 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:33:02,560 - APP.services.mt5_service - DEBUG - Current price (cp): 4037.226
2025-10-08 10:33:02,571 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 346, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:33:02,665 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 233, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:33:02,666 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:33:02,668 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:33:02,673 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:33:02,676 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:02,676 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:33:02,677 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:33:02,684 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:33:02,686 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:02,688 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:33:02,690 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:33:02,721 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:33:02,758 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:02,761 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:33:02,762 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:33:02,765 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:33:02,766 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:02,766 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:33:02,767 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:33:02,772 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:33:02,775 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:33:02,777 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:33:02,790 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:33:02,821 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:33:02,915 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:33:02,917 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:33:02.917234+07:00
2025-10-08 10:33:02,921 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:33:02.917234+07:00
2025-10-08 10:33:02,924 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:33:02.917234+07:00 trong DST: True
2025-10-08 10:33:02,925 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:33:02,928 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:33:02,931 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:33:02,935 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:33:02,963 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.750556149734
2025-10-08 10:33:02,966 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 113 rates.
2025-10-08 10:33:02,968 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.782765984275
2025-10-08 10:33:02,999 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.750556149734, 'asia': 4036.782765984275, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:33:03,000 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:33:03,000 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.857398285122
2025-10-08 10:33:03,001 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:33:03,003 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.3543557318794
2025-10-08 10:33:03,028 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:33:03,030 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.956842971664
2025-10-08 10:33:03,030 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:33:03,031 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.956384440213
2025-10-08 10:33:03,031 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:33:03,032 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.3003952731606
2025-10-08 10:33:03,033 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:33:03,033 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.2651980956102
2025-10-08 10:33:03,034 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:33:03,054 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.8041902227924
2025-10-08 10:33:03,076 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:33:03,077 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1230798857896
2025-10-08 10:33:03,077 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.857398285122, 'ema200': 4036.3543557318794}, 'M5': {'ema50': 4031.956842971664, 'ema200': 4009.956384440213}, 'M15': {'ema50': 4014.3003952731606, 'ema200': 3980.2651980956102}, 'H1': {'ema50': 3974.8041902227924, 'ema200': 3912.1230798857896}}
2025-10-08 10:33:03,078 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:33:03,079 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.1165046690705807, TRs count: 179
2025-10-08 10:33:03,079 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:33:03,080 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.437153813093882, TRs count: 119
2025-10-08 10:33:03,080 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:33:03,082 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:33:03,082 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:33:03,083 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:33:03,084 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.1165046690705807, 'M1': 1.437153813093882, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:33:03,084 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:33:03,085 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4037.226, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:33:03,087 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:33:03,088 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:33:03,089 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:33:03,089 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:33:03,090 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 41228.000000000065
2025-10-08 10:33:03,090 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 96345.00000000025
2025-10-08 10:33:03,091 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 24675.99999999993
2025-10-08 10:33:03,092 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 42797.00000000002
2025-10-08 10:33:03,092 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:33:03,093 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41228.000000000065}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96345.00000000025}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24675.99999999993}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42797.00000000002}]
2025-10-08 10:33:03,093 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:33:03,094 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:33:03,095 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:33:03,096 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:33:03,125 - APP.services.mt5_service - DEBUG - Position in day range: 0.9404855408782608
2025-10-08 10:33:03,158 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:33:03,218 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:33:03.217842+07:00
2025-10-08 10:33:03,220 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:33:03.217842+07:00
2025-10-08 10:33:03,220 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:33:03.217842+07:00 trong DST: True
2025-10-08 10:33:03,249 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:33:03,250 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:33:03,251 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 207
2025-10-08 10:33:03,251 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:03,283 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:03,308 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '2200', 'price': 4037.22, 'distance_pips': 0.6}, {'level': '2225', 'price': 4037.223, 'distance_pips': 0.35}, {'level': '2250', 'price': 4037.225, 'distance_pips': 0.1}, {'level': '2275', 'price': 4037.228, 'distance_pips': 0.15}]
2025-10-08 10:33:03,311 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1872274849131386}
2025-10-08 10:33:03,311 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:03,312 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:03,312 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:33:03,313 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.226
2025-10-08 10:33:03,340 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:03,343 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:33:03,344 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:03,345 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:33:03,345 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:33:03,371 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4037.226
2025-10-08 10:33:03,374 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:03,374 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:33:03,376 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:03,376 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:33:03,377 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:33:03,404 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4037.226
2025-10-08 10:33:03,405 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:03,406 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:33:03,407 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:03,408 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:33:03,437 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:33:03,438 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.226
2025-10-08 10:33:03,439 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:03,439 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:33:03,468 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:03,469 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:33:03,470 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:03,470 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:03,501 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:33:03,527 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:33:03,528 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:33:03,529 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:33:03,530 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:33:03,530 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:33:03,531 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:33:03,531 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:33:03,532 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:33:03,532 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:33:03,533 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:33:03,533 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:33:03,534 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:33:03,562 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:33:03,563 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:33:03,564 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:33:03,591 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:03,591 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:03,592 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:33:03,593 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:33:03,593 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:33:03,593 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:33:03,594 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:33:03,623 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:33:03,625 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:33:03,625 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:33:03,626 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:03,629 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:33:03,653 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4037.226, 'ask': 4037.263, 'last': 0.0, 'time': 1759919582}
2025-10-08 10:33:03,654 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:33:03,654 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:33:03,655 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:33:03,655 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:03,656 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:03,656 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:03,657 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:03,657 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:03,658 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:33:03,659 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4037.226
2025-10-08 10:33:03,659 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41228.000000000065}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96345.00000000025}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24675.99999999993}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42797.00000000002}]
2025-10-08 10:33:03,687 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:33:03,722 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:03,724 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:33:03,745 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:33:03,746 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:33:03,748 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:33:06,997 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:33:07,000 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:33:07,000 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:33:07,000 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:33:07,003 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:33:07,007 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:33:07,028 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:33:07,031 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:33:07,032 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:33:07,032 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:07,033 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:33:07,034 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:33:07,035 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:33:07,064 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:07,558 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:33:07,561 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:33:07,562 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:33:07,562 - APP.services.mt5_service - DEBUG - Current price (cp): 4037.071
2025-10-08 10:33:07,572 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 347, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:33:07,625 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 233, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:33:07,626 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:33:07,626 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:33:07,630 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:33:07,634 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:07,635 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:33:07,636 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:33:07,639 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:33:07,639 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:07,639 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:33:07,640 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:33:07,642 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:33:07,642 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:07,643 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:33:07,643 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:33:07,645 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:33:07,645 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:07,646 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:33:07,646 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:33:07,648 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:33:07,649 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:33:07,649 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:33:07,650 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:33:07,650 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:33:07,651 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:33:07,651 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:33:07.651576+07:00
2025-10-08 10:33:07,652 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:33:07.651576+07:00
2025-10-08 10:33:07,652 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:33:07.651576+07:00 trong DST: True
2025-10-08 10:33:07,652 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:33:07,653 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:33:07,653 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:33:07,654 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:33:07,655 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.750556149734
2025-10-08 10:33:07,657 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 113 rates.
2025-10-08 10:33:07,657 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.782765984275
2025-10-08 10:33:07,661 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.750556149734, 'asia': 4036.782765984275, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:33:07,686 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:33:07,687 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.857398285122
2025-10-08 10:33:07,687 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:33:07,688 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.3543557318794
2025-10-08 10:33:07,688 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:33:07,689 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.956842971664
2025-10-08 10:33:07,689 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:33:07,689 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.956384440213
2025-10-08 10:33:07,690 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:33:07,691 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.3003952731606
2025-10-08 10:33:07,718 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:33:07,719 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.2651980956102
2025-10-08 10:33:07,720 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:33:07,720 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.8041902227924
2025-10-08 10:33:07,721 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:33:07,734 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1230798857896
2025-10-08 10:33:07,763 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.857398285122, 'ema200': 4036.3543557318794}, 'M5': {'ema50': 4031.956842971664, 'ema200': 4009.956384440213}, 'M15': {'ema50': 4014.3003952731606, 'ema200': 3980.2651980956102}, 'H1': {'ema50': 3974.8041902227924, 'ema200': 3912.1230798857896}}
2025-10-08 10:33:07,764 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:33:07,765 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.1165046690705807, TRs count: 179
2025-10-08 10:33:07,765 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:33:07,766 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.437153813093882, TRs count: 119
2025-10-08 10:33:07,766 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:33:07,767 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:33:07,768 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:33:07,769 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:33:07,769 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.1165046690705807, 'M1': 1.437153813093882, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:33:07,769 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:33:07,770 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4037.071, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:33:07,770 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:33:07,770 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:33:07,771 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:33:07,771 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:33:07,771 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 41072.99999999986
2025-10-08 10:33:07,772 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 96190.00000000006
2025-10-08 10:33:07,772 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 24520.99999999973
2025-10-08 10:33:07,773 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 42641.999999999825
2025-10-08 10:33:07,773 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:33:07,773 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41072.99999999986}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96190.00000000006}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24520.99999999973}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42641.999999999825}]
2025-10-08 10:33:07,774 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:33:07,775 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:33:07,775 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:33:07,775 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:33:07,776 - APP.services.mt5_service - DEBUG - Position in day range: 0.9377186719028913
2025-10-08 10:33:07,776 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:33:07,776 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:33:07.776825+07:00
2025-10-08 10:33:07,777 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:33:07.776825+07:00
2025-10-08 10:33:07,777 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:33:07.776825+07:00 trong DST: True
2025-10-08 10:33:07,778 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:33:07,778 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:33:07,778 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 207
2025-10-08 10:33:07,779 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:07,779 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:07,780 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '700', 'price': 4037.07, 'distance_pips': 0.1}, {'level': '725', 'price': 4037.073, 'distance_pips': 0.15}, {'level': '750', 'price': 4037.075, 'distance_pips': 0.4}, {'level': '775', 'price': 4037.078, 'distance_pips': 0.65}]
2025-10-08 10:33:07,780 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1872274849277302}
2025-10-08 10:33:07,780 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:07,781 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:07,781 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:33:07,782 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.071
2025-10-08 10:33:07,783 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:07,783 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:33:07,811 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:07,812 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:33:07,812 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:33:07,813 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4037.071
2025-10-08 10:33:07,813 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:07,814 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:33:07,815 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:07,842 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:33:07,843 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:33:07,844 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4037.071
2025-10-08 10:33:07,844 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:07,845 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:33:07,845 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:07,846 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:33:07,848 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:33:07,873 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.071
2025-10-08 10:33:07,874 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:07,875 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:33:07,876 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:07,876 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:33:07,878 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:07,905 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:07,906 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:33:07,907 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:33:07,908 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:33:07,908 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:33:07,911 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:33:07,937 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:33:07,939 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:33:07,940 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:33:07,943 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:33:07,969 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:33:07,970 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:33:07,970 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:33:07,970 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:33:07,971 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:33:07,971 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:33:07,972 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:33:08,002 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:08,003 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:08,003 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:33:08,004 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:33:08,028 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:33:08,030 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:33:08,031 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:33:08,032 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:33:08,033 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:08,034 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:33:08,034 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:33:08,035 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4037.071, 'ask': 4037.108, 'last': 0.0, 'time': 1759919586}
2025-10-08 10:33:08,057 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:33:08,060 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:33:08,061 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:33:08,062 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:33:08,062 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:08,063 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:08,063 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:08,063 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:08,064 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:08,064 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:33:08,065 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4037.071
2025-10-08 10:33:08,065 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41072.99999999986}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96190.00000000006}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24520.99999999973}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42641.999999999825}]
2025-10-08 10:33:08,065 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:33:08,161 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:08,162 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:33:08,163 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:33:08,164 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:33:08,165 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:33:10,155 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:33:10,172 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:33:12,001 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:33:12,004 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:33:12,004 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:33:12,005 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:33:12,006 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:33:12,007 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:33:12,013 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:33:12,020 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:33:12,032 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:12,033 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:33:12,034 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:33:12,036 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:33:12,038 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:33:12,090 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:12,540 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:33:12,544 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:33:12,544 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:33:12,546 - APP.services.mt5_service - DEBUG - Current price (cp): 4036.919
2025-10-08 10:33:12,554 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 342, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:33:12,621 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 233, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:33:12,622 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:33:12,622 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:33:12,625 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:33:12,625 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:12,626 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:33:12,627 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:33:12,631 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:33:12,632 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:12,632 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:33:12,633 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:33:12,635 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:33:12,635 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:12,636 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:33:12,637 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:33:12,639 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:33:12,640 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:12,640 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:33:12,640 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:33:12,643 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:33:12,643 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:33:12,644 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:33:12,644 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:33:12,645 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:33:12,645 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:33:12,645 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:33:12.645928+07:00
2025-10-08 10:33:12,646 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:33:12.645928+07:00
2025-10-08 10:33:12,646 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:33:12.645928+07:00 trong DST: True
2025-10-08 10:33:12,647 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:33:12,647 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:33:12,647 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:33:12,649 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:33:12,650 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.750556149734
2025-10-08 10:33:12,651 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 113 rates.
2025-10-08 10:33:12,652 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.782765984275
2025-10-08 10:33:12,655 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.750556149734, 'asia': 4036.782765984275, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:33:12,655 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:33:12,656 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.857398285122
2025-10-08 10:33:12,656 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:33:12,657 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.3543557318794
2025-10-08 10:33:12,658 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:33:12,658 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.956842971664
2025-10-08 10:33:12,659 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:33:12,660 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.956384440213
2025-10-08 10:33:12,661 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:33:12,661 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.3003952731606
2025-10-08 10:33:12,683 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:33:12,684 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.2651980956102
2025-10-08 10:33:12,685 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:33:12,686 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.8041902227924
2025-10-08 10:33:12,686 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:33:12,687 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1230798857896
2025-10-08 10:33:12,687 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.857398285122, 'ema200': 4036.3543557318794}, 'M5': {'ema50': 4031.956842971664, 'ema200': 4009.956384440213}, 'M15': {'ema50': 4014.3003952731606, 'ema200': 3980.2651980956102}, 'H1': {'ema50': 3974.8041902227924, 'ema200': 3912.1230798857896}}
2025-10-08 10:33:12,688 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:33:12,688 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.1165046690705807, TRs count: 179
2025-10-08 10:33:12,689 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:33:12,689 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.437153813093882, TRs count: 119
2025-10-08 10:33:12,690 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:33:12,691 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:33:12,692 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:33:12,703 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:33:12,714 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.1165046690705807, 'M1': 1.437153813093882, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:33:12,715 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:33:12,715 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4036.919, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:33:12,715 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:33:12,716 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:33:12,716 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:33:12,716 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:33:12,717 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 40920.99999999982
2025-10-08 10:33:12,717 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 96038.00000000001
2025-10-08 10:33:12,717 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 24368.999999999687
2025-10-08 10:33:12,718 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 42489.99999999978
2025-10-08 10:33:12,718 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:33:12,719 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 40920.99999999982}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96038.00000000001}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24368.999999999687}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42489.99999999978}]
2025-10-08 10:33:12,720 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:33:12,720 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:33:12,721 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:33:12,721 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:33:12,722 - APP.services.mt5_service - DEBUG - Position in day range: 0.9350053552302735
2025-10-08 10:33:12,723 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:33:12,723 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:33:12.723678+07:00
2025-10-08 10:33:12,724 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:33:12.723678+07:00
2025-10-08 10:33:12,740 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:33:12.723678+07:00 trong DST: True
2025-10-08 10:33:12,741 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:33:12,741 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:33:12,742 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 207
2025-10-08 10:33:12,742 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:12,742 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:12,743 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '9100', 'price': 4036.91, 'distance_pips': 0.9}, {'level': '9125', 'price': 4036.913, 'distance_pips': 0.65}, {'level': '9150', 'price': 4036.915, 'distance_pips': 0.4}, {'level': '9175', 'price': 4036.918, 'distance_pips': 0.15}]
2025-10-08 10:33:12,744 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1872274849277302}
2025-10-08 10:33:12,745 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:12,745 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:12,746 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:33:12,746 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4036.919
2025-10-08 10:33:12,747 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:12,747 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:33:12,748 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:12,748 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:33:12,749 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:33:12,749 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4036.919
2025-10-08 10:33:12,750 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:12,750 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:33:12,751 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:12,751 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:33:12,752 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:33:12,753 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4036.919
2025-10-08 10:33:12,755 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:12,755 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:33:12,757 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:12,778 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:33:12,779 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:33:12,780 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4036.919
2025-10-08 10:33:12,781 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:12,781 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:33:12,782 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:12,782 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:33:12,783 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:12,783 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:12,784 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:33:12,785 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:33:12,785 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:33:12,785 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:33:12,786 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:33:12,787 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:33:12,787 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:33:12,788 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:33:12,788 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:33:12,788 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:33:12,789 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:33:12,789 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:33:12,789 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:33:12,790 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:33:12,790 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:33:12,790 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:33:12,791 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:12,791 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:12,792 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:33:12,792 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:33:12,792 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:33:12,793 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:33:12,793 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:33:12,794 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:33:12,796 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:12,796 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:33:12,797 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:33:12,797 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4036.919, 'ask': 4036.956, 'last': 0.0, 'time': 1759919592}
2025-10-08 10:33:12,803 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:33:12,830 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:33:12,843 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:33:12,849 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:33:12,851 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:12,854 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:12,856 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:12,857 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:12,858 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:12,860 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:33:12,861 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4036.919
2025-10-08 10:33:12,862 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 40920.99999999982}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96038.00000000001}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24368.999999999687}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42489.99999999978}]
2025-10-08 10:33:12,890 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:33:12,892 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:12,917 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:33:12,937 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:33:12,939 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:33:12,942 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:33:17,006 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:33:17,009 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:33:17,009 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:33:17,010 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:33:17,012 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:33:17,012 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:33:17,016 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:33:17,016 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:17,037 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:17,424 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:33:17,425 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:33:17,426 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:33:17,426 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:33:17,426 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:33:17,927 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:33:17,929 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:33:17,930 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:33:17,931 - APP.services.mt5_service - DEBUG - Current price (cp): 4036.896
2025-10-08 10:33:17,937 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 346, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:33:17,972 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 234, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:33:17,973 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:33:17,974 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:33:17,976 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:33:17,976 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:17,977 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:33:17,977 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:33:17,985 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:33:17,998 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:17,998 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:33:17,999 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:33:18,001 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:33:18,002 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:18,002 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:33:18,003 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:33:18,012 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:33:18,039 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:18,040 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:33:18,047 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:33:18,070 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:33:18,073 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:33:18,075 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:33:18,075 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:33:18,104 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:33:18,105 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:33:18,131 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:33:18.131877+07:00
2025-10-08 10:33:18,136 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:33:18.131877+07:00
2025-10-08 10:33:18,159 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:33:18.131877+07:00 trong DST: True
2025-10-08 10:33:18,162 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:33:18,163 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:33:18,163 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:33:18,165 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:33:18,167 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.750556149734
2025-10-08 10:33:18,180 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 113 rates.
2025-10-08 10:33:18,188 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.782765984275
2025-10-08 10:33:18,191 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.750556149734, 'asia': 4036.782765984275, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:33:18,192 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:33:18,193 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.857398285122
2025-10-08 10:33:18,193 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:33:18,194 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.3543557318794
2025-10-08 10:33:18,195 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:33:18,195 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.956842971664
2025-10-08 10:33:18,196 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:33:18,199 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.956384440213
2025-10-08 10:33:18,206 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:33:18,220 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.3003952731606
2025-10-08 10:33:18,221 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:33:18,221 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.2651980956102
2025-10-08 10:33:18,223 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:33:18,223 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.8041902227924
2025-10-08 10:33:18,225 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:33:18,226 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1230798857896
2025-10-08 10:33:18,226 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.857398285122, 'ema200': 4036.3543557318794}, 'M5': {'ema50': 4031.956842971664, 'ema200': 4009.956384440213}, 'M15': {'ema50': 4014.3003952731606, 'ema200': 3980.2651980956102}, 'H1': {'ema50': 3974.8041902227924, 'ema200': 3912.1230798857896}}
2025-10-08 10:33:18,227 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:33:18,229 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.1165046690705807, TRs count: 179
2025-10-08 10:33:18,229 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:33:18,236 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.437153813093882, TRs count: 119
2025-10-08 10:33:18,250 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:33:18,250 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:33:18,251 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:33:18,252 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:33:18,252 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.1165046690705807, 'M1': 1.437153813093882, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:33:18,253 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:33:18,254 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4036.896, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:33:18,254 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:33:18,255 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:33:18,256 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:33:18,257 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:33:18,257 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 40898.00000000014
2025-10-08 10:33:18,258 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 96015.00000000032
2025-10-08 10:33:18,258 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 24346.000000000004
2025-10-08 10:33:18,259 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 42467.000000000095
2025-10-08 10:33:18,260 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:33:18,260 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 40898.00000000014}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96015.00000000032}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24346.000000000004}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42467.000000000095}]
2025-10-08 10:33:18,285 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:33:18,288 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:33:18,289 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:33:18,290 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:33:18,291 - APP.services.mt5_service - DEBUG - Position in day range: 0.93459478757587
2025-10-08 10:33:18,291 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:33:18,292 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:33:18.292237+07:00
2025-10-08 10:33:18,292 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:33:18.292237+07:00
2025-10-08 10:33:18,293 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:33:18.292237+07:00 trong DST: True
2025-10-08 10:33:18,311 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:33:18,311 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:33:18,312 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 207
2025-10-08 10:33:18,312 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:18,313 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:18,313 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '8900', 'price': 4036.89, 'distance_pips': 0.6}, {'level': '8925', 'price': 4036.892, 'distance_pips': 0.35}, {'level': '8950', 'price': 4036.895, 'distance_pips': 0.1}, {'level': '8975', 'price': 4036.898, 'distance_pips': 0.15}]
2025-10-08 10:33:18,313 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1872274849131386}
2025-10-08 10:33:18,314 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:18,314 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:18,314 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:33:18,315 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4036.896
2025-10-08 10:33:18,317 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:18,320 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:33:18,322 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:18,323 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:33:18,324 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:33:18,328 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4036.896
2025-10-08 10:33:18,343 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:18,343 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:33:18,344 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:18,345 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:33:18,345 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:33:18,346 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4036.896
2025-10-08 10:33:18,346 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:18,347 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:33:18,348 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:18,348 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:33:18,351 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:33:18,352 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4036.896
2025-10-08 10:33:18,352 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:18,353 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:33:18,354 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:18,355 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:33:18,355 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:18,381 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:18,382 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:33:18,382 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:33:18,383 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:33:18,384 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:33:18,385 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:33:18,385 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:33:18,388 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:33:18,388 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:33:18,388 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:33:18,408 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:33:18,409 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:33:18,411 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:33:18,411 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:33:18,412 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:33:18,412 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:33:18,412 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:33:18,413 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:18,413 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:18,413 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:33:18,414 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:33:18,414 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:33:18,416 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:33:18,417 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:33:18,422 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:33:18,439 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:18,442 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:33:18,443 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:33:18,443 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4036.896, 'ask': 4036.933, 'last': 0.0, 'time': 1759919597}
2025-10-08 10:33:18,446 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:33:18,449 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:33:18,469 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:33:18,470 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:33:18,470 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:18,471 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:18,471 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:18,472 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:18,472 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:18,473 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:33:18,474 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4036.896
2025-10-08 10:33:18,474 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 40898.00000000014}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96015.00000000032}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24346.000000000004}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42467.000000000095}]
2025-10-08 10:33:18,475 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:33:18,541 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:18,541 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:33:18,542 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:33:18,543 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:33:18,545 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:33:22,011 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:33:22,013 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:33:22,014 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:33:22,015 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:33:22,016 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:33:22,017 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:33:22,021 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:33:22,021 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:22,024 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:33:22,025 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:33:22,026 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:33:22,026 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:33:22,027 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:33:22,047 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:22,550 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:33:22,570 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:33:22,577 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:33:22,654 - APP.services.mt5_service - DEBUG - Current price (cp): 4036.944
2025-10-08 10:33:22,725 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 345, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:33:22,860 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 234, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:33:22,866 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:33:22,867 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:33:22,870 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:33:22,904 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:22,964 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:33:22,964 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:33:22,998 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:33:23,002 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:23,004 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:33:23,031 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:33:23,035 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:33:23,093 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:23,125 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:33:23,126 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:33:23,129 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:33:23,134 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:23,139 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:33:23,141 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:33:23,144 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:33:23,146 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:33:23,148 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:33:23,148 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:33:23,149 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:33:23,151 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:33:23,152 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:33:23.152718+07:00
2025-10-08 10:33:23,153 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:33:23.152718+07:00
2025-10-08 10:33:23,154 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:33:23.152718+07:00 trong DST: True
2025-10-08 10:33:23,156 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:33:23,157 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:33:23,158 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:33:23,159 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:33:23,178 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.750556149734
2025-10-08 10:33:23,203 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 113 rates.
2025-10-08 10:33:23,204 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.782765984275
2025-10-08 10:33:23,207 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.750556149734, 'asia': 4036.782765984275, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:33:23,208 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:33:23,209 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.857398285122
2025-10-08 10:33:23,211 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:33:23,212 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.3543557318794
2025-10-08 10:33:23,213 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:33:23,214 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.956842971664
2025-10-08 10:33:23,215 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:33:23,217 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.956384440213
2025-10-08 10:33:23,218 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:33:23,219 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.3003952731606
2025-10-08 10:33:23,221 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:33:23,222 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.2651980956102
2025-10-08 10:33:23,266 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:33:23,268 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.8041902227924
2025-10-08 10:33:23,269 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:33:23,272 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1230798857896
2025-10-08 10:33:23,273 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.857398285122, 'ema200': 4036.3543557318794}, 'M5': {'ema50': 4031.956842971664, 'ema200': 4009.956384440213}, 'M15': {'ema50': 4014.3003952731606, 'ema200': 3980.2651980956102}, 'H1': {'ema50': 3974.8041902227924, 'ema200': 3912.1230798857896}}
2025-10-08 10:33:23,275 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:33:23,276 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.1165046690705807, TRs count: 179
2025-10-08 10:33:23,280 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:33:23,282 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.437153813093882, TRs count: 119
2025-10-08 10:33:23,325 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:33:23,342 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:33:23,389 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:33:23,391 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:33:23,392 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.1165046690705807, 'M1': 1.437153813093882, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:33:23,394 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:33:23,394 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4036.944, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:33:23,395 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:33:23,396 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:33:23,397 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:33:23,398 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:33:23,399 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 40945.99999999991
2025-10-08 10:33:23,400 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 96063.0000000001
2025-10-08 10:33:23,400 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 24393.999999999778
2025-10-08 10:33:23,402 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 42514.99999999987
2025-10-08 10:33:23,403 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:33:23,404 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 40945.99999999991}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96063.0000000001}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24393.999999999778}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42514.99999999987}]
2025-10-08 10:33:23,405 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:33:23,406 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:33:23,407 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:33:23,425 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:33:23,449 - APP.services.mt5_service - DEBUG - Position in day range: 0.9354516244198503
2025-10-08 10:33:23,459 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:33:23,464 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:33:23.464569+07:00
2025-10-08 10:33:23,465 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:33:23.464569+07:00
2025-10-08 10:33:23,466 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:33:23.464569+07:00 trong DST: True
2025-10-08 10:33:23,467 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:33:23,470 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:33:23,470 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 207
2025-10-08 10:33:23,472 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:23,546 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:23,547 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '9400', 'price': 4036.94, 'distance_pips': 0.4}, {'level': '9425', 'price': 4036.943, 'distance_pips': 0.15}, {'level': '9450', 'price': 4036.945, 'distance_pips': 0.1}, {'level': '9475', 'price': 4036.948, 'distance_pips': 0.35}]
2025-10-08 10:33:23,550 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1872274849277302}
2025-10-08 10:33:23,552 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:23,555 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:23,556 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:33:23,558 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4036.944
2025-10-08 10:33:23,561 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:23,564 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:33:23,623 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:23,624 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:33:23,627 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:33:23,703 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4036.944
2025-10-08 10:33:23,704 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:23,705 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:33:23,707 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:23,710 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:33:23,710 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:33:23,711 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4036.944
2025-10-08 10:33:23,712 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:23,712 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:33:23,713 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:23,713 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:33:23,714 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:33:23,714 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4036.944
2025-10-08 10:33:23,715 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:23,715 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:33:23,716 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:23,717 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:33:23,717 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:23,718 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:23,718 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:33:23,718 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:33:23,719 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:33:23,719 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:33:23,719 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:33:23,720 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:33:23,720 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:33:23,721 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:33:23,721 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:33:23,721 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:33:23,722 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:33:23,723 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:33:23,724 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:33:23,724 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:33:23,725 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:33:23,725 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:33:23,726 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:23,751 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:23,752 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:33:23,752 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:33:23,752 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:33:23,753 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:33:23,754 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:33:23,797 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:33:23,799 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:23,800 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:33:23,800 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:33:23,801 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4036.944, 'ask': 4036.981, 'last': 0.0, 'time': 1759919601}
2025-10-08 10:33:23,803 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:33:23,804 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:33:23,804 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:33:23,805 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:33:23,806 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:23,806 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:23,807 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:23,807 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:23,807 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:23,808 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:33:23,808 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4036.944
2025-10-08 10:33:23,808 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 40945.99999999991}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96063.0000000001}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24393.999999999778}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42514.99999999987}]
2025-10-08 10:33:23,809 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:33:23,853 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:23,862 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:33:23,864 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:33:23,865 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:33:23,867 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:33:25,156 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:33:25,173 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:33:27,015 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:33:27,017 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:33:27,018 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:33:27,018 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:33:27,020 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:33:27,021 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:33:27,024 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:33:27,025 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:27,051 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:33:27,051 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:33:27,052 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:33:27,053 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:33:27,053 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:33:27,150 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:27,556 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:33:27,559 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:33:27,560 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:33:27,564 - APP.services.mt5_service - DEBUG - Current price (cp): 4036.515
2025-10-08 10:33:27,579 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 348, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:33:27,644 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 234, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:33:27,655 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:33:27,657 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:33:27,659 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:33:27,660 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:27,663 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:33:27,665 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:33:27,668 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:33:27,670 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:27,671 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:33:27,673 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:33:27,677 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:33:27,678 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:27,679 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:33:27,681 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:33:27,683 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:33:27,684 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:27,685 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:33:27,687 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:33:27,690 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:33:27,715 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:33:27,720 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:33:27,720 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:33:27,721 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:33:27,721 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:33:27,722 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:33:27.722105+07:00
2025-10-08 10:33:27,723 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:33:27.722105+07:00
2025-10-08 10:33:27,731 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:33:27.722105+07:00 trong DST: True
2025-10-08 10:33:27,747 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:33:27,748 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:33:27,749 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:33:27,750 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:33:27,751 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.750556149734
2025-10-08 10:33:27,752 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 113 rates.
2025-10-08 10:33:27,752 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.782765984275
2025-10-08 10:33:27,756 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.750556149734, 'asia': 4036.782765984275, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:33:27,782 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:33:27,784 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.857398285122
2025-10-08 10:33:27,809 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:33:27,810 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.3543557318794
2025-10-08 10:33:27,810 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:33:27,811 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.956842971664
2025-10-08 10:33:27,811 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:33:27,811 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.956384440213
2025-10-08 10:33:27,812 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:33:27,812 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.3003952731606
2025-10-08 10:33:27,813 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:33:27,813 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.2651980956102
2025-10-08 10:33:27,814 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:33:27,815 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.8041902227924
2025-10-08 10:33:27,815 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:33:27,837 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1230798857896
2025-10-08 10:33:27,843 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.857398285122, 'ema200': 4036.3543557318794}, 'M5': {'ema50': 4031.956842971664, 'ema200': 4009.956384440213}, 'M15': {'ema50': 4014.3003952731606, 'ema200': 3980.2651980956102}, 'H1': {'ema50': 3974.8041902227924, 'ema200': 3912.1230798857896}}
2025-10-08 10:33:27,845 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:33:27,846 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.1165046690705807, TRs count: 179
2025-10-08 10:33:27,846 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:33:27,876 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.437153813093882, TRs count: 119
2025-10-08 10:33:27,876 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:33:27,877 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:33:27,877 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:33:27,878 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:33:27,878 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.1165046690705807, 'M1': 1.437153813093882, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:33:27,879 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:33:27,879 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4036.515, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:33:27,882 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:33:27,883 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:33:27,883 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:33:27,918 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:33:27,918 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 40516.999999999825
2025-10-08 10:33:27,919 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 95634.00000000001
2025-10-08 10:33:27,919 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 23964.99999999969
2025-10-08 10:33:27,919 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 42085.99999999978
2025-10-08 10:33:27,920 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:33:27,920 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 40516.999999999825}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 95634.00000000001}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 23964.99999999969}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42085.99999999978}]
2025-10-08 10:33:27,921 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:33:27,921 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:33:27,922 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:33:27,924 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:33:27,925 - APP.services.mt5_service - DEBUG - Position in day range: 0.9277936451267391
2025-10-08 10:33:27,925 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:33:27,926 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:33:27.926228+07:00
2025-10-08 10:33:27,926 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:33:27.926228+07:00
2025-10-08 10:33:27,927 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:33:27.926228+07:00 trong DST: True
2025-10-08 10:33:27,927 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:33:27,927 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:33:27,928 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 207
2025-10-08 10:33:27,928 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:27,928 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:27,929 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '5100', 'price': 4036.51, 'distance_pips': 0.5}, {'level': '5125', 'price': 4036.513, 'distance_pips': 0.25}, {'level': '5150', 'price': 4036.515, 'distance_pips': 0.0}, {'level': '5175', 'price': 4036.518, 'distance_pips': 0.25}]
2025-10-08 10:33:27,930 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1872274849277302}
2025-10-08 10:33:27,930 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:27,930 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:27,931 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:33:27,931 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4036.515
2025-10-08 10:33:27,932 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:27,932 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:33:27,933 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:27,934 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:33:27,934 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:33:27,935 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4036.515
2025-10-08 10:33:27,935 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:27,936 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:33:27,937 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:27,937 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:33:27,937 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:33:27,938 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4036.515
2025-10-08 10:33:27,938 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:27,939 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:33:27,940 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:27,940 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:33:27,941 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:33:27,941 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4036.515
2025-10-08 10:33:27,943 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:27,944 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:33:27,945 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:27,945 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:33:27,970 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:27,971 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:27,971 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:33:27,972 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:33:27,972 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:33:27,973 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:33:28,011 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:33:28,012 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:33:28,012 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:33:28,012 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:33:28,013 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:33:28,013 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:33:28,013 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:33:28,014 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:33:28,014 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:33:28,014 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:33:28,016 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:33:28,016 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:33:28,019 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:28,019 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:28,020 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:33:28,020 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:33:28,020 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:33:28,021 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:33:28,021 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:33:28,022 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:33:28,023 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:28,024 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:33:28,024 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4036.515, 'ask': 4036.552, 'last': 0.0, 'time': 1759919607}
2025-10-08 10:33:28,024 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:33:28,025 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:33:28,027 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:33:28,028 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:33:28,028 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:33:28,028 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:28,029 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:28,029 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:28,030 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:28,030 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:28,031 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:33:28,031 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4036.515
2025-10-08 10:33:28,032 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 40516.999999999825}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 95634.00000000001}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 23964.99999999969}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42085.99999999978}]
2025-10-08 10:33:28,032 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:33:28,111 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:28,111 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:33:28,112 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:33:28,113 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:33:28,114 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:33:32,019 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:33:32,021 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:33:32,021 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:33:32,022 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:33:32,024 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:33:32,024 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:33:32,027 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:33:32,028 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:32,051 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:33:32,052 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:33:32,053 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:33:32,053 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:33:32,054 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:33:32,115 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:32,555 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:33:32,557 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:33:32,558 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:33:32,558 - APP.services.mt5_service - DEBUG - Current price (cp): 4036.513
2025-10-08 10:33:32,564 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 351, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:33:32,596 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 234, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:33:32,597 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:33:32,598 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:33:32,601 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:33:32,601 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:32,601 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:33:32,602 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:33:32,622 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:33:32,623 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:32,623 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:33:32,624 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:33:32,625 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:33:32,626 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:32,626 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:33:32,627 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:33:32,629 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:33:32,631 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:32,631 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:33:32,632 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:33:32,637 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:33:32,653 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:33:32,654 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:33:32,654 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:33:32,655 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:33:32,655 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:33:32,656 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:33:32.655991+07:00
2025-10-08 10:33:32,656 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:33:32.655991+07:00
2025-10-08 10:33:32,656 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:33:32.655991+07:00 trong DST: True
2025-10-08 10:33:32,657 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:33:32,657 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:33:32,657 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:33:32,659 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:33:32,659 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.750556149734
2025-10-08 10:33:32,661 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 113 rates.
2025-10-08 10:33:32,683 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.782765984275
2025-10-08 10:33:32,688 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.750556149734, 'asia': 4036.782765984275, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:33:32,689 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:33:32,690 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.857398285122
2025-10-08 10:33:32,690 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:33:32,690 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.3543557318794
2025-10-08 10:33:32,691 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:33:32,692 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.956842971664
2025-10-08 10:33:32,692 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:33:32,693 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.956384440213
2025-10-08 10:33:32,694 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:33:32,714 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.3003952731606
2025-10-08 10:33:32,714 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:33:32,715 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.2651980956102
2025-10-08 10:33:32,715 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:33:32,716 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.8041902227924
2025-10-08 10:33:32,716 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:33:32,716 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1230798857896
2025-10-08 10:33:32,717 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.857398285122, 'ema200': 4036.3543557318794}, 'M5': {'ema50': 4031.956842971664, 'ema200': 4009.956384440213}, 'M15': {'ema50': 4014.3003952731606, 'ema200': 3980.2651980956102}, 'H1': {'ema50': 3974.8041902227924, 'ema200': 3912.1230798857896}}
2025-10-08 10:33:32,717 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:33:32,718 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.1165046690705807, TRs count: 179
2025-10-08 10:33:32,718 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:33:32,719 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.437153813093882, TRs count: 119
2025-10-08 10:33:32,719 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:33:32,720 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:33:32,721 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:33:32,722 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:33:32,722 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.1165046690705807, 'M1': 1.437153813093882, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:33:32,722 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:33:32,725 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4036.513, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:33:32,726 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:33:32,749 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:33:32,749 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:33:32,750 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:33:32,750 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 40514.99999999987
2025-10-08 10:33:32,751 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 95632.00000000006
2025-10-08 10:33:32,751 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 23962.999999999738
2025-10-08 10:33:32,752 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 42083.99999999983
2025-10-08 10:33:32,752 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:33:32,752 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 40514.99999999987}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 95632.00000000006}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 23962.999999999738}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42083.99999999983}]
2025-10-08 10:33:32,753 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:33:32,754 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:33:32,754 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:33:32,756 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:33:32,757 - APP.services.mt5_service - DEBUG - Position in day range: 0.9277579435915739
2025-10-08 10:33:32,757 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:33:32,757 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:33:32.757614+07:00
2025-10-08 10:33:32,777 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:33:32.757614+07:00
2025-10-08 10:33:32,779 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:33:32.757614+07:00 trong DST: True
2025-10-08 10:33:32,780 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:33:32,781 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:33:32,782 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 207
2025-10-08 10:33:32,783 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:32,783 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:32,784 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '5100', 'price': 4036.51, 'distance_pips': 0.3}, {'level': '5125', 'price': 4036.513, 'distance_pips': 0.05}, {'level': '5150', 'price': 4036.515, 'distance_pips': 0.2}, {'level': '5175', 'price': 4036.518, 'distance_pips': 0.45}]
2025-10-08 10:33:32,784 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1872274849277302}
2025-10-08 10:33:32,785 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:32,787 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:32,788 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:33:32,796 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4036.513
2025-10-08 10:33:32,806 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:32,808 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:33:32,809 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:32,809 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:33:32,810 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:33:32,810 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4036.513
2025-10-08 10:33:32,811 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:32,811 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:33:32,812 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:32,813 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:33:32,813 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:33:32,814 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4036.513
2025-10-08 10:33:32,815 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:32,815 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:33:32,817 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:32,828 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:33:32,844 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:33:32,846 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4036.513
2025-10-08 10:33:32,847 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:32,848 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:33:32,849 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:32,849 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:33:32,850 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:32,850 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:32,851 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:33:32,867 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:33:32,873 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:33:32,877 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:33:32,877 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:33:32,878 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:33:32,879 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:33:32,881 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:33:32,882 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:33:32,882 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:33:32,885 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:33:32,899 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:33:32,903 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:33:32,904 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:33:32,904 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:33:32,906 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:33:32,906 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:32,907 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:32,908 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:33:32,908 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:33:32,909 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:33:32,909 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:33:32,913 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:33:32,941 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:33:32,944 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:32,946 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:33:32,946 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:33:32,947 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4036.513, 'ask': 4036.55, 'last': 0.0, 'time': 1759919612}
2025-10-08 10:33:32,967 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:33:32,967 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:33:32,968 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:33:32,969 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:33:32,969 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:32,970 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:32,970 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:32,971 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:32,971 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:32,971 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:33:32,972 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4036.513
2025-10-08 10:33:32,972 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 40514.99999999987}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 95632.00000000006}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 23962.999999999738}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42083.99999999983}]
2025-10-08 10:33:32,973 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:33:33,040 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:33,040 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:33:33,041 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:33:33,042 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:33:33,043 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:33:37,023 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:33:37,025 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:33:37,025 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:33:37,026 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:33:37,027 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:33:37,028 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:33:37,031 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:33:37,032 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:37,053 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:37,429 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:33:37,430 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:33:37,431 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:33:37,431 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:33:37,432 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:33:37,933 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:33:37,934 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:33:37,935 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:33:37,935 - APP.services.mt5_service - DEBUG - Current price (cp): 4037.681
2025-10-08 10:33:37,941 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 354, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:33:37,974 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 235, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:33:37,974 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:33:37,976 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:33:37,981 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:33:37,994 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:37,995 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:33:37,996 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:33:37,999 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:33:37,999 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:37,999 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:33:38,000 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:33:38,002 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:33:38,003 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:38,003 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:33:38,004 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:33:38,007 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:33:38,029 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:38,029 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:33:38,030 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:33:38,032 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:33:38,033 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:33:38,033 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:33:38,034 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:33:38,034 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:33:38,034 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:33:38,035 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:33:38.035386+07:00
2025-10-08 10:33:38,035 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:33:38.035386+07:00
2025-10-08 10:33:38,036 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:33:38.035386+07:00 trong DST: True
2025-10-08 10:33:38,044 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:33:38,058 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:33:38,061 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:33:38,063 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:33:38,064 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.750556149734
2025-10-08 10:33:38,065 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 113 rates.
2025-10-08 10:33:38,065 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.782765984275
2025-10-08 10:33:38,070 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.750556149734, 'asia': 4036.782765984275, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:33:38,090 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:33:38,091 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.857398285122
2025-10-08 10:33:38,091 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:33:38,092 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.3543557318794
2025-10-08 10:33:38,092 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:33:38,093 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.956842971664
2025-10-08 10:33:38,093 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:33:38,094 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.956384440213
2025-10-08 10:33:38,094 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:33:38,094 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.3003952731606
2025-10-08 10:33:38,095 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:33:38,095 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.2651980956102
2025-10-08 10:33:38,096 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:33:38,097 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.8041902227924
2025-10-08 10:33:38,098 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:33:38,098 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1230798857896
2025-10-08 10:33:38,099 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.857398285122, 'ema200': 4036.3543557318794}, 'M5': {'ema50': 4031.956842971664, 'ema200': 4009.956384440213}, 'M15': {'ema50': 4014.3003952731606, 'ema200': 3980.2651980956102}, 'H1': {'ema50': 3974.8041902227924, 'ema200': 3912.1230798857896}}
2025-10-08 10:33:38,101 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:33:38,124 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.1165046690705807, TRs count: 179
2025-10-08 10:33:38,125 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:33:38,126 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.437153813093882, TRs count: 119
2025-10-08 10:33:38,126 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:33:38,127 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:33:38,127 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:33:38,128 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:33:38,128 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.1165046690705807, 'M1': 1.437153813093882, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:33:38,129 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:33:38,129 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4037.681, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:33:38,130 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:33:38,157 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:33:38,158 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:33:38,158 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:33:38,159 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 41682.99999999999
2025-10-08 10:33:38,159 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 96800.00000000017
2025-10-08 10:33:38,160 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 25130.999999999858
2025-10-08 10:33:38,160 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 43251.99999999995
2025-10-08 10:33:38,161 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:33:38,185 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41682.99999999999}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96800.00000000017}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25130.999999999858}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43251.99999999995}]
2025-10-08 10:33:38,185 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:33:38,187 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:33:38,187 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:33:38,187 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:33:38,188 - APP.services.mt5_service - DEBUG - Position in day range: 0.9486076401285272
2025-10-08 10:33:38,188 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:33:38,189 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:33:38.188955+07:00
2025-10-08 10:33:38,189 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:33:38.188955+07:00
2025-10-08 10:33:38,189 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:33:38.188955+07:00 trong DST: True
2025-10-08 10:33:38,189 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:33:38,190 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:33:38,190 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 207
2025-10-08 10:33:38,191 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:38,191 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:38,191 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '6800', 'price': 4037.68, 'distance_pips': 0.1}, {'level': '6825', 'price': 4037.683, 'distance_pips': 0.15}, {'level': '6850', 'price': 4037.685, 'distance_pips': 0.4}, {'level': '6875', 'price': 4037.688, 'distance_pips': 0.65}]
2025-10-08 10:33:38,194 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1872274849131386}
2025-10-08 10:33:38,215 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:38,217 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:38,217 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:33:38,218 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.681
2025-10-08 10:33:38,219 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:38,219 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:33:38,220 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:38,220 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:33:38,221 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:33:38,222 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4037.681
2025-10-08 10:33:38,222 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:38,223 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:33:38,251 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:38,251 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:33:38,252 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:33:38,253 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4037.681
2025-10-08 10:33:38,253 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:38,254 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:33:38,272 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:38,284 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:33:38,285 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:33:38,285 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.681
2025-10-08 10:33:38,286 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:38,287 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:33:38,296 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:38,314 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:33:38,315 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:38,315 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:38,316 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:33:38,316 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:33:38,317 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:33:38,342 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:33:38,344 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:33:38,345 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:33:38,346 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:33:38,347 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:33:38,348 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:33:38,374 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:33:38,375 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:33:38,376 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:33:38,376 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:33:38,377 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:33:38,377 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:33:38,378 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:33:38,378 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:38,379 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:38,379 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:33:38,380 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:33:38,380 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:33:38,407 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:33:38,409 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:33:38,410 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:33:38,412 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:38,435 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:33:38,435 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:33:38,436 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4037.681, 'ask': 4037.718, 'last': 0.0, 'time': 1759919617}
2025-10-08 10:33:38,438 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:33:38,439 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:33:38,439 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:33:38,440 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:33:38,440 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:38,441 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:38,441 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:38,445 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:38,465 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:38,466 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:33:38,466 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4037.681
2025-10-08 10:33:38,467 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41682.99999999999}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96800.00000000017}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25130.999999999858}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43251.99999999995}]
2025-10-08 10:33:38,467 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:33:38,508 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:38,531 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:33:38,531 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:33:38,533 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:33:38,534 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:33:40,157 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:33:40,242 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:33:42,027 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:33:42,029 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:33:42,029 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:33:42,030 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:33:42,031 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:33:42,032 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:33:42,035 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:33:42,056 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:42,058 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:33:42,059 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:33:42,060 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:33:42,060 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:33:42,061 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:33:42,155 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:42,562 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:33:42,563 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:33:42,564 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:33:42,564 - APP.services.mt5_service - DEBUG - Current price (cp): 4037.728
2025-10-08 10:33:42,571 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 355, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:33:42,603 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 235, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:33:42,604 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:33:42,604 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:33:42,608 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:33:42,608 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:42,609 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:33:42,609 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:33:42,613 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:33:42,613 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:42,613 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:33:42,614 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:33:42,615 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:33:42,616 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:42,616 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:33:42,617 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:33:42,619 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:33:42,619 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:42,619 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:33:42,620 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:33:42,622 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:33:42,623 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:33:42,623 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:33:42,623 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:33:42,624 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:33:42,624 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:33:42,624 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:33:42.624816+07:00
2025-10-08 10:33:42,625 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:33:42.624816+07:00
2025-10-08 10:33:42,625 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:33:42.624816+07:00 trong DST: True
2025-10-08 10:33:42,626 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:33:42,626 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:33:42,626 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:33:42,627 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:33:42,628 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.750556149734
2025-10-08 10:33:42,628 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 113 rates.
2025-10-08 10:33:42,629 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.782765984275
2025-10-08 10:33:42,636 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.750556149734, 'asia': 4036.782765984275, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:33:42,653 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:33:42,654 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.857398285122
2025-10-08 10:33:42,655 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:33:42,655 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.3543557318794
2025-10-08 10:33:42,655 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:33:42,656 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.956842971664
2025-10-08 10:33:42,656 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:33:42,657 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.956384440213
2025-10-08 10:33:42,657 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:33:42,658 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.3003952731606
2025-10-08 10:33:42,658 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:33:42,659 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.2651980956102
2025-10-08 10:33:42,659 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:33:42,660 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.8041902227924
2025-10-08 10:33:42,660 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:33:42,660 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1230798857896
2025-10-08 10:33:42,661 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.857398285122, 'ema200': 4036.3543557318794}, 'M5': {'ema50': 4031.956842971664, 'ema200': 4009.956384440213}, 'M15': {'ema50': 4014.3003952731606, 'ema200': 3980.2651980956102}, 'H1': {'ema50': 3974.8041902227924, 'ema200': 3912.1230798857896}}
2025-10-08 10:33:42,661 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:33:42,662 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.1165046690705807, TRs count: 179
2025-10-08 10:33:42,672 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:33:42,687 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.437153813093882, TRs count: 119
2025-10-08 10:33:42,687 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:33:42,688 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:33:42,688 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:33:42,689 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:33:42,689 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.1165046690705807, 'M1': 1.437153813093882, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:33:42,690 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:33:42,690 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4037.728, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:33:42,691 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:33:42,691 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:33:42,691 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:33:42,692 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:33:42,718 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 41730.000000000015
2025-10-08 10:33:42,720 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 96847.0000000002
2025-10-08 10:33:42,721 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 25177.999999999884
2025-10-08 10:33:42,722 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 43298.99999999998
2025-10-08 10:33:42,722 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:33:42,722 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41730.000000000015}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96847.0000000002}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25177.999999999884}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43298.99999999998}]
2025-10-08 10:33:42,723 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:33:42,724 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:33:42,743 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:33:42,744 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:33:42,745 - APP.services.mt5_service - DEBUG - Position in day range: 0.9494466262049289
2025-10-08 10:33:42,745 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:33:42,745 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:33:42.745782+07:00
2025-10-08 10:33:42,746 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:33:42.745782+07:00
2025-10-08 10:33:42,746 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:33:42.745782+07:00 trong DST: True
2025-10-08 10:33:42,747 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:33:42,747 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:33:42,747 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 207
2025-10-08 10:33:42,748 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:42,748 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:42,749 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '7200', 'price': 4037.72, 'distance_pips': 0.8}, {'level': '7225', 'price': 4037.723, 'distance_pips': 0.55}, {'level': '7250', 'price': 4037.725, 'distance_pips': 0.3}, {'level': '7275', 'price': 4037.728, 'distance_pips': 0.05}]
2025-10-08 10:33:42,749 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1872274849131386}
2025-10-08 10:33:42,750 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:42,750 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:42,751 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:33:42,752 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.728
2025-10-08 10:33:42,753 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:42,753 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:33:42,754 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:42,755 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:33:42,757 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:33:42,778 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4037.728
2025-10-08 10:33:42,780 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:42,781 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:33:42,782 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:42,782 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:33:42,782 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:33:42,783 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4037.728
2025-10-08 10:33:42,784 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:42,784 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:33:42,785 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:42,785 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:33:42,785 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:33:42,789 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.728
2025-10-08 10:33:42,812 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:42,814 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:33:42,816 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:42,817 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:33:42,821 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:42,846 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:42,847 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:33:42,848 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:33:42,849 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:33:42,875 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:33:42,875 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:33:42,876 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:33:42,877 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:33:42,877 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:33:42,877 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:33:42,878 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:33:42,878 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:33:42,879 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:33:42,879 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:33:42,879 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:33:42,880 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:33:42,880 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:33:42,896 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:42,904 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:42,905 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:33:42,905 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:33:42,906 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:33:42,906 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:33:42,907 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:33:42,908 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:33:42,909 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:42,911 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:33:42,911 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:33:42,915 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4037.728, 'ask': 4037.765, 'last': 0.0, 'time': 1759919621}
2025-10-08 10:33:42,937 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:33:42,938 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:33:42,939 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:33:42,939 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:33:42,940 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:42,940 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:42,941 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:42,941 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:42,941 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:42,942 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:33:42,943 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4037.728
2025-10-08 10:33:42,946 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41730.000000000015}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96847.0000000002}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25177.999999999884}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43298.99999999998}]
2025-10-08 10:33:42,966 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:33:42,974 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:42,977 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:33:42,999 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:33:43,001 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:33:43,002 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:33:47,031 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:33:47,034 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:33:47,034 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:33:47,034 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:33:47,037 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:33:47,037 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:33:47,041 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:33:47,042 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:47,065 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:33:47,065 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:33:47,067 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:33:47,067 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:33:47,068 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:33:47,121 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:47,578 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:33:47,581 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:33:47,583 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:33:47,584 - APP.services.mt5_service - DEBUG - Current price (cp): 4037.517
2025-10-08 10:33:47,596 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 358, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:33:47,659 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 235, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:33:47,666 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:33:47,671 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:33:47,674 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:33:47,676 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:47,677 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:33:47,679 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:33:47,684 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:33:47,686 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:47,688 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:33:47,691 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:33:47,695 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:33:47,721 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:47,723 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:33:47,759 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:33:47,768 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:33:47,769 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:47,775 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:33:47,776 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:33:47,780 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:33:47,780 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:33:47,782 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:33:47,784 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:33:47,812 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:33:47,816 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:33:47,855 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:33:47.854943+07:00
2025-10-08 10:33:47,857 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:33:47.854943+07:00
2025-10-08 10:33:47,859 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:33:47.854943+07:00 trong DST: True
2025-10-08 10:33:47,861 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:33:47,863 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:33:47,863 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:33:47,866 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:33:47,867 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.750556149734
2025-10-08 10:33:47,871 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 113 rates.
2025-10-08 10:33:47,872 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.782765984275
2025-10-08 10:33:47,876 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.750556149734, 'asia': 4036.782765984275, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:33:47,876 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:33:47,877 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.857398285122
2025-10-08 10:33:47,878 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:33:47,879 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.3543557318794
2025-10-08 10:33:47,924 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:33:47,924 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.956842971664
2025-10-08 10:33:47,925 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:33:47,925 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.956384440213
2025-10-08 10:33:47,926 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:33:47,927 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.3003952731606
2025-10-08 10:33:47,927 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:33:47,928 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.2651980956102
2025-10-08 10:33:47,928 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:33:47,929 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.8041902227924
2025-10-08 10:33:47,930 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:33:47,931 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1230798857896
2025-10-08 10:33:47,931 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.857398285122, 'ema200': 4036.3543557318794}, 'M5': {'ema50': 4031.956842971664, 'ema200': 4009.956384440213}, 'M15': {'ema50': 4014.3003952731606, 'ema200': 3980.2651980956102}, 'H1': {'ema50': 3974.8041902227924, 'ema200': 3912.1230798857896}}
2025-10-08 10:33:47,932 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:33:47,932 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.1165046690705807, TRs count: 179
2025-10-08 10:33:47,933 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:33:47,934 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.437153813093882, TRs count: 119
2025-10-08 10:33:47,934 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:33:47,935 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:33:47,935 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:33:47,936 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:33:47,936 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.1165046690705807, 'M1': 1.437153813093882, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:33:47,937 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:33:47,937 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4037.517, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:33:47,938 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:33:47,939 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:33:47,940 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:33:47,940 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:33:47,941 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 41518.999999999774
2025-10-08 10:33:47,944 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 96635.99999999997
2025-10-08 10:33:47,973 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 24966.999999999643
2025-10-08 10:33:47,978 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 43087.99999999974
2025-10-08 10:33:47,978 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:33:47,979 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41518.999999999774}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96635.99999999997}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24966.999999999643}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43087.99999999974}]
2025-10-08 10:33:47,980 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:33:47,980 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:33:47,981 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:33:47,981 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:33:47,982 - APP.services.mt5_service - DEBUG - Position in day range: 0.9456801142449104
2025-10-08 10:33:47,982 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:33:47,982 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:33:47.982718+07:00
2025-10-08 10:33:47,983 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:33:47.982718+07:00
2025-10-08 10:33:47,983 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:33:47.982718+07:00 trong DST: True
2025-10-08 10:33:47,984 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:33:47,985 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:33:47,985 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 207
2025-10-08 10:33:47,986 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:47,986 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:47,986 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '5100', 'price': 4037.51, 'distance_pips': 0.7}, {'level': '5125', 'price': 4037.513, 'distance_pips': 0.45}, {'level': '5150', 'price': 4037.515, 'distance_pips': 0.2}, {'level': '5175', 'price': 4037.518, 'distance_pips': 0.05}]
2025-10-08 10:33:47,987 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1872274849277302}
2025-10-08 10:33:47,987 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:47,988 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:47,988 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:33:47,989 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.517
2025-10-08 10:33:47,989 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:47,990 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:33:47,991 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:47,991 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:33:47,992 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:33:47,992 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4037.517
2025-10-08 10:33:47,993 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:47,993 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:33:47,994 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:47,995 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:33:47,995 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:33:47,996 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4037.517
2025-10-08 10:33:47,997 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:47,997 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:33:47,998 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:47,998 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:33:47,998 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:33:47,999 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.517
2025-10-08 10:33:47,999 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:48,000 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:33:48,001 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:48,002 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:33:48,002 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:48,003 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:48,003 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:33:48,003 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:33:48,004 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:33:48,004 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:33:48,004 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:33:48,005 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:33:48,005 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:33:48,006 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:33:48,008 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:33:48,009 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:33:48,017 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:33:48,019 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:33:48,023 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:33:48,032 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:33:48,037 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:33:48,039 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:33:48,040 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:48,041 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:48,041 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:33:48,042 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:33:48,042 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:33:48,043 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:33:48,044 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:33:48,045 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:33:48,046 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:48,048 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:33:48,048 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4037.517, 'ask': 4037.554, 'last': 0.0, 'time': 1759919627}
2025-10-08 10:33:48,048 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:33:48,049 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:33:48,051 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:33:48,052 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:33:48,052 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:33:48,053 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:48,054 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:48,054 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:48,055 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:48,055 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:48,055 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:33:48,056 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4037.517
2025-10-08 10:33:48,056 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41518.999999999774}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96635.99999999997}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24966.999999999643}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43087.99999999974}]
2025-10-08 10:33:48,057 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:33:48,143 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:48,163 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:33:48,165 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:33:48,168 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:33:48,169 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:33:52,036 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:33:52,038 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:33:52,038 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:33:52,039 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:33:52,041 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:33:52,041 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:33:52,044 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:33:52,044 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:52,055 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:33:52,064 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:33:52,066 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:33:52,066 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:33:52,067 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:33:52,141 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:52,568 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:33:52,569 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:33:52,570 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:33:52,571 - APP.services.mt5_service - DEBUG - Current price (cp): 4037.021
2025-10-08 10:33:52,576 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 362, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:33:52,608 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 235, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:33:52,608 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:33:52,609 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:33:52,611 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:33:52,612 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:52,612 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:33:52,613 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:33:52,615 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:33:52,616 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:52,616 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:33:52,617 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:33:52,618 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:33:52,619 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:52,619 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:33:52,619 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:33:52,622 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:33:52,622 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:52,623 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:33:52,623 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:33:52,625 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:33:52,626 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:33:52,626 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:33:52,627 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:33:52,627 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:33:52,627 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:33:52,628 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:33:52.628420+07:00
2025-10-08 10:33:52,629 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:33:52.628420+07:00
2025-10-08 10:33:52,629 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:33:52.628420+07:00 trong DST: True
2025-10-08 10:33:52,630 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:33:52,630 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:33:52,630 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:33:52,633 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:33:52,633 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.750556149734
2025-10-08 10:33:52,654 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 113 rates.
2025-10-08 10:33:52,655 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.782765984275
2025-10-08 10:33:52,657 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.750556149734, 'asia': 4036.782765984275, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:33:52,658 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:33:52,658 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.857398285122
2025-10-08 10:33:52,659 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:33:52,659 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.3543557318794
2025-10-08 10:33:52,660 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:33:52,660 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.956842971664
2025-10-08 10:33:52,661 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:33:52,661 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.956384440213
2025-10-08 10:33:52,662 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:33:52,663 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.3003952731606
2025-10-08 10:33:52,663 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:33:52,664 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.2651980956102
2025-10-08 10:33:52,664 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:33:52,665 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.8041902227924
2025-10-08 10:33:52,686 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:33:52,689 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1230798857896
2025-10-08 10:33:52,689 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.857398285122, 'ema200': 4036.3543557318794}, 'M5': {'ema50': 4031.956842971664, 'ema200': 4009.956384440213}, 'M15': {'ema50': 4014.3003952731606, 'ema200': 3980.2651980956102}, 'H1': {'ema50': 3974.8041902227924, 'ema200': 3912.1230798857896}}
2025-10-08 10:33:52,690 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:33:52,690 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.1165046690705807, TRs count: 179
2025-10-08 10:33:52,691 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:33:52,691 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.437153813093882, TRs count: 119
2025-10-08 10:33:52,692 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:33:52,692 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:33:52,692 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:33:52,693 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:33:52,693 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.1165046690705807, 'M1': 1.437153813093882, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:33:52,696 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:33:52,696 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4037.021, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:33:52,717 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:33:52,718 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:33:52,718 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:33:52,719 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:33:52,719 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 41023.00000000014
2025-10-08 10:33:52,720 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 96140.00000000032
2025-10-08 10:33:52,721 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 24471.000000000004
2025-10-08 10:33:52,721 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 42592.000000000095
2025-10-08 10:33:52,722 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:33:52,722 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41023.00000000014}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96140.00000000032}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24471.000000000004}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42592.000000000095}]
2025-10-08 10:33:52,722 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:33:52,723 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:33:52,723 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:33:52,724 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:33:52,726 - APP.services.mt5_service - DEBUG - Position in day range: 0.9368261335237458
2025-10-08 10:33:52,727 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:33:52,732 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:33:52.732603+07:00
2025-10-08 10:33:52,746 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:33:52.732603+07:00
2025-10-08 10:33:52,747 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:33:52.732603+07:00 trong DST: True
2025-10-08 10:33:52,748 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:33:52,749 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:33:52,749 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 207
2025-10-08 10:33:52,750 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:52,750 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:52,751 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '200', 'price': 4037.02, 'distance_pips': 0.1}, {'level': '225', 'price': 4037.023, 'distance_pips': 0.15}, {'level': '250', 'price': 4037.025, 'distance_pips': 0.4}, {'level': '275', 'price': 4037.028, 'distance_pips': 0.65}]
2025-10-08 10:33:52,751 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1872274849131386}
2025-10-08 10:33:52,752 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:52,752 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:52,752 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:33:52,753 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.021
2025-10-08 10:33:52,753 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:52,754 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:33:52,755 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:52,758 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:33:52,778 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:33:52,779 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4037.021
2025-10-08 10:33:52,780 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:52,780 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:33:52,781 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:52,782 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:33:52,782 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:33:52,783 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4037.021
2025-10-08 10:33:52,784 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:52,784 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:33:52,785 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:52,785 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:33:52,786 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:33:52,786 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.021
2025-10-08 10:33:52,787 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:52,789 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:33:52,790 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:52,814 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:33:52,815 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:52,816 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:52,816 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:33:52,817 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:33:52,846 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:33:52,847 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:33:52,848 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:33:52,848 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:33:52,851 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:33:52,875 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:33:52,876 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:33:52,877 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:33:52,877 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:33:52,878 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:33:52,878 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:33:52,879 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:33:52,880 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:33:52,911 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:33:52,912 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:52,940 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:52,941 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:33:52,942 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:33:52,942 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:33:52,942 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:33:52,943 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:33:52,947 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:33:52,968 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:52,969 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:33:52,969 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:33:52,970 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4037.021, 'ask': 4037.058, 'last': 0.0, 'time': 1759919632}
2025-10-08 10:33:52,973 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:33:52,973 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:33:52,974 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:33:52,974 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:33:52,976 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:52,976 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:52,977 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:52,977 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:52,977 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:52,997 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:33:52,998 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4037.021
2025-10-08 10:33:52,999 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41023.00000000014}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96140.00000000032}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24471.000000000004}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42592.000000000095}]
2025-10-08 10:33:52,999 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:33:53,016 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:53,031 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:33:53,032 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:33:53,035 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:33:53,037 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:33:55,159 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:33:55,243 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:33:57,040 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:33:57,042 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:33:57,042 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:33:57,043 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:33:57,044 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:33:57,045 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:33:57,048 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:33:57,048 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:57,089 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:33:57,089 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:33:57,090 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:33:57,090 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:33:57,091 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:33:57,150 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:57,592 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:33:57,594 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:33:57,594 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:33:57,595 - APP.services.mt5_service - DEBUG - Current price (cp): 4037.179
2025-10-08 10:33:57,600 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 360, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:33:57,630 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 235, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:33:57,631 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:33:57,631 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:33:57,635 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:33:57,654 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:57,655 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:33:57,656 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:33:57,659 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:33:57,659 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:57,659 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:33:57,660 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:33:57,662 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:33:57,662 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:57,662 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:33:57,663 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:33:57,666 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:33:57,666 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:33:57,687 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:33:57,688 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:33:57,691 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:33:57,691 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:33:57,692 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:33:57,692 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:33:57,693 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:33:57,693 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:33:57,694 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:33:57.694117+07:00
2025-10-08 10:33:57,694 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:33:57.694117+07:00
2025-10-08 10:33:57,694 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:33:57.694117+07:00 trong DST: True
2025-10-08 10:33:57,695 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:33:57,695 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:33:57,696 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:33:57,699 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:33:57,715 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.750556149734
2025-10-08 10:33:57,719 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 113 rates.
2025-10-08 10:33:57,720 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.782765984275
2025-10-08 10:33:57,731 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.750556149734, 'asia': 4036.782765984275, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:33:57,758 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:33:57,759 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.857398285122
2025-10-08 10:33:57,787 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:33:57,825 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.3543557318794
2025-10-08 10:33:57,876 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:33:57,877 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.956842971664
2025-10-08 10:33:57,919 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:33:57,925 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.956384440213
2025-10-08 10:33:57,929 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:33:57,932 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.3003952731606
2025-10-08 10:33:57,933 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:33:57,936 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.2651980956102
2025-10-08 10:33:57,938 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:33:57,940 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.8041902227924
2025-10-08 10:33:57,941 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:33:57,942 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1230798857896
2025-10-08 10:33:57,943 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.857398285122, 'ema200': 4036.3543557318794}, 'M5': {'ema50': 4031.956842971664, 'ema200': 4009.956384440213}, 'M15': {'ema50': 4014.3003952731606, 'ema200': 3980.2651980956102}, 'H1': {'ema50': 3974.8041902227924, 'ema200': 3912.1230798857896}}
2025-10-08 10:33:57,945 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:33:58,021 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.1165046690705807, TRs count: 179
2025-10-08 10:33:58,026 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:33:58,029 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.437153813093882, TRs count: 119
2025-10-08 10:33:58,032 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:33:58,033 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:33:58,034 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:33:58,035 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:33:58,036 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.1165046690705807, 'M1': 1.437153813093882, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:33:58,066 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:33:58,067 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4037.179, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:33:58,067 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:33:58,068 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:33:58,068 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:33:58,069 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:33:58,070 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 41181.00000000004
2025-10-08 10:33:58,071 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 96298.00000000023
2025-10-08 10:33:58,071 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 24628.999999999905
2025-10-08 10:33:58,093 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 42750.0
2025-10-08 10:33:58,094 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:33:58,095 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41181.00000000004}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96298.00000000023}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24628.999999999905}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42750.0}]
2025-10-08 10:33:58,095 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:33:58,096 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:33:58,096 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:33:58,097 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:33:58,098 - APP.services.mt5_service - DEBUG - Position in day range: 0.939646554801859
2025-10-08 10:33:58,099 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:33:58,100 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:33:58.100067+07:00
2025-10-08 10:33:58,100 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:33:58.100067+07:00
2025-10-08 10:33:58,104 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:33:58.100067+07:00 trong DST: True
2025-10-08 10:33:58,127 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:33:58,127 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:33:58,128 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 207
2025-10-08 10:33:58,128 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:58,129 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:58,129 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '1700', 'price': 4037.17, 'distance_pips': 0.9}, {'level': '1725', 'price': 4037.173, 'distance_pips': 0.65}, {'level': '1750', 'price': 4037.175, 'distance_pips': 0.4}, {'level': '1775', 'price': 4037.178, 'distance_pips': 0.15}]
2025-10-08 10:33:58,130 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1872274849131386}
2025-10-08 10:33:58,130 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:58,131 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:58,134 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:33:58,135 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.179
2025-10-08 10:33:58,155 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:58,156 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:33:58,157 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:58,157 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:33:58,158 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:33:58,158 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4037.179
2025-10-08 10:33:58,159 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:58,159 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:33:58,160 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:58,161 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:33:58,161 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:33:58,162 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4037.179
2025-10-08 10:33:58,163 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:58,164 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:33:58,165 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:58,186 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:33:58,187 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:33:58,189 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.179
2025-10-08 10:33:58,189 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:33:58,189 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:33:58,190 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:33:58,190 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:33:58,191 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:58,191 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:58,192 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:33:58,192 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:33:58,192 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:33:58,193 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:33:58,193 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:33:58,196 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:33:58,196 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:33:58,197 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:33:58,220 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:33:58,221 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:33:58,221 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:33:58,222 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:33:58,222 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:33:58,222 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:33:58,223 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:33:58,223 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:33:58,223 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:58,224 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:58,224 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:33:58,227 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:33:58,244 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:33:58,249 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:33:58,250 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:33:58,251 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:33:58,252 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:58,253 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:33:58,253 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:33:58,253 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4037.179, 'ask': 4037.216, 'last': 0.0, 'time': 1759919636}
2025-10-08 10:33:58,256 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:33:58,257 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:33:58,258 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:33:58,258 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:33:58,259 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:58,280 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:58,280 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:58,281 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:33:58,282 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:33:58,283 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:33:58,283 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4037.179
2025-10-08 10:33:58,283 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41181.00000000004}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96298.00000000023}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24628.999999999905}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42750.0}]
2025-10-08 10:33:58,284 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:33:58,333 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:33:58,334 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:33:58,335 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:33:58,335 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:33:58,337 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:34:00,783 - APP.ui.app_ui - INFO - Autorun tick: Kích hoạt worker kiểm tra.
2025-10-08 10:34:00,784 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_autorun_tick_worker' vào thread pool.
2025-10-08 10:34:00,784 - APP.ui.app_ui - DEBUG - Autorun tick worker: Bắt đầu kiểm tra điều kiện.
2025-10-08 10:34:00,786 - APP.ui.app_ui - INFO - Autorun tick worker: Điều kiện hợp lệ, yêu cầu bắt đầu phân tích trên luồng UI.
2025-10-08 10:34:00,875 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: start_analysis
2025-10-08 10:34:00,875 - APP.ui.app_ui - INFO - Yêu cầu bắt đầu phân tích từ UI.
2025-10-08 10:34:00,876 - APP.ui.utils.ui_builder - DEBUG - Đã thay đổi trạng thái nút Start/Stop thành 'disabled'. Các điều khiển khác không bị ảnh hưởng.
2025-10-08 10:34:00,876 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:34:00,877 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:34:00,878 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:34:00,878 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:34:00,878 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:34:00,879 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:34:00,880 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:34:00,880 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:34:00,881 - APP.services.te_service - INFO - Đăng nhập thành công vào Trading Economics API.
2025-10-08 10:34:00,885 - APP.services.news_service - DEBUG - Cấu hình NewsService đã được cập nhật.
2025-10-08 10:34:00,916 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-08 10:34:00,916 - APP.ui.app_ui - INFO - Đã khởi tạo và bắt đầu luồng AnalysisWorker.
2025-10-08 10:34:00,938 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-08 10:34:00,942 - APP.services.gemini_service - INFO - Đã khởi tạo model 'models/gemini-2.5-flash' thành công.
2025-10-08 10:34:00,971 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 2: Xây dựng ngữ cảnh và kiểm tra điều kiện.
2025-10-08 10:34:00,972 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 3: Chuẩn bị và upload ảnh (song song).
2025-10-08 10:34:00,972 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-RUN.
2025-10-08 10:34:00,973 - APP.analysis.image_processor - DEBUG - Đang thử tải cache upload.
2025-10-08 10:34:00,983 - APP.analysis.image_processor - DEBUG - Đã tải cache upload với 4 mục.
2025-10-08 10:34:00,996 - APP.services.mt5_service - DEBUG - Bắt đầu get_active_killzone cho 2025-10-08 10:34:00.973353 với timezone Asia/Ho_Chi_Minh
2025-10-08 10:34:01,000 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-08 10:34:00.973353+07:00, Target TZ: None
2025-10-08 10:34:01,001 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 10:34:00.973353+07:00
2025-10-08 10:34:01,002 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 10:34:00.973353+07:00 trong DST: True
2025-10-08 10:34:01,003 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:34:01,003 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:34:01,004 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_H1.png: 15022:1759914264:adcc044a34c2739b
2025-10-08 10:34:01,005 - APP.services.mt5_service - DEBUG - Không trong killzone nào.
2025-10-08 10:34:01,005 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M1.png: 21123:1759914329:c9ca25adc2713e89
2025-10-08 10:34:01,006 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_H1.png. Tên từ xa: files/jcq192qkqfx5
2025-10-08 10:34:01,007 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M15.png: 14475:1759914258:f522dd906714fb0b
2025-10-08 10:34:01,029 - APP.core.trading.conditions - INFO - Điều kiện NO-RUN được kích hoạt: Không chạy ngoài các Kill Zone đã định nghĩa.
2025-10-08 10:34:01,030 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M1.png. Tên từ xa: files/zl0mc2r9tv6i
2025-10-08 10:34:01,030 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_H1.png, đang lấy thông tin file...
2025-10-08 10:34:01,031 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M15.png. Tên từ xa: files/4s2o4xrat6a8
2025-10-08 10:34:01,032 - APP.core.trading.conditions - INFO - Thoát sớm. Giai đoạn: no-run, Lý do: Không chạy ngoài các Kill Zone đã định nghĩa.
2025-10-08 10:34:01,033 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M5.png: 22339:1759914253:ac9da090a54f8eec
2025-10-08 10:34:01,033 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M1.png, đang lấy thông tin file...
2025-10-08 10:34:01,035 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M15.png, đang lấy thông tin file...
2025-10-08 10:34:01,049 - APP.persistence.log_handler - DEBUG - Đang chuẩn bị ghi log giao dịch. Giai đoạn: no-run, Thư mục con: None
2025-10-08 10:34:01,058 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:01,064 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M5.png. Tên từ xa: files/kis0no3da2v8
2025-10-08 10:34:01,066 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M5.png, đang lấy thông tin file...
2025-10-08 10:34:01,140 - APP.persistence.log_handler - DEBUG - Đã ghi log giao dịch thành công vào trade_log_20251008.jsonl.
2025-10-08 10:34:01,141 - APP.persistence.log_handler - DEBUG - Kết thúc hàm log_trade.
2025-10-08 10:34:01,141 - APP.core.analysis_worker - INFO - Giai đoạn 2 thoát sớm: Điều kiện No-Run: Không chạy ngoài các Kill Zone đã định nghĩa.
2025-10-08 10:34:01,142 - APP.utils.threading_utils - DEBUG - Tác vụ song song '_execute_stage_2_logic' đã hoàn thành.
2025-10-08 10:34:01,174 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:01,188 - APP.analysis.image_processor - DEBUG - Đang lưu cache upload với 4 mục.
2025-10-08 10:34:01,190 - APP.analysis.image_processor - DEBUG - Đã lưu cache upload thành công.
2025-10-08 10:34:01,191 - APP.utils.threading_utils - DEBUG - Tác vụ song song '_execute_stage_3_logic' đã hoàn thành.
2025-10-08 10:34:01,192 - APP.core.analysis_worker - WARNING - Một trong các giai đoạn song song đã thất bại. Dừng worker.
2025-10-08 10:34:01,192 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Thoát sớm do lỗi ở Giai đoạn 2 hoặc 3.
2025-10-08 10:34:01,193 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-08 10:34:01,193 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-08 10:34:01,287 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:01,389 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:01,490 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:01,491 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:01,492 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:01,492 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:01,594 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:01,594 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:01,695 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:01,696 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:01,797 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:01,797 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:01,898 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:01,899 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:01,900 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: _finalize_done
2025-10-08 10:34:01,901 - APP.ui.utils.ui_builder - DEBUG - Đã thay đổi trạng thái nút Start/Stop thành 'normal'. Các điều khiển khác không bị ảnh hưởng.
2025-10-08 10:34:01,901 - APP.ui.app_ui - DEBUG - Lên lịch chạy tự động tiếp theo sau 60000ms.
2025-10-08 10:34:02,044 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:34:02,046 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:34:02,047 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:34:02,047 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:34:02,049 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:34:02,050 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:34:02,053 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:34:02,054 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:02,080 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:34:02,081 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:34:02,082 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:34:02,082 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:34:02,083 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:34:02,103 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:02,583 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:34:02,585 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:34:02,585 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:34:02,586 - APP.services.mt5_service - DEBUG - Current price (cp): 4037.583
2025-10-08 10:34:02,591 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 357, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:34:02,622 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 235, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:34:02,623 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:34:02,624 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:34:02,626 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:34:02,626 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:02,626 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:34:02,627 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:34:02,630 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:34:02,630 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:02,630 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:34:02,631 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:34:02,633 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:34:02,633 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:02,634 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:34:02,634 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:34:02,639 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:34:02,655 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:02,656 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:34:02,656 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:34:02,659 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:34:02,659 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:34:02,660 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:34:02,660 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:34:02,661 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:34:02,661 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:34:02,662 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:34:02.662179+07:00
2025-10-08 10:34:02,662 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:34:02.662179+07:00
2025-10-08 10:34:02,663 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:34:02.662179+07:00 trong DST: True
2025-10-08 10:34:02,663 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:34:02,663 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:34:02,665 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:34:02,669 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:34:02,685 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.750556149734
2025-10-08 10:34:02,687 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 113 rates.
2025-10-08 10:34:02,688 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.782765984275
2025-10-08 10:34:02,690 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.750556149734, 'asia': 4036.782765984275, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:34:02,691 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:34:02,743 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.857398285122
2025-10-08 10:34:02,743 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:34:02,744 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.3543557318794
2025-10-08 10:34:02,745 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:34:02,746 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.956842971664
2025-10-08 10:34:02,747 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:34:02,803 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.956384440213
2025-10-08 10:34:02,807 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:34:02,891 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.3003952731606
2025-10-08 10:34:03,063 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:34:03,158 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.2651980956102
2025-10-08 10:34:03,177 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:34:03,206 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.8041902227924
2025-10-08 10:34:03,207 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:34:03,208 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1230798857896
2025-10-08 10:34:03,209 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.857398285122, 'ema200': 4036.3543557318794}, 'M5': {'ema50': 4031.956842971664, 'ema200': 4009.956384440213}, 'M15': {'ema50': 4014.3003952731606, 'ema200': 3980.2651980956102}, 'H1': {'ema50': 3974.8041902227924, 'ema200': 3912.1230798857896}}
2025-10-08 10:34:03,212 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:34:03,213 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.1165046690705807, TRs count: 179
2025-10-08 10:34:03,213 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:34:03,214 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.437153813093882, TRs count: 119
2025-10-08 10:34:03,215 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:34:03,215 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:34:03,216 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:34:03,216 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:34:03,216 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.1165046690705807, 'M1': 1.437153813093882, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:34:03,217 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:34:03,217 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4037.583, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:34:03,218 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:34:03,218 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:34:03,219 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:34:03,219 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:34:03,220 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 41585.00000000004
2025-10-08 10:34:03,220 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 96702.00000000022
2025-10-08 10:34:03,221 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 25032.9999999999
2025-10-08 10:34:03,222 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 43153.99999999999
2025-10-08 10:34:03,223 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:34:03,224 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41585.00000000004}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96702.00000000022}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25032.9999999999}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43153.99999999999}]
2025-10-08 10:34:03,224 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:34:03,227 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:34:03,244 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:34:03,245 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:34:03,246 - APP.services.mt5_service - DEBUG - Position in day range: 0.9468582649053934
2025-10-08 10:34:03,247 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:34:03,247 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:34:03.247825+07:00
2025-10-08 10:34:03,248 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:34:03.247825+07:00
2025-10-08 10:34:03,248 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:34:03.247825+07:00 trong DST: True
2025-10-08 10:34:03,250 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:34:03,251 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:34:03,251 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 206
2025-10-08 10:34:03,252 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:03,254 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:03,280 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '5800', 'price': 4037.58, 'distance_pips': 0.3}, {'level': '5825', 'price': 4037.582, 'distance_pips': 0.05}, {'level': '5850', 'price': 4037.585, 'distance_pips': 0.2}, {'level': '5875', 'price': 4037.588, 'distance_pips': 0.45}]
2025-10-08 10:34:03,287 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1872274849131386}
2025-10-08 10:34:03,318 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:03,319 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:03,319 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:34:03,320 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.583
2025-10-08 10:34:03,321 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:03,321 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:34:03,322 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:03,341 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:34:03,341 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:34:03,343 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4037.583
2025-10-08 10:34:03,343 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:03,343 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:34:03,344 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:03,345 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:34:03,345 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:34:03,346 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4037.583
2025-10-08 10:34:03,348 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:03,348 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:34:03,349 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:03,349 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:34:03,349 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:34:03,351 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.583
2025-10-08 10:34:03,351 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:03,352 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:34:03,374 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:03,379 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:34:03,380 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:03,381 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:03,383 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:34:03,383 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:34:03,384 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:34:03,384 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:34:03,405 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:34:03,406 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:34:03,407 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:34:03,407 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:34:03,408 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:34:03,409 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:34:03,409 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:34:03,410 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:34:03,410 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:34:03,410 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:34:03,411 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:34:03,411 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:34:03,412 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:03,412 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:03,414 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:34:03,415 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:34:03,438 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:34:03,440 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:34:03,441 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:34:03,443 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:34:03,444 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:03,446 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:34:03,446 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:34:03,446 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4037.583, 'ask': 4037.62, 'last': 0.0, 'time': 1759919642}
2025-10-08 10:34:03,451 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:34:03,464 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:34:03,467 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:34:03,467 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:34:03,468 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:03,468 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:03,469 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:03,469 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:03,470 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:03,470 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:34:03,471 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4037.583
2025-10-08 10:34:03,471 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41585.00000000004}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96702.00000000022}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25032.9999999999}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43153.99999999999}]
2025-10-08 10:34:03,472 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:34:03,530 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:03,532 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:34:03,533 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:34:03,535 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:34:03,536 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:34:07,048 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:34:07,050 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:34:07,051 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:34:07,051 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:34:07,053 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:34:07,054 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:34:07,057 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:34:07,057 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:07,081 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:34:07,083 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:34:07,084 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:34:07,085 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:34:07,085 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:34:07,143 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:07,586 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:34:07,588 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:34:07,588 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:34:07,589 - APP.services.mt5_service - DEBUG - Current price (cp): 4037.822
2025-10-08 10:34:07,593 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 356, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:34:07,620 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 235, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:34:07,624 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:34:07,625 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:34:07,628 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:34:07,628 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:07,629 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:34:07,630 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:34:07,633 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:34:07,633 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:07,634 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:34:07,651 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:34:07,655 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:34:07,655 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:07,655 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:34:07,656 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:34:07,658 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:34:07,658 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:07,658 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:34:07,659 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:34:07,661 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:34:07,662 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:34:07,662 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:34:07,663 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:34:07,663 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:34:07,664 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:34:07,664 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:34:07.664327+07:00
2025-10-08 10:34:07,664 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:34:07.664327+07:00
2025-10-08 10:34:07,665 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:34:07.664327+07:00 trong DST: True
2025-10-08 10:34:07,665 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:34:07,665 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:34:07,668 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:34:07,671 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:34:07,676 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.750556149734
2025-10-08 10:34:07,679 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 113 rates.
2025-10-08 10:34:07,684 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.782765984275
2025-10-08 10:34:07,688 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.750556149734, 'asia': 4036.782765984275, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:34:07,689 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:34:07,689 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.857398285122
2025-10-08 10:34:07,690 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:34:07,690 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.3543557318794
2025-10-08 10:34:07,690 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:34:07,691 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.956842971664
2025-10-08 10:34:07,691 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:34:07,692 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.956384440213
2025-10-08 10:34:07,692 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:34:07,692 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.3003952731606
2025-10-08 10:34:07,693 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:34:07,693 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.2651980956102
2025-10-08 10:34:07,693 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:34:07,694 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.8041902227924
2025-10-08 10:34:07,694 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:34:07,695 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1230798857896
2025-10-08 10:34:07,695 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.857398285122, 'ema200': 4036.3543557318794}, 'M5': {'ema50': 4031.956842971664, 'ema200': 4009.956384440213}, 'M15': {'ema50': 4014.3003952731606, 'ema200': 3980.2651980956102}, 'H1': {'ema50': 3974.8041902227924, 'ema200': 3912.1230798857896}}
2025-10-08 10:34:07,695 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:34:07,696 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.1165046690705807, TRs count: 179
2025-10-08 10:34:07,696 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:34:07,697 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.437153813093882, TRs count: 119
2025-10-08 10:34:07,706 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:34:07,707 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:34:07,711 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:34:07,716 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:34:07,717 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.1165046690705807, 'M1': 1.437153813093882, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:34:07,718 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:34:07,719 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4037.822, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:34:07,720 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:34:07,720 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:34:07,720 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:34:07,721 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:34:07,721 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 41824.000000000065
2025-10-08 10:34:07,722 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 96941.00000000026
2025-10-08 10:34:07,722 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 25271.999999999935
2025-10-08 10:34:07,723 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 43393.00000000003
2025-10-08 10:34:07,723 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:34:07,723 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41824.000000000065}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96941.00000000026}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25271.999999999935}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43393.00000000003}]
2025-10-08 10:34:07,724 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:34:07,724 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:34:07,725 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:34:07,725 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:34:07,726 - APP.services.mt5_service - DEBUG - Position in day range: 0.9511245983577324
2025-10-08 10:34:07,726 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:34:07,726 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:34:07.726773+07:00
2025-10-08 10:34:07,727 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:34:07.726773+07:00
2025-10-08 10:34:07,727 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:34:07.726773+07:00 trong DST: True
2025-10-08 10:34:07,728 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:34:07,728 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:34:07,731 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 206
2025-10-08 10:34:07,735 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:07,741 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:07,746 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '8200', 'price': 4037.82, 'distance_pips': 0.2}, {'level': '8225', 'price': 4037.823, 'distance_pips': 0.05}, {'level': '8250', 'price': 4037.825, 'distance_pips': 0.3}, {'level': '8275', 'price': 4037.828, 'distance_pips': 0.55}]
2025-10-08 10:34:07,747 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1872274849131386}
2025-10-08 10:34:07,747 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:07,748 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:07,748 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:34:07,749 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.822
2025-10-08 10:34:07,750 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:07,750 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:34:07,751 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:07,751 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:34:07,752 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:34:07,752 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4037.822
2025-10-08 10:34:07,753 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:07,753 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:34:07,754 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:07,755 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:34:07,755 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:34:07,756 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4037.822
2025-10-08 10:34:07,757 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:07,757 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:34:07,759 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:07,761 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:34:07,765 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:34:07,768 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.822
2025-10-08 10:34:07,769 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:07,772 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:34:07,774 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:07,777 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:34:07,781 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:07,782 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:07,783 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:34:07,783 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:34:07,784 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:34:07,785 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:34:07,785 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:34:07,785 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:34:07,785 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:34:07,786 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:34:07,786 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:34:07,786 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:34:07,787 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:34:07,787 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:34:07,788 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:34:07,788 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:34:07,788 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:34:07,789 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:34:07,789 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:07,790 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:07,790 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:34:07,791 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:34:07,793 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:34:07,797 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:34:07,800 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:34:07,812 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:34:07,813 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:07,814 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:34:07,814 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:34:07,815 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4037.822, 'ask': 4037.859, 'last': 0.0, 'time': 1759919646}
2025-10-08 10:34:07,817 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:34:07,818 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:34:07,818 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:34:07,819 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:34:07,820 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:07,820 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:07,821 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:07,821 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:07,822 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:07,822 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:34:07,823 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4037.822
2025-10-08 10:34:07,823 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41824.000000000065}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96941.00000000026}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25271.999999999935}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43393.00000000003}]
2025-10-08 10:34:07,838 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:34:07,843 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:07,845 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:34:07,845 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:34:07,852 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:34:07,875 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:34:10,179 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:34:10,199 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:34:12,052 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:34:12,054 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:34:12,055 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:34:12,055 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:34:12,057 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:34:12,058 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:34:12,061 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:34:12,061 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:12,084 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:34:12,085 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:34:12,086 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:34:12,086 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:34:12,087 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:34:12,130 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:12,588 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:34:12,589 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:34:12,590 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:34:12,592 - APP.services.mt5_service - DEBUG - Current price (cp): 4037.57
2025-10-08 10:34:12,597 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 358, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:34:12,632 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 235, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:34:12,633 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:34:12,636 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:34:12,641 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:34:12,657 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:12,658 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:34:12,659 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:34:12,662 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:34:12,664 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:12,666 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:34:12,689 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:34:12,691 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:34:12,692 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:12,694 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:34:12,720 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:34:12,723 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:34:12,724 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:12,725 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:34:12,749 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:34:12,752 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:34:12,753 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:34:12,754 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:34:12,754 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:34:12,754 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:34:12,755 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:34:12,755 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:34:12.755743+07:00
2025-10-08 10:34:12,756 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:34:12.755743+07:00
2025-10-08 10:34:12,756 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:34:12.755743+07:00 trong DST: True
2025-10-08 10:34:12,756 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:34:12,757 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:34:12,779 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:34:12,781 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:34:12,781 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.750556149734
2025-10-08 10:34:12,782 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 113 rates.
2025-10-08 10:34:12,783 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.782765984275
2025-10-08 10:34:12,786 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.750556149734, 'asia': 4036.782765984275, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:34:12,787 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:34:12,787 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.857398285122
2025-10-08 10:34:12,787 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:34:12,788 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.3543557318794
2025-10-08 10:34:12,788 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:34:12,789 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.956842971664
2025-10-08 10:34:12,790 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:34:12,791 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.956384440213
2025-10-08 10:34:12,796 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:34:12,810 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.3003952731606
2025-10-08 10:34:12,811 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:34:12,811 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.2651980956102
2025-10-08 10:34:12,812 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:34:12,812 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.8041902227924
2025-10-08 10:34:12,812 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:34:12,813 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1230798857896
2025-10-08 10:34:12,813 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.857398285122, 'ema200': 4036.3543557318794}, 'M5': {'ema50': 4031.956842971664, 'ema200': 4009.956384440213}, 'M15': {'ema50': 4014.3003952731606, 'ema200': 3980.2651980956102}, 'H1': {'ema50': 3974.8041902227924, 'ema200': 3912.1230798857896}}
2025-10-08 10:34:12,814 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:34:12,814 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.1165046690705807, TRs count: 179
2025-10-08 10:34:12,815 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:34:12,815 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.437153813093882, TRs count: 119
2025-10-08 10:34:12,816 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:34:12,817 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:34:12,817 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:34:12,818 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:34:12,818 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.1165046690705807, 'M1': 1.437153813093882, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:34:12,819 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:34:12,819 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4037.57, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:34:12,820 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:34:12,847 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:34:12,847 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:34:12,848 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:34:12,848 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 41572.00000000012
2025-10-08 10:34:12,849 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 96689.0000000003
2025-10-08 10:34:12,849 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 25019.99999999998
2025-10-08 10:34:12,849 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 43141.00000000007
2025-10-08 10:34:12,850 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:34:12,850 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41572.00000000012}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96689.0000000003}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25019.99999999998}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43141.00000000007}]
2025-10-08 10:34:12,850 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:34:12,854 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:34:12,876 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:34:12,876 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:34:12,877 - APP.services.mt5_service - DEBUG - Position in day range: 0.9466262049268157
2025-10-08 10:34:12,877 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:34:12,878 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:34:12.878123+07:00
2025-10-08 10:34:12,878 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:34:12.878123+07:00
2025-10-08 10:34:12,879 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:34:12.878123+07:00 trong DST: True
2025-10-08 10:34:12,879 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:34:12,880 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:34:12,880 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 206
2025-10-08 10:34:12,881 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:12,881 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:12,881 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '5700', 'price': 4037.57, 'distance_pips': 0.0}, {'level': '5725', 'price': 4037.573, 'distance_pips': 0.25}, {'level': '5750', 'price': 4037.575, 'distance_pips': 0.5}, {'level': '5775', 'price': 4037.578, 'distance_pips': 0.75}]
2025-10-08 10:34:12,882 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1872274849131386}
2025-10-08 10:34:12,883 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:12,903 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:12,906 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:34:12,907 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.57
2025-10-08 10:34:12,907 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:12,908 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:34:12,909 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:12,909 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:34:12,910 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:34:12,911 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4037.57
2025-10-08 10:34:12,911 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:12,912 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:34:12,912 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:12,913 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:34:12,922 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:34:12,941 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4037.57
2025-10-08 10:34:12,943 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:12,943 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:34:12,944 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:12,968 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:34:12,969 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:34:12,970 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.57
2025-10-08 10:34:12,971 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:12,971 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:34:12,972 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:12,972 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:34:12,973 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:12,974 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:12,974 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:34:12,974 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:34:12,975 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:34:12,975 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:34:12,976 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:34:13,002 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:34:13,002 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:34:13,003 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:34:13,004 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:34:13,005 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:34:13,005 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:34:13,006 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:34:13,006 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:34:13,006 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:34:13,008 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:34:13,010 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:34:13,035 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:13,036 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:13,036 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:34:13,037 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:34:13,037 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:34:13,037 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:34:13,038 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:34:13,041 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:34:13,067 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:34:13,068 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:34:13,068 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:13,072 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:34:13,091 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4037.57, 'ask': 4037.607, 'last': 0.0, 'time': 1759919652}
2025-10-08 10:34:13,092 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:34:13,092 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:34:13,093 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:34:13,093 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:13,094 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:13,094 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:13,095 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:13,095 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:13,096 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:34:13,096 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4037.57
2025-10-08 10:34:13,097 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41572.00000000012}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96689.0000000003}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25019.99999999998}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43141.00000000007}]
2025-10-08 10:34:13,097 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:34:13,192 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:13,192 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:34:13,193 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:34:13,194 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:34:13,198 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:34:17,057 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:34:17,059 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:34:17,059 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:34:17,060 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:34:17,062 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:34:17,062 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:34:17,065 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:34:17,066 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:17,089 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:34:17,090 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:34:17,091 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:34:17,091 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:34:17,092 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:34:17,130 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:17,593 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:34:17,595 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:34:17,595 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:34:17,596 - APP.services.mt5_service - DEBUG - Current price (cp): 4037.563
2025-10-08 10:34:17,601 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 362, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:34:17,632 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 235, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:34:17,633 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:34:17,634 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:34:17,636 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:34:17,637 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:17,652 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:34:17,653 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:34:17,658 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:34:17,658 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:17,659 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:34:17,659 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:34:17,661 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:34:17,661 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:17,662 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:34:17,662 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:34:17,664 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:34:17,665 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:17,666 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:34:17,666 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:34:17,672 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:34:17,690 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:34:17,691 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:34:17,692 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:34:17,692 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:34:17,693 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:34:17,693 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:34:17.693545+07:00
2025-10-08 10:34:17,693 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:34:17.693545+07:00
2025-10-08 10:34:17,694 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:34:17.693545+07:00 trong DST: True
2025-10-08 10:34:17,694 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:34:17,695 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:34:17,695 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:34:17,697 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:34:17,698 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.750556149734
2025-10-08 10:34:17,701 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 113 rates.
2025-10-08 10:34:17,719 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.782765984275
2025-10-08 10:34:17,723 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.750556149734, 'asia': 4036.782765984275, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:34:17,724 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:34:17,724 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.857398285122
2025-10-08 10:34:17,725 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:34:17,725 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.3543557318794
2025-10-08 10:34:17,726 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:34:17,729 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.956842971664
2025-10-08 10:34:17,729 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:34:17,736 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.956384440213
2025-10-08 10:34:17,749 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:34:17,750 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.3003952731606
2025-10-08 10:34:17,750 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:34:17,751 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.2651980956102
2025-10-08 10:34:17,751 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:34:17,752 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.8041902227924
2025-10-08 10:34:17,752 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:34:17,752 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1230798857896
2025-10-08 10:34:17,753 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.857398285122, 'ema200': 4036.3543557318794}, 'M5': {'ema50': 4031.956842971664, 'ema200': 4009.956384440213}, 'M15': {'ema50': 4014.3003952731606, 'ema200': 3980.2651980956102}, 'H1': {'ema50': 3974.8041902227924, 'ema200': 3912.1230798857896}}
2025-10-08 10:34:17,753 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:34:17,754 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.1165046690705807, TRs count: 179
2025-10-08 10:34:17,754 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:34:17,755 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.437153813093882, TRs count: 119
2025-10-08 10:34:17,755 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:34:17,756 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:34:17,756 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:34:17,757 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:34:17,757 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.1165046690705807, 'M1': 1.437153813093882, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:34:17,758 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:34:17,759 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4037.563, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:34:17,760 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:34:17,761 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:34:17,762 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:34:17,783 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:34:17,784 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 41565.00000000005
2025-10-08 10:34:17,785 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 96682.00000000025
2025-10-08 10:34:17,785 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 25012.99999999992
2025-10-08 10:34:17,786 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 43134.000000000015
2025-10-08 10:34:17,786 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:34:17,787 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41565.00000000005}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96682.00000000025}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25012.99999999992}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43134.000000000015}]
2025-10-08 10:34:17,787 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:34:17,788 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:34:17,788 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:34:17,789 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:34:17,790 - APP.services.mt5_service - DEBUG - Position in day range: 0.9465012495537336
2025-10-08 10:34:17,791 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:34:17,807 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:34:17.807215+07:00
2025-10-08 10:34:17,807 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:34:17.807215+07:00
2025-10-08 10:34:17,808 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:34:17.807215+07:00 trong DST: True
2025-10-08 10:34:17,809 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:34:17,809 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:34:17,810 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 206
2025-10-08 10:34:17,810 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:17,810 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:17,811 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '5600', 'price': 4037.56, 'distance_pips': 0.3}, {'level': '5625', 'price': 4037.562, 'distance_pips': 0.05}, {'level': '5650', 'price': 4037.565, 'distance_pips': 0.2}, {'level': '5675', 'price': 4037.568, 'distance_pips': 0.45}]
2025-10-08 10:34:17,811 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1872274849131386}
2025-10-08 10:34:17,811 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:17,812 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:17,812 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:34:17,813 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.563
2025-10-08 10:34:17,813 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:17,814 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:34:17,815 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:17,815 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:34:17,816 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:34:17,816 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4037.563
2025-10-08 10:34:17,817 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:17,817 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:34:17,818 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:17,818 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:34:17,819 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:34:17,819 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4037.563
2025-10-08 10:34:17,826 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:17,849 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:34:17,850 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:17,851 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:34:17,853 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:34:17,854 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.563
2025-10-08 10:34:17,874 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:17,875 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:34:17,876 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:17,877 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:34:17,877 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:17,878 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:17,878 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:34:17,878 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:34:17,879 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:34:17,879 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:34:17,880 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:34:17,880 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:34:17,880 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:34:17,881 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:34:17,881 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:34:17,881 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:34:17,882 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:34:17,907 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:34:17,909 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:34:17,909 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:34:17,910 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:34:17,910 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:34:17,911 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:17,911 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:17,911 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:34:17,912 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:34:17,912 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:34:17,913 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:34:17,913 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:34:17,917 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:34:17,939 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:17,940 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:34:17,940 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:34:17,941 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4037.563, 'ask': 4037.6, 'last': 0.0, 'time': 1759919657}
2025-10-08 10:34:17,943 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:34:17,944 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:34:17,944 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:34:17,945 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:34:17,968 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:17,970 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:17,970 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:17,971 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:17,971 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:17,971 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:34:17,972 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4037.563
2025-10-08 10:34:17,972 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41565.00000000005}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96682.00000000025}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25012.99999999992}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43134.000000000015}]
2025-10-08 10:34:17,973 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:34:18,068 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:18,069 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:34:18,073 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:34:18,074 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:34:18,077 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:34:22,061 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:34:22,063 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:34:22,063 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:34:22,064 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:34:22,066 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:34:22,066 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:34:22,069 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:34:22,070 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:22,092 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:34:22,092 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:34:22,093 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:34:22,093 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:34:22,094 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:34:22,188 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:22,595 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:34:22,597 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:34:22,597 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:34:22,598 - APP.services.mt5_service - DEBUG - Current price (cp): 4037.573
2025-10-08 10:34:22,603 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 361, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:34:22,636 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 234, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:34:22,636 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:34:22,637 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:34:22,639 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:34:22,640 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:22,640 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:34:22,641 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:34:22,644 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:34:22,644 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:22,644 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:34:22,645 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:34:22,647 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:34:22,647 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:22,647 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:34:22,648 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:34:22,650 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:34:22,650 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:22,651 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:34:22,651 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:34:22,653 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:34:22,654 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:34:22,654 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:34:22,655 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:34:22,655 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:34:22,656 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:34:22,656 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:34:22.656419+07:00
2025-10-08 10:34:22,656 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:34:22.656419+07:00
2025-10-08 10:34:22,657 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:34:22.656419+07:00 trong DST: True
2025-10-08 10:34:22,657 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:34:22,658 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:34:22,658 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:34:22,659 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:34:22,659 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.750556149734
2025-10-08 10:34:22,660 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 113 rates.
2025-10-08 10:34:22,661 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.782765984275
2025-10-08 10:34:22,664 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.750556149734, 'asia': 4036.782765984275, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:34:22,665 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:34:22,666 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.857398285122
2025-10-08 10:34:22,666 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:34:22,667 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.3543557318794
2025-10-08 10:34:22,667 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:34:22,668 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.956842971664
2025-10-08 10:34:22,686 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:34:22,687 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.956384440213
2025-10-08 10:34:22,688 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:34:22,689 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.3003952731606
2025-10-08 10:34:22,690 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:34:22,691 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.2651980956102
2025-10-08 10:34:22,691 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:34:22,692 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.8041902227924
2025-10-08 10:34:22,692 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:34:22,692 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1230798857896
2025-10-08 10:34:22,693 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.857398285122, 'ema200': 4036.3543557318794}, 'M5': {'ema50': 4031.956842971664, 'ema200': 4009.956384440213}, 'M15': {'ema50': 4014.3003952731606, 'ema200': 3980.2651980956102}, 'H1': {'ema50': 3974.8041902227924, 'ema200': 3912.1230798857896}}
2025-10-08 10:34:22,694 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:34:22,695 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.1165046690705807, TRs count: 179
2025-10-08 10:34:22,696 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:34:22,697 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.437153813093882, TRs count: 119
2025-10-08 10:34:22,698 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:34:22,705 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:34:22,718 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:34:22,719 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:34:22,720 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.1165046690705807, 'M1': 1.437153813093882, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:34:22,720 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:34:22,720 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4037.573, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:34:22,721 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:34:22,721 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:34:22,721 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:34:22,722 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:34:22,722 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 41574.99999999982
2025-10-08 10:34:22,723 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 96692.0
2025-10-08 10:34:22,723 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 25022.999999999683
2025-10-08 10:34:22,724 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 43143.999999999774
2025-10-08 10:34:22,724 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:34:22,724 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41574.99999999982}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96692.0}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25022.999999999683}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43143.999999999774}]
2025-10-08 10:34:22,725 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:34:22,725 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:34:22,726 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:34:22,726 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:34:22,727 - APP.services.mt5_service - DEBUG - Position in day range: 0.9466797572295594
2025-10-08 10:34:22,727 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:34:22,729 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:34:22.729402+07:00
2025-10-08 10:34:22,729 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:34:22.729402+07:00
2025-10-08 10:34:22,748 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:34:22.729402+07:00 trong DST: True
2025-10-08 10:34:22,749 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:34:22,749 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:34:22,750 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 206
2025-10-08 10:34:22,750 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:22,751 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:22,751 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '5700', 'price': 4037.57, 'distance_pips': 0.3}, {'level': '5725', 'price': 4037.573, 'distance_pips': 0.05}, {'level': '5750', 'price': 4037.575, 'distance_pips': 0.2}, {'level': '5775', 'price': 4037.578, 'distance_pips': 0.45}]
2025-10-08 10:34:22,752 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1872274849277302}
2025-10-08 10:34:22,752 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:22,753 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:22,753 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:34:22,754 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.573
2025-10-08 10:34:22,754 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:22,755 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:34:22,756 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:22,756 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:34:22,757 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:34:22,757 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4037.573
2025-10-08 10:34:22,759 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:22,760 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:34:22,761 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:22,781 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:34:22,782 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:34:22,783 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4037.573
2025-10-08 10:34:22,784 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:22,785 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:34:22,785 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:22,786 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:34:22,786 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:34:22,787 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.573
2025-10-08 10:34:22,788 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:22,788 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:34:22,789 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:22,789 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:34:22,790 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:22,791 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:22,791 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:34:22,792 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:34:22,792 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:34:22,815 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:34:22,816 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:34:22,816 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:34:22,816 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:34:22,817 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:34:22,817 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:34:22,818 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:34:22,818 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:34:22,819 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:34:22,820 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:34:22,820 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:34:22,821 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:34:22,822 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:34:22,849 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:22,851 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:22,851 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:34:22,852 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:34:22,852 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:34:22,853 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:34:22,853 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:34:22,855 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:34:22,856 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:22,869 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:34:22,875 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:34:22,877 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4037.573, 'ask': 4037.61, 'last': 0.0, 'time': 1759919661}
2025-10-08 10:34:22,882 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:34:22,882 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:34:22,883 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:34:22,884 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:34:22,886 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:22,906 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:22,907 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:22,908 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:22,908 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:22,909 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:34:22,909 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4037.573
2025-10-08 10:34:22,910 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41574.99999999982}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96692.0}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25022.999999999683}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43143.999999999774}]
2025-10-08 10:34:22,911 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:34:23,007 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:23,009 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:34:23,010 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:34:23,011 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:34:23,013 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:34:25,195 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:34:25,221 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:34:27,065 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:34:27,067 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:34:27,068 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:34:27,068 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:34:27,070 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:34:27,071 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:34:27,074 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:34:27,075 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:27,097 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:34:27,098 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:34:27,099 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:34:27,099 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:34:27,100 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:34:27,132 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:27,601 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:34:27,603 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:34:27,604 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:34:27,604 - APP.services.mt5_service - DEBUG - Current price (cp): 4037.18
2025-10-08 10:34:27,610 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 358, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:34:27,650 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 234, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:34:27,650 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:34:27,651 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:34:27,653 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:34:27,653 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:27,654 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:34:27,654 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:34:27,657 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:34:27,657 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:27,658 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:34:27,658 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:34:27,660 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:34:27,660 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:27,660 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:34:27,661 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:34:27,663 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:34:27,663 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:27,663 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:34:27,664 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:34:27,667 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:34:27,668 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:34:27,688 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:34:27,690 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:34:27,690 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:34:27,690 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:34:27,691 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:34:27.691266+07:00
2025-10-08 10:34:27,691 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:34:27.691266+07:00
2025-10-08 10:34:27,692 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:34:27.691266+07:00 trong DST: True
2025-10-08 10:34:27,692 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:34:27,693 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:34:27,693 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:34:27,694 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:34:27,695 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.750556149734
2025-10-08 10:34:27,698 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 113 rates.
2025-10-08 10:34:27,719 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.782765984275
2025-10-08 10:34:27,723 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.750556149734, 'asia': 4036.782765984275, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:34:27,723 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:34:27,724 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.857398285122
2025-10-08 10:34:27,725 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:34:27,725 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.3543557318794
2025-10-08 10:34:27,726 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:34:27,726 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.956842971664
2025-10-08 10:34:27,727 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:34:27,728 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.956384440213
2025-10-08 10:34:27,729 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:34:27,730 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.3003952731606
2025-10-08 10:34:27,752 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:34:27,753 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.2651980956102
2025-10-08 10:34:27,753 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:34:27,754 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.8041902227924
2025-10-08 10:34:27,754 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:34:27,755 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1230798857896
2025-10-08 10:34:27,755 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.857398285122, 'ema200': 4036.3543557318794}, 'M5': {'ema50': 4031.956842971664, 'ema200': 4009.956384440213}, 'M15': {'ema50': 4014.3003952731606, 'ema200': 3980.2651980956102}, 'H1': {'ema50': 3974.8041902227924, 'ema200': 3912.1230798857896}}
2025-10-08 10:34:27,756 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:34:27,757 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.1165046690705807, TRs count: 179
2025-10-08 10:34:27,757 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:34:27,757 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.437153813093882, TRs count: 119
2025-10-08 10:34:27,758 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:34:27,760 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:34:27,761 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:34:27,783 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:34:27,783 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.1165046690705807, 'M1': 1.437153813093882, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:34:27,784 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:34:27,785 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4037.18, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:34:27,785 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:34:27,786 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:34:27,786 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:34:27,787 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:34:27,787 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 41181.99999999979
2025-10-08 10:34:27,787 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 96298.99999999997
2025-10-08 10:34:27,788 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 24629.999999999654
2025-10-08 10:34:27,788 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 42750.999999999745
2025-10-08 10:34:27,788 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:34:27,789 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41181.99999999979}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96298.99999999997}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24629.999999999654}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42750.999999999745}]
2025-10-08 10:34:27,792 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:34:27,793 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:34:27,807 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:34:27,808 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:34:27,809 - APP.services.mt5_service - DEBUG - Position in day range: 0.9396644055694375
2025-10-08 10:34:27,810 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:34:27,811 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:34:27.811289+07:00
2025-10-08 10:34:27,811 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:34:27.811289+07:00
2025-10-08 10:34:27,812 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:34:27.811289+07:00 trong DST: True
2025-10-08 10:34:27,813 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:34:27,813 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:34:27,813 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 206
2025-10-08 10:34:27,814 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:27,814 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:27,815 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '1800', 'price': 4037.18, 'distance_pips': 0.0}, {'level': '1825', 'price': 4037.183, 'distance_pips': 0.25}, {'level': '1850', 'price': 4037.185, 'distance_pips': 0.5}, {'level': '1875', 'price': 4037.188, 'distance_pips': 0.75}]
2025-10-08 10:34:27,815 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1872274849277302}
2025-10-08 10:34:27,815 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:27,816 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:27,816 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:34:27,817 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.18
2025-10-08 10:34:27,818 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:27,818 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:34:27,819 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:27,819 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:34:27,820 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:34:27,821 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4037.18
2025-10-08 10:34:27,822 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:27,822 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:34:27,846 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:27,848 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:34:27,848 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:34:27,849 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4037.18
2025-10-08 10:34:27,850 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:27,851 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:34:27,851 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:27,852 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:34:27,852 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:34:27,854 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.18
2025-10-08 10:34:27,855 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:27,855 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:34:27,877 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:27,878 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:34:27,878 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:27,879 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:27,879 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:34:27,880 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:34:27,880 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:34:27,881 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:34:27,882 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:34:27,882 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:34:27,883 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:34:27,884 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:34:27,885 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:34:27,886 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:34:27,908 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:34:27,910 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:34:27,910 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:34:27,911 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:34:27,911 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:34:27,912 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:34:27,912 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:27,913 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:27,914 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:34:27,914 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:34:27,916 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:34:27,917 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:34:27,941 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:34:27,943 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:34:27,944 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:27,945 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:34:27,945 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:34:27,945 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4037.18, 'ask': 4037.217, 'last': 0.0, 'time': 1759919667}
2025-10-08 10:34:27,949 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:34:27,950 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:34:27,968 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:34:27,970 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:34:27,970 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:27,971 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:27,971 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:27,972 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:27,972 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:27,972 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:34:27,973 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4037.18
2025-10-08 10:34:27,974 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41181.99999999979}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96298.99999999997}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24629.999999999654}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42750.999999999745}]
2025-10-08 10:34:27,974 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:34:27,991 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:28,000 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:34:28,002 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:34:28,004 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:34:28,006 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:34:32,069 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:34:32,071 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:34:32,071 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:34:32,072 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:34:32,074 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:34:32,076 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:34:32,081 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:34:32,101 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:32,102 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:34:32,103 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:34:32,103 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:34:32,104 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:34:32,105 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:34:32,122 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:32,606 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:34:32,607 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:34:32,608 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:34:32,608 - APP.services.mt5_service - DEBUG - Current price (cp): 4037.335
2025-10-08 10:34:32,615 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 358, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:34:32,655 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 234, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:34:32,655 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:34:32,656 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:34:32,658 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:34:32,658 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:32,659 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:34:32,659 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:34:32,663 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:34:32,663 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:32,664 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:34:32,666 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:34:32,692 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:34:32,692 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:32,693 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:34:32,694 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:34:32,696 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:34:32,720 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:32,721 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:34:32,722 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:34:32,725 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:34:32,726 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:34:32,727 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:34:32,727 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:34:32,752 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:34:32,753 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:34:32,754 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:34:32.754284+07:00
2025-10-08 10:34:32,754 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:34:32.754284+07:00
2025-10-08 10:34:32,755 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:34:32.754284+07:00 trong DST: True
2025-10-08 10:34:32,755 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:34:32,755 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:34:32,756 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:34:32,757 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:34:32,758 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.750556149734
2025-10-08 10:34:32,768 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 113 rates.
2025-10-08 10:34:32,782 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.782765984275
2025-10-08 10:34:32,785 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.750556149734, 'asia': 4036.782765984275, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:34:32,786 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:34:32,787 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.857398285122
2025-10-08 10:34:32,787 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:34:32,788 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.3543557318794
2025-10-08 10:34:32,788 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:34:32,789 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.956842971664
2025-10-08 10:34:32,789 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:34:32,790 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.956384440213
2025-10-08 10:34:32,816 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:34:32,817 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.3003952731606
2025-10-08 10:34:32,818 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:34:32,819 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.2651980956102
2025-10-08 10:34:32,819 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:34:32,820 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.8041902227924
2025-10-08 10:34:32,846 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:34:32,847 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1230798857896
2025-10-08 10:34:32,847 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.857398285122, 'ema200': 4036.3543557318794}, 'M5': {'ema50': 4031.956842971664, 'ema200': 4009.956384440213}, 'M15': {'ema50': 4014.3003952731606, 'ema200': 3980.2651980956102}, 'H1': {'ema50': 3974.8041902227924, 'ema200': 3912.1230798857896}}
2025-10-08 10:34:32,848 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:34:32,848 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.1165046690705807, TRs count: 179
2025-10-08 10:34:32,849 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:34:32,849 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.437153813093882, TRs count: 119
2025-10-08 10:34:32,850 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:34:32,850 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:34:32,851 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:34:32,851 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:34:32,852 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.1165046690705807, 'M1': 1.437153813093882, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:34:32,880 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:34:32,881 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4037.335, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:34:32,882 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:34:32,882 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:34:32,882 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:34:32,883 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:34:32,883 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 41336.999999999985
2025-10-08 10:34:32,896 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 96454.00000000017
2025-10-08 10:34:32,911 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 24784.999999999854
2025-10-08 10:34:32,914 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 42905.99999999995
2025-10-08 10:34:32,914 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:34:32,915 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41336.999999999985}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96454.00000000017}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24784.999999999854}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42905.99999999995}]
2025-10-08 10:34:32,934 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:34:32,936 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:34:32,938 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:34:32,939 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:34:32,939 - APP.services.mt5_service - DEBUG - Position in day range: 0.942431274544807
2025-10-08 10:34:32,939 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:34:32,940 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:34:32.940185+07:00
2025-10-08 10:34:32,940 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:34:32.940185+07:00
2025-10-08 10:34:32,941 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:34:32.940185+07:00 trong DST: True
2025-10-08 10:34:32,941 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:34:32,941 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:34:32,942 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 206
2025-10-08 10:34:32,942 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:32,942 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:32,943 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '3300', 'price': 4037.33, 'distance_pips': 0.5}, {'level': '3325', 'price': 4037.332, 'distance_pips': 0.25}, {'level': '3350', 'price': 4037.335, 'distance_pips': 0.0}, {'level': '3375', 'price': 4037.338, 'distance_pips': 0.25}]
2025-10-08 10:34:32,943 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1872274849131386}
2025-10-08 10:34:32,943 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:32,944 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:32,944 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:34:32,945 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.335
2025-10-08 10:34:32,946 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:32,971 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:34:32,973 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:32,974 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:34:32,974 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:34:32,975 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4037.335
2025-10-08 10:34:32,976 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:32,976 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:34:32,977 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:33,006 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:34:33,006 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:34:33,008 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4037.335
2025-10-08 10:34:33,008 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:33,009 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:34:33,036 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:33,036 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:34:33,037 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:34:33,038 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.335
2025-10-08 10:34:33,039 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:33,039 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:34:33,065 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:33,067 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:34:33,067 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:33,068 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:33,068 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:34:33,069 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:34:33,069 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:34:33,069 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:34:33,070 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:34:33,070 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:34:33,070 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:34:33,071 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:34:33,074 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:34:33,095 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:34:33,096 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:34:33,096 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:34:33,097 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:34:33,097 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:34:33,097 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:34:33,098 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:34:33,098 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:33,099 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:33,099 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:34:33,100 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:34:33,100 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:34:33,101 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:34:33,102 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:34:33,129 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:34:33,130 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:33,131 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:34:33,131 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:34:33,132 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4037.335, 'ask': 4037.372, 'last': 0.0, 'time': 1759919672}
2025-10-08 10:34:33,135 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:34:33,154 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:34:33,155 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:34:33,156 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:34:33,157 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:33,157 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:33,157 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:33,158 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:33,158 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:33,158 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:34:33,159 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4037.335
2025-10-08 10:34:33,159 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41336.999999999985}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96454.00000000017}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24784.999999999854}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42905.99999999995}]
2025-10-08 10:34:33,160 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:34:33,264 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:33,303 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:34:33,357 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:34:33,366 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:34:33,377 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:34:37,074 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:34:37,076 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:34:37,077 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:34:37,077 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:34:37,079 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:34:37,080 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:34:37,083 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:34:37,083 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:37,111 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:34:37,112 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:34:37,113 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:34:37,113 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:34:37,114 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:34:37,154 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:37,615 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:34:37,616 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:34:37,617 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:34:37,617 - APP.services.mt5_service - DEBUG - Current price (cp): 4037.441
2025-10-08 10:34:37,622 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 354, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:34:37,644 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 234, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:34:37,654 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:34:37,655 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:34:37,658 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:34:37,658 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:37,658 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:34:37,659 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:34:37,662 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:34:37,662 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:37,662 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:34:37,663 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:34:37,664 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:34:37,665 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:37,667 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:34:37,668 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:34:37,673 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:34:37,689 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:37,689 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:34:37,690 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:34:37,693 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:34:37,694 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:34:37,694 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:34:37,695 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:34:37,695 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:34:37,696 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:34:37,696 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:34:37.696481+07:00
2025-10-08 10:34:37,696 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:34:37.696481+07:00
2025-10-08 10:34:37,698 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:34:37.696481+07:00 trong DST: True
2025-10-08 10:34:37,698 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:34:37,699 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:34:37,719 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:34:37,721 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:34:37,721 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.750556149734
2025-10-08 10:34:37,723 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 113 rates.
2025-10-08 10:34:37,723 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.782765984275
2025-10-08 10:34:37,726 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.750556149734, 'asia': 4036.782765984275, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:34:37,727 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:34:37,727 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.857398285122
2025-10-08 10:34:37,728 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:34:37,729 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.3543557318794
2025-10-08 10:34:37,730 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:34:37,736 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.956842971664
2025-10-08 10:34:37,750 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:34:37,750 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.956384440213
2025-10-08 10:34:37,751 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:34:37,751 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.3003952731606
2025-10-08 10:34:37,752 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:34:37,752 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.2651980956102
2025-10-08 10:34:37,752 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:34:37,753 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.8041902227924
2025-10-08 10:34:37,753 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:34:37,754 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1230798857896
2025-10-08 10:34:37,755 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.857398285122, 'ema200': 4036.3543557318794}, 'M5': {'ema50': 4031.956842971664, 'ema200': 4009.956384440213}, 'M15': {'ema50': 4014.3003952731606, 'ema200': 3980.2651980956102}, 'H1': {'ema50': 3974.8041902227924, 'ema200': 3912.1230798857896}}
2025-10-08 10:34:37,755 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:34:37,756 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.1165046690705807, TRs count: 179
2025-10-08 10:34:37,756 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:34:37,757 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.437153813093882, TRs count: 119
2025-10-08 10:34:37,757 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:34:37,758 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:34:37,758 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:34:37,758 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:34:37,759 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.1165046690705807, 'M1': 1.437153813093882, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:34:37,759 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:34:37,761 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4037.441, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:34:37,762 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:34:37,762 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:34:37,783 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:34:37,783 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:34:37,784 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 41442.99999999975
2025-10-08 10:34:37,784 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 96559.99999999994
2025-10-08 10:34:37,785 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 24890.99999999962
2025-10-08 10:34:37,785 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 43011.999999999716
2025-10-08 10:34:37,785 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:34:37,786 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41442.99999999975}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96559.99999999994}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24890.99999999962}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43011.999999999716}]
2025-10-08 10:34:37,786 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:34:37,787 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:34:37,788 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:34:37,788 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:34:37,789 - APP.services.mt5_service - DEBUG - Position in day range: 0.9443234559086016
2025-10-08 10:34:37,789 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:34:37,790 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:34:37.790433+07:00
2025-10-08 10:34:37,792 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:34:37.790433+07:00
2025-10-08 10:34:37,793 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:34:37.790433+07:00 trong DST: True
2025-10-08 10:34:37,793 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:34:37,812 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:34:37,813 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 206
2025-10-08 10:34:37,813 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:37,814 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:37,815 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4400', 'price': 4037.44, 'distance_pips': 0.1}, {'level': '4425', 'price': 4037.443, 'distance_pips': 0.15}, {'level': '4450', 'price': 4037.445, 'distance_pips': 0.4}, {'level': '4475', 'price': 4037.448, 'distance_pips': 0.65}]
2025-10-08 10:34:37,815 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1872274849277302}
2025-10-08 10:34:37,816 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:37,816 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:37,817 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:34:37,817 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.441
2025-10-08 10:34:37,818 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:37,818 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:34:37,819 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:37,819 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:34:37,820 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:34:37,821 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4037.441
2025-10-08 10:34:37,821 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:37,824 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:34:37,848 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:37,849 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:34:37,850 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:34:37,853 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4037.441
2025-10-08 10:34:37,853 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:37,854 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:34:37,855 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:37,856 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:34:37,856 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:34:37,857 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.441
2025-10-08 10:34:37,865 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:37,879 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:34:37,882 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:37,882 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:34:37,883 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:37,884 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:37,885 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:34:37,885 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:34:37,886 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:34:37,886 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:34:37,910 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:34:37,910 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:34:37,911 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:34:37,912 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:34:37,912 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:34:37,913 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:34:37,913 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:34:37,914 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:34:37,914 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:34:37,915 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:34:37,917 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:34:37,918 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:34:37,918 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:37,918 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:37,919 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:34:37,932 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:34:37,941 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:34:37,942 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:34:37,944 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:34:37,945 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:34:37,947 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:37,948 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:34:37,949 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4037.441, 'ask': 4037.478, 'last': 0.0, 'time': 1759919677}
2025-10-08 10:34:37,949 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:34:37,956 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:34:37,968 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:34:37,969 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:37,972 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:34:37,973 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:37,974 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:34:37,974 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:37,975 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:37,975 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:37,976 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:34:37,977 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4037.441
2025-10-08 10:34:37,977 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41442.99999999975}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96559.99999999994}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24890.99999999962}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43011.999999999716}]
2025-10-08 10:34:37,978 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:34:38,073 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:38,074 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:34:38,074 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:34:38,075 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:34:38,077 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:34:40,196 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:34:40,283 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:34:42,078 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:34:42,080 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:34:42,081 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:34:42,081 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:34:42,083 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:34:42,084 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:34:42,087 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:34:42,087 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:42,112 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:34:42,113 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:34:42,114 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:34:42,114 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:34:42,115 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:34:42,208 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:42,616 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:34:42,617 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:34:42,618 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:34:42,618 - APP.services.mt5_service - DEBUG - Current price (cp): 4037.774
2025-10-08 10:34:42,623 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 348, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:34:42,647 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 234, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:34:42,655 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:34:42,656 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:34:42,658 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:34:42,658 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:42,659 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:34:42,659 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:34:42,662 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:34:42,663 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:42,663 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:34:42,664 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:34:42,665 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:34:42,665 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:42,666 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:34:42,668 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:34:42,673 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:34:42,689 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:42,691 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:34:42,691 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:34:42,694 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:34:42,695 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:34:42,696 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:34:42,697 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:34:42,698 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:34:42,699 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:34:42,700 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:34:42.700007+07:00
2025-10-08 10:34:42,700 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:34:42.700007+07:00
2025-10-08 10:34:42,719 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:34:42.700007+07:00 trong DST: True
2025-10-08 10:34:42,720 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:34:42,721 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:34:42,722 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:34:42,724 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:34:42,724 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.750556149734
2025-10-08 10:34:42,725 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 113 rates.
2025-10-08 10:34:42,726 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.782765984275
2025-10-08 10:34:42,728 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.750556149734, 'asia': 4036.782765984275, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:34:42,731 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:34:42,731 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.857398285122
2025-10-08 10:34:42,749 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:34:42,750 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.3543557318794
2025-10-08 10:34:42,752 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:34:42,753 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.956842971664
2025-10-08 10:34:42,753 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:34:42,754 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.956384440213
2025-10-08 10:34:42,754 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:34:42,755 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.3003952731606
2025-10-08 10:34:42,756 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:34:42,757 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.2651980956102
2025-10-08 10:34:42,758 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:34:42,758 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.8041902227924
2025-10-08 10:34:42,759 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:34:42,774 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1230798857896
2025-10-08 10:34:42,784 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.857398285122, 'ema200': 4036.3543557318794}, 'M5': {'ema50': 4031.956842971664, 'ema200': 4009.956384440213}, 'M15': {'ema50': 4014.3003952731606, 'ema200': 3980.2651980956102}, 'H1': {'ema50': 3974.8041902227924, 'ema200': 3912.1230798857896}}
2025-10-08 10:34:42,785 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:34:42,786 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.1165046690705807, TRs count: 179
2025-10-08 10:34:42,786 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:34:42,787 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.437153813093882, TRs count: 119
2025-10-08 10:34:42,787 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:34:42,787 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:34:42,788 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:34:42,788 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:34:42,789 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.1165046690705807, 'M1': 1.437153813093882, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:34:42,789 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:34:42,790 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4037.774, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:34:42,790 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:34:42,816 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:34:42,818 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:34:42,819 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:34:42,819 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 41775.99999999984
2025-10-08 10:34:42,820 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 96893.00000000003
2025-10-08 10:34:42,820 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 25223.999999999705
2025-10-08 10:34:42,821 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 43344.999999999796
2025-10-08 10:34:42,821 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:34:42,848 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41775.99999999984}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96893.00000000003}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25223.999999999705}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43344.999999999796}]
2025-10-08 10:34:42,849 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:34:42,850 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:34:42,850 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:34:42,851 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:34:42,851 - APP.services.mt5_service - DEBUG - Position in day range: 0.950267761513744
2025-10-08 10:34:42,851 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:34:42,852 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:34:42.852262+07:00
2025-10-08 10:34:42,852 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:34:42.852262+07:00
2025-10-08 10:34:42,853 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:34:42.852262+07:00 trong DST: True
2025-10-08 10:34:42,856 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:34:42,874 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:34:42,875 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 206
2025-10-08 10:34:42,875 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:42,876 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:42,876 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '7700', 'price': 4037.77, 'distance_pips': 0.4}, {'level': '7725', 'price': 4037.773, 'distance_pips': 0.15}, {'level': '7750', 'price': 4037.775, 'distance_pips': 0.1}, {'level': '7775', 'price': 4037.778, 'distance_pips': 0.35}]
2025-10-08 10:34:42,876 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1872274849277302}
2025-10-08 10:34:42,877 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:42,877 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:42,878 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:34:42,879 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.774
2025-10-08 10:34:42,879 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:42,880 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:34:42,880 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:42,881 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:34:42,881 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:34:42,882 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4037.774
2025-10-08 10:34:42,883 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:42,883 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:34:42,884 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:42,885 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:34:42,887 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:34:42,892 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4037.774
2025-10-08 10:34:42,902 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:42,911 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:34:42,914 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:42,915 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:34:42,915 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:34:42,917 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.774
2025-10-08 10:34:42,919 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:42,924 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:34:42,939 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:42,944 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:34:42,944 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:42,945 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:42,945 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:34:42,946 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:34:42,946 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:34:42,947 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:34:42,949 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:34:42,958 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:34:42,971 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:34:42,972 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:34:42,972 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:34:42,973 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:34:42,973 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:34:42,974 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:34:42,974 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:34:42,975 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:34:42,975 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:34:42,975 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:34:42,976 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:42,976 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:42,976 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:34:42,977 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:34:42,977 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:34:42,978 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:34:42,979 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:34:42,981 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:34:43,004 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:43,006 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:34:43,006 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4037.774, 'ask': 4037.811, 'last': 0.0, 'time': 1759919682}
2025-10-08 10:34:43,007 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:34:43,007 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:34:43,009 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:34:43,010 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:34:43,018 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:34:43,030 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:43,031 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:43,032 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:43,032 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:43,033 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:43,033 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:34:43,034 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4037.774
2025-10-08 10:34:43,034 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41775.99999999984}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96893.00000000003}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25223.999999999705}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43344.999999999796}]
2025-10-08 10:34:43,035 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:34:43,132 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:43,133 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:34:43,133 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:34:43,136 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:34:43,142 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:34:47,082 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:34:47,084 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:34:47,084 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:34:47,085 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:34:47,087 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:34:47,087 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:34:47,091 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:34:47,092 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:47,117 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:34:47,118 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:34:47,119 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:34:47,119 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:34:47,120 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:34:47,160 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:47,621 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:34:47,623 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:34:47,624 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:34:47,624 - APP.services.mt5_service - DEBUG - Current price (cp): 4037.848
2025-10-08 10:34:47,629 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 350, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:34:47,660 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 234, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:34:47,669 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:34:47,670 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:34:47,672 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:34:47,673 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:47,675 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:34:47,676 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:34:47,679 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:34:47,680 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:47,680 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:34:47,680 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:34:47,683 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:34:47,683 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:47,684 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:34:47,684 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:34:47,686 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:34:47,686 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:47,687 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:34:47,687 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:34:47,690 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:34:47,690 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:34:47,691 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:34:47,691 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:34:47,692 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:34:47,692 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:34:47,693 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:34:47.693172+07:00
2025-10-08 10:34:47,693 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:34:47.693172+07:00
2025-10-08 10:34:47,694 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:34:47.693172+07:00 trong DST: True
2025-10-08 10:34:47,694 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:34:47,695 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:34:47,695 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:34:47,696 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:34:47,697 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.750556149734
2025-10-08 10:34:47,699 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 113 rates.
2025-10-08 10:34:47,726 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.782765984275
2025-10-08 10:34:47,749 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.750556149734, 'asia': 4036.782765984275, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:34:47,750 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:34:47,751 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.857398285122
2025-10-08 10:34:47,751 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:34:47,752 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.3543557318794
2025-10-08 10:34:47,752 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:34:47,753 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.956842971664
2025-10-08 10:34:47,753 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:34:47,753 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.956384440213
2025-10-08 10:34:47,754 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:34:47,754 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.3003952731606
2025-10-08 10:34:47,755 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:34:47,755 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.2651980956102
2025-10-08 10:34:47,756 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:34:47,756 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.8041902227924
2025-10-08 10:34:47,757 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:34:47,757 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1230798857896
2025-10-08 10:34:47,757 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.857398285122, 'ema200': 4036.3543557318794}, 'M5': {'ema50': 4031.956842971664, 'ema200': 4009.956384440213}, 'M15': {'ema50': 4014.3003952731606, 'ema200': 3980.2651980956102}, 'H1': {'ema50': 3974.8041902227924, 'ema200': 3912.1230798857896}}
2025-10-08 10:34:47,758 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:34:47,759 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.1165046690705807, TRs count: 179
2025-10-08 10:34:47,759 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:34:47,759 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.437153813093882, TRs count: 119
2025-10-08 10:34:47,760 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:34:47,763 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.49278796042937, TRs count: 95
2025-10-08 10:34:47,769 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:34:47,787 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.09103280068215, TRs count: 119
2025-10-08 10:34:47,788 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.1165046690705807, 'M1': 1.437153813093882, 'M15': 5.49278796042937, 'H1': 11.09103280068215}
2025-10-08 10:34:47,788 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:34:47,788 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4037.848, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:34:47,789 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:34:47,789 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:34:47,790 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:34:47,790 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:34:47,790 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 41849.999999999905
2025-10-08 10:34:47,793 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 96967.0000000001
2025-10-08 10:34:47,794 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 25297.999999999774
2025-10-08 10:34:47,813 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 43418.99999999987
2025-10-08 10:34:47,814 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:34:47,814 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41849.999999999905}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96967.0000000001}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25297.999999999774}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43418.99999999987}]
2025-10-08 10:34:47,815 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:34:47,816 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:34:47,816 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:34:47,817 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:34:47,817 - APP.services.mt5_service - DEBUG - Position in day range: 0.9515887183148877
2025-10-08 10:34:47,817 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:34:47,818 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:34:47.818451+07:00
2025-10-08 10:34:47,818 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:34:47.818451+07:00
2025-10-08 10:34:47,819 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:34:47.818451+07:00 trong DST: True
2025-10-08 10:34:47,819 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:34:47,820 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:34:47,820 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 206
2025-10-08 10:34:47,820 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:47,821 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:47,822 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '8400', 'price': 4037.84, 'distance_pips': 0.8}, {'level': '8425', 'price': 4037.843, 'distance_pips': 0.55}, {'level': '8450', 'price': 4037.845, 'distance_pips': 0.3}, {'level': '8475', 'price': 4037.848, 'distance_pips': 0.05}]
2025-10-08 10:34:47,822 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1872274849277302}
2025-10-08 10:34:47,846 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:47,847 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:47,847 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:34:47,848 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.848
2025-10-08 10:34:47,849 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:47,849 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:34:47,850 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:47,850 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:34:47,851 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:34:47,851 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4037.848
2025-10-08 10:34:47,852 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:47,852 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:34:47,853 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:47,855 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:34:47,881 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:34:47,883 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4037.848
2025-10-08 10:34:47,883 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:47,884 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:34:47,884 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:47,888 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:34:47,908 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:34:47,909 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.848
2025-10-08 10:34:47,910 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:47,911 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:34:47,911 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:47,912 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:34:47,912 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:47,913 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:47,913 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:34:47,914 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:34:47,914 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:34:47,914 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:34:47,915 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:34:47,916 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:34:47,917 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:34:47,945 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:34:47,945 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:34:47,946 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:34:47,946 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:34:47,949 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:34:47,975 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:34:47,977 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:34:47,978 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:34:47,978 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:34:48,009 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:48,067 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:48,068 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:34:48,069 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:34:48,069 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:34:48,069 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:34:48,070 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:34:48,071 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:34:48,077 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:48,078 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:34:48,078 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4037.848, 'ask': 4037.885, 'last': 0.0, 'time': 1759919686}
2025-10-08 10:34:48,078 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:34:48,079 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:34:48,081 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:34:48,082 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:34:48,083 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:34:48,083 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:48,084 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:48,084 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:48,085 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:48,085 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:48,085 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:34:48,086 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4037.848
2025-10-08 10:34:48,086 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41849.999999999905}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96967.0000000001}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 25297.999999999774}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 43418.99999999987}]
2025-10-08 10:34:48,087 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:34:48,128 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:48,129 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:34:48,129 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:34:48,131 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:34:48,132 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:34:52,086 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:34:52,089 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:34:52,089 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:34:52,090 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:34:52,092 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:34:52,093 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:34:52,097 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:34:52,097 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:52,126 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:34:52,127 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:34:52,128 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:34:52,128 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:34:52,129 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:34:52,152 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:52,631 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:34:52,636 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:34:52,638 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:34:52,639 - APP.services.mt5_service - DEBUG - Current price (cp): 4037.225
2025-10-08 10:34:52,650 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 351, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:34:52,701 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 234, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:34:52,720 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:34:52,725 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:34:52,728 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:34:52,728 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:52,746 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:34:52,749 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:34:52,753 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:34:52,754 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:52,756 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:34:52,786 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:34:52,789 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:34:52,789 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:52,791 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:34:52,793 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:34:52,801 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:34:52,837 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:52,839 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:34:52,840 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:34:52,845 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:34:52,846 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:34:52,847 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:34:52,849 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:34:52,850 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:34:52,851 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:34:52,852 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:34:52.852046+07:00
2025-10-08 10:34:52,853 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:34:52.852046+07:00
2025-10-08 10:34:52,877 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:34:52.852046+07:00 trong DST: True
2025-10-08 10:34:52,879 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:34:52,880 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:34:52,882 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:34:52,884 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:34:52,887 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7525302902864
2025-10-08 10:34:52,909 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 113 rates.
2025-10-08 10:34:52,910 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.782765984275
2025-10-08 10:34:52,918 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7525302902864, 'asia': 4036.782765984275, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:34:52,941 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:34:52,942 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.8734767164947
2025-10-08 10:34:52,943 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:34:52,944 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.3584353338697
2025-10-08 10:34:52,945 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:34:52,951 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.9729214030367
2025-10-08 10:34:52,974 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:34:52,975 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.960464042203
2025-10-08 10:34:52,977 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:34:52,979 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.316473704533
2025-10-08 10:34:53,005 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:34:53,006 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.2692776976005
2025-10-08 10:34:53,008 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:34:53,048 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.820268654165
2025-10-08 10:34:53,049 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:34:53,050 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.12715948778
2025-10-08 10:34:53,050 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.8734767164947, 'ema200': 4036.3584353338697}, 'M5': {'ema50': 4031.9729214030367, 'ema200': 4009.960464042203}, 'M15': {'ema50': 4014.316473704533, 'ema200': 3980.2692776976005}, 'H1': {'ema50': 3974.820268654165, 'ema200': 3912.12715948778}}
2025-10-08 10:34:53,051 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:34:53,052 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.146504669070586, TRs count: 179
2025-10-08 10:34:53,052 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:34:53,053 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.4875823845224303, TRs count: 119
2025-10-08 10:34:53,053 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:34:53,053 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.52050224614365, TRs count: 95
2025-10-08 10:34:53,054 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:34:53,055 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.11874708639643, TRs count: 119
2025-10-08 10:34:53,055 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.146504669070586, 'M1': 1.4875823845224303, 'M15': 5.52050224614365, 'H1': 11.11874708639643}
2025-10-08 10:34:53,056 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:34:53,056 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4037.225, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:34:53,056 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:34:53,057 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:34:53,057 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:34:53,058 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:34:53,058 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 41226.99999999986
2025-10-08 10:34:53,058 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 96344.00000000004
2025-10-08 10:34:53,059 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 24674.999999999727
2025-10-08 10:34:53,059 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 42795.99999999982
2025-10-08 10:34:53,060 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:34:53,061 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41226.99999999986}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96344.00000000004}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24674.999999999727}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42795.99999999982}]
2025-10-08 10:34:53,061 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:34:53,062 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:34:53,063 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:34:53,063 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:34:53,063 - APP.services.mt5_service - DEBUG - Position in day range: 0.9404676901106741
2025-10-08 10:34:53,064 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:34:53,064 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:34:53.064733+07:00
2025-10-08 10:34:53,065 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:34:53.064733+07:00
2025-10-08 10:34:53,065 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:34:53.064733+07:00 trong DST: True
2025-10-08 10:34:53,065 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:34:53,066 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:34:53,066 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 206
2025-10-08 10:34:53,067 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:53,067 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:53,067 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '2200', 'price': 4037.22, 'distance_pips': 0.5}, {'level': '2225', 'price': 4037.223, 'distance_pips': 0.25}, {'level': '2250', 'price': 4037.225, 'distance_pips': 0.0}, {'level': '2275', 'price': 4037.228, 'distance_pips': 0.25}]
2025-10-08 10:34:53,068 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.1759079960682528}
2025-10-08 10:34:53,068 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:53,068 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:53,069 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:34:53,070 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.225
2025-10-08 10:34:53,070 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:53,071 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:34:53,071 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:53,072 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:34:53,072 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:34:53,073 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4037.225
2025-10-08 10:34:53,076 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:53,079 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:34:53,096 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:53,097 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:34:53,098 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:34:53,099 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4037.225
2025-10-08 10:34:53,099 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:53,099 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:34:53,100 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:53,101 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:34:53,101 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:34:53,102 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4037.225
2025-10-08 10:34:53,103 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:53,103 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:34:53,110 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:53,129 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:34:53,130 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:53,131 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:53,131 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:34:53,131 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:34:53,132 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:34:53,132 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:34:53,133 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:34:53,134 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:34:53,134 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:34:53,134 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:34:53,135 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:34:53,160 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:34:53,161 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:34:53,164 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:34:53,165 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:34:53,165 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:34:53,166 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:34:53,168 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:34:53,184 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:53,191 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:53,192 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:34:53,193 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:34:53,194 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:34:53,196 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:34:53,197 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:34:53,201 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:34:53,224 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:53,225 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:34:53,225 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:34:53,225 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4037.225, 'ask': 4037.262, 'last': 0.0, 'time': 1759919692}
2025-10-08 10:34:53,228 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:34:53,231 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:34:53,243 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:34:53,252 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:34:53,253 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:53,254 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:53,255 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:53,255 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:53,256 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:53,256 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:34:53,257 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4037.225
2025-10-08 10:34:53,257 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 41226.99999999986}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 96344.00000000004}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 24674.999999999727}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42795.99999999982}]
2025-10-08 10:34:53,258 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:34:53,288 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:53,289 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:34:53,290 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:34:53,292 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:34:53,321 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:34:55,200 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:34:55,229 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:34:57,091 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:34:57,094 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:34:57,094 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:34:57,096 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:34:57,098 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:34:57,131 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:34:57,133 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:34:57,137 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:34:57,139 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:34:57,157 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:34:57,158 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:34:57,159 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:57,159 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:34:57,238 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:57,667 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:34:57,676 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:34:57,681 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:34:57,681 - APP.services.mt5_service - DEBUG - Current price (cp): 4036.498
2025-10-08 10:34:57,687 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 350, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:34:57,720 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 235, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:34:57,724 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:34:57,724 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:34:57,729 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:34:57,732 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:57,758 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:34:57,761 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:34:57,801 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:34:57,804 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:57,805 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:34:57,811 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:34:57,817 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:34:57,819 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:57,837 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:34:57,838 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:34:57,843 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:34:57,846 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:34:57,876 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:34:57,878 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:34:57,882 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:34:57,886 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:34:57,913 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:34:57,914 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:34:57,915 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:34:57,916 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:34:57,943 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:34:57.943606+07:00
2025-10-08 10:34:57,945 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:34:57.943606+07:00
2025-10-08 10:34:57,946 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:34:57.943606+07:00 trong DST: True
2025-10-08 10:34:57,947 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:34:57,974 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:34:57,975 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:34:57,978 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:34:58,002 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7599627216155
2025-10-08 10:34:58,006 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 113 rates.
2025-10-08 10:34:58,009 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.782765984275
2025-10-08 10:34:58,069 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7599627216155, 'asia': 4036.782765984275, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:34:58,070 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:34:58,072 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.883868873357
2025-10-08 10:34:58,101 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:34:58,104 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.36107214979
2025-10-08 10:34:58,112 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:34:58,115 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.983313559899
2025-10-08 10:34:58,118 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:34:58,119 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.963100858123
2025-10-08 10:34:58,120 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:34:58,120 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.3268658613956
2025-10-08 10:34:58,121 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:34:58,122 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.2719145135206
2025-10-08 10:34:58,123 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:34:58,124 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.8306608110274
2025-10-08 10:34:58,126 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:34:58,126 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1297963037
2025-10-08 10:34:58,127 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.883868873357, 'ema200': 4036.36107214979}, 'M5': {'ema50': 4031.983313559899, 'ema200': 4009.963100858123}, 'M15': {'ema50': 4014.3268658613956, 'ema200': 3980.2719145135206}, 'H1': {'ema50': 3974.8306608110274, 'ema200': 3912.1297963037}}
2025-10-08 10:34:58,127 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:34:58,128 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.163147526213423, TRs count: 179
2025-10-08 10:34:58,129 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:34:58,130 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5042252416652673, TRs count: 119
2025-10-08 10:34:58,130 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:34:58,131 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.537145103286487, TRs count: 95
2025-10-08 10:34:58,132 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:34:58,133 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.135389943539268, TRs count: 119
2025-10-08 10:34:58,134 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.163147526213423, 'M1': 1.5042252416652673, 'M15': 5.537145103286487, 'H1': 11.135389943539268}
2025-10-08 10:34:58,135 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:34:58,183 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4036.498, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:34:58,184 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:34:58,186 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:34:58,186 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:34:58,187 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:34:58,187 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 40500.0
2025-10-08 10:34:58,188 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 95617.00000000019
2025-10-08 10:34:58,189 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 23947.999999999865
2025-10-08 10:34:58,189 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 42068.999999999956
2025-10-08 10:34:58,190 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:34:58,190 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 40500.0}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 95617.00000000019}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 23947.999999999865}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42068.999999999956}]
2025-10-08 10:34:58,191 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:34:58,192 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:34:58,192 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:34:58,193 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:34:58,194 - APP.services.mt5_service - DEBUG - Position in day range: 0.9274901820778312
2025-10-08 10:34:58,194 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:34:58,194 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:34:58.194916+07:00
2025-10-08 10:34:58,195 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:34:58.194916+07:00
2025-10-08 10:34:58,196 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:34:58.194916+07:00 trong DST: True
2025-10-08 10:34:58,196 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:34:58,197 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:34:58,197 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 206
2025-10-08 10:34:58,223 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:58,225 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:58,227 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4900', 'price': 4036.49, 'distance_pips': 0.8}, {'level': '4925', 'price': 4036.493, 'distance_pips': 0.55}, {'level': '4950', 'price': 4036.495, 'distance_pips': 0.3}, {'level': '4975', 'price': 4036.498, 'distance_pips': 0.05}]
2025-10-08 10:34:58,227 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.169720972328457}
2025-10-08 10:34:58,228 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:58,228 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:58,229 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:34:58,231 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4036.498
2025-10-08 10:34:58,232 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:58,255 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:34:58,257 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:58,258 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:34:58,291 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:34:58,317 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4036.498
2025-10-08 10:34:58,318 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:58,318 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:34:58,319 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:58,320 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:34:58,320 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:34:58,322 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4036.498
2025-10-08 10:34:58,351 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:58,352 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:34:58,353 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:58,354 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:34:58,357 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:34:58,378 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4036.498
2025-10-08 10:34:58,380 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:34:58,381 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:34:58,383 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:34:58,384 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:34:58,386 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:58,390 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:58,426 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:34:58,427 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:34:58,428 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:34:58,429 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:34:58,429 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:34:58,430 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:34:58,431 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:34:58,432 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:34:58,432 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:34:58,433 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:34:58,433 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:34:58,434 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:34:58,434 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:34:58,435 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:34:58,436 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:34:58,437 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:34:58,437 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:58,438 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:58,438 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:34:58,439 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:34:58,439 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:34:58,440 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:34:58,440 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:34:58,442 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:34:58,443 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:34:58,444 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:58,444 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:34:58,445 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4036.498, 'ask': 4036.535, 'last': 0.0, 'time': 1759919696}
2025-10-08 10:34:58,449 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:34:58,472 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:34:58,474 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:34:58,474 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:34:58,475 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:58,476 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:58,477 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:58,477 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:34:58,478 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:34:58,518 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:34:58,519 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4036.498
2025-10-08 10:34:58,519 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 40500.0}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 95617.00000000019}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 23947.999999999865}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 42068.999999999956}]
2025-10-08 10:34:58,521 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:34:58,526 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:34:58,526 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:34:58,527 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:34:58,528 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:34:58,529 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:35:01,901 - APP.ui.app_ui - INFO - Autorun tick: Kích hoạt worker kiểm tra.
2025-10-08 10:35:01,902 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_autorun_tick_worker' vào thread pool.
2025-10-08 10:35:01,903 - APP.ui.app_ui - DEBUG - Autorun tick worker: Bắt đầu kiểm tra điều kiện.
2025-10-08 10:35:01,904 - APP.ui.app_ui - INFO - Autorun tick worker: Điều kiện hợp lệ, yêu cầu bắt đầu phân tích trên luồng UI.
2025-10-08 10:35:01,940 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: start_analysis
2025-10-08 10:35:01,940 - APP.ui.app_ui - INFO - Yêu cầu bắt đầu phân tích từ UI.
2025-10-08 10:35:01,942 - APP.ui.utils.ui_builder - DEBUG - Đã thay đổi trạng thái nút Start/Stop thành 'disabled'. Các điều khiển khác không bị ảnh hưởng.
2025-10-08 10:35:01,942 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:35:01,943 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:35:01,944 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:35:01,945 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:35:01,945 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:35:01,946 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:35:01,947 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:35:01,950 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:35:01,978 - APP.services.te_service - INFO - Đăng nhập thành công vào Trading Economics API.
2025-10-08 10:35:01,978 - APP.services.news_service - DEBUG - Cấu hình NewsService đã được cập nhật.
2025-10-08 10:35:02,003 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-08 10:35:02,003 - APP.ui.app_ui - INFO - Đã khởi tạo và bắt đầu luồng AnalysisWorker.
2025-10-08 10:35:02,004 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-08 10:35:02,013 - APP.services.gemini_service - INFO - Đã khởi tạo model 'models/gemini-2.5-flash' thành công.
2025-10-08 10:35:02,039 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 2: Xây dựng ngữ cảnh và kiểm tra điều kiện.
2025-10-08 10:35:02,039 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-RUN.
2025-10-08 10:35:02,040 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 3: Chuẩn bị và upload ảnh (song song).
2025-10-08 10:35:02,041 - APP.analysis.image_processor - DEBUG - Đang thử tải cache upload.
2025-10-08 10:35:02,061 - APP.services.mt5_service - DEBUG - Bắt đầu get_active_killzone cho 2025-10-08 10:35:02.040786 với timezone Asia/Ho_Chi_Minh
2025-10-08 10:35:02,063 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-08 10:35:02.040786+07:00, Target TZ: None
2025-10-08 10:35:02,064 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 10:35:02.040786+07:00
2025-10-08 10:35:02,065 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 10:35:02.040786+07:00 trong DST: True
2025-10-08 10:35:02,065 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:35:02,065 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:35:02,066 - APP.services.mt5_service - DEBUG - Không trong killzone nào.
2025-10-08 10:35:02,066 - APP.core.trading.conditions - INFO - Điều kiện NO-RUN được kích hoạt: Không chạy ngoài các Kill Zone đã định nghĩa.
2025-10-08 10:35:02,067 - APP.core.trading.conditions - INFO - Thoát sớm. Giai đoạn: no-run, Lý do: Không chạy ngoài các Kill Zone đã định nghĩa.
2025-10-08 10:35:02,067 - APP.persistence.log_handler - DEBUG - Đang chuẩn bị ghi log giao dịch. Giai đoạn: no-run, Thư mục con: None
2025-10-08 10:35:02,071 - APP.analysis.image_processor - DEBUG - Đã tải cache upload với 4 mục.
2025-10-08 10:35:02,094 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_H1.png: 15022:1759914264:adcc044a34c2739b
2025-10-08 10:35:02,095 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_H1.png. Tên từ xa: files/jcq192qkqfx5
2025-10-08 10:35:02,096 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M1.png: 22562:1759919694:5b4938732766e6bc
2025-10-08 10:35:02,096 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_H1.png, đang lấy thông tin file...
2025-10-08 10:35:02,096 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:35:02,097 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M1.png, nhưng chữ ký không khớp.
2025-10-08 10:35:02,098 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M15.png: 14475:1759914258:f522dd906714fb0b
2025-10-08 10:35:02,098 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M5.png: 20530:1759919699:22bff43ee115a669
2025-10-08 10:35:02,131 - APP.analysis.image_processor - DEBUG - Đang chuẩn bị ảnh: XAUUSD_M1.png, Tối ưu hóa: False
2025-10-08 10:35:02,133 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:35:02,133 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:35:02,133 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M15.png. Tên từ xa: files/4s2o4xrat6a8
2025-10-08 10:35:02,142 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M5.png, nhưng chữ ký không khớp.
2025-10-08 10:35:02,162 - APP.analysis.image_processor - DEBUG - Bỏ qua tối ưu hóa hình ảnh.
2025-10-08 10:35:02,164 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:35:02,164 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M15.png, đang lấy thông tin file...
2025-10-08 10:35:02,165 - APP.analysis.image_processor - DEBUG - Đang chuẩn bị ảnh: XAUUSD_M5.png, Tối ưu hóa: False
2025-10-08 10:35:02,165 - APP.analysis.image_processor - INFO - Đang tải 'XAUUSD_M1.png' lên Gemini File API...
2025-10-08 10:35:02,168 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:02,169 - APP.persistence.log_handler - DEBUG - Đã ghi log giao dịch thành công vào trade_log_20251008.jsonl.
2025-10-08 10:35:02,189 - APP.analysis.image_processor - DEBUG - Bỏ qua tối ưu hóa hình ảnh.
2025-10-08 10:35:02,192 - APP.persistence.log_handler - DEBUG - Kết thúc hàm log_trade.
2025-10-08 10:35:02,193 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:02,193 - APP.analysis.image_processor - INFO - Đang tải 'XAUUSD_M5.png' lên Gemini File API...
2025-10-08 10:35:02,194 - APP.core.analysis_worker - INFO - Giai đoạn 2 thoát sớm: Điều kiện No-Run: Không chạy ngoài các Kill Zone đã định nghĩa.
2025-10-08 10:35:02,196 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:02,197 - APP.utils.threading_utils - DEBUG - Tác vụ song song '_execute_stage_2_logic' đã hoàn thành.
2025-10-08 10:35:02,229 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:35:02,238 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:35:02,240 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:35:02,241 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:35:02,244 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:35:02,248 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:35:02,248 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:02,248 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:35:02,250 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:35:02,313 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:02,415 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:02,516 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:02,617 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:02,718 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:02,751 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:35:02,753 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:35:02,754 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:35:02,754 - APP.services.mt5_service - DEBUG - Current price (cp): 4036.38
2025-10-08 10:35:02,762 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 354, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:35:02,828 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 235, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:35:02,829 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:02,831 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:35:02,832 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:02,832 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:35:02,835 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:35:02,836 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:02,837 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:35:02,840 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:35:02,844 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:35:02,845 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:02,845 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:35:02,846 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:35:02,848 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:35:02,848 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:02,849 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:35:02,849 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:35:02,852 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:35:02,853 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:02,853 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:35:02,853 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:35:02,857 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:35:02,879 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:35:02,880 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:35:02,880 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:35:02,881 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:35:02,881 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:35:02,881 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:35:02.881751+07:00
2025-10-08 10:35:02,882 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:35:02.881751+07:00
2025-10-08 10:35:02,882 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:35:02.881751+07:00 trong DST: True
2025-10-08 10:35:02,883 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:35:02,883 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:35:02,883 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:35:02,885 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:35:02,886 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7599627216155
2025-10-08 10:35:02,909 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 113 rates.
2025-10-08 10:35:02,910 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.782765984275
2025-10-08 10:35:02,914 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7599627216155, 'asia': 4036.782765984275, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:35:02,916 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:35:02,917 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.883868873357
2025-10-08 10:35:02,940 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:02,941 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:35:02,941 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:02,942 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.36107214979
2025-10-08 10:35:02,943 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:35:02,944 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.983313559899
2025-10-08 10:35:02,944 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:35:02,946 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.963100858123
2025-10-08 10:35:02,947 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:35:02,947 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.3268658613956
2025-10-08 10:35:02,948 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:35:02,948 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.2719145135206
2025-10-08 10:35:02,975 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:35:02,976 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.8306608110274
2025-10-08 10:35:02,977 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:35:02,978 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1297963037
2025-10-08 10:35:02,979 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.883868873357, 'ema200': 4036.36107214979}, 'M5': {'ema50': 4031.983313559899, 'ema200': 4009.963100858123}, 'M15': {'ema50': 4014.3268658613956, 'ema200': 3980.2719145135206}, 'H1': {'ema50': 3974.8306608110274, 'ema200': 3912.1297963037}}
2025-10-08 10:35:03,001 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:35:03,003 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.163147526213423, TRs count: 179
2025-10-08 10:35:03,004 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:35:03,005 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5042252416652673, TRs count: 119
2025-10-08 10:35:03,005 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:35:03,006 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.537145103286487, TRs count: 95
2025-10-08 10:35:03,006 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:35:03,007 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.135389943539268, TRs count: 119
2025-10-08 10:35:03,009 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.163147526213423, 'M1': 1.5042252416652673, 'M15': 5.537145103286487, 'H1': 11.135389943539268}
2025-10-08 10:35:03,010 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:35:03,011 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4036.38, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:35:03,039 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:35:03,040 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:35:03,040 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:35:03,041 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:35:03,041 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 40382.00000000006
2025-10-08 10:35:03,042 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:03,067 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 95499.00000000025
2025-10-08 10:35:03,148 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 23829.999999999927
2025-10-08 10:35:03,156 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 41951.00000000002
2025-10-08 10:35:03,186 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:35:03,189 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 40382.00000000006}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 95499.00000000025}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 23829.999999999927}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 41951.00000000002}]
2025-10-08 10:35:03,198 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:35:03,253 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:35:03,291 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:35:03,310 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:35:03,352 - APP.services.mt5_service - DEBUG - Position in day range: 0.9253837915030375
2025-10-08 10:35:03,364 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:35:03,379 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:35:03.379496+07:00
2025-10-08 10:35:03,409 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:35:03.379496+07:00
2025-10-08 10:35:03,437 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:35:03.379496+07:00 trong DST: True
2025-10-08 10:35:03,444 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:35:03,473 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:35:03,504 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 205
2025-10-08 10:35:03,510 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:03,540 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:03,564 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '3800', 'price': 4036.38, 'distance_pips': 0.0}, {'level': '3825', 'price': 4036.383, 'distance_pips': 0.25}, {'level': '3850', 'price': 4036.385, 'distance_pips': 0.5}, {'level': '3875', 'price': 4036.388, 'distance_pips': 0.75}]
2025-10-08 10:35:03,595 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.169720972328457}
2025-10-08 10:35:03,602 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:03,647 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:03,657 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:35:03,666 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4036.38
2025-10-08 10:35:03,727 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:35:03,741 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:35:03,749 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:03,761 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:35:03,829 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:35:03,844 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4036.38
2025-10-08 10:35:03,880 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:35:03,882 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:35:03,987 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:03,998 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:35:03,999 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:35:04,001 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4036.38
2025-10-08 10:35:04,003 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:35:04,005 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:35:04,006 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:04,007 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:35:04,008 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:35:04,041 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4036.38
2025-10-08 10:35:04,048 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:35:04,050 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:35:04,053 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:04,056 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:35:04,058 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:04,111 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:04,119 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:35:04,120 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:35:04,121 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:35:04,123 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:35:04,126 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:35:04,127 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:35:04,134 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:35:04,170 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:35:04,447 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:35:04,575 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:35:04,620 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:35:04,621 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:35:04,623 - googleapiclient.discovery - DEBUG - URL being requested: POST https://generativelanguage.googleapis.com/upload/v1beta/files?key=AIzaSyDSYUGBjTZkXmxIAA4ySZi6h1EepuAnoKE&alt=json&uploadType=resumable
2025-10-08 10:35:04,624 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:35:04,626 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:35:04,640 - googleapiclient.discovery - DEBUG - URL being requested: POST https://generativelanguage.googleapis.com/upload/v1beta/files?key=AIzaSyDSYUGBjTZkXmxIAA4ySZi6h1EepuAnoKE&alt=json&uploadType=resumable
2025-10-08 10:35:04,641 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:35:04,659 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:35:04,660 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:04,751 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:04,794 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:35:04,797 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:35:04,798 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:35:04,799 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:35:04,800 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:35:04,801 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:35:04,803 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:04,804 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:35:04,804 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:35:04,805 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4036.38, 'ask': 4036.417, 'last': 0.0, 'time': 1759919702}
2025-10-08 10:35:04,807 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:35:04,807 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:35:04,808 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:35:04,808 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:35:04,809 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:04,810 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:04,811 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:04,811 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:04,812 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:04,812 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:35:04,812 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4036.38
2025-10-08 10:35:04,813 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 40382.00000000006}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 95499.00000000025}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 23829.999999999927}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 41951.00000000002}]
2025-10-08 10:35:04,813 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:35:04,893 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:04,894 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:35:04,895 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:35:04,897 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:35:04,900 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:35:06,253 - APP.analysis.image_processor - DEBUG - Yêu cầu tải lên đã được gửi. Tên từ xa: files/verl2q0oxkyk. Đang chờ trạng thái ACTIVE.
2025-10-08 10:35:06,534 - APP.analysis.image_processor - DEBUG - Yêu cầu tải lên đã được gửi. Tên từ xa: files/dp4jmcr5j3ke. Đang chờ trạng thái ACTIVE.
2025-10-08 10:35:06,908 - APP.analysis.image_processor - DEBUG - Kiểm tra trạng thái tệp cho 'XAUUSD_M5.png': ACTIVE. Thời gian đã trôi qua: 0.7s
2025-10-08 10:35:06,923 - APP.analysis.image_processor - INFO - Đã tải lên và xử lý thành công 'XAUUSD_M5.png'.
2025-10-08 10:35:06,927 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M5.png: 20530:1759919699:22bff43ee115a669
2025-10-08 10:35:06,940 - APP.analysis.image_processor - DEBUG - Đã thêm/cập nhật XAUUSD_M5.png trong cache với tên từ xa files/verl2q0oxkyk.
2025-10-08 10:35:06,941 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:06,960 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:07,166 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:35:07,169 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:35:07,169 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:35:07,170 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:35:07,171 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:35:07,172 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:35:07,176 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:35:07,176 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:07,191 - APP.analysis.image_processor - DEBUG - Kiểm tra trạng thái tệp cho 'XAUUSD_M1.png': ACTIVE. Thời gian đã trôi qua: 0.7s
2025-10-08 10:35:07,196 - APP.analysis.image_processor - INFO - Đã tải lên và xử lý thành công 'XAUUSD_M1.png'.
2025-10-08 10:35:07,198 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M1.png: 22562:1759919694:5b4938732766e6bc
2025-10-08 10:35:07,198 - APP.analysis.image_processor - DEBUG - Đã thêm/cập nhật XAUUSD_M1.png trong cache với tên từ xa files/dp4jmcr5j3ke.
2025-10-08 10:35:07,202 - APP.analysis.image_processor - DEBUG - Đang lưu cache upload với 4 mục.
2025-10-08 10:35:07,218 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:35:07,223 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:35:07,224 - APP.analysis.image_processor - DEBUG - Đã lưu cache upload thành công.
2025-10-08 10:35:07,224 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:35:07,225 - APP.utils.threading_utils - DEBUG - Tác vụ song song '_execute_stage_3_logic' đã hoàn thành.
2025-10-08 10:35:07,225 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:35:07,226 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:35:07,227 - APP.core.analysis_worker - WARNING - Một trong các giai đoạn song song đã thất bại. Dừng worker.
2025-10-08 10:35:07,228 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Thoát sớm do lỗi ở Giai đoạn 2 hoặc 3.
2025-10-08 10:35:07,228 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-08 10:35:07,229 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-08 10:35:07,265 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:07,571 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:07,572 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:07,728 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:35:07,730 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:35:07,731 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:35:07,733 - APP.services.mt5_service - DEBUG - Current price (cp): 4036.25
2025-10-08 10:35:07,743 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 355, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:35:07,821 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 236, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:35:07,829 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:35:07,831 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:35:07,834 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:35:07,836 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:07,837 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:35:07,837 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:35:07,842 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:35:07,843 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:07,845 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:35:07,845 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:35:07,847 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:35:07,849 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:07,850 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:35:07,852 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:35:07,855 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:35:07,859 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:07,880 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:35:07,883 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:35:07,892 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:35:07,909 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:35:07,910 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:35:07,911 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}
2025-10-08 10:35:07,913 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:35:07,914 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:35:07,916 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:35:07.916515+07:00
2025-10-08 10:35:07,919 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:35:07.916515+07:00
2025-10-08 10:35:07,920 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:35:07.916515+07:00 trong DST: True
2025-10-08 10:35:07,944 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:35:07,946 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:35:07,948 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:35:07,972 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:35:07,974 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.7599627216155
2025-10-08 10:35:07,977 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 113 rates.
2025-10-08 10:35:07,979 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4036.782765984275
2025-10-08 10:35:08,004 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4036.7599627216155, 'asia': 4036.782765984275, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:35:08,005 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:35:08,007 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4037.883868873357
2025-10-08 10:35:08,010 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:35:08,013 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.36107214979
2025-10-08 10:35:08,036 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:35:08,038 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4031.983313559899
2025-10-08 10:35:08,041 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:35:08,043 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4009.963100858123
2025-10-08 10:35:08,046 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:35:08,070 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4014.3268658613956
2025-10-08 10:35:08,072 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:35:08,077 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3980.2719145135206
2025-10-08 10:35:08,097 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:35:08,100 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3974.8306608110274
2025-10-08 10:35:08,102 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:35:08,104 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1297963037
2025-10-08 10:35:08,104 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4037.883868873357, 'ema200': 4036.36107214979}, 'M5': {'ema50': 4031.983313559899, 'ema200': 4009.963100858123}, 'M15': {'ema50': 4014.3268658613956, 'ema200': 3980.2719145135206}, 'H1': {'ema50': 3974.8306608110274, 'ema200': 3912.1297963037}}
2025-10-08 10:35:08,125 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:35:08,130 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.163147526213423, TRs count: 179
2025-10-08 10:35:08,130 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:35:08,131 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.5042252416652673, TRs count: 119
2025-10-08 10:35:08,133 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:35:08,134 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 5.537145103286487, TRs count: 95
2025-10-08 10:35:08,135 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:35:08,136 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 11.135389943539268, TRs count: 119
2025-10-08 10:35:08,138 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.163147526213423, 'M1': 1.5042252416652673, 'M15': 5.537145103286487, 'H1': 11.135389943539268}
2025-10-08 10:35:08,156 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:08,162 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:35:08,163 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4036.25, daily: {'open': 3994.429, 'high': 4040.56, 'low': 3984.54, 'eq50': 4012.55, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:35:08,164 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:08,164 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:35:08,165 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: _finalize_done
2025-10-08 10:35:08,165 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:35:08,166 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4012.55
2025-10-08 10:35:08,166 - APP.ui.utils.ui_builder - DEBUG - Đã thay đổi trạng thái nút Start/Stop thành 'normal'. Các điều khiển khác không bị ảnh hưởng.
2025-10-08 10:35:08,167 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:35:08,167 - APP.ui.app_ui - DEBUG - Lên lịch chạy tự động tiếp theo sau 60000ms.
2025-10-08 10:35:08,168 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 40251.99999999995
2025-10-08 10:35:08,170 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 95369.00000000015
2025-10-08 10:35:08,185 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4012.55, Relation: BELOW, Distance: 23699.999999999818
2025-10-08 10:35:08,192 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 41820.99999999991
2025-10-08 10:35:08,193 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:35:08,193 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 40251.99999999995}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 95369.00000000015}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 23699.999999999818}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 41820.99999999991}]
2025-10-08 10:35:08,195 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:35:08,196 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:35:08,197 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:35:08,197 - APP.services.mt5_service - DEBUG - Day range: 56.01999999999998, Day range % of ADR20: 109.26989879563185
2025-10-08 10:35:08,197 - APP.services.mt5_service - DEBUG - Position in day range: 0.9230631917172448
2025-10-08 10:35:08,198 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:35:08,199 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:35:08.199340+07:00
2025-10-08 10:35:08,201 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:35:08.199340+07:00
2025-10-08 10:35:08,201 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:35:08.199340+07:00 trong DST: True
2025-10-08 10:35:08,202 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:35:08,202 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:35:08,224 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 205
2025-10-08 10:35:08,226 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:08,227 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:08,228 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '2500', 'price': 4036.25, 'distance_pips': 0.0}, {'level': '2525', 'price': 4036.253, 'distance_pips': 0.25}, {'level': '2550', 'price': 4036.255, 'distance_pips': 0.5}, {'level': '2575', 'price': 4036.258, 'distance_pips': 0.75}]
2025-10-08 10:35:08,229 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.169720972328457}
2025-10-08 10:35:08,229 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:08,230 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:08,232 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:35:08,250 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4036.25
2025-10-08 10:35:08,252 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:35:08,253 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:35:08,254 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:08,255 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:35:08,255 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:35:08,257 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4036.25
2025-10-08 10:35:08,258 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:35:08,258 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:35:08,259 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:08,260 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:35:08,260 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:35:08,261 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4036.25
2025-10-08 10:35:08,263 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:35:08,265 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:35:08,294 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:08,295 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:35:08,296 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:35:08,297 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4036.25
2025-10-08 10:35:08,319 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:35:08,321 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:35:08,323 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:08,325 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:35:08,327 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:08,350 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:08,351 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:35:08,352 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:35:08,352 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:35:08,353 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:35:08,353 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:35:08,354 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:35:08,355 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:35:08,356 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:35:08,357 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:35:08,358 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:35:08,378 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:35:08,380 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:35:08,380 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:35:08,381 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:35:08,381 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:35:08,382 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:35:08,383 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:08,383 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:08,384 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:35:08,385 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:35:08,385 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:35:08,386 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:35:08,389 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:35:08,414 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:35:08,416 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:08,417 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:35:08,417 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:35:08,419 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4036.25, 'ask': 4036.287, 'last': 0.0, 'time': 1759919707}
2025-10-08 10:35:08,420 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:35:08,425 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:35:08,440 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:35:08,442 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:35:08,442 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:08,443 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:08,444 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:08,444 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:08,445 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:08,445 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:35:08,445 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4036.25
2025-10-08 10:35:08,446 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 40251.99999999995}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 95369.00000000015}, {'name': 'EQ50_D', 'price': 4012.55, 'relation': 'BELOW', 'distance_pips': 23699.999999999818}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 41820.99999999991}]
2025-10-08 10:35:08,447 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:35:08,511 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:08,514 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:35:08,515 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:35:08,517 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:35:08,519 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:35:10,203 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:35:10,225 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:35:12,170 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:35:12,173 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:35:12,173 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:35:12,174 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:35:12,175 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:35:12,176 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:35:12,179 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:35:12,180 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:12,201 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:35:12,202 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:35:12,203 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:35:12,203 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:35:12,204 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:35:12,233 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:12,705 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:35:12,707 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:35:12,707 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:35:12,708 - APP.services.mt5_service - DEBUG - Current price (cp): 4035.665
2025-10-08 10:35:12,713 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 357, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:35:12,732 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 237, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:35:12,732 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:35:12,733 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:35:12,750 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:35:12,751 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:12,752 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:35:12,752 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:35:12,755 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:35:12,756 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:12,756 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:35:12,756 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:35:12,759 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:35:12,759 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:12,759 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:35:12,760 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:35:12,762 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:35:12,763 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:12,763 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:35:12,787 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:35:12,791 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:35:12,792 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:35:12,792 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:35:12,793 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4049.726, 'low': 3984.54, 'eq50': 4017.133, 'midnight_open': None}
2025-10-08 10:35:12,793 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:35:12,794 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:35:12,795 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:35:12.795312+07:00
2025-10-08 10:35:12,795 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:35:12.795312+07:00
2025-10-08 10:35:12,796 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:35:12.795312+07:00 trong DST: True
2025-10-08 10:35:12,815 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:35:12,816 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:35:12,816 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:35:12,818 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:35:12,819 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4040.60903133238
2025-10-08 10:35:12,820 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 24 rates.
2025-10-08 10:35:12,820 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4038.442545350559
2025-10-08 10:35:12,824 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4040.60903133238, 'asia': 4038.442545350559, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:35:12,826 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:35:12,828 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4042.20502103054
2025-10-08 10:35:12,849 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:35:12,851 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4040.608859143395
2025-10-08 10:35:12,852 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:35:12,854 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.734226889902
2025-10-08 10:35:12,854 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:35:12,858 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4015.191395819945
2025-10-08 10:35:12,891 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:35:12,909 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4020.1114235691
2025-10-08 10:35:12,909 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:35:12,910 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3985.4449058665427
2025-10-08 10:35:12,911 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:35:12,911 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3977.582684581329
2025-10-08 10:35:12,911 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:35:12,912 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.136320674689
2025-10-08 10:35:12,912 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4042.20502103054, 'ema200': 4040.608859143395}, 'M5': {'ema50': 4036.734226889902, 'ema200': 4015.191395819945}, 'M15': {'ema50': 4020.1114235691, 'ema200': 3985.4449058665427}, 'H1': {'ema50': 3977.582684581329, 'ema200': 3912.136320674689}}
2025-10-08 10:35:12,913 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:35:12,913 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.478164416487002, TRs count: 179
2025-10-08 10:35:12,914 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:35:12,915 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.8853516394156957, TRs count: 119
2025-10-08 10:35:12,915 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:35:12,916 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 6.075837197297505, TRs count: 95
2025-10-08 10:35:12,916 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:35:12,917 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 12.236193395914158, TRs count: 119
2025-10-08 10:35:12,917 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.478164416487002, 'M1': 1.8853516394156957, 'M15': 6.075837197297505, 'H1': 12.236193395914158}
2025-10-08 10:35:12,918 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:35:12,942 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4035.665, daily: {'open': 3994.429, 'high': 4049.726, 'low': 3984.54, 'eq50': 4017.133, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:35:12,943 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:35:12,944 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:35:12,944 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4017.133
2025-10-08 10:35:12,944 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:35:12,945 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 39666.99999999991
2025-10-08 10:35:12,945 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 94784.0000000001
2025-10-08 10:35:12,945 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4017.133, Relation: BELOW, Distance: 18532.000000000153
2025-10-08 10:35:12,946 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 41235.999999999876
2025-10-08 10:35:12,946 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:35:12,947 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 39666.99999999991}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 94784.0000000001}, {'name': 'EQ50_D', 'price': 4017.133, 'relation': 'BELOW', 'distance_pips': 18532.000000000153}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 41235.999999999876}]
2025-10-08 10:35:12,947 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:35:12,948 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:35:12,948 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:35:12,949 - APP.services.mt5_service - DEBUG - Day range: 65.18600000000015, Day range % of ADR20: 127.14865446076536
2025-10-08 10:35:12,974 - APP.services.mt5_service - DEBUG - Position in day range: 0.7842941735955555
2025-10-08 10:35:12,975 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:35:12,975 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:35:12.975821+07:00
2025-10-08 10:35:12,976 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:35:12.975821+07:00
2025-10-08 10:35:12,976 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:35:12.975821+07:00 trong DST: True
2025-10-08 10:35:12,977 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:35:12,977 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:35:12,978 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 205
2025-10-08 10:35:12,978 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:12,978 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:12,979 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '6600', 'price': 4035.66, 'distance_pips': 0.5}, {'level': '6625', 'price': 4035.663, 'distance_pips': 0.25}, {'level': '6650', 'price': 4035.665, 'distance_pips': 0.0}, {'level': '6675', 'price': 4035.668, 'distance_pips': 0.25}]
2025-10-08 10:35:12,981 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.0637794988896037}
2025-10-08 10:35:12,984 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:12,998 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:13,002 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:35:13,003 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4035.665
2025-10-08 10:35:13,004 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:35:13,004 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:35:13,005 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:13,005 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:35:13,006 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:35:13,006 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4035.665
2025-10-08 10:35:13,007 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-08 10:35:13,007 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:35:13,008 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:13,009 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:35:13,009 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:35:13,010 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4035.665
2025-10-08 10:35:13,010 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-08 10:35:13,011 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:35:13,011 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:13,012 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:35:13,012 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:35:13,041 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4035.665
2025-10-08 10:35:13,086 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-08 10:35:13,088 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:35:13,089 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:13,090 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:35:13,090 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:13,091 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:13,091 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:35:13,092 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:35:13,092 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:35:13,092 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:35:13,092 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:35:13,093 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:35:13,093 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:35:13,094 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:35:13,094 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:35:13,095 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:35:13,095 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:35:13,095 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:35:13,096 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:35:13,096 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:35:13,096 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:35:13,097 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:35:13,097 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:13,097 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:13,098 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:35:13,098 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:35:13,099 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:35:13,099 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:35:13,100 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:35:13,101 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:35:13,103 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:13,103 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:35:13,104 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:35:13,104 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4035.665, 'ask': 4035.702, 'last': 0.0, 'time': 1759919712}
2025-10-08 10:35:13,108 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:35:13,130 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:35:13,131 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:35:13,132 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:35:13,132 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:13,133 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:13,133 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:13,134 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:13,134 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:13,134 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:35:13,135 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4035.665
2025-10-08 10:35:13,135 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 39666.99999999991}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 94784.0000000001}, {'name': 'EQ50_D', 'price': 4017.133, 'relation': 'BELOW', 'distance_pips': 18532.000000000153}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 41235.999999999876}]
2025-10-08 10:35:13,136 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:35:13,191 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:13,192 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:35:13,193 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:35:13,194 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:35:13,195 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:35:17,174 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:35:17,177 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:35:17,177 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:35:17,178 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:35:17,179 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:35:17,180 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:35:17,183 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:35:17,184 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:17,207 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:35:17,208 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:35:17,209 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:35:17,209 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:35:17,210 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:35:17,212 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:17,711 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:35:17,712 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:35:17,713 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:35:17,713 - APP.services.mt5_service - DEBUG - Current price (cp): 4034.998
2025-10-08 10:35:17,719 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 362, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:35:17,742 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 237, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:35:17,750 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:35:17,751 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:35:17,754 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:35:17,754 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:17,754 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:35:17,755 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:35:17,758 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:35:17,758 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:17,758 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:35:17,759 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:35:17,761 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:35:17,761 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:17,762 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:35:17,763 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:35:17,768 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:35:17,786 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:17,786 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:35:17,787 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:35:17,790 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:35:17,790 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:35:17,791 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:35:17,791 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4049.726, 'low': 3984.54, 'eq50': 4017.133, 'midnight_open': None}
2025-10-08 10:35:17,792 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:35:17,792 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:35:17,793 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:35:17.793309+07:00
2025-10-08 10:35:17,794 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:35:17.793309+07:00
2025-10-08 10:35:17,795 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:35:17.793309+07:00 trong DST: True
2025-10-08 10:35:17,796 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:35:17,796 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:35:17,817 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:35:17,819 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:35:17,820 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4040.5973571491213
2025-10-08 10:35:17,821 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 24 rates.
2025-10-08 10:35:17,822 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4038.442545350559
2025-10-08 10:35:17,825 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4040.5973571491213, 'asia': 4038.442545350559, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:35:17,847 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:35:17,847 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4042.178864167795
2025-10-08 10:35:17,848 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:35:17,848 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4040.6022223274745
2025-10-08 10:35:17,848 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:35:17,849 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.7080700271567
2025-10-08 10:35:17,849 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:35:17,850 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4015.1847590040243
2025-10-08 10:35:17,850 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:35:17,851 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4020.085266706355
2025-10-08 10:35:17,851 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:35:17,852 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3985.4382690506222
2025-10-08 10:35:17,853 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:35:17,853 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3977.5565277185838
2025-10-08 10:35:17,853 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:35:17,854 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1296838587687
2025-10-08 10:35:17,854 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4042.178864167795, 'ema200': 4040.6022223274745}, 'M5': {'ema50': 4036.7080700271567, 'ema200': 4015.1847590040243}, 'M15': {'ema50': 4020.085266706355, 'ema200': 3985.4382690506222}, 'H1': {'ema50': 3977.5565277185838, 'ema200': 3912.1296838587687}}
2025-10-08 10:35:17,855 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:35:17,855 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.522450130772741, TRs count: 179
2025-10-08 10:35:17,856 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:35:17,858 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.9296373537014346, TRs count: 119
2025-10-08 10:35:17,858 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:35:17,880 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 6.120122911583244, TRs count: 95
2025-10-08 10:35:17,882 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:35:17,882 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 12.280479110199899, TRs count: 119
2025-10-08 10:35:17,883 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.522450130772741, 'M1': 1.9296373537014346, 'M15': 6.120122911583244, 'H1': 12.280479110199899}
2025-10-08 10:35:17,884 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:35:17,884 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4034.998, daily: {'open': 3994.429, 'high': 4049.726, 'low': 3984.54, 'eq50': 4017.133, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:35:17,885 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:35:17,885 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:35:17,886 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4017.133
2025-10-08 10:35:17,887 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:35:17,887 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 39000.0
2025-10-08 10:35:17,888 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 94117.00000000019
2025-10-08 10:35:17,889 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4017.133, Relation: BELOW, Distance: 17865.000000000236
2025-10-08 10:35:17,890 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 40568.999999999956
2025-10-08 10:35:17,912 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:35:17,913 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 39000.0}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 94117.00000000019}, {'name': 'EQ50_D', 'price': 4017.133, 'relation': 'BELOW', 'distance_pips': 17865.000000000236}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 40568.999999999956}]
2025-10-08 10:35:17,913 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:35:17,914 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:35:17,915 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:35:17,916 - APP.services.mt5_service - DEBUG - Day range: 65.18600000000015, Day range % of ADR20: 127.14865446076536
2025-10-08 10:35:17,916 - APP.services.mt5_service - DEBUG - Position in day range: 0.7740619151351512
2025-10-08 10:35:17,916 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:35:17,917 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:35:17.917666+07:00
2025-10-08 10:35:17,918 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:35:17.917666+07:00
2025-10-08 10:35:17,919 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:35:17.917666+07:00 trong DST: True
2025-10-08 10:35:17,920 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:35:17,920 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:35:17,921 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 205
2025-10-08 10:35:17,940 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:17,941 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:17,942 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '9900', 'price': 4034.99, 'distance_pips': 0.8}, {'level': '9925', 'price': 4034.993, 'distance_pips': 0.55}, {'level': '9950', 'price': 4034.995, 'distance_pips': 0.3}, {'level': '9975', 'price': 4034.998, 'distance_pips': 0.05}]
2025-10-08 10:35:17,943 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.0504052187018549}
2025-10-08 10:35:17,944 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:17,944 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:17,945 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:35:17,946 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4034.998
2025-10-08 10:35:17,946 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:35:17,947 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:35:17,947 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:17,948 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:35:17,948 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:35:17,949 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4034.998
2025-10-08 10:35:17,950 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-08 10:35:17,951 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:35:17,975 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:17,976 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:35:17,976 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:35:17,977 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4034.998
2025-10-08 10:35:17,978 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-08 10:35:17,978 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:35:17,979 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:17,979 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:35:17,980 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:35:17,981 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4034.998
2025-10-08 10:35:17,983 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:35:17,983 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:35:18,004 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:18,005 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:35:18,006 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:18,006 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:18,007 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:35:18,008 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:35:18,008 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:35:18,009 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:35:18,009 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:35:18,010 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:35:18,010 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:35:18,011 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:35:18,012 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:35:18,013 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:35:18,013 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:35:18,014 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:35:18,014 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:35:18,038 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:35:18,039 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:35:18,039 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:35:18,040 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:18,040 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:18,041 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:35:18,042 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:35:18,042 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:35:18,043 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:35:18,045 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:35:18,062 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:35:18,070 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:18,071 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:35:18,071 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:35:18,071 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4034.998, 'ask': 4035.035, 'last': 0.0, 'time': 1759919717}
2025-10-08 10:35:18,074 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:35:18,075 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:35:18,077 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:35:18,077 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:35:18,078 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:18,098 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:18,099 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:18,100 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:18,100 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:18,100 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:35:18,101 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4034.998
2025-10-08 10:35:18,101 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 39000.0}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 94117.00000000019}, {'name': 'EQ50_D', 'price': 4017.133, 'relation': 'BELOW', 'distance_pips': 17865.000000000236}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 40568.999999999956}]
2025-10-08 10:35:18,102 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:35:18,132 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:18,133 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:35:18,135 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:35:18,136 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:35:18,139 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:35:22,178 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:35:22,181 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:35:22,181 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:35:22,181 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:35:22,183 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:35:22,184 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:35:22,187 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:35:22,187 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:22,211 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:35:22,212 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:35:22,213 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:35:22,213 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:35:22,213 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:35:22,273 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:22,715 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:35:22,717 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:35:22,718 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:35:22,718 - APP.services.mt5_service - DEBUG - Current price (cp): 4034.97
2025-10-08 10:35:22,725 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 355, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:35:22,762 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 238, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:35:22,786 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:35:22,787 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:35:22,790 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:35:22,790 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:22,790 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:35:22,791 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:35:22,795 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:35:22,815 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:22,816 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:35:22,816 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:35:22,818 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:35:22,818 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:22,819 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:35:22,819 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:35:22,822 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:35:22,822 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:22,823 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:35:22,823 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:35:22,828 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:35:22,850 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:35:22,851 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:35:22,852 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4049.726, 'low': 3984.54, 'eq50': 4017.133, 'midnight_open': None}
2025-10-08 10:35:22,852 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:35:22,852 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:35:22,853 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:35:22.853085+07:00
2025-10-08 10:35:22,853 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:35:22.853085+07:00
2025-10-08 10:35:22,853 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:35:22.853085+07:00 trong DST: True
2025-10-08 10:35:22,854 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:35:22,854 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:35:22,854 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:35:22,856 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:35:22,879 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4040.5932470174384
2025-10-08 10:35:22,881 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 24 rates.
2025-10-08 10:35:22,881 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4038.442545350559
2025-10-08 10:35:22,884 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4040.5932470174384, 'asia': 4038.442545350559, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:35:22,884 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:35:22,884 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4042.177766128579
2025-10-08 10:35:22,885 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:35:22,885 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4040.601943720509
2025-10-08 10:35:22,886 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:35:22,886 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.706971987941
2025-10-08 10:35:22,887 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:35:22,887 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4015.184480397059
2025-10-08 10:35:22,888 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:35:22,888 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4020.0841686671392
2025-10-08 10:35:22,931 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:35:22,932 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3985.437990443657
2025-10-08 10:35:22,932 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:35:22,933 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3977.555429679368
2025-10-08 10:35:22,933 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:35:22,934 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1294052518033
2025-10-08 10:35:22,934 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4042.177766128579, 'ema200': 4040.601943720509}, 'M5': {'ema50': 4036.706971987941, 'ema200': 4015.184480397059}, 'M15': {'ema50': 4020.0841686671392, 'ema200': 3985.437990443657}, 'H1': {'ema50': 3977.555429679368, 'ema200': 3912.1294052518033}}
2025-10-08 10:35:22,935 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:35:22,936 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.530450130772714, TRs count: 179
2025-10-08 10:35:22,936 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:35:22,937 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.9376373537014078, TRs count: 119
2025-10-08 10:35:22,938 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:35:22,938 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 6.128122911583217, TRs count: 95
2025-10-08 10:35:22,939 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:35:22,939 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 12.288479110199871, TRs count: 119
2025-10-08 10:35:22,939 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.530450130772714, 'M1': 1.9376373537014078, 'M15': 6.128122911583217, 'H1': 12.288479110199871}
2025-10-08 10:35:22,940 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:35:22,940 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4034.97, daily: {'open': 3994.429, 'high': 4049.726, 'low': 3984.54, 'eq50': 4017.133, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:35:22,940 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:35:22,941 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:35:22,941 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4017.133
2025-10-08 10:35:22,941 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:35:22,942 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 38971.99999999975
2025-10-08 10:35:22,942 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 94088.99999999994
2025-10-08 10:35:22,943 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4017.133, Relation: BELOW, Distance: 17836.99999999999
2025-10-08 10:35:22,943 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 40540.99999999971
2025-10-08 10:35:22,944 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:35:22,944 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 38971.99999999975}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 94088.99999999994}, {'name': 'EQ50_D', 'price': 4017.133, 'relation': 'BELOW', 'distance_pips': 17836.99999999999}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 40540.99999999971}]
2025-10-08 10:35:22,945 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:35:22,945 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:35:22,946 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:35:22,946 - APP.services.mt5_service - DEBUG - Day range: 65.18600000000015, Day range % of ADR20: 127.14865446076536
2025-10-08 10:35:22,947 - APP.services.mt5_service - DEBUG - Position in day range: 0.773632375049853
2025-10-08 10:35:22,947 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:35:22,947 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:35:22.947680+07:00
2025-10-08 10:35:22,948 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:35:22.947680+07:00
2025-10-08 10:35:22,948 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:35:22.947680+07:00 trong DST: True
2025-10-08 10:35:22,948 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:35:22,949 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:35:22,949 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 205
2025-10-08 10:35:22,951 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:22,952 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:22,953 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '9700', 'price': 4034.97, 'distance_pips': 0.0}, {'level': '9725', 'price': 4034.973, 'distance_pips': 0.25}, {'level': '9750', 'price': 4034.975, 'distance_pips': 0.5}, {'level': '9775', 'price': 4034.978, 'distance_pips': 0.75}]
2025-10-08 10:35:22,973 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.0480250004880736}
2025-10-08 10:35:22,975 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:22,975 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:22,976 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:35:22,976 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4034.97
2025-10-08 10:35:22,977 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:35:22,977 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:35:22,978 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:22,979 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:35:22,979 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:35:22,979 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4034.97
2025-10-08 10:35:22,980 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-08 10:35:22,981 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:35:22,986 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:23,004 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:35:23,005 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:35:23,006 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4034.97
2025-10-08 10:35:23,006 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-08 10:35:23,007 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:35:23,007 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:23,008 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:35:23,008 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:35:23,009 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4034.97
2025-10-08 10:35:23,009 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:35:23,010 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:35:23,010 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:23,011 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:35:23,011 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:23,012 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:23,012 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:35:23,040 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:35:23,041 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:35:23,041 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:35:23,042 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:35:23,042 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:35:23,043 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:35:23,043 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:35:23,044 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:35:23,047 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:35:23,070 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:35:23,070 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:35:23,071 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:35:23,071 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:35:23,072 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:35:23,072 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:35:23,073 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:23,073 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:23,073 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:35:23,074 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:35:23,074 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:35:23,074 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:35:23,100 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:35:23,102 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:35:23,103 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:23,104 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:35:23,104 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:35:23,105 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4034.97, 'ask': 4035.007, 'last': 0.0, 'time': 1759919722}
2025-10-08 10:35:23,108 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:35:23,129 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:35:23,129 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:35:23,130 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:35:23,131 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:23,131 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:23,131 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:23,132 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:23,132 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:23,132 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:35:23,133 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4034.97
2025-10-08 10:35:23,133 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 38971.99999999975}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 94088.99999999994}, {'name': 'EQ50_D', 'price': 4017.133, 'relation': 'BELOW', 'distance_pips': 17836.99999999999}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 40540.99999999971}]
2025-10-08 10:35:23,134 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:35:23,208 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:23,209 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:35:23,209 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:35:23,211 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:35:23,212 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:35:25,204 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:35:25,219 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:35:27,182 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:35:27,184 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:35:27,185 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:35:27,185 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:35:27,187 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:35:27,188 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:35:27,192 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:35:27,213 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:27,214 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:35:27,215 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:35:27,216 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:35:27,216 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:35:27,217 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:35:27,243 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:27,718 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:35:27,720 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:35:27,720 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:35:27,721 - APP.services.mt5_service - DEBUG - Current price (cp): 4034.591
2025-10-08 10:35:27,726 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 354, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:35:27,758 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 238, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:35:27,761 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:35:27,762 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:35:27,765 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:35:27,765 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:27,766 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:35:27,766 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:35:27,784 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:35:27,786 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:27,786 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:35:27,787 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:35:27,789 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:35:27,789 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:27,790 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:35:27,790 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:35:27,793 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:35:27,794 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:27,794 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:35:27,795 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:35:27,800 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:35:27,817 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:35:27,819 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:35:27,820 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4049.726, 'low': 3984.54, 'eq50': 4017.133, 'midnight_open': None}
2025-10-08 10:35:27,820 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:35:27,820 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:35:27,821 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:35:27.821424+07:00
2025-10-08 10:35:27,821 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:35:27.821424+07:00
2025-10-08 10:35:27,822 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:35:27.821424+07:00 trong DST: True
2025-10-08 10:35:27,822 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:35:27,822 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:35:27,823 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:35:27,825 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:35:27,825 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4040.5861811099444
2025-10-08 10:35:27,827 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 24 rates.
2025-10-08 10:35:27,828 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4038.442545350559
2025-10-08 10:35:27,843 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4040.5861811099444, 'asia': 4038.442545350559, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:35:27,853 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:35:27,854 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4042.1629033834815
2025-10-08 10:35:27,855 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:35:27,856 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4040.598172576231
2025-10-08 10:35:27,856 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:35:27,857 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.692109242843
2025-10-08 10:35:27,858 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:35:27,859 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4015.1807092527806
2025-10-08 10:35:27,860 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:35:27,860 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4020.0683255298845
2025-10-08 10:35:27,860 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:35:27,861 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3985.4339705431594
2025-10-08 10:35:27,869 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:35:27,879 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3977.5395865421133
2025-10-08 10:35:27,880 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:35:27,884 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.125385351306
2025-10-08 10:35:27,885 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4042.1629033834815, 'ema200': 4040.598172576231}, 'M5': {'ema50': 4036.692109242843, 'ema200': 4015.1807092527806}, 'M15': {'ema50': 4020.0683255298845, 'ema200': 3985.4339705431594}, 'H1': {'ema50': 3977.5395865421133, 'ema200': 3912.125385351306}}
2025-10-08 10:35:27,886 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:35:27,890 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.5466644164870225, TRs count: 179
2025-10-08 10:35:27,919 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:35:27,922 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.9538516394157162, TRs count: 119
2025-10-08 10:35:27,923 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:35:27,924 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 6.146122911583246, TRs count: 95
2025-10-08 10:35:27,944 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:35:27,947 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 12.3064791101999, TRs count: 119
2025-10-08 10:35:27,947 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.5466644164870225, 'M1': 1.9538516394157162, 'M15': 6.146122911583246, 'H1': 12.3064791101999}
2025-10-08 10:35:27,948 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:35:27,948 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4034.591, daily: {'open': 3994.429, 'high': 4049.726, 'low': 3984.54, 'eq50': 4017.133, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:35:27,949 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:35:27,949 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:35:27,950 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4017.133
2025-10-08 10:35:27,950 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:35:27,950 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 38592.99999999985
2025-10-08 10:35:27,951 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 93710.00000000003
2025-10-08 10:35:27,962 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4017.133, Relation: BELOW, Distance: 17458.000000000084
2025-10-08 10:35:27,971 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 40161.9999999998
2025-10-08 10:35:27,977 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:35:27,978 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 38592.99999999985}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 93710.00000000003}, {'name': 'EQ50_D', 'price': 4017.133, 'relation': 'BELOW', 'distance_pips': 17458.000000000084}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 40161.9999999998}]
2025-10-08 10:35:27,979 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:35:27,979 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:35:27,980 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:35:27,980 - APP.services.mt5_service - DEBUG - Day range: 65.18600000000015, Day range % of ADR20: 127.14865446076536
2025-10-08 10:35:27,981 - APP.services.mt5_service - DEBUG - Position in day range: 0.7678182431810483
2025-10-08 10:35:27,981 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:35:27,981 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:35:27.981783+07:00
2025-10-08 10:35:27,982 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:35:27.981783+07:00
2025-10-08 10:35:27,983 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:35:27.981783+07:00 trong DST: True
2025-10-08 10:35:27,984 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:35:27,985 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:35:27,988 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 205
2025-10-08 10:35:27,991 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:27,992 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:27,993 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '5900', 'price': 4034.59, 'distance_pips': 0.1}, {'level': '5925', 'price': 4034.593, 'distance_pips': 0.15}, {'level': '5950', 'price': 4034.595, 'distance_pips': 0.4}, {'level': '5975', 'price': 4034.598, 'distance_pips': 0.65}]
2025-10-08 10:35:27,999 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.0432337445929125}
2025-10-08 10:35:28,001 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:28,003 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:28,004 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:35:28,006 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4034.591
2025-10-08 10:35:28,006 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:35:28,006 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:35:28,007 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:28,008 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:35:28,008 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:35:28,008 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4034.591
2025-10-08 10:35:28,009 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-08 10:35:28,009 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:35:28,010 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:28,011 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:35:28,011 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:35:28,012 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4034.591
2025-10-08 10:35:28,012 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-08 10:35:28,013 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:35:28,014 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:28,015 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:35:28,020 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:35:28,022 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4034.591
2025-10-08 10:35:28,038 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:35:28,039 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:35:28,040 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:28,040 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:35:28,041 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:28,041 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:28,042 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:35:28,042 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:35:28,042 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:35:28,043 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:35:28,043 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:35:28,044 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:35:28,045 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:35:28,047 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:35:28,048 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:35:28,054 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:35:28,063 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:35:28,068 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:35:28,070 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:35:28,071 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:35:28,071 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:35:28,072 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:35:28,072 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:28,073 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:28,073 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:35:28,074 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:35:28,074 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:35:28,075 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:35:28,075 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:35:28,101 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:35:28,103 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:28,103 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4034.591, 'ask': 4034.628, 'last': 0.0, 'time': 1759919727}
2025-10-08 10:35:28,104 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:35:28,104 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:35:28,105 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:28,140 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:35:28,142 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:35:28,142 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:28,147 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:35:28,149 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:28,150 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:35:28,151 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:28,152 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:28,153 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:35:28,154 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4034.591
2025-10-08 10:35:28,156 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 38592.99999999985}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 93710.00000000003}, {'name': 'EQ50_D', 'price': 4017.133, 'relation': 'BELOW', 'distance_pips': 17458.000000000084}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 40161.9999999998}]
2025-10-08 10:35:28,158 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:35:28,196 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:28,197 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:35:28,198 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:35:28,199 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:35:28,226 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:35:32,200 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:35:32,228 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:35:32,228 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:35:32,229 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:35:32,231 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:35:32,232 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:35:32,238 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:35:32,255 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:32,255 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:35:32,257 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:35:32,258 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:35:32,258 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:35:32,259 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:35:32,261 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:32,760 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:35:32,762 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:35:32,762 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:35:32,763 - APP.services.mt5_service - DEBUG - Current price (cp): 4034.906
2025-10-08 10:35:32,769 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 353, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:35:32,801 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 239, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:35:32,801 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:35:32,802 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:35:32,806 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:35:32,807 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:32,807 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:35:32,808 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:35:32,810 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:35:32,811 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:32,812 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:35:32,813 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:35:32,814 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:35:32,814 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:32,815 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:35:32,816 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:35:32,818 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:35:32,819 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:32,820 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:35:32,821 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:35:32,824 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:35:32,833 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:35:32,860 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:35:32,878 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4049.726, 'low': 3984.54, 'eq50': 4017.133, 'midnight_open': None}
2025-10-08 10:35:32,879 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:35:32,879 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:35:32,880 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:35:32.880532+07:00
2025-10-08 10:35:32,881 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:35:32.880532+07:00
2025-10-08 10:35:32,881 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:35:32.880532+07:00 trong DST: True
2025-10-08 10:35:32,882 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:35:32,882 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:35:32,883 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:35:32,885 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:35:32,886 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4040.576520203723
2025-10-08 10:35:32,887 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 24 rates.
2025-10-08 10:35:32,887 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4038.442545350559
2025-10-08 10:35:32,892 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4040.576520203723, 'asia': 4038.442545350559, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:35:32,912 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:35:32,914 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4042.1752563246578
2025-10-08 10:35:32,916 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:35:32,916 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4040.601306904589
2025-10-08 10:35:32,917 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:35:32,988 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.7044621840196
2025-10-08 10:35:32,990 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:35:32,991 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4015.1838435811387
2025-10-08 10:35:32,992 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:35:32,992 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4020.081658863218
2025-10-08 10:35:32,992 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:35:32,993 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3985.4373536277367
2025-10-08 10:35:32,993 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:35:32,994 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3977.5529198754466
2025-10-08 10:35:32,994 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:35:32,994 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.128768435883
2025-10-08 10:35:32,995 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4042.1752563246578, 'ema200': 4040.601306904589}, 'M5': {'ema50': 4036.7044621840196, 'ema200': 4015.1838435811387}, 'M15': {'ema50': 4020.081658863218, 'ema200': 3985.4373536277367}, 'H1': {'ema50': 3977.5529198754466, 'ema200': 3912.128768435883}}
2025-10-08 10:35:32,995 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:35:32,996 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.576235845058434, TRs count: 179
2025-10-08 10:35:32,996 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:35:32,997 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.9834230679871276, TRs count: 119
2025-10-08 10:35:32,997 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:35:32,998 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 6.173908625868937, TRs count: 95
2025-10-08 10:35:32,998 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:35:32,998 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 12.33426482448559, TRs count: 119
2025-10-08 10:35:32,999 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.576235845058434, 'M1': 1.9834230679871276, 'M15': 6.173908625868937, 'H1': 12.33426482448559}
2025-10-08 10:35:32,999 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:35:33,000 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4034.906, daily: {'open': 3994.429, 'high': 4049.726, 'low': 3984.54, 'eq50': 4017.133, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:35:33,000 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:35:33,000 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:35:33,001 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4017.133
2025-10-08 10:35:33,001 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:35:33,001 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 38907.9999999999
2025-10-08 10:35:33,002 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 94025.00000000009
2025-10-08 10:35:33,002 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4017.133, Relation: BELOW, Distance: 17773.00000000014
2025-10-08 10:35:33,002 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 40476.99999999986
2025-10-08 10:35:33,003 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:35:33,004 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 38907.9999999999}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 94025.00000000009}, {'name': 'EQ50_D', 'price': 4017.133, 'relation': 'BELOW', 'distance_pips': 17773.00000000014}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 40476.99999999986}]
2025-10-08 10:35:33,004 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:35:33,005 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:35:33,005 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:35:33,006 - APP.services.mt5_service - DEBUG - Day range: 65.18600000000015, Day range % of ADR20: 127.14865446076536
2025-10-08 10:35:33,007 - APP.services.mt5_service - DEBUG - Position in day range: 0.772650569140611
2025-10-08 10:35:33,007 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:35:33,008 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:35:33.008127+07:00
2025-10-08 10:35:33,008 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:35:33.008127+07:00
2025-10-08 10:35:33,008 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:35:33.008127+07:00 trong DST: True
2025-10-08 10:35:33,009 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:35:33,009 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:35:33,009 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 205
2025-10-08 10:35:33,010 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:33,010 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:33,011 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '9000', 'price': 4034.9, 'distance_pips': 0.6}, {'level': '9025', 'price': 4034.903, 'distance_pips': 0.35}, {'level': '9050', 'price': 4034.905, 'distance_pips': 0.1}, {'level': '9075', 'price': 4034.908, 'distance_pips': 0.15}]
2025-10-08 10:35:33,011 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.0346073805895029}
2025-10-08 10:35:33,012 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:33,012 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:33,015 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:35:33,015 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4034.906
2025-10-08 10:35:33,016 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:35:33,034 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:35:33,035 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:33,036 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:35:33,037 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:35:33,038 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4034.906
2025-10-08 10:35:33,038 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-08 10:35:33,039 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:35:33,039 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:33,040 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:35:33,040 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:35:33,041 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4034.906
2025-10-08 10:35:33,041 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-08 10:35:33,042 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:35:33,043 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:33,044 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:35:33,044 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:35:33,045 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4034.906
2025-10-08 10:35:33,046 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:35:33,047 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:35:33,047 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:33,048 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:35:33,069 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:33,071 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:33,072 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:35:33,072 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:35:33,073 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:35:33,074 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:35:33,074 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:35:33,074 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:35:33,075 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:35:33,075 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:35:33,076 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:35:33,077 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:35:33,077 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:35:33,102 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:35:33,104 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:35:33,150 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:35:33,152 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:35:33,153 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:35:33,154 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:33,156 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:33,156 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:35:33,157 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:35:33,157 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:35:33,157 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:35:33,158 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:35:33,160 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:35:33,166 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:35:33,167 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:33,167 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:35:33,168 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4034.906, 'ask': 4034.943, 'last': 0.0, 'time': 1759919731}
2025-10-08 10:35:33,173 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:35:33,199 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:35:33,200 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:35:33,201 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:35:33,240 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:33,240 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:33,241 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:33,242 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:33,242 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:33,243 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:35:33,244 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4034.906
2025-10-08 10:35:33,245 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 38907.9999999999}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 94025.00000000009}, {'name': 'EQ50_D', 'price': 4017.133, 'relation': 'BELOW', 'distance_pips': 17773.00000000014}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 40476.99999999986}]
2025-10-08 10:35:33,246 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:35:33,250 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:33,251 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:35:33,251 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:35:33,252 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:35:33,253 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:35:37,230 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:35:37,233 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:35:37,233 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:35:37,234 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:35:37,237 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:35:37,241 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:35:37,267 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:35:37,268 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:35:37,269 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:37,269 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:35:37,271 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:35:37,271 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:35:37,272 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:35:37,362 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:37,773 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:35:37,775 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:35:37,775 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:35:37,776 - APP.services.mt5_service - DEBUG - Current price (cp): 4034.859
2025-10-08 10:35:37,780 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 352, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:35:37,809 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 239, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:35:37,811 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:35:37,813 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:35:37,815 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:35:37,815 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:37,816 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:35:37,817 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:35:37,820 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:35:37,820 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:37,821 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:35:37,821 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:35:37,823 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:35:37,824 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:37,824 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:35:37,824 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:35:37,827 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:35:37,832 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:37,853 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:35:37,854 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:35:37,857 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:35:37,857 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:35:37,859 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:35:37,860 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4049.726, 'low': 3984.54, 'eq50': 4017.133, 'midnight_open': None}
2025-10-08 10:35:37,860 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:35:37,861 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:35:37,861 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:35:37.861656+07:00
2025-10-08 10:35:37,880 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:35:37.861656+07:00
2025-10-08 10:35:37,880 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:35:37.861656+07:00 trong DST: True
2025-10-08 10:35:37,882 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:35:37,882 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:35:37,882 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:35:37,883 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:35:37,884 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4040.56796546395
2025-10-08 10:35:37,885 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 24 rates.
2025-10-08 10:35:37,885 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4038.442545350559
2025-10-08 10:35:37,888 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4040.56796546395, 'asia': 4038.442545350559, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:35:37,889 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:35:37,891 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4042.1734131874027
2025-10-08 10:35:37,911 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:35:37,912 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4040.600839242897
2025-10-08 10:35:37,912 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:35:37,913 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.7026190467645
2025-10-08 10:35:37,913 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:35:37,914 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4015.183375919447
2025-10-08 10:35:37,914 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:35:37,915 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4020.079815725963
2025-10-08 10:35:37,915 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:35:37,916 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3985.436885966045
2025-10-08 10:35:37,917 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:35:37,917 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3977.5510767381916
2025-10-08 10:35:37,918 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:35:37,918 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1283007741913
2025-10-08 10:35:37,918 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4042.1734131874027, 'ema200': 4040.600839242897}, 'M5': {'ema50': 4036.7026190467645, 'ema200': 4015.183375919447}, 'M15': {'ema50': 4020.079815725963, 'ema200': 3985.436885966045}, 'H1': {'ema50': 3977.5510767381916, 'ema200': 3912.1283007741913}}
2025-10-08 10:35:37,919 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:35:37,943 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.576235845058434, TRs count: 179
2025-10-08 10:35:37,944 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:35:37,944 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.9834230679871276, TRs count: 119
2025-10-08 10:35:37,945 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:35:37,945 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 6.173908625868937, TRs count: 95
2025-10-08 10:35:37,946 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:35:37,946 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 12.33426482448559, TRs count: 119
2025-10-08 10:35:37,947 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.576235845058434, 'M1': 1.9834230679871276, 'M15': 6.173908625868937, 'H1': 12.33426482448559}
2025-10-08 10:35:37,947 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:35:37,948 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4034.859, daily: {'open': 3994.429, 'high': 4049.726, 'low': 3984.54, 'eq50': 4017.133, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:35:37,948 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:35:37,948 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:35:37,949 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4017.133
2025-10-08 10:35:37,949 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:35:37,950 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 38860.999999999876
2025-10-08 10:35:37,951 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 93978.00000000006
2025-10-08 10:35:37,952 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4017.133, Relation: BELOW, Distance: 17726.000000000113
2025-10-08 10:35:37,953 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 40429.99999999983
2025-10-08 10:35:37,976 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:35:37,977 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 38860.999999999876}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 93978.00000000006}, {'name': 'EQ50_D', 'price': 4017.133, 'relation': 'BELOW', 'distance_pips': 17726.000000000113}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 40429.99999999983}]
2025-10-08 10:35:37,978 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:35:37,978 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:35:37,979 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:35:37,980 - APP.services.mt5_service - DEBUG - Day range: 65.18600000000015, Day range % of ADR20: 127.14865446076536
2025-10-08 10:35:37,980 - APP.services.mt5_service - DEBUG - Position in day range: 0.7719295554260094
2025-10-08 10:35:37,980 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:35:37,981 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:35:37.981088+07:00
2025-10-08 10:35:37,981 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:35:37.981088+07:00
2025-10-08 10:35:37,981 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:35:37.981088+07:00 trong DST: True
2025-10-08 10:35:37,982 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:35:37,984 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:35:38,005 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 205
2025-10-08 10:35:38,005 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:38,006 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:38,007 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '8500', 'price': 4034.85, 'distance_pips': 0.9}, {'level': '8525', 'price': 4034.852, 'distance_pips': 0.65}, {'level': '8550', 'price': 4034.855, 'distance_pips': 0.4}, {'level': '8575', 'price': 4034.858, 'distance_pips': 0.15}]
2025-10-08 10:35:38,008 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.0346073805895029}
2025-10-08 10:35:38,008 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:38,009 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:38,009 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:35:38,010 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4034.859
2025-10-08 10:35:38,010 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:35:38,011 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:35:38,012 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:38,012 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:35:38,015 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:35:38,016 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4034.859
2025-10-08 10:35:38,038 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-08 10:35:38,039 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:35:38,040 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:38,041 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:35:38,041 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:35:38,042 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4034.859
2025-10-08 10:35:38,043 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-08 10:35:38,043 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:35:38,044 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:38,044 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:35:38,047 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:35:38,072 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4034.859
2025-10-08 10:35:38,072 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:35:38,073 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:35:38,074 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:38,074 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:35:38,075 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:38,075 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:38,075 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:35:38,076 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:35:38,105 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:35:38,106 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:35:38,106 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:35:38,106 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:35:38,109 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:35:38,135 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:35:38,136 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:35:38,136 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:35:38,137 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:35:38,137 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:35:38,137 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:35:38,138 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:35:38,138 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:35:38,138 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:35:38,165 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:38,166 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:38,167 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:35:38,167 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:35:38,168 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:35:38,168 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:35:38,169 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:35:38,170 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:35:38,195 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:35:38,195 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:35:38,196 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:38,198 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:35:38,199 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4034.859, 'ask': 4034.896, 'last': 0.0, 'time': 1759919737}
2025-10-08 10:35:38,199 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:35:38,200 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:35:38,202 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:35:38,204 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:38,221 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:38,224 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:38,225 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:38,226 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:38,226 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:35:38,227 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4034.859
2025-10-08 10:35:38,227 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 38860.999999999876}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 93978.00000000006}, {'name': 'EQ50_D', 'price': 4017.133, 'relation': 'BELOW', 'distance_pips': 17726.000000000113}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 40429.99999999983}]
2025-10-08 10:35:38,228 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:35:38,265 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:38,290 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:35:38,291 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:35:38,292 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:35:38,294 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:35:40,206 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:35:40,299 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:35:42,235 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:35:42,238 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:35:42,238 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:35:42,239 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:35:42,241 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:35:42,241 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:35:42,245 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:35:42,245 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:42,268 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:35:42,270 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:35:42,272 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:35:42,272 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:35:42,273 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:35:42,315 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:42,774 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:35:42,776 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:35:42,777 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:35:42,777 - APP.services.mt5_service - DEBUG - Current price (cp): 4034.578
2025-10-08 10:35:42,784 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 356, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:35:42,828 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 240, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:35:42,840 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:35:42,840 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:35:42,843 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:35:42,843 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:42,843 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:35:42,844 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:35:42,847 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:35:42,847 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:42,848 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:35:42,848 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:35:42,850 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:35:42,850 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:42,851 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:35:42,851 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:35:42,854 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:35:42,854 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:42,855 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:35:42,855 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:35:42,858 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:35:42,859 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:35:42,881 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:35:42,883 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4049.726, 'low': 3984.54, 'eq50': 4017.133, 'midnight_open': None}
2025-10-08 10:35:42,883 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:35:42,884 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:35:42,885 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:35:42.885174+07:00
2025-10-08 10:35:42,885 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:35:42.885174+07:00
2025-10-08 10:35:42,886 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:35:42.885174+07:00 trong DST: True
2025-10-08 10:35:42,887 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:35:42,887 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:35:42,888 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:35:42,890 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:35:42,892 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4040.5580277850363
2025-10-08 10:35:42,893 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 24 rates.
2025-10-08 10:35:42,894 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4038.442545350559
2025-10-08 10:35:42,898 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4040.5580277850363, 'asia': 4038.442545350559, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:35:42,899 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:35:42,899 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4042.1623935795596
2025-10-08 10:35:42,899 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:35:42,900 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4040.5980432229967
2025-10-08 10:35:42,900 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:35:42,901 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.6915994389215
2025-10-08 10:35:42,901 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:35:42,902 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4015.1805798995465
2025-10-08 10:35:42,902 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:35:42,902 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4020.0687961181197
2025-10-08 10:35:42,903 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:35:42,903 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3985.4340899461445
2025-10-08 10:35:42,903 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:35:42,904 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3977.5400571303485
2025-10-08 10:35:42,904 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:35:42,905 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.125504754291
2025-10-08 10:35:42,905 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4042.1623935795596, 'ema200': 4040.5980432229967}, 'M5': {'ema50': 4036.6915994389215, 'ema200': 4015.1805798995465}, 'M15': {'ema50': 4020.0687961181197, 'ema200': 3985.4340899461445}, 'H1': {'ema50': 3977.5400571303485, 'ema200': 3912.125504754291}}
2025-10-08 10:35:42,906 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:35:42,906 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.576235845058434, TRs count: 179
2025-10-08 10:35:42,908 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:35:42,910 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.9834230679871276, TRs count: 119
2025-10-08 10:35:42,938 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:35:42,940 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 6.173908625868937, TRs count: 95
2025-10-08 10:35:43,129 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:35:43,260 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 12.33426482448559, TRs count: 119
2025-10-08 10:35:43,334 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.576235845058434, 'M1': 1.9834230679871276, 'M15': 6.173908625868937, 'H1': 12.33426482448559}
2025-10-08 10:35:43,362 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:35:43,401 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4034.578, daily: {'open': 3994.429, 'high': 4049.726, 'low': 3984.54, 'eq50': 4017.133, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:35:43,402 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:35:43,402 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:35:43,403 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4017.133
2025-10-08 10:35:43,403 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:35:43,404 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 38579.99999999993
2025-10-08 10:35:43,405 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 93697.00000000012
2025-10-08 10:35:43,405 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4017.133, Relation: BELOW, Distance: 17445.000000000164
2025-10-08 10:35:43,406 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 40148.99999999988
2025-10-08 10:35:43,406 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:35:43,406 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 38579.99999999993}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 93697.00000000012}, {'name': 'EQ50_D', 'price': 4017.133, 'relation': 'BELOW', 'distance_pips': 17445.000000000164}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 40148.99999999988}]
2025-10-08 10:35:43,407 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:35:43,407 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:35:43,408 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:35:43,408 - APP.services.mt5_service - DEBUG - Day range: 65.18600000000015, Day range % of ADR20: 127.14865446076536
2025-10-08 10:35:43,408 - APP.services.mt5_service - DEBUG - Position in day range: 0.7676188138557343
2025-10-08 10:35:43,409 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:35:43,409 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:35:43.409635+07:00
2025-10-08 10:35:43,410 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:35:43.409635+07:00
2025-10-08 10:35:43,410 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:35:43.409635+07:00 trong DST: True
2025-10-08 10:35:43,410 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:35:43,411 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:35:43,411 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 205
2025-10-08 10:35:43,412 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:43,412 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:43,412 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '5700', 'price': 4034.57, 'distance_pips': 0.8}, {'level': '5725', 'price': 4034.573, 'distance_pips': 0.55}, {'level': '5750', 'price': 4034.575, 'distance_pips': 0.3}, {'level': '5775', 'price': 4034.578, 'distance_pips': 0.05}]
2025-10-08 10:35:43,413 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.034607380576787}
2025-10-08 10:35:43,413 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:43,413 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:43,414 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:35:43,414 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4034.578
2025-10-08 10:35:43,415 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:35:43,415 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:35:43,416 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:43,417 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:35:43,417 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:35:43,418 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4034.578
2025-10-08 10:35:43,418 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-08 10:35:43,419 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:35:43,427 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:43,428 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:35:43,433 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:35:43,436 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4034.578
2025-10-08 10:35:43,441 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-08 10:35:43,442 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:35:43,444 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:43,445 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:35:43,448 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:35:43,449 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4034.578
2025-10-08 10:35:43,450 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:35:43,562 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:35:43,568 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:43,650 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:35:43,651 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:43,651 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:43,652 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:35:43,652 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:35:43,653 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:35:43,653 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:35:43,654 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:35:43,655 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:35:43,655 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:35:43,656 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:35:43,656 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:35:43,657 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:35:43,657 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:35:43,657 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:35:43,658 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:35:43,658 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:35:43,658 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:35:43,659 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:35:43,659 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:43,660 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:43,660 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:35:43,661 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:35:43,661 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:35:43,661 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:35:43,662 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:35:43,663 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:35:43,665 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:43,666 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:35:43,666 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4034.578, 'ask': 4034.615, 'last': 0.0, 'time': 1759919742}
2025-10-08 10:35:43,666 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:35:43,667 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:35:43,669 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:35:43,670 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:35:43,675 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:35:43,676 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:43,677 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:43,678 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:43,678 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:43,679 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:43,679 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:35:43,680 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4034.578
2025-10-08 10:35:43,681 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 38579.99999999993}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 93697.00000000012}, {'name': 'EQ50_D', 'price': 4017.133, 'relation': 'BELOW', 'distance_pips': 17445.000000000164}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 40148.99999999988}]
2025-10-08 10:35:43,682 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:35:43,806 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:43,835 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:35:43,837 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:35:43,842 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:35:43,844 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:35:47,240 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:35:47,242 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:35:47,242 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:35:47,243 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:35:47,245 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:35:47,245 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:35:47,248 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:35:47,248 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:47,251 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:35:47,252 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:35:47,252 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:35:47,253 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:35:47,253 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:35:47,298 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:47,754 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:35:47,757 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:35:47,757 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:35:47,758 - APP.services.mt5_service - DEBUG - Current price (cp): 4034.803
2025-10-08 10:35:47,763 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 356, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:35:47,800 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 241, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:35:47,804 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:35:47,805 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:35:47,807 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:35:47,808 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:47,808 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:35:47,809 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:35:47,813 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:35:47,813 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:47,813 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:35:47,814 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:35:47,815 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:35:47,816 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:47,816 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:35:47,817 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:35:47,819 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:35:47,819 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:47,819 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:35:47,820 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:35:47,822 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:35:47,822 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:35:47,823 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:35:47,823 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4049.726, 'low': 3984.54, 'eq50': 4017.133, 'midnight_open': None}
2025-10-08 10:35:47,824 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:35:47,824 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:35:47,825 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:35:47.824991+07:00
2025-10-08 10:35:47,825 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:35:47.824991+07:00
2025-10-08 10:35:47,826 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:35:47.824991+07:00 trong DST: True
2025-10-08 10:35:47,866 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:35:47,867 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:35:47,867 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:35:47,869 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:35:47,869 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4040.5521605214435
2025-10-08 10:35:47,870 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 24 rates.
2025-10-08 10:35:47,871 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4038.442545350559
2025-10-08 10:35:47,874 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4040.5521605214435, 'asia': 4038.442545350559, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:35:47,874 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:35:47,875 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4042.1712171089716
2025-10-08 10:35:47,875 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:35:47,875 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4040.600282028967
2025-10-08 10:35:47,876 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:35:47,876 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.7004229683334
2025-10-08 10:35:47,877 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:35:47,877 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4015.1828187055166
2025-10-08 10:35:47,877 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:35:47,878 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4020.0776196475317
2025-10-08 10:35:47,878 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:35:47,879 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3985.4363287521146
2025-10-08 10:35:47,879 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:35:47,879 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3977.5488806597605
2025-10-08 10:35:47,880 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:35:47,880 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.127743560261
2025-10-08 10:35:47,880 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4042.1712171089716, 'ema200': 4040.600282028967}, 'M5': {'ema50': 4036.7004229683334, 'ema200': 4015.1828187055166}, 'M15': {'ema50': 4020.0776196475317, 'ema200': 3985.4363287521146}, 'H1': {'ema50': 3977.5488806597605, 'ema200': 3912.127743560261}}
2025-10-08 10:35:47,881 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:35:47,881 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.576235845058434, TRs count: 179
2025-10-08 10:35:47,881 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:35:47,882 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.9834230679871276, TRs count: 119
2025-10-08 10:35:47,882 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:35:47,883 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 6.173908625868937, TRs count: 95
2025-10-08 10:35:47,883 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:35:47,884 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 12.33426482448559, TRs count: 119
2025-10-08 10:35:47,884 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.576235845058434, 'M1': 1.9834230679871276, 'M15': 6.173908625868937, 'H1': 12.33426482448559}
2025-10-08 10:35:47,884 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:35:47,885 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4034.803, daily: {'open': 3994.429, 'high': 4049.726, 'low': 3984.54, 'eq50': 4017.133, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:35:47,885 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:35:47,885 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:35:47,886 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4017.133
2025-10-08 10:35:47,886 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:35:47,886 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 38804.99999999983
2025-10-08 10:35:47,886 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 93922.00000000003
2025-10-08 10:35:47,887 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4017.133, Relation: BELOW, Distance: 17670.000000000073
2025-10-08 10:35:47,887 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 40373.999999999796
2025-10-08 10:35:47,888 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:35:47,888 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 38804.99999999983}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 93922.00000000003}, {'name': 'EQ50_D', 'price': 4017.133, 'relation': 'BELOW', 'distance_pips': 17670.000000000073}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 40373.999999999796}]
2025-10-08 10:35:47,888 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:35:47,914 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:35:47,914 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:35:47,915 - APP.services.mt5_service - DEBUG - Day range: 65.18600000000015, Day range % of ADR20: 127.14865446076536
2025-10-08 10:35:47,915 - APP.services.mt5_service - DEBUG - Position in day range: 0.7710704752554199
2025-10-08 10:35:47,916 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:35:47,916 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:35:47.916375+07:00
2025-10-08 10:35:47,916 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:35:47.916375+07:00
2025-10-08 10:35:47,917 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:35:47.916375+07:00 trong DST: True
2025-10-08 10:35:47,917 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:35:47,917 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:35:47,918 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 205
2025-10-08 10:35:47,919 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:47,919 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:47,920 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '8000', 'price': 4034.8, 'distance_pips': 0.3}, {'level': '8025', 'price': 4034.803, 'distance_pips': 0.05}, {'level': '8050', 'price': 4034.805, 'distance_pips': 0.2}, {'level': '8075', 'price': 4034.808, 'distance_pips': 0.45}]
2025-10-08 10:35:47,920 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.0346073805895029}
2025-10-08 10:35:47,920 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:47,944 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:47,944 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:35:47,945 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4034.803
2025-10-08 10:35:47,946 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:35:47,946 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:35:47,947 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:47,947 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:35:47,948 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:35:47,949 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4034.803
2025-10-08 10:35:47,949 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-08 10:35:47,949 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:35:47,951 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:47,951 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:35:47,955 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:35:47,978 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4034.803
2025-10-08 10:35:47,980 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-08 10:35:47,981 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:35:47,981 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:47,982 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:35:47,982 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:35:47,983 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4034.803
2025-10-08 10:35:48,012 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:35:48,013 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:35:48,045 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:48,074 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:35:48,075 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:48,075 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:48,076 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:35:48,076 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:35:48,103 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:35:48,104 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:35:48,104 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:35:48,105 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:35:48,105 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:35:48,106 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:35:48,106 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:35:48,108 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:35:48,108 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:35:48,137 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:35:48,138 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:35:48,138 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:35:48,139 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:35:48,166 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:35:48,166 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:48,167 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:48,168 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:35:48,168 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:35:48,169 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:35:48,169 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:35:48,170 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:35:48,198 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:35:48,199 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:48,200 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:35:48,200 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4034.803, 'ask': 4034.84, 'last': 0.0, 'time': 1759919747}
2025-10-08 10:35:48,200 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:35:48,201 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:35:48,235 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:35:48,274 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:35:48,275 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:35:48,276 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:48,277 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:48,278 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:48,278 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:48,279 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:48,280 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:35:48,280 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4034.803
2025-10-08 10:35:48,281 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 38804.99999999983}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 93922.00000000003}, {'name': 'EQ50_D', 'price': 4017.133, 'relation': 'BELOW', 'distance_pips': 17670.000000000073}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 40373.999999999796}]
2025-10-08 10:35:48,282 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:35:48,381 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:48,382 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:35:48,383 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:35:48,384 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:35:48,386 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:35:52,243 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:35:52,246 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:35:52,246 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:35:52,247 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:35:52,248 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:35:52,249 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:35:52,252 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:35:52,253 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:52,279 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:35:52,280 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:35:52,281 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:35:52,281 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:35:52,282 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:35:52,296 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:52,783 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:35:52,785 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:35:52,785 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:35:52,786 - APP.services.mt5_service - DEBUG - Current price (cp): 4034.716
2025-10-08 10:35:52,792 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 354, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:35:52,839 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 241, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:35:52,840 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:35:52,841 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:35:52,843 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:35:52,844 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:52,844 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:35:52,845 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:35:52,848 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:35:52,848 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:52,848 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:35:52,849 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:35:52,850 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:35:52,851 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:52,851 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:35:52,852 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:35:52,854 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:35:52,854 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:52,854 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:35:52,855 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:35:52,857 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:35:52,858 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:35:52,859 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:35:52,881 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4049.726, 'low': 3984.54, 'eq50': 4017.133, 'midnight_open': None}
2025-10-08 10:35:52,883 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:35:52,883 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:35:52,884 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:35:52.884037+07:00
2025-10-08 10:35:52,884 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:35:52.884037+07:00
2025-10-08 10:35:52,884 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:35:52.884037+07:00 trong DST: True
2025-10-08 10:35:52,885 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:35:52,885 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:35:52,885 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:35:52,887 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:35:52,887 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4040.5451974954703
2025-10-08 10:35:52,889 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 24 rates.
2025-10-08 10:35:52,912 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4038.442545350559
2025-10-08 10:35:52,914 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4040.5451974954703, 'asia': 4038.442545350559, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:35:52,915 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:35:52,915 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4042.171295540344
2025-10-08 10:35:52,916 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:35:52,916 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4040.6003019294644
2025-10-08 10:35:52,917 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:35:52,917 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.7017170859804
2025-10-08 10:35:52,917 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:35:52,919 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4015.1831470637258
2025-10-08 10:35:52,919 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:35:52,920 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4020.0789137651786
2025-10-08 10:35:52,920 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:35:52,920 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3985.4366571103237
2025-10-08 10:35:52,946 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:35:52,947 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3977.5501747774074
2025-10-08 10:35:52,948 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:35:52,948 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.12807191847
2025-10-08 10:35:52,949 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4042.171295540344, 'ema200': 4040.6003019294644}, 'M5': {'ema50': 4036.7017170859804, 'ema200': 4015.1831470637258}, 'M15': {'ema50': 4020.0789137651786, 'ema200': 3985.4366571103237}, 'H1': {'ema50': 3977.5501747774074, 'ema200': 3912.12807191847}}
2025-10-08 10:35:52,949 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:35:52,950 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.576235845058434, TRs count: 179
2025-10-08 10:35:52,950 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:35:52,951 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.9834230679871276, TRs count: 119
2025-10-08 10:35:52,951 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:35:52,952 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 6.173908625868937, TRs count: 95
2025-10-08 10:35:52,955 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:35:52,980 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 12.33426482448559, TRs count: 119
2025-10-08 10:35:52,981 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.576235845058434, 'M1': 1.9834230679871276, 'M15': 6.173908625868937, 'H1': 12.33426482448559}
2025-10-08 10:35:52,982 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:35:52,982 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4034.716, daily: {'open': 3994.429, 'high': 4049.726, 'low': 3984.54, 'eq50': 4017.133, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:35:52,983 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:35:52,986 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:35:53,010 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4017.133
2025-10-08 10:35:53,011 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:35:53,011 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 38717.99999999985
2025-10-08 10:35:53,012 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 93835.00000000003
2025-10-08 10:35:53,012 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4017.133, Relation: BELOW, Distance: 17583.000000000084
2025-10-08 10:35:53,013 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 40286.9999999998
2025-10-08 10:35:53,013 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:35:53,013 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 38717.99999999985}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 93835.00000000003}, {'name': 'EQ50_D', 'price': 4017.133, 'relation': 'BELOW', 'distance_pips': 17583.000000000084}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 40286.9999999998}]
2025-10-08 10:35:53,014 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:35:53,037 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:35:53,038 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:35:53,039 - APP.services.mt5_service - DEBUG - Day range: 65.18600000000015, Day range % of ADR20: 127.14865446076536
2025-10-08 10:35:53,039 - APP.services.mt5_service - DEBUG - Position in day range: 0.7697358328475411
2025-10-08 10:35:53,040 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:35:53,040 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:35:53.040684+07:00
2025-10-08 10:35:53,041 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:35:53.040684+07:00
2025-10-08 10:35:53,041 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:35:53.040684+07:00 trong DST: True
2025-10-08 10:35:53,042 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:35:53,042 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:35:53,042 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 205
2025-10-08 10:35:53,043 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:53,043 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:53,044 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '7100', 'price': 4034.71, 'distance_pips': 0.6}, {'level': '7125', 'price': 4034.713, 'distance_pips': 0.35}, {'level': '7150', 'price': 4034.715, 'distance_pips': 0.1}, {'level': '7175', 'price': 4034.718, 'distance_pips': 0.15}]
2025-10-08 10:35:53,045 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.0346073805895029}
2025-10-08 10:35:53,045 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:53,046 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:53,070 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:35:53,071 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4034.716
2025-10-08 10:35:53,071 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:35:53,072 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:35:53,073 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:53,073 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:35:53,073 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:35:53,074 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4034.716
2025-10-08 10:35:53,075 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-08 10:35:53,076 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:35:53,103 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:53,105 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:35:53,105 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:35:53,106 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4034.716
2025-10-08 10:35:53,107 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-08 10:35:53,107 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:35:53,108 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:53,136 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:35:53,137 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:35:53,138 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4034.716
2025-10-08 10:35:53,138 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:35:53,139 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:35:53,140 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:53,140 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:35:53,166 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:53,166 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:53,167 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:35:53,167 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:35:53,168 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:35:53,168 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:35:53,168 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:35:53,169 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:35:53,169 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:35:53,169 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:35:53,169 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:35:53,170 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:35:53,170 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:35:53,170 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:35:53,198 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:35:53,199 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:35:53,199 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:35:53,199 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:35:53,200 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:53,200 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:53,200 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:35:53,201 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:35:53,201 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:35:53,202 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:35:53,205 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:35:53,230 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:35:53,231 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:53,232 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:35:53,232 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4034.716, 'ask': 4034.753, 'last': 0.0, 'time': 1759919752}
2025-10-08 10:35:53,232 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:35:53,233 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:35:53,236 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:35:53,258 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:35:53,259 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:35:53,259 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:53,260 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:53,260 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:53,260 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:53,261 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:53,261 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:35:53,261 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4034.716
2025-10-08 10:35:53,262 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 38717.99999999985}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 93835.00000000003}, {'name': 'EQ50_D', 'price': 4017.133, 'relation': 'BELOW', 'distance_pips': 17583.000000000084}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 40286.9999999998}]
2025-10-08 10:35:53,262 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:35:53,363 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:53,364 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:35:53,365 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:35:53,366 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:35:53,367 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:35:55,208 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:35:55,285 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:35:57,248 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:35:57,250 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:35:57,250 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:35:57,251 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:35:57,253 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:35:57,253 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:35:57,256 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:35:57,257 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:57,284 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:35:57,285 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:35:57,285 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:35:57,286 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:35:57,287 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:35:57,319 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:57,788 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:35:57,790 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:35:57,790 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:35:57,791 - APP.services.mt5_service - DEBUG - Current price (cp): 4034.928
2025-10-08 10:35:57,797 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 358, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:35:57,836 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 242, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:35:57,837 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:35:57,838 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:35:57,842 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:35:57,842 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:57,843 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:35:57,844 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:35:57,846 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:35:57,846 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:57,847 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:35:57,847 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:35:57,849 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:35:57,849 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:57,850 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:35:57,850 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:35:57,852 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:35:57,853 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:35:57,853 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:35:57,853 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:35:57,856 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:35:57,856 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:35:57,857 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:35:57,857 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4049.726, 'low': 3984.54, 'eq50': 4017.133, 'midnight_open': None}
2025-10-08 10:35:57,857 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:35:57,858 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:35:57,860 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:35:57.860089+07:00
2025-10-08 10:35:57,860 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:35:57.860089+07:00
2025-10-08 10:35:57,882 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:35:57.860089+07:00 trong DST: True
2025-10-08 10:35:57,883 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:35:57,883 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:35:57,884 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:35:57,885 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:35:57,885 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4040.539890037687
2025-10-08 10:35:57,886 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 24 rates.
2025-10-08 10:35:57,887 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4038.442545350559
2025-10-08 10:35:57,889 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4040.539890037687, 'asia': 4038.442545350559, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:35:57,890 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:35:57,890 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4042.1761190697557
2025-10-08 10:35:57,890 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:35:57,899 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4040.6015258100615
2025-10-08 10:35:57,914 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:35:57,914 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.7053249291175
2025-10-08 10:35:57,915 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:35:57,915 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4015.1840624866113
2025-10-08 10:35:57,916 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:35:57,916 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4020.082521608316
2025-10-08 10:35:57,917 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:35:57,917 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3985.4375725332093
2025-10-08 10:35:57,918 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:35:57,918 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3977.5537826205446
2025-10-08 10:35:57,918 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:35:57,919 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1289873413557
2025-10-08 10:35:57,919 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4042.1761190697557, 'ema200': 4040.6015258100615}, 'M5': {'ema50': 4036.7053249291175, 'ema200': 4015.1840624866113}, 'M15': {'ema50': 4020.082521608316, 'ema200': 3985.4375725332093}, 'H1': {'ema50': 3977.5537826205446, 'ema200': 3912.1289873413557}}
2025-10-08 10:35:57,920 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:35:57,921 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.576235845058434, TRs count: 179
2025-10-08 10:35:57,921 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:35:57,922 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.9834230679871276, TRs count: 119
2025-10-08 10:35:57,922 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:35:57,923 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 6.173908625868937, TRs count: 95
2025-10-08 10:35:57,924 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:35:57,945 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 12.33426482448559, TRs count: 119
2025-10-08 10:35:57,947 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.576235845058434, 'M1': 1.9834230679871276, 'M15': 6.173908625868937, 'H1': 12.33426482448559}
2025-10-08 10:35:57,947 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:35:57,948 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4034.928, daily: {'open': 3994.429, 'high': 4049.726, 'low': 3984.54, 'eq50': 4017.133, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:35:57,948 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:35:57,948 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:35:57,949 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4017.133
2025-10-08 10:35:57,949 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:35:57,949 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 38929.99999999983
2025-10-08 10:35:57,950 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 94047.00000000003
2025-10-08 10:35:57,950 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4017.133, Relation: BELOW, Distance: 17795.000000000073
2025-10-08 10:35:57,950 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 40498.999999999796
2025-10-08 10:35:57,951 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:35:57,951 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 38929.99999999983}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 94047.00000000003}, {'name': 'EQ50_D', 'price': 4017.133, 'relation': 'BELOW', 'distance_pips': 17795.000000000073}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 40498.999999999796}]
2025-10-08 10:35:57,952 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:35:57,952 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:35:57,955 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:35:57,973 - APP.services.mt5_service - DEBUG - Day range: 65.18600000000015, Day range % of ADR20: 127.14865446076536
2025-10-08 10:35:57,974 - APP.services.mt5_service - DEBUG - Position in day range: 0.7729880649219127
2025-10-08 10:35:57,974 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:35:57,975 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:35:57.975430+07:00
2025-10-08 10:35:57,975 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:35:57.975430+07:00
2025-10-08 10:35:57,976 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:35:57.975430+07:00 trong DST: True
2025-10-08 10:35:57,976 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:35:57,976 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:35:57,977 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 205
2025-10-08 10:35:57,977 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:57,977 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:57,978 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '9200', 'price': 4034.92, 'distance_pips': 0.8}, {'level': '9225', 'price': 4034.923, 'distance_pips': 0.55}, {'level': '9250', 'price': 4034.925, 'distance_pips': 0.3}, {'level': '9275', 'price': 4034.928, 'distance_pips': 0.05}]
2025-10-08 10:35:57,979 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.0346073805895029}
2025-10-08 10:35:57,979 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:57,979 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:57,980 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:35:57,981 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4034.928
2025-10-08 10:35:57,981 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:35:57,982 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:35:57,982 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:57,983 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:35:57,983 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:35:57,984 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4034.928
2025-10-08 10:35:57,986 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-08 10:35:57,987 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:35:58,008 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:58,009 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:35:58,010 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:35:58,010 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4034.928
2025-10-08 10:35:58,011 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-08 10:35:58,011 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:35:58,012 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:58,013 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:35:58,013 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:35:58,014 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4034.928
2025-10-08 10:35:58,017 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:35:58,032 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:35:58,043 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:35:58,044 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:35:58,044 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:58,044 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:58,045 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:35:58,045 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:35:58,046 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:35:58,047 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:35:58,073 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:35:58,073 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:35:58,074 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:35:58,074 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:35:58,075 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:35:58,075 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:35:58,076 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:35:58,076 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:35:58,077 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:35:58,077 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:35:58,079 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:35:58,105 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:35:58,107 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:58,109 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:58,111 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:35:58,138 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:35:58,138 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:35:58,139 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:35:58,140 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:35:58,142 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:35:58,170 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:58,171 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:35:58,171 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:35:58,171 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4034.928, 'ask': 4034.965, 'last': 0.0, 'time': 1759919757}
2025-10-08 10:35:58,197 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:35:58,197 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:35:58,198 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:35:58,198 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:35:58,199 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:58,200 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:58,200 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:58,201 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:35:58,201 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:35:58,202 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:35:58,226 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4034.928
2025-10-08 10:35:58,227 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 38929.99999999983}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 94047.00000000003}, {'name': 'EQ50_D', 'price': 4017.133, 'relation': 'BELOW', 'distance_pips': 17795.000000000073}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 40498.999999999796}]
2025-10-08 10:35:58,228 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:35:58,291 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:35:58,291 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:35:58,292 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:35:58,293 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:35:58,295 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:36:02,252 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:36:02,254 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:36:02,254 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:36:02,255 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:36:02,256 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:36:02,257 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:36:02,260 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:36:02,261 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:36:02,286 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:36:02,287 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:36:02,288 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:36:02,289 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:36:02,290 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:36:02,354 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:36:02,791 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:36:02,793 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:36:02,793 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:36:02,794 - APP.services.mt5_service - DEBUG - Current price (cp): 4035.674
2025-10-08 10:36:02,803 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 359, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:36:02,868 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 242, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:36:02,869 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:36:02,869 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:36:02,872 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:36:02,872 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:36:02,873 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:36:02,874 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:36:02,877 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:36:02,877 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:36:02,877 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:36:02,878 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:36:02,880 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:36:02,880 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:36:02,881 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:36:02,881 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:36:02,883 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:36:02,883 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:36:02,884 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:36:02,884 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:36:02,887 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:36:02,887 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:36:02,888 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:36:02,888 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4049.726, 'low': 3984.54, 'eq50': 4017.133, 'midnight_open': None}
2025-10-08 10:36:02,888 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:36:02,889 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:36:02,889 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:36:02.889606+07:00
2025-10-08 10:36:02,889 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:36:02.889606+07:00
2025-10-08 10:36:02,890 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:36:02.889606+07:00 trong DST: True
2025-10-08 10:36:02,892 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:36:02,893 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:36:02,913 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:36:02,915 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:36:02,915 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4040.539379754709
2025-10-08 10:36:02,916 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 23 rates.
2025-10-08 10:36:02,917 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4038.4214374611083
2025-10-08 10:36:02,919 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4040.539379754709, 'asia': 4038.4214374611083, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:36:02,920 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:36:02,920 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4041.908639071608
2025-10-08 10:36:02,921 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:36:02,921 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4039.759147453273
2025-10-08 10:36:02,922 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:36:02,922 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.7365798310784
2025-10-08 10:36:02,923 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:36:02,925 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4015.1919928348702
2025-10-08 10:36:02,945 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:36:02,945 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4020.1137765102767
2025-10-08 10:36:02,946 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:36:02,946 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3985.445502881468
2025-10-08 10:36:02,947 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:36:02,948 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3977.5850375225054
2025-10-08 10:36:02,948 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:36:02,948 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1369176896146
2025-10-08 10:36:02,949 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4041.908639071608, 'ema200': 4039.759147453273}, 'M5': {'ema50': 4036.7365798310784, 'ema200': 4015.1919928348702}, 'M15': {'ema50': 4020.1137765102767, 'ema200': 3985.445502881468}, 'H1': {'ema50': 3977.5850375225054, 'ema200': 3912.1369176896146}}
2025-10-08 10:36:02,950 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:36:02,950 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.576235845058434, TRs count: 179
2025-10-08 10:36:02,951 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:36:02,951 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.889068973759679, TRs count: 119
2025-10-08 10:36:02,952 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:36:02,953 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 6.173908625868937, TRs count: 95
2025-10-08 10:36:02,953 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:36:02,976 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 12.33426482448559, TRs count: 119
2025-10-08 10:36:02,977 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.576235845058434, 'M1': 1.889068973759679, 'M15': 6.173908625868937, 'H1': 12.33426482448559}
2025-10-08 10:36:02,978 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:36:02,978 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4035.674, daily: {'open': 3994.429, 'high': 4049.726, 'low': 3984.54, 'eq50': 4017.133, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:36:02,978 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:36:02,979 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:36:02,979 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4017.133
2025-10-08 10:36:02,979 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:36:02,980 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 39675.99999999993
2025-10-08 10:36:02,980 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 94793.00000000012
2025-10-08 10:36:02,980 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4017.133, Relation: BELOW, Distance: 18541.000000000167
2025-10-08 10:36:02,981 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 41244.99999999989
2025-10-08 10:36:02,981 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:36:02,982 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 39675.99999999993}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 94793.00000000012}, {'name': 'EQ50_D', 'price': 4017.133, 'relation': 'BELOW', 'distance_pips': 18541.000000000167}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 41244.99999999989}]
2025-10-08 10:36:02,982 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:36:02,983 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:36:02,983 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:36:02,983 - APP.services.mt5_service - DEBUG - Day range: 65.18600000000015, Day range % of ADR20: 127.14865446076536
2025-10-08 10:36:03,003 - APP.services.mt5_service - DEBUG - Position in day range: 0.7844322400515432
2025-10-08 10:36:03,003 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:36:03,004 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:36:03.004333+07:00
2025-10-08 10:36:03,004 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:36:03.004333+07:00
2025-10-08 10:36:03,005 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:36:03.004333+07:00 trong DST: True
2025-10-08 10:36:03,005 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:36:03,005 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:36:03,006 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 204
2025-10-08 10:36:03,006 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:36:03,007 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:36:03,007 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '6700', 'price': 4035.67, 'distance_pips': 0.4}, {'level': '6725', 'price': 4035.673, 'distance_pips': 0.15}, {'level': '6750', 'price': 4035.675, 'distance_pips': 0.1}, {'level': '6775', 'price': 4035.678, 'distance_pips': 0.35}]
2025-10-08 10:36:03,007 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.034607380576787}
2025-10-08 10:36:03,008 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:36:03,008 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:36:03,009 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:36:03,009 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4035.674
2025-10-08 10:36:03,010 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:36:03,010 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:36:03,011 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:36:03,011 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:36:03,012 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:36:03,012 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4035.674
2025-10-08 10:36:03,013 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-08 10:36:03,013 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:36:03,014 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:36:03,014 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:36:03,015 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:36:03,017 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4035.674
2025-10-08 10:36:03,042 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-08 10:36:03,042 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:36:03,043 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:36:03,044 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:36:03,044 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:36:03,045 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4035.674
2025-10-08 10:36:03,045 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-08 10:36:03,046 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:36:03,058 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:36:03,072 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:36:03,073 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:36:03,074 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:36:03,074 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:36:03,075 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:36:03,075 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:36:03,076 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:36:03,076 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:36:03,076 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:36:03,077 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:36:03,077 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:36:03,077 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:36:03,080 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:36:03,080 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:36:03,104 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:36:03,105 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:36:03,106 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:36:03,106 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:36:03,107 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:36:03,107 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:36:03,108 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:36:03,108 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:36:03,108 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:36:03,109 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:36:03,109 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:36:03,136 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:36:03,138 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:36:03,139 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:36:03,142 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:36:03,142 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:36:03,165 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4035.674, 'ask': 4035.711, 'last': 0.0, 'time': 1759919762}
2025-10-08 10:36:03,168 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:36:03,169 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:36:03,170 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:36:03,170 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:36:03,195 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:36:03,195 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:36:03,196 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:36:03,196 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:36:03,197 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:36:03,197 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:36:03,198 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4035.674
2025-10-08 10:36:03,198 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 39675.99999999993}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 94793.00000000012}, {'name': 'EQ50_D', 'price': 4017.133, 'relation': 'BELOW', 'distance_pips': 18541.000000000167}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 41244.99999999989}]
2025-10-08 10:36:03,199 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:36:03,281 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:36:03,282 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:36:03,282 - APP.utils.safe_data - DEBUG - Get top-level key 'account': {'balance': 125.22, 'equity': 125.22, 'free_margin': 125.22, 'currency': 'USD', 'leverage': 2000}
2025-10-08 10:36:03,283 - APP.utils.safe_data - DEBUG - Get top-level key 'positions': []
2025-10-08 10:36:03,284 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:36:07,255 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker lấy thông tin.
2025-10-08 10:36:07,287 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:36:07,287 - APP.ui.components.chart_tab - DEBUG - Bắt đầu worker vẽ biểu đồ.
2025-10-08 10:36:07,332 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_chart_drawing_worker' vào thread pool.
2025-10-08 10:36:07,339 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 150
2025-10-08 10:36:07,342 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:36:07,405 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:36:07,494 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:36:07,511 - APP.services.mt5_service - DEBUG - Đã lấy 150 bars cho XAUUSD 15.
2025-10-08 10:36:07,513 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:36:07,531 - APP.services.mt5_service - DEBUG - Bắt đầu build_context cho symbol: XAUUSD
2025-10-08 10:36:07,532 - APP.services.mt5_service - DEBUG - Đã đảm bảo symbol 'XAUUSD' được chọn. Chờ 0.5s để đồng bộ.
2025-10-08 10:36:07,533 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:36:07,627 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:36:08,066 - APP.services.mt5_service - DEBUG - Đã lấy symbol info, account info, tick info.
2025-10-08 10:36:08,179 - APP.services.mt5_service - WARNING - Không thể xác định múi giờ từ TerminalInfo (thiếu thuộc tính hoặc rỗng), sử dụng UTC.
2025-10-08 10:36:08,231 - APP.services.mt5_service - DEBUG - Đã xây dựng info_obj, account_obj, rules_obj.
2025-10-08 10:36:08,255 - APP.services.mt5_service - DEBUG - Current price (cp): 4035.491
2025-10-08 10:36:08,300 - APP.services.mt5_service - DEBUG - Tick stats 5m: {'ticks_per_min': 365, 'median_spread': 37, 'p90_spread': 37}
2025-10-08 10:36:08,385 - APP.services.mt5_service - DEBUG - Tick stats 30m: {'ticks_per_min': 244, 'median_spread': 37.0, 'p90_spread': 37}
2025-10-08 10:36:08,430 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 1, bars: 120
2025-10-08 10:36:08,457 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 1 ở lần thử 1.
2025-10-08 10:36:08,471 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 1.
2025-10-08 10:36:08,473 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:36:08,481 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 5, bars: 180
2025-10-08 10:36:08,482 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 5 ở lần thử 1.
2025-10-08 10:36:08,483 - APP.ui.app_ui - INFO - Autorun tick: Kích hoạt worker kiểm tra.
2025-10-08 10:36:08,493 - APP.services.mt5_service - DEBUG - Đã lấy 180 bars cho XAUUSD 5.
2025-10-08 10:36:08,514 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_autorun_tick_worker' vào thread pool.
2025-10-08 10:36:08,514 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:36:08,566 - APP.ui.app_ui - DEBUG - Autorun tick worker: Bắt đầu kiểm tra điều kiện.
2025-10-08 10:36:08,572 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 15, bars: 96
2025-10-08 10:36:08,574 - APP.ui.app_ui - INFO - Autorun tick worker: Điều kiện hợp lệ, yêu cầu bắt đầu phân tích trên luồng UI.
2025-10-08 10:36:08,575 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 15 ở lần thử 1.
2025-10-08 10:36:08,598 - APP.services.mt5_service - DEBUG - Đã lấy 96 bars cho XAUUSD 15.
2025-10-08 10:36:08,607 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:36:08,608 - APP.services.mt5_service - DEBUG - Bắt đầu _series_from_mt5 cho symbol: XAUUSD, tf_code: 16385, bars: 120
2025-10-08 10:36:08,631 - APP.services.mt5_service - DEBUG - Lấy rates thành công cho XAUUSD 16385 ở lần thử 1.
2025-10-08 10:36:08,659 - APP.services.mt5_service - DEBUG - Đã lấy 120 bars cho XAUUSD 16385.
2025-10-08 10:36:08,684 - APP.services.mt5_service - DEBUG - Kết thúc _series_from_mt5.
2025-10-08 10:36:08,685 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: start_analysis
2025-10-08 10:36:08,687 - APP.services.mt5_service - DEBUG - Đã lấy OHLCV series cho các khung thời gian.
2025-10-08 10:36:08,687 - APP.ui.app_ui - INFO - Yêu cầu bắt đầu phân tích từ UI.
2025-10-08 10:36:08,694 - APP.services.mt5_service - DEBUG - Bắt đầu tính toán các mức khung thời gian lớn từ series H1.
2025-10-08 10:36:08,720 - APP.ui.utils.ui_builder - DEBUG - Đã thay đổi trạng thái nút Start/Stop thành 'disabled'. Các điều khiển khác không bị ảnh hưởng.
2025-10-08 10:36:08,724 - APP.services.mt5_service - DEBUG - Đã lấy prev_day HL: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:36:08,726 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:36:08,726 - APP.services.mt5_service - DEBUG - Đã lấy prev_week HL: {'high': 3897.216, 'low': 3763.408}
2025-10-08 10:36:08,728 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:36:08,728 - APP.services.mt5_service - DEBUG - Đã tính toán xong các mức khung thời gian lớn.
2025-10-08 10:36:08,751 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:36:08,822 - APP.services.mt5_service - DEBUG - Đã enrich daily data: {'open': 3994.429, 'high': 4049.726, 'low': 3984.54, 'eq50': 4017.133, 'midnight_open': None}
2025-10-08 10:36:08,823 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:36:08,824 - APP.services.mt5_service - DEBUG - Bắt đầu session_ranges_today. M1 rates count: 120
2025-10-08 10:36:08,837 - APP.ui.app_ui - DEBUG - Bắt đầu chụp ảnh nhanh cấu hình từ UI.
2025-10-08 10:36:08,838 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-08 10:36:08,839 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=False, token='', chat_id='', skip_verify=False, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh'), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-08 10:36:08,862 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:36:08,863 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:36:08.863246+07:00
2025-10-08 10:36:08,864 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:36:08.863246+07:00
2025-10-08 10:36:08,884 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:36:08.863246+07:00 trong DST: True
2025-10-08 10:36:08,925 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-08 10:36:08,957 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:36:08,965 - APP.services.te_service - INFO - Đăng nhập thành công vào Trading Economics API.
2025-10-08 10:36:08,967 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:36:08,985 - APP.services.news_service - DEBUG - Cấu hình NewsService đã được cập nhật.
2025-10-08 10:36:08,986 - APP.services.mt5_service - DEBUG - Kết thúc session_ranges_today.
2025-10-08 10:36:09,068 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 120 rates.
2025-10-08 10:36:09,076 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4040.5269035851634
2025-10-08 10:36:09,076 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-08 10:36:09,077 - APP.ui.app_ui - INFO - Đã khởi tạo và bắt đầu luồng AnalysisWorker.
2025-10-08 10:36:09,080 - APP.services.mt5_service - DEBUG - Bắt đầu vwap_from_rates cho 23 rates.
2025-10-08 10:36:09,117 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-08 10:36:09,122 - APP.services.mt5_service - DEBUG - Kết thúc vwap_from_rates. VWAP: 4038.4214374611083
2025-10-08 10:36:09,124 - APP.services.gemini_service - INFO - Đã khởi tạo model 'models/gemini-2.5-flash' thành công.
2025-10-08 10:36:09,129 - APP.services.mt5_service - DEBUG - Đã tính toán sessions, session liquidity và VWAPs: {'day': 4040.5269035851634, 'asia': 4038.4214374611083, 'london': None, 'newyork_am': None, 'newyork_pm': None}
2025-10-08 10:36:09,132 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:36:09,132 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 2: Xây dựng ngữ cảnh và kiểm tra điều kiện.
2025-10-08 10:36:09,135 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4041.89946260102
2025-10-08 10:36:09,136 - APP.core.analysis_worker - DEBUG - BẮT ĐẦU GIAI ĐOẠN 3: Chuẩn bị và upload ảnh (song song).
2025-10-08 10:36:09,136 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-RUN.
2025-10-08 10:36:09,137 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:36:09,137 - APP.analysis.image_processor - DEBUG - Đang thử tải cache upload.
2025-10-08 10:36:09,143 - APP.services.mt5_service - DEBUG - Bắt đầu get_active_killzone cho 2025-10-08 10:36:09.138405 với timezone Asia/Ho_Chi_Minh
2025-10-08 10:36:09,146 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4039.7568190950637
2025-10-08 10:36:09,194 - APP.analysis.image_processor - DEBUG - Đã tải cache upload với 4 mục.
2025-10-08 10:36:09,194 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: 2025-10-08 10:36:09.138405+07:00, Target TZ: None
2025-10-08 10:36:09,195 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 50
2025-10-08 10:36:09,398 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_H1.png: 15517:1759919709:7ec85118b0c2c3da
2025-10-08 10:36:09,398 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 10:36:09.138405+07:00
2025-10-08 10:36:09,479 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M1.png: 22562:1759919694:5b4938732766e6bc
2025-10-08 10:36:09,480 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4036.7274033604904
2025-10-08 10:36:09,497 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:36:09,499 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M15.png: 17494:1759919704:69b61167d4b95a60
2025-10-08 10:36:09,499 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_H1.png, nhưng chữ ký không khớp.
2025-10-08 10:36:09,500 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M5.png: 20530:1759919699:22bff43ee115a669
2025-10-08 10:36:09,501 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 10:36:09.138405+07:00 trong DST: True
2025-10-08 10:36:09,598 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M1.png. Tên từ xa: files/dp4jmcr5j3ke
2025-10-08 10:36:09,604 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 180 giá trị, period: 200
2025-10-08 10:36:09,607 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M15.png, nhưng chữ ký không khớp.
2025-10-08 10:36:09,608 - APP.analysis.image_processor - DEBUG - Đang chuẩn bị ảnh: XAUUSD_H1.png, Tối ưu hóa: False
2025-10-08 10:36:09,609 - APP.analysis.image_processor - DEBUG - Cache hit cho XAUUSD_M5.png. Tên từ xa: files/verl2q0oxkyk
2025-10-08 10:36:09,619 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:36:09,620 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M1.png, đang lấy thông tin file...
2025-10-08 10:36:09,621 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4015.189664476661
2025-10-08 10:36:09,622 - APP.analysis.image_processor - DEBUG - Đang chuẩn bị ảnh: XAUUSD_M15.png, Tối ưu hóa: False
2025-10-08 10:36:09,623 - APP.analysis.image_processor - DEBUG - Bỏ qua tối ưu hóa hình ảnh.
2025-10-08 10:36:09,623 - APP.core.analysis_worker - DEBUG - Tìm thấy trong cache: XAUUSD_M5.png, đang lấy thông tin file...
2025-10-08 10:36:09,624 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:36:09,743 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 50
2025-10-08 10:36:09,744 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:36:09,745 - APP.analysis.image_processor - DEBUG - Bỏ qua tối ưu hóa hình ảnh.
2025-10-08 10:36:09,746 - APP.analysis.image_processor - INFO - Đang tải 'XAUUSD_H1.png' lên Gemini File API...
2025-10-08 10:36:09,747 - APP.services.mt5_service - DEBUG - Không trong killzone nào.
2025-10-08 10:36:09,748 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 4020.1036196475316
2025-10-08 10:36:09,749 - APP.analysis.image_processor - INFO - Đang tải 'XAUUSD_M15.png' lên Gemini File API...
2025-10-08 10:36:09,755 - APP.core.trading.conditions - INFO - Điều kiện NO-RUN được kích hoạt: Không chạy ngoài các Kill Zone đã định nghĩa.
2025-10-08 10:36:09,758 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 96 giá trị, period: 200
2025-10-08 10:36:09,809 - APP.core.trading.conditions - INFO - Thoát sớm. Giai đoạn: no-run, Lý do: Không chạy ngoài các Kill Zone đã định nghĩa.
2025-10-08 10:36:09,811 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3985.44292576704
2025-10-08 10:36:09,816 - APP.persistence.log_handler - DEBUG - Đang chuẩn bị ghi log giao dịch. Giai đoạn: no-run, Thư mục con: None
2025-10-08 10:36:09,873 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:36:09,875 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 50
2025-10-08 10:36:09,889 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3977.5748806597603
2025-10-08 10:36:09,890 - APP.services.mt5_service - DEBUG - Bắt đầu ema cho 120 giá trị, period: 200
2025-10-08 10:36:09,890 - APP.services.mt5_service - DEBUG - Kết thúc ema. EMA: 3912.1343405751863
2025-10-08 10:36:09,962 - APP.services.mt5_service - DEBUG - Đã tính toán EMA: {'M1': {'ema50': 4041.89946260102, 'ema200': 4039.7568190950637}, 'M5': {'ema50': 4036.7274033604904, 'ema200': 4015.189664476661}, 'M15': {'ema50': 4020.1036196475316, 'ema200': 3985.44292576704}, 'H1': {'ema50': 3977.5748806597603, 'ema200': 3912.1343405751863}}
2025-10-08 10:36:09,966 - APP.persistence.log_handler - DEBUG - Đã ghi log giao dịch thành công vào trade_log_20251008.jsonl.
2025-10-08 10:36:10,029 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:36:10,031 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 180 rates, period: 14
2025-10-08 10:36:10,041 - APP.persistence.log_handler - DEBUG - Kết thúc hàm log_trade.
2025-10-08 10:36:10,246 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 3.583950130772732, TRs count: 179
2025-10-08 10:36:10,260 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:36:10,349 - APP.core.analysis_worker - INFO - Giai đoạn 2 thoát sớm: Điều kiện No-Run: Không chạy ngoài các Kill Zone đã định nghĩa.
2025-10-08 10:36:10,406 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:36:10,458 - APP.utils.threading_utils - DEBUG - Gửi tác vụ '_mt5_check_connection_worker' vào thread pool.
2025-10-08 10:36:10,464 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 1.960997545188255, TRs count: 119
2025-10-08 10:36:10,474 - APP.utils.threading_utils - DEBUG - Tác vụ song song '_execute_stage_2_logic' đã hoàn thành.
2025-10-08 10:36:10,475 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 96 rates, period: 14
2025-10-08 10:36:10,476 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 6.173908625868937, TRs count: 95
2025-10-08 10:36:10,477 - APP.services.mt5_service - DEBUG - Bắt đầu atr_series cho 120 rates, period: 14
2025-10-08 10:36:10,482 - APP.services.mt5_service - DEBUG - Kết thúc atr_series. Last ATR: 12.33426482448559, TRs count: 119
2025-10-08 10:36:10,483 - APP.services.mt5_service - DEBUG - Đã tính toán ATR: {'M5': 3.583950130772732, 'M1': 1.960997545188255, 'M15': 6.173908625868937, 'H1': 12.33426482448559}
2025-10-08 10:36:10,484 - APP.services.mt5_service - DEBUG - Volatility regime: trending
2025-10-08 10:36:10,534 - APP.services.mt5_service - DEBUG - Bắt đầu _nearby_key_levels cho cp: 4035.491, daily: {'open': 3994.429, 'high': 4049.726, 'low': 3984.54, 'eq50': 4017.133, 'midnight_open': None}, prev_day: {'high': 3995.998, 'low': 3940.881}
2025-10-08 10:36:10,535 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:36:10,603 - APP.services.mt5_service - DEBUG - Thêm PDH: 3995.998
2025-10-08 10:36:10,661 - APP.services.mt5_service - DEBUG - Thêm PDL: 3940.881
2025-10-08 10:36:10,662 - APP.services.mt5_service - DEBUG - Thêm EQ50_D: 4017.133
2025-10-08 10:36:10,663 - APP.services.mt5_service - DEBUG - Thêm DO: 3994.429
2025-10-08 10:36:10,664 - APP.services.mt5_service - DEBUG - Key level: PDH, Price: 3995.998, Relation: BELOW, Distance: 39492.999999999935
2025-10-08 10:36:10,664 - APP.services.mt5_service - DEBUG - Key level: PDL, Price: 3940.881, Relation: BELOW, Distance: 94610.00000000013
2025-10-08 10:36:10,665 - APP.services.mt5_service - DEBUG - Key level: EQ50_D, Price: 4017.133, Relation: BELOW, Distance: 18358.000000000175
2025-10-08 10:36:10,666 - APP.services.mt5_service - DEBUG - Key level: DO, Price: 3994.429, Relation: BELOW, Distance: 41061.9999999999
2025-10-08 10:36:10,667 - APP.services.mt5_service - DEBUG - Kết thúc _nearby_key_levels. Số key levels: 4
2025-10-08 10:36:10,667 - APP.services.mt5_service - DEBUG - Key levels nearby: [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 39492.999999999935}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 94610.00000000013}, {'name': 'EQ50_D', 'price': 4017.133, 'relation': 'BELOW', 'distance_pips': 18358.000000000175}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 41061.9999999999}]
2025-10-08 10:36:10,669 - APP.services.mt5_service - DEBUG - Bắt đầu adr_stats cho symbol: XAUUSD, n: 20
2025-10-08 10:36:10,670 - APP.services.mt5_service - DEBUG - Kết thúc adr_stats. Kết quả: {'d5': 60.160200000000074, 'd10': 55.000900000000044, 'd20': 51.26755000000003}
2025-10-08 10:36:10,671 - APP.services.mt5_service - DEBUG - Prev day close: 3994.473
2025-10-08 10:36:10,675 - APP.services.mt5_service - DEBUG - Day range: 65.18600000000015, Day range % of ADR20: 127.14865446076536
2025-10-08 10:36:10,676 - APP.services.mt5_service - DEBUG - Position in day range: 0.7816248887797979
2025-10-08 10:36:10,677 - APP.services.mt5_service - DEBUG - Bắt đầu _killzone_ranges_vn. Date: None, Target TZ: None
2025-10-08 10:36:10,678 - APP.services.mt5_service - DEBUG - Sử dụng thời gian hiện tại ở TZ: Asia/Ho_Chi_Minh, Date: 2025-10-08 17:36:10.678155+07:00
2025-10-08 10:36:10,678 - APP.services.mt5_service - DEBUG - Bắt đầu _is_us_dst cho ngày: 2025-10-08 17:36:10.678155+07:00
2025-10-08 10:36:10,680 - APP.services.mt5_service - DEBUG - Kết thúc _is_us_dst. Ngày 2025-10-08 17:36:10.678155+07:00 trong DST: True
2025-10-08 10:36:10,692 - APP.services.mt5_service - DEBUG - Is US DST (summer): True
2025-10-08 10:36:10,693 - APP.services.mt5_service - DEBUG - Đã tạo killzone ranges cho mùa hè.
2025-10-08 10:36:10,761 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:36:10,795 - APP.services.mt5_service - DEBUG - Killzone active: None, Mins to next killzone: 204
2025-10-08 10:36:10,950 - googleapiclient.discovery - DEBUG - URL being requested: POST https://generativelanguage.googleapis.com/upload/v1beta/files?key=AIzaSyDSYUGBjTZkXmxIAA4ySZi6h1EepuAnoKE&alt=json&uploadType=resumable
2025-10-08 10:36:10,952 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:36:10,970 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:36:10,986 - googleapiclient.discovery - DEBUG - URL being requested: POST https://generativelanguage.googleapis.com/upload/v1beta/files?key=AIzaSyDSYUGBjTZkXmxIAA4ySZi6h1EepuAnoKE&alt=json&uploadType=resumable
2025-10-08 10:36:11,071 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:36:11,117 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:36:11,326 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:36:11,344 - APP.services.mt5_service - DEBUG - Round levels: [{'level': '4900', 'price': 4035.49, 'distance_pips': 0.1}, {'level': '4925', 'price': 4035.493, 'distance_pips': 0.15}, {'level': '4950', 'price': 4035.495, 'distance_pips': 0.4}, {'level': '4975', 'price': 4035.498, 'distance_pips': 0.65}]
2025-10-08 10:36:11,471 - APP.services.mt5_service - DEBUG - ATR normalized spread: {'spread_as_pct_of_atr_m5': 1.032380436382625}
2025-10-08 10:36:11,509 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:36:11,597 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:36:11,603 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: <lambda>
2025-10-08 10:36:11,624 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:36:11,625 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:36:11,626 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4035.491
2025-10-08 10:36:11,638 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 1 FVG.
2025-10-08 10:36:11,699 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:36:11,756 - APP.ui.utils.ui_builder - DEBUG - Executing UI callback: update_ui
2025-10-08 10:36:11,772 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:36:11,790 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe H1.
2025-10-08 10:36:11,914 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 96 rates, lookback: 200
2025-10-08 10:36:11,929 - APP.ui.app_ui - INFO - Bắt đầu quy trình tắt ứng dụng an toàn.
2025-10-08 10:36:11,978 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 96 rates, current_price: 4035.491
2025-10-08 10:36:11,983 - APP.ui.app_ui - DEBUG - Đang chờ luồng AnalysisWorker kết thúc...
2025-10-08 10:36:12,039 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-08 10:36:12,045 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 96 rates, lookback: 100
2025-10-08 10:36:12,099 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:36:12,161 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M15.
2025-10-08 10:36:12,196 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 180 rates, lookback: 200
2025-10-08 10:36:12,199 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 180 rates, current_price: 4035.491
2025-10-08 10:36:12,202 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-08 10:36:12,203 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 180 rates, lookback: 100
2025-10-08 10:36:12,271 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:36:12,280 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M5.
2025-10-08 10:36:12,281 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_liquidity_levels với 120 rates, lookback: 200
2025-10-08 10:36:12,283 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_fvgs với 120 rates, current_price: 4035.491
2025-10-08 10:36:12,286 - APP.analysis.ict_analyzer - DEBUG - Kết thúc find_fvgs. Tìm thấy 2 FVG.
2025-10-08 10:36:12,287 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_order_blocks với 120 rates, lookback: 100
2025-10-08 10:36:12,289 - APP.analysis.ict_analyzer - DEBUG - Bắt đầu find_market_structure_shift với 5 highs, 5 lows.
2025-10-08 10:36:12,290 - APP.services.mt5_service - DEBUG - Đã hoàn thành phân tích ICT cho timeframe M1.
2025-10-08 10:36:12,336 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:36:12,338 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:36:12,339 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:36:12,342 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:36:12,345 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:36:12,346 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:36:12,356 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:36:12,359 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:36:12,386 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:36:12,390 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:36:12,417 - APP.services.mt5_service - DEBUG - Bắt đầu value_per_point cho symbol: XAUUSD
2025-10-08 10:36:12,451 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: point, default: 0.0
2025-10-08 10:36:12,452 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'point' trong object. Giá trị: 0.001
2025-10-08 10:36:12,479 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_value, default: 0.0
2025-10-08 10:36:12,480 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_value' trong object. Giá trị: 0.1
2025-10-08 10:36:12,481 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: trade_tick_size, default: 0.0
2025-10-08 10:36:12,482 - APP.services.mt5_service - DEBUG - Tìm thấy attribute 'trade_tick_size' trong object. Giá trị: 0.001
2025-10-08 10:36:12,482 - APP.services.mt5_service - DEBUG - Tính value_per_point từ tick_value/tick_size: 0.1
2025-10-08 10:36:12,483 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:36:12,511 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:36:12,514 - APP.services.mt5_service - DEBUG - Đã xây dựng payload MT5_DATA.
2025-10-08 10:36:12,515 - APP.utils.safe_data - DEBUG - Khởi tạo SafeData với data có: True
2025-10-08 10:36:12,551 - APP.services.mt5_service - DEBUG - Đã tạo SafeData object.
2025-10-08 10:36:12,576 - APP.services.mt5_service - DEBUG - Kết thúc build_context.
2025-10-08 10:36:12,607 - APP.utils.safe_data - DEBUG - Kiểm tra is_valid: True
2025-10-08 10:36:12,634 - APP.core.trading.conditions - DEBUG - Bắt đầu kiểm tra các điều kiện NO-TRADE.
2025-10-08 10:36:12,636 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_upcoming_events' đã hoàn thành.
2025-10-08 10:36:12,636 - APP.services.mt5_service - DEBUG - Bắt đầu lấy lịch sử deals cho XAUUSD trong 7 ngày qua.
2025-10-08 10:36:12,638 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:36:12,651 - APP.services.mt5_service - DEBUG - Đã định dạng 44 deals cho XAUUSD.
2025-10-08 10:36:12,654 - APP.utils.safe_data - DEBUG - Get top-level key 'tick': {'bid': 4035.491, 'ask': 4035.528, 'last': 0.0, 'time': 1759919767}
2025-10-08 10:36:12,657 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'get_history_deals' đã hoàn thành.
2025-10-08 10:36:12,658 - APP.services.mt5_service - DEBUG - Bắt đầu info_get cho key: spread_current, default: None
2025-10-08 10:36:12,660 - APP.services.mt5_service - DEBUG - Tìm thấy key 'spread_current' trong dict. Giá trị: 37
2025-10-08 10:36:12,661 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:36:12,667 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:36:12,668 - APP.utils.safe_data - DEBUG - Get top-level key 'info': {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:36:12,677 - APP.services.mt5_service - DEBUG - Bắt đầu points_per_pip_from_info cho info: {'digits': 3, 'point': 0.001, 'contract_size': 100.0, 'spread_current': 37, 'swap_long': -490.0, 'swap_short': 0.0}
2025-10-08 10:36:12,679 - APP.services.mt5_service - DEBUG - Kết thúc points_per_pip_from_info. Digits: 3, PPP: 10
2025-10-08 10:36:12,681 - APP.utils.safe_data - DEBUG - Get top-level key 'killzone_active': None
2025-10-08 10:36:12,683 - APP.utils.safe_data - DEBUG - Get tick value 'bid': 4035.491
2025-10-08 10:36:12,684 - APP.utils.safe_data - DEBUG - Get top-level key 'key_levels_nearby': [{'name': 'PDH', 'price': 3995.998, 'relation': 'BELOW', 'distance_pips': 39492.999999999935}, {'name': 'PDL', 'price': 3940.881, 'relation': 'BELOW', 'distance_pips': 94610.00000000013}, {'name': 'EQ50_D', 'price': 4017.133, 'relation': 'BELOW', 'distance_pips': 18358.000000000175}, {'name': 'DO', 'price': 3994.429, 'relation': 'BELOW', 'distance_pips': 41061.9999999999}]
2025-10-08 10:36:12,684 - APP.utils.threading_utils - DEBUG - Tác vụ song song 'check_no_trade_conditions' đã hoàn thành.
2025-10-08 10:36:13,122 - APP.analysis.image_processor - DEBUG - Yêu cầu tải lên đã được gửi. Tên từ xa: files/zm6lfkvb6z45. Đang chờ trạng thái ACTIVE.
2025-10-08 10:36:13,465 - APP.analysis.image_processor - DEBUG - Yêu cầu tải lên đã được gửi. Tên từ xa: files/7fnsfq3tvcye. Đang chờ trạng thái ACTIVE.
2025-10-08 10:36:14,115 - APP.analysis.image_processor - DEBUG - Kiểm tra trạng thái tệp cho 'XAUUSD_M15.png': ACTIVE. Thời gian đã trôi qua: 1.0s
2025-10-08 10:36:14,139 - APP.analysis.image_processor - INFO - Đã tải lên và xử lý thành công 'XAUUSD_M15.png'.
2025-10-08 10:36:14,183 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_M15.png: 17494:1759919704:69b61167d4b95a60
2025-10-08 10:36:14,185 - APP.analysis.image_processor - DEBUG - Đã thêm/cập nhật XAUUSD_M15.png trong cache với tên từ xa files/zm6lfkvb6z45.
2025-10-08 10:36:14,232 - APP.analysis.image_processor - DEBUG - Kiểm tra trạng thái tệp cho 'XAUUSD_H1.png': ACTIVE. Thời gian đã trôi qua: 0.7s
2025-10-08 10:36:14,349 - APP.analysis.image_processor - INFO - Đã tải lên và xử lý thành công 'XAUUSD_H1.png'.
2025-10-08 10:36:14,443 - APP.analysis.image_processor - DEBUG - Đã tính toán chữ ký cho XAUUSD_H1.png: 15517:1759919709:7ec85118b0c2c3da
2025-10-08 10:36:14,546 - APP.analysis.image_processor - DEBUG - Đã thêm/cập nhật XAUUSD_H1.png trong cache với tên từ xa files/7fnsfq3tvcye.
2025-10-08 10:36:14,813 - APP.core.analysis_worker - INFO - Giai đoạn 3 thoát sớm: Dừng bởi người dùng trong quá trình upload.
2025-10-08 10:36:14,910 - APP.utils.threading_utils - DEBUG - Tác vụ song song '_execute_stage_3_logic' đã hoàn thành.
2025-10-08 10:36:15,000 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-08 10:36:15,109 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-08 10:36:15,179 - APP.ui.components.chart_tab - INFO - ChartTab đã dừng làm mới dữ liệu.
2025-10-08 10:36:15,190 - APP.services.news_service - INFO - Đang yêu cầu dừng dịch vụ nền NewsService...
2025-10-08 10:36:15,324 - APP.services.news_service - DEBUG - Luồng nền NewsService đã thoát khỏi vòng lặp.
2025-10-08 10:36:15,531 - APP.services.news_service - INFO - Dịch vụ nền NewsService đã dừng thành công.
2025-10-08 10:36:15,697 - APP.ui.app_ui - DEBUG - Bắt đầu thu thập dữ liệu cấu hình từ UI.
2025-10-08 10:36:15,840 - APP.configs.workspace_config - DEBUG - Bắt đầu lưu cấu hình vào file.
2025-10-08 10:36:15,963 - APP.utils.general_utils - DEBUG - Bắt đầu obfuscate text với salt.
2025-10-08 10:36:16,046 - APP.utils.general_utils - DEBUG - Tạo machine key.
2025-10-08 10:36:16,132 - APP.utils.general_utils - DEBUG - Đã tạo machine key. Độ dài: 32 bytes.
2025-10-08 10:36:16,223 - APP.utils.general_utils - DEBUG - Thực hiện XOR bytes.
2025-10-08 10:36:16,337 - APP.utils.general_utils - DEBUG - Đã obfuscate text thành công.
2025-10-08 10:36:16,430 - APP.configs.workspace_config - DEBUG - Đã mã hóa thành công trường 'api_key' trong nhóm 'te'.
2025-10-08 10:36:16,483 - APP.utils.general_utils - DEBUG - Bắt đầu obfuscate text với salt.
2025-10-08 10:36:16,603 - APP.utils.general_utils - DEBUG - Tạo machine key.
2025-10-08 10:36:16,681 - APP.utils.general_utils - DEBUG - Đã tạo machine key. Độ dài: 32 bytes.
2025-10-08 10:36:16,825 - APP.utils.general_utils - DEBUG - Thực hiện XOR bytes.
2025-10-08 10:36:16,990 - APP.utils.general_utils - DEBUG - Đã obfuscate text thành công.
2025-10-08 10:36:17,101 - APP.configs.workspace_config - DEBUG - Đã mã hóa thành công trường 'api_key' trong nhóm 'fmp'.
2025-10-08 10:36:17,216 - APP.configs.workspace_config - INFO - Cấu hình đã được lưu thành công vào C:\Users\leanhchi\.gemini_folder_analyze\workspace.json
2025-10-08 10:36:17,356 - APP.configs.workspace_config - DEBUG - Kết thúc lưu cấu hình vào file.
2025-10-08 10:36:17,465 - APP.ui.app_ui - INFO - Đã lưu cấu hình workspace thành công.
2025-10-08 10:36:17,591 - APP.services.mt5_service - INFO - Đang ngắt kết nối khỏi MetaTrader 5.
2025-10-08 10:36:17,694 - APP.services.mt5_service - INFO - Đã ngắt kết nối MT5 thành công.
2025-10-08 10:36:17,776 - APP.utils.threading_utils - INFO - Yêu cầu tắt ThreadPoolExecutor (wait=True, timeout=2.0).
2025-10-08 10:36:17,905 - APP.utils.threading_utils - INFO - ThreadPoolExecutor đã được tắt.
2025-10-08 10:36:18,355 - APP.ui.app_ui - INFO - Ứng dụng đã đóng thành công.
2025-10-08 10:36:18,469 - __main__ - INFO - Ứng dụng đã đóng thành công.
