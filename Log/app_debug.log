2025-10-17 05:33:30,023 - APP.persistence.log_handler - INFO - Đã cấu hình logging xoay vòng. File log: Log\app_debug.log, Size: 5MB, Backups: 5
2025-10-17 05:33:30,024 - APP.persistence.log_handler - DEBUG - Hoàn tất thiết lập logging cho ứng dụng.
2025-10-17 05:33:30,024 - __main__ - INFO - Application starting...
2025-10-17 05:33:30,025 - __main__ - INFO - telemetry.ui_backend=pyqt6
2025-10-17 05:33:30,026 - APP.utils.threading_utils - INFO - Khởi tạo ThreadPoolExecutor với tối đa 10 luồng.
2025-10-17 05:33:30,102 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 05:33:30,104 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 05:33:30,108 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 05:33:30,116 - APP.services.news_service - ERROR - Kh?ng th? kh?i t?o TEService: Cannot initialize TEService because the tradingeconomics dependency is not available.
Traceback (most recent call last):
  File "C:\tool\app_gemini-1\APP\services\te_service.py", line 9, in <module>
    import tradingeconomics as te  # type: ignore[import]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\tool\app_gemini-1\.venv\Lib\site-packages\tradingeconomics\__init__.py", line 11, in <module>
    from .historicalDB import getHistorical
  File "C:\tool\app_gemini-1\.venv\Lib\site-packages\tradingeconomics\historicalDB.py", line 4, in <module>
    import pandas as pd
  File "C:\tool\app_gemini-1\.venv\Lib\site-packages\pandas\__init__.py", line 61, in <module>
    from pandas.core.api import (
    ...<62 lines>...
    )
  File "C:\tool\app_gemini-1\.venv\Lib\site-packages\pandas\core\api.py", line 1, in <module>
    from pandas._libs import (
    ...<4 lines>...
    )
  File "C:\tool\app_gemini-1\.venv\Lib\site-packages\pandas\_libs\__init__.py", line 18, in <module>
    from pandas._libs.interval import Interval
  File "pandas/_libs/interval.pyx", line 1, in init pandas._libs.interval
  File "pandas/_libs/hashtable.pyx", line 1, in init pandas._libs.hashtable
  File "pandas/_libs/missing.pyx", line 40, in init pandas._libs.missing
AttributeError: partially initialized module 'pandas' from 'C:\tool\app_gemini-1\.venv\Lib\site-packages\pandas\__init__.py' has no attribute '_pandas_datetime_CAPI' (most likely due to a circular import)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\tool\app_gemini-1\APP\services\news_service.py", line 160, in update_config
    self.te_service = TEService(config.te)
                      ~~~~~~~~~^^^^^^^^^^^
  File "C:\tool\app_gemini-1\APP\services\te_service.py", line 59, in __init__
    raise RuntimeError(message) from _te_import_error
RuntimeError: Cannot initialize TEService because the tradingeconomics dependency is not available.
2025-10-17 05:33:30,167 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 05:33:30,181 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 05:33:30,215 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 05:33:30,220 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 05:33:30,221 - APP.services.news_service - DEBUG - B? qua TEService do l?i tru?c do: Cannot initialize TEService because the tradingeconomics dependency is not available.
2025-10-17 05:33:30,222 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 05:33:30,231 - APP.ui.utils.timeframe_detector - DEBUG - TimeframeDetector đã được khởi tạo và biên dịch 9 mẫu regex.
2025-10-17 05:33:30,682 - APP.ui.controllers.chart_controller - DEBUG - Cập nhật config chart stream: ChartStreamConfig(symbol='XAUUSD', timeframe='M1', candles=50, chart_type='candlestick')
2025-10-17 05:33:30,684 - APP.ui.controllers.chart_controller - INFO - Khởi động ChartController cho symbol=XAUUSD
2025-10-17 05:33:30,685 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'candlestick', 'component': 'chart'})
2025-10-17 05:33:30,688 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-17 05:33:30,694 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'candlestick', 'component': 'chart'})
2025-10-17 05:33:30,695 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 05:33:30,696 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-17 05:33:30,698 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 05:33:30,702 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 05:33:30,734 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 05:33:30,764 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 05:33:30,764 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.06s
2025-10-17 05:33:30,826 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 05:33:30,827 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.13s)
2025-10-17 05:33:30,884 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 05:33:30,888 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.19s
2025-10-17 05:33:30,889 - APP.services.news_service - DEBUG - B? qua TEService do l?i tru?c do: Cannot initialize TEService because the tradingeconomics dependency is not available.
2025-10-17 05:33:30,981 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 05:33:31,123 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 05:33:31,181 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 05:33:31,182 - APP.utils.threading_utils - DEBUG - Gửi task 'prompt.load' vào nhóm 'prompt' (metadata={'component': 'prompt', 'operation': 'load'})
2025-10-17 05:33:31,273 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 05:33:31,280 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 05:33:31,438 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.16s
2025-10-17 05:33:31,442 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O prompt.load vào group prompt (metadata={'component': 'prompt', 'operation': 'load'})
2025-10-17 05:33:31,443 - APP.utils.threading_utils - ERROR - Task 'prompt.load' (group=prompt) gặp lỗi.
Traceback (most recent call last):
  File "C:\tool\app_gemini-1\APP\utils\threading_utils.py", line 124, in _runner
    result = func(*args, **call_kwargs)
  File "C:\tool\app_gemini-1\APP\ui\controllers\io_controller.py", line 53, in _runner
    return worker(*args, **kwargs)
  File "C:\tool\app_gemini-1\APP\ui\pyqt6\main_window.py", line 807, in _job
    raw = path.read_text(encoding="utf-8", errors="ignore")
  File "C:\Users\leanhchi\AppData\Local\Programs\Python\Python313\Lib\pathlib\_local.py", line 546, in read_text
    return PathBase.read_text(self, encoding, errors, newline)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\leanhchi\AppData\Local\Programs\Python\Python313\Lib\pathlib\_abc.py", line 632, in read_text
    with self.open(mode='r', encoding=encoding, errors=errors, newline=newline) as f:
         ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\leanhchi\AppData\Local\Programs\Python\Python313\Lib\pathlib\_local.py", line 537, in open
    return io.open(self, mode, buffering, encoding, errors, newline)
           ~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
PermissionError: [Errno 13] Permission denied: '.'
2025-10-17 05:33:31,524 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.34s)
2025-10-17 05:33:31,607 - APP.utils.threading_utils - DEBUG - Gửi task 'reports.refresh' vào nhóm 'reports' (metadata={})
2025-10-17 05:33:31,616 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.44s
2025-10-17 05:33:31,617 - APP.ui.pyqt6.event_bridge - DEBUG - Bắt đầu timer chuyển queue → signal (interval=50ms)
2025-10-17 05:33:31,820 - APP.utils.threading_utils - DEBUG - Task 'reports.refresh' (group=reports) hoàn tất sau 0.20s
2025-10-17 05:33:59,152 - APP.utils.threading_utils - DEBUG - Gửi task 'reports.refresh' vào nhóm 'reports' (metadata={})
2025-10-17 05:33:59,196 - APP.utils.threading_utils - DEBUG - Task 'reports.refresh' (group=reports) hoàn tất sau 0.04s
2025-10-17 05:34:08,169 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'candlestick', 'component': 'chart'})
2025-10-17 05:34:08,170 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'candlestick', 'component': 'chart'})
2025-10-17 05:34:08,171 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-17 05:34:08,172 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-17 05:34:31,185 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 05:34:31,186 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 05:34:31,187 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 05:34:31,188 - APP.services.news_service - DEBUG - B? qua TEService do l?i tru?c do: Cannot initialize TEService because the tradingeconomics dependency is not available.
2025-10-17 05:34:31,188 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 05:34:31,189 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 05:34:31,189 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 05:34:31,190 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 05:34:31,191 - APP.services.news_service - DEBUG - B? qua TEService do l?i tru?c do: Cannot initialize TEService because the tradingeconomics dependency is not available.
2025-10-17 05:34:31,192 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 05:34:31,192 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 05:34:31,196 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 05:34:31,200 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 05:39:27,903 - APP.persistence.log_handler - INFO - Đã cấu hình logging xoay vòng. File log: Log\app_debug.log, Size: 5MB, Backups: 5
2025-10-17 05:39:27,904 - APP.persistence.log_handler - DEBUG - Hoàn tất thiết lập logging cho ứng dụng.
2025-10-17 05:39:27,904 - __main__ - INFO - Application starting...
2025-10-17 05:39:27,906 - __main__ - INFO - telemetry.ui_backend=pyqt6
2025-10-17 05:39:27,906 - APP.utils.threading_utils - INFO - Khởi tạo ThreadPoolExecutor với tối đa 10 luồng.
2025-10-17 05:39:27,987 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 05:39:27,995 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 05:39:27,996 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 05:39:27,997 - APP.services.news_service - ERROR - Kh?ng th? kh?i t?o TEService: Cannot initialize TEService because the tradingeconomics dependency is not available.
Traceback (most recent call last):
  File "C:\tool\app_gemini-1\APP\services\te_service.py", line 9, in <module>
    import tradingeconomics as te  # type: ignore[import]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\tool\app_gemini-1\.venv\Lib\site-packages\tradingeconomics\__init__.py", line 11, in <module>
    from .historicalDB import getHistorical
  File "C:\tool\app_gemini-1\.venv\Lib\site-packages\tradingeconomics\historicalDB.py", line 4, in <module>
    import pandas as pd
  File "C:\tool\app_gemini-1\.venv\Lib\site-packages\pandas\__init__.py", line 61, in <module>
    from pandas.core.api import (
    ...<62 lines>...
    )
  File "C:\tool\app_gemini-1\.venv\Lib\site-packages\pandas\core\api.py", line 1, in <module>
    from pandas._libs import (
    ...<4 lines>...
    )
  File "C:\tool\app_gemini-1\.venv\Lib\site-packages\pandas\_libs\__init__.py", line 18, in <module>
    from pandas._libs.interval import Interval
  File "pandas/_libs/interval.pyx", line 1, in init pandas._libs.interval
  File "pandas/_libs/hashtable.pyx", line 1, in init pandas._libs.hashtable
  File "pandas/_libs/missing.pyx", line 40, in init pandas._libs.missing
AttributeError: partially initialized module 'pandas' from 'C:\tool\app_gemini-1\.venv\Lib\site-packages\pandas\__init__.py' has no attribute '_pandas_datetime_CAPI' (most likely due to a circular import)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\tool\app_gemini-1\APP\services\news_service.py", line 160, in update_config
    self.te_service = TEService(config.te)
                      ~~~~~~~~~^^^^^^^^^^^
  File "C:\tool\app_gemini-1\APP\services\te_service.py", line 59, in __init__
    raise RuntimeError(message) from _te_import_error
RuntimeError: Cannot initialize TEService because the tradingeconomics dependency is not available.
2025-10-17 05:39:28,007 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 05:39:28,011 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 05:39:28,013 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 05:39:28,014 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 05:39:28,015 - APP.services.news_service - DEBUG - B? qua TEService do l?i tru?c do: Cannot initialize TEService because the tradingeconomics dependency is not available.
2025-10-17 05:39:28,017 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 05:39:28,021 - APP.ui.utils.timeframe_detector - DEBUG - TimeframeDetector đã được khởi tạo và biên dịch 9 mẫu regex.
2025-10-17 05:39:28,293 - APP.ui.controllers.chart_controller - DEBUG - Cập nhật config chart stream: ChartStreamConfig(symbol='XAUUSD', timeframe='M1', candles=50, chart_type='candlestick')
2025-10-17 05:39:28,294 - APP.ui.controllers.chart_controller - INFO - Khởi động ChartController cho symbol=XAUUSD
2025-10-17 05:39:28,295 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'candlestick', 'component': 'chart'})
2025-10-17 05:39:28,304 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-17 05:39:28,307 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'candlestick', 'component': 'chart'})
2025-10-17 05:39:28,338 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 05:39:28,340 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-17 05:39:28,345 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 05:39:28,346 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 05:39:28,348 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 05:39:28,349 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 05:39:28,350 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 05:39:28,351 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 05:39:28,351 - APP.services.news_service - DEBUG - B? qua TEService do l?i tru?c do: Cannot initialize TEService because the tradingeconomics dependency is not available.
2025-10-17 05:39:28,352 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.00s
2025-10-17 05:39:28,352 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 05:39:28,355 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 05:39:28,355 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.01s)
2025-10-17 05:39:28,357 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 05:39:28,357 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.01s
2025-10-17 05:39:28,361 - APP.utils.threading_utils - DEBUG - Gửi task 'prompt.load' vào nhóm 'prompt' (metadata={'component': 'prompt', 'operation': 'load'})
2025-10-17 05:39:28,363 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 05:39:28,421 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O prompt.load vào group prompt (metadata={'component': 'prompt', 'operation': 'load'})
2025-10-17 05:39:28,422 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 05:39:28,422 - APP.utils.threading_utils - ERROR - Task 'prompt.load' (group=prompt) gặp lỗi.
Traceback (most recent call last):
  File "C:\tool\app_gemini-1\APP\utils\threading_utils.py", line 124, in _runner
    result = func(*args, **call_kwargs)
  File "C:\tool\app_gemini-1\APP\ui\controllers\io_controller.py", line 53, in _runner
    return worker(*args, **kwargs)
  File "C:\tool\app_gemini-1\APP\ui\pyqt6\main_window.py", line 807, in _job
    raw = path.read_text(encoding="utf-8", errors="ignore")
  File "C:\Users\leanhchi\AppData\Local\Programs\Python\Python313\Lib\pathlib\_local.py", line 546, in read_text
    return PathBase.read_text(self, encoding, errors, newline)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\leanhchi\AppData\Local\Programs\Python\Python313\Lib\pathlib\_abc.py", line 632, in read_text
    with self.open(mode='r', encoding=encoding, errors=errors, newline=newline) as f:
         ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\leanhchi\AppData\Local\Programs\Python\Python313\Lib\pathlib\_local.py", line 537, in open
    return io.open(self, mode, buffering, encoding, errors, newline)
           ~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
PermissionError: [Errno 13] Permission denied: '.'
2025-10-17 05:39:28,423 - APP.utils.threading_utils - DEBUG - Gửi task 'reports.refresh' vào nhóm 'reports' (metadata={})
2025-10-17 05:39:28,424 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.06s
2025-10-17 05:39:28,516 - APP.ui.pyqt6.event_bridge - DEBUG - Bắt đầu timer chuyển queue → signal (interval=50ms)
2025-10-17 05:39:28,518 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.16s)
2025-10-17 05:39:28,732 - APP.utils.threading_utils - DEBUG - Task 'reports.refresh' (group=reports) hoàn tất sau 0.22s
2025-10-17 05:39:28,766 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.41s
2025-10-17 05:39:45,204 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 05:39:45,205 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxsg'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 05:39:45,210 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 05:39:45,210 - APP.services.news_service - DEBUG - B? qua TEService do l?i tru?c do: Cannot initialize TEService because the tradingeconomics dependency is not available.
2025-10-17 05:39:45,213 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 05:39:45,257 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 05:39:45,264 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxsg'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 05:39:45,268 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 05:39:45,343 - APP.services.news_service - DEBUG - B? qua TEService do l?i tru?c do: Cannot initialize TEService because the tradingeconomics dependency is not available.
2025-10-17 05:39:45,407 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 05:39:45,465 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 05:39:45,480 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 05:39:45,532 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 05:39:45,550 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 05:39:45,627 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.10s
2025-10-17 05:39:45,679 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.20s)
2025-10-17 05:39:45,684 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.20s
2025-10-17 05:39:45,979 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 05:39:45,980 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxsg'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 05:39:45,987 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 05:39:46,027 - APP.services.news_service - DEBUG - B? qua TEService do l?i tru?c do: Cannot initialize TEService because the tradingeconomics dependency is not available.
2025-10-17 05:39:46,029 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 05:39:46,032 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 05:39:46,035 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxsg'), te=TEConfig(enabled=True, api_key='2965e93128ff437:ovhzxu4u55gccrl', skip_ssl_verify=True), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 05:39:46,038 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 05:39:46,039 - APP.services.news_service - DEBUG - B? qua TEService do l?i tru?c do: Cannot initialize TEService because the tradingeconomics dependency is not available.
2025-10-17 05:39:46,046 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 05:39:46,096 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 05:39:46,100 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 05:39:46,102 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 05:39:46,104 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 05:39:46,106 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.00s
2025-10-17 05:39:46,107 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.01s)
2025-10-17 06:42:11,769 - APP.persistence.log_handler - INFO - Đã cấu hình logging xoay vòng. File log: Log\app_debug.log, Size: 5MB, Backups: 5
2025-10-17 06:42:11,770 - APP.persistence.log_handler - DEBUG - Hoàn tất thiết lập logging cho ứng dụng.
2025-10-17 06:42:11,771 - __main__ - INFO - Application starting...
2025-10-17 06:42:11,772 - __main__ - INFO - telemetry.ui_backend=pyqt6
2025-10-17 06:42:11,772 - APP.utils.threading_utils - INFO - Khởi tạo ThreadPoolExecutor với tối đa 10 luồng.
2025-10-17 06:42:11,845 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:42:11,869 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:42:11,884 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:42:11,887 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:42:11,942 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:42:11,954 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:42:11,956 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:42:11,963 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:42:12,027 - APP.ui.utils.timeframe_detector - DEBUG - TimeframeDetector đã được khởi tạo và biên dịch 9 mẫu regex.
2025-10-17 06:42:12,703 - __main__ - ERROR - Fatal exception occurred in main().
Traceback (most recent call last):
  File "C:\tool\app_gemini-1\APP\main.py", line 107, in main
    app = PyQtApplication(config_state=config_state)
  File "C:\tool\app_gemini-1\APP\ui\pyqt6\application.py", line 57, in __init__
    self.window = TradingMainWindow(
                  ~~~~~~~~~~~~~~~~~^
        config_state,
        ^^^^^^^^^^^^^
    ...<3 lines>...
        apply_config=self._coordinator.apply_config,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\tool\app_gemini-1\APP\ui\pyqt6\main_window.py", line 271, in __init__
    self.options_tab = OptionsTabWidget(config_state, self)
                       ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "C:\tool\app_gemini-1\APP\ui\pyqt6\tabs\options.py", line 127, in __init__
    self.reset_from_state(state)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\tool\app_gemini-1\APP\ui\pyqt6\tabs\options.py", line 562, in reset_from_state
    self.te_enabled.setChecked(state.te.enabled)
                               ^^^^^^^^
AttributeError: 'UiConfigState' object has no attribute 'te'
2025-10-17 06:43:12,284 - APP.persistence.log_handler - INFO - Đã cấu hình logging xoay vòng. File log: Log\app_debug.log, Size: 5MB, Backups: 5
2025-10-17 06:43:12,285 - APP.persistence.log_handler - DEBUG - Hoàn tất thiết lập logging cho ứng dụng.
2025-10-17 06:43:12,285 - __main__ - INFO - Application starting...
2025-10-17 06:43:12,286 - __main__ - INFO - telemetry.ui_backend=pyqt6
2025-10-17 06:43:12,287 - APP.utils.threading_utils - INFO - Khởi tạo ThreadPoolExecutor với tối đa 10 luồng.
2025-10-17 06:43:12,384 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:43:12,387 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:43:12,389 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:43:12,391 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:43:12,395 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:43:12,402 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:43:12,413 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:43:12,414 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:43:12,417 - APP.ui.utils.timeframe_detector - DEBUG - TimeframeDetector đã được khởi tạo và biên dịch 9 mẫu regex.
2025-10-17 06:43:13,111 - __main__ - ERROR - Fatal exception occurred in main().
Traceback (most recent call last):
  File "C:\tool\app_gemini-1\APP\main.py", line 107, in main
    app = PyQtApplication(config_state=config_state)
  File "C:\tool\app_gemini-1\APP\ui\pyqt6\application.py", line 57, in __init__
    self.window = TradingMainWindow(
                  ~~~~~~~~~~~~~~~~~^
        config_state,
        ^^^^^^^^^^^^^
    ...<3 lines>...
        apply_config=self._coordinator.apply_config,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\tool\app_gemini-1\APP\ui\pyqt6\main_window.py", line 271, in __init__
    self.options_tab = OptionsTabWidget(config_state, self)
                       ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "C:\tool\app_gemini-1\APP\ui\pyqt6\tabs\options.py", line 127, in __init__
    self.reset_from_state(state)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\tool\app_gemini-1\APP\ui\pyqt6\tabs\options.py", line 563, in reset_from_state
    self.te_key_edit.setText(state.te.api_key)
                             ^^^^^^^^
AttributeError: 'UiConfigState' object has no attribute 'te'
2025-10-17 06:43:55,387 - APP.persistence.log_handler - INFO - Đã cấu hình logging xoay vòng. File log: Log\app_debug.log, Size: 5MB, Backups: 5
2025-10-17 06:43:55,388 - APP.persistence.log_handler - DEBUG - Hoàn tất thiết lập logging cho ứng dụng.
2025-10-17 06:43:55,389 - __main__ - INFO - Application starting...
2025-10-17 06:43:55,390 - __main__ - INFO - telemetry.ui_backend=pyqt6
2025-10-17 06:43:55,391 - APP.utils.threading_utils - INFO - Khởi tạo ThreadPoolExecutor với tối đa 10 luồng.
2025-10-17 06:43:55,443 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:43:55,448 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:43:55,454 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:43:55,462 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:43:55,520 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:43:55,522 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:43:55,525 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:43:55,526 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:43:55,592 - APP.ui.utils.timeframe_detector - DEBUG - TimeframeDetector đã được khởi tạo và biên dịch 9 mẫu regex.
2025-10-17 06:43:56,433 - APP.ui.controllers.chart_controller - DEBUG - Cập nhật config chart stream: ChartStreamConfig(symbol='XAUUSD', timeframe='M1', candles=50, chart_type='candlestick')
2025-10-17 06:43:56,434 - APP.ui.controllers.chart_controller - INFO - Khởi động ChartController cho symbol=XAUUSD
2025-10-17 06:43:56,435 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'candlestick', 'component': 'chart'})
2025-10-17 06:43:56,445 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.01s
2025-10-17 06:43:56,451 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'candlestick', 'component': 'chart'})
2025-10-17 06:43:56,453 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:43:56,454 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-17 06:43:56,458 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:43:56,461 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:43:56,467 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:43:56,475 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:43:56,476 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:43:56,478 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:43:56,479 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.00s
2025-10-17 06:43:56,488 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.03s)
2025-10-17 06:43:56,495 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:43:56,525 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.07s
2025-10-17 06:43:56,527 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:43:56,548 - APP.utils.threading_utils - DEBUG - Gửi task 'prompt.load' vào nhóm 'prompt' (metadata={'component': 'prompt', 'operation': 'load'})
2025-10-17 06:43:56,549 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:43:56,653 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O prompt.load vào group prompt (metadata={'component': 'prompt', 'operation': 'load'})
2025-10-17 06:43:56,654 - APP.utils.threading_utils - DEBUG - Task 'prompt.load' (group=prompt) hoàn tất sau 0.00s
2025-10-17 06:43:56,655 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:43:56,656 - APP.utils.threading_utils - DEBUG - Gửi task 'reports.refresh' vào nhóm 'reports' (metadata={})
2025-10-17 06:43:56,666 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:43:56,668 - APP.ui.pyqt6.event_bridge - DEBUG - Bắt đầu timer chuyển queue → signal (interval=50ms)
2025-10-17 06:43:56,670 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.01s
2025-10-17 06:43:56,960 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.41s)
2025-10-17 06:43:57,020 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.47s
2025-10-17 06:43:59,093 - APP.utils.threading_utils - DEBUG - Task 'reports.refresh' (group=reports) hoàn tất sau 2.43s
2025-10-17 06:44:43,502 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:44:43,503 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=False, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:44:43,506 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:44:43,507 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:44:43,508 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:44:43,509 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=False, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:44:43,517 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:44:43,518 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:44:43,549 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:44:43,554 - APP.services.news_service - DEBUG - Không có nhà cung cấp tin tức nào được kích hoạt.
2025-10-17 06:44:43,558 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.00s)
2025-10-17 06:44:43,561 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.01s
2025-10-17 06:44:44,042 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:44:44,046 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=False, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:44:44,048 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:44:44,049 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:44:44,050 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:44:44,051 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=False, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:44:44,155 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:44:44,156 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:44:44,219 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:44:44,223 - APP.services.news_service - DEBUG - Không có nhà cung cấp tin tức nào được kích hoạt.
2025-10-17 06:44:44,265 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.04s)
2025-10-17 06:44:44,268 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.04s
2025-10-17 06:45:34,202 - APP.persistence.log_handler - INFO - Đã cấu hình logging xoay vòng. File log: Log\app_debug.log, Size: 5MB, Backups: 5
2025-10-17 06:45:34,203 - APP.persistence.log_handler - DEBUG - Hoàn tất thiết lập logging cho ứng dụng.
2025-10-17 06:45:34,204 - __main__ - INFO - Application starting...
2025-10-17 06:45:34,205 - __main__ - INFO - telemetry.ui_backend=pyqt6
2025-10-17 06:45:34,205 - APP.utils.threading_utils - INFO - Khởi tạo ThreadPoolExecutor với tối đa 10 luồng.
2025-10-17 06:45:34,322 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:45:34,323 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:45:34,328 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:45:34,332 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:45:34,338 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:45:34,340 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:45:34,342 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:45:34,344 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:45:34,352 - APP.ui.utils.timeframe_detector - DEBUG - TimeframeDetector đã được khởi tạo và biên dịch 9 mẫu regex.
2025-10-17 06:45:34,978 - APP.ui.controllers.chart_controller - DEBUG - Cập nhật config chart stream: ChartStreamConfig(symbol='XAUUSD', timeframe='M1', candles=50, chart_type='candlestick')
2025-10-17 06:45:34,984 - APP.ui.controllers.chart_controller - INFO - Khởi động ChartController cho symbol=XAUUSD
2025-10-17 06:45:34,986 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'candlestick', 'component': 'chart'})
2025-10-17 06:45:35,034 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-17 06:45:35,039 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'candlestick', 'component': 'chart'})
2025-10-17 06:45:35,041 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:45:35,041 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-17 06:45:35,094 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:45:35,097 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:45:35,100 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:45:35,143 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:45:35,145 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.05s
2025-10-17 06:45:35,146 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:45:35,147 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.05s)
2025-10-17 06:45:35,148 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:45:35,148 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.05s
2025-10-17 06:45:35,149 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:45:35,149 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:45:35,151 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:45:35,152 - APP.utils.threading_utils - DEBUG - Gửi task 'prompt.load' vào nhóm 'prompt' (metadata={'component': 'prompt', 'operation': 'load'})
2025-10-17 06:45:35,153 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:45:35,155 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:45:35,156 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.00s
2025-10-17 06:45:35,157 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.01s)
2025-10-17 06:45:35,158 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O prompt.load vào group prompt (metadata={'component': 'prompt', 'operation': 'load'})
2025-10-17 06:45:35,158 - APP.utils.threading_utils - DEBUG - Task 'prompt.load' (group=prompt) hoàn tất sau 0.00s
2025-10-17 06:45:35,159 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.01s
2025-10-17 06:45:35,160 - APP.utils.threading_utils - DEBUG - Gửi task 'reports.refresh' vào nhóm 'reports' (metadata={})
2025-10-17 06:45:35,163 - APP.ui.pyqt6.event_bridge - DEBUG - Bắt đầu timer chuyển queue → signal (interval=50ms)
2025-10-17 06:45:35,431 - APP.utils.threading_utils - DEBUG - Task 'reports.refresh' (group=reports) hoàn tất sau 0.27s
2025-10-17 06:46:05,697 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:46:05,698 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:46:05,700 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:46:05,700 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:46:05,701 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:46:05,702 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:46:05,703 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:46:05,704 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:46:05,706 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:46:05,710 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:46:05,712 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.session.autorun-20251017-064605' vào nhóm 'analysis.session' (metadata={'component': 'analysis', 'session_id': 'autorun-20251017-064605', 'priority': 'autorun'})
2025-10-17 06:46:05,713 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:46:05,714 - APP.core.analysis_controller - INFO - Đã submit phiên phân tích autorun-20251017-064605 (priority=autorun)
2025-10-17 06:46:05,715 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-17 06:46:05,751 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:46:05,756 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-17 06:46:05,772 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.06s
2025-10-17 06:46:05,774 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Không có ảnh để phân tích.
2025-10-17 06:46:05,814 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.10s)
2025-10-17 06:46:05,816 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-17 06:46:05,817 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.11s
2025-10-17 06:46:05,826 - APP.persistence.json_handler - DEBUG - JsonSaver được khởi tạo cho workspace: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots
2025-10-17 06:46:05,871 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu tạo map timeframe với 0 tên file.
2025-10-17 06:46:05,876 - APP.ui.utils.timeframe_detector - DEBUG - Kết thúc tạo map timeframe. Map: {}
2025-10-17 06:46:05,880 - APP.persistence.md_handler - DEBUG - Bắt đầu lưu báo cáo Markdown.
2025-10-17 06:46:05,881 - APP.persistence.json_handler - DEBUG - Bắt đầu quá trình lưu báo cáo JSON.
2025-10-17 06:46:05,885 - APP.persistence.md_handler - DEBUG - Đường dẫn file báo cáo Markdown: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports\report_20251017_064605.md
2025-10-17 06:46:05,885 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:46:05,887 - APP.persistence.md_handler - DEBUG - Bắt đầu trích xuất báo cáo human-readable.
2025-10-17 06:46:05,901 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:46:05,903 - APP.persistence.md_handler - WARNING - Không tìm thấy điểm bắt đầu báo cáo hợp lệ, trả về toàn bộ nội dung.
2025-10-17 06:46:05,937 - APP.persistence.json_handler - DEBUG - Đã thêm 1 khối JSON vào data_to_save.
2025-10-17 06:46:05,943 - APP.persistence.md_handler - INFO - Đã lưu báo cáo Markdown thành công tại: report_20251017_064605.md
2025-10-17 06:46:05,944 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất tóm tắt và chữ ký.
2025-10-17 06:46:05,944 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: *.md, giữ lại: 10 file.
2025-10-17 06:46:05,945 - APP.analysis.report_parser - DEBUG - Hoàn tất trích xuất. High Prob: False
2025-10-17 06:46:05,946 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:46:05,947 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:46:05,947 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:46:05,948 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:46:05,949 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: report_20251015_075431.md
2025-10-17 06:46:05,951 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:46:05,962 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:46:05,996 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:46:05,999 - APP.persistence.md_handler - DEBUG - Kết thúc việc lưu báo cáo Markdown.
2025-10-17 06:46:06,000 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:46:06,001 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:46:06,002 - APP.persistence.json_handler - DEBUG - Đã parse và lưu plan: {'direction': None}
2025-10-17 06:46:06,004 - APP.persistence.json_handler - INFO - Đã lưu file JSON báo cáo thành công tại: ctx_20251017_064606.json
2025-10-17 06:46:06,005 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: ctx_*.json, giữ lại: 10 file.
2025-10-17 06:46:06,013 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: ctx_20251015_075431.json
2025-10-17 06:46:06,024 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:46:06,025 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:46:06,028 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:46:06,060 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:46:06,061 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:46:06,062 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:46:06,063 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:46:06,065 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:46:06,068 - APP.persistence.json_handler - DEBUG - Kết thúc quá trình lưu báo cáo JSON.
2025-10-17 06:46:06,070 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:46:06,072 - APP.core.analysis_worker - INFO - Đã lưu báo cáo MD và JSON song song.
2025-10-17 06:46:06,073 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-17 06:46:06,074 - APP.utils.threading_utils - DEBUG - Task 'analysis.session.autorun-20251017-064605' (group=analysis.session) hoàn tất sau 0.36s
2025-10-17 06:46:06,097 - APP.core.analysis_controller - INFO - Kết thúc session autorun-20251017-064605: {'status': 'completed', 'early_exit': False}
2025-10-17 06:46:10,985 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:46:10,986 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:46:10,987 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:46:10,988 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:46:10,988 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:46:10,989 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:46:10,990 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:46:10,991 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:46:10,991 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:46:10,993 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.session.manual-20251017-064610' vào nhóm 'analysis.session' (metadata={'component': 'analysis', 'session_id': 'manual-20251017-064610', 'priority': 'user'})
2025-10-17 06:46:10,993 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:46:10,996 - APP.core.analysis_controller - INFO - Đã submit phiên phân tích manual-20251017-064610 (priority=user)
2025-10-17 06:46:10,996 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-17 06:46:10,998 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:46:11,034 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-17 06:46:11,035 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:46:11,036 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.04s
2025-10-17 06:46:11,036 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.04s)
2025-10-17 06:46:11,037 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Không có ảnh để phân tích.
2025-10-17 06:46:11,041 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-17 06:46:11,043 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.05s
2025-10-17 06:46:11,100 - APP.persistence.json_handler - DEBUG - JsonSaver được khởi tạo cho workspace: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots
2025-10-17 06:46:11,101 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu tạo map timeframe với 0 tên file.
2025-10-17 06:46:11,103 - APP.ui.utils.timeframe_detector - DEBUG - Kết thúc tạo map timeframe. Map: {}
2025-10-17 06:46:11,107 - APP.persistence.md_handler - DEBUG - Bắt đầu lưu báo cáo Markdown.
2025-10-17 06:46:11,153 - APP.persistence.json_handler - DEBUG - Bắt đầu quá trình lưu báo cáo JSON.
2025-10-17 06:46:11,155 - APP.persistence.md_handler - DEBUG - Đường dẫn file báo cáo Markdown: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports\report_20251017_064611.md
2025-10-17 06:46:11,156 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:46:11,158 - APP.persistence.md_handler - DEBUG - Bắt đầu trích xuất báo cáo human-readable.
2025-10-17 06:46:11,159 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:46:11,159 - APP.persistence.md_handler - WARNING - Không tìm thấy điểm bắt đầu báo cáo hợp lệ, trả về toàn bộ nội dung.
2025-10-17 06:46:11,160 - APP.persistence.json_handler - DEBUG - Đã thêm 1 khối JSON vào data_to_save.
2025-10-17 06:46:11,162 - APP.persistence.md_handler - INFO - Đã lưu báo cáo Markdown thành công tại: report_20251017_064611.md
2025-10-17 06:46:11,163 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất tóm tắt và chữ ký.
2025-10-17 06:46:11,163 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: *.md, giữ lại: 10 file.
2025-10-17 06:46:11,164 - APP.analysis.report_parser - DEBUG - Hoàn tất trích xuất. High Prob: False
2025-10-17 06:46:11,166 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:46:11,167 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: report_20251015_075643.md
2025-10-17 06:46:11,168 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:46:11,183 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:46:11,186 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:46:11,196 - APP.persistence.md_handler - DEBUG - Kết thúc việc lưu báo cáo Markdown.
2025-10-17 06:46:11,221 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:46:11,223 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:46:11,227 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:46:11,228 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:46:11,228 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:46:11,229 - APP.persistence.json_handler - DEBUG - Đã parse và lưu plan: {'direction': None}
2025-10-17 06:46:11,231 - APP.persistence.json_handler - INFO - Đã lưu file JSON báo cáo thành công tại: ctx_20251017_064611.json
2025-10-17 06:46:11,233 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: ctx_*.json, giữ lại: 10 file.
2025-10-17 06:46:11,262 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: ctx_20251015_075643.json
2025-10-17 06:46:11,268 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:46:11,308 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:46:11,312 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:46:11,316 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:46:11,318 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:46:11,324 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:46:11,325 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:46:11,326 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:46:11,327 - APP.persistence.json_handler - DEBUG - Kết thúc quá trình lưu báo cáo JSON.
2025-10-17 06:46:11,388 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:46:11,390 - APP.core.analysis_worker - INFO - Đã lưu báo cáo MD và JSON song song.
2025-10-17 06:46:11,392 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-17 06:46:11,393 - APP.utils.threading_utils - DEBUG - Task 'analysis.session.manual-20251017-064610' (group=analysis.session) hoàn tất sau 0.40s
2025-10-17 06:46:11,412 - APP.core.analysis_controller - INFO - Kết thúc session manual-20251017-064610: {'status': 'completed', 'early_exit': False}
2025-10-17 06:46:27,868 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'candlestick', 'component': 'chart'})
2025-10-17 06:46:27,869 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'candlestick', 'component': 'chart'})
2025-10-17 06:46:27,869 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-17 06:46:27,871 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-17 06:46:29,214 - APP.ui.controllers.chart_controller - DEBUG - User yêu cầu snapshot chart ngay lập tức.
2025-10-17 06:46:29,215 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'candlestick', 'component': 'chart'})
2025-10-17 06:46:29,216 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'candlestick', 'component': 'chart'})
2025-10-17 06:46:29,216 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-17 06:46:29,217 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-17 06:46:32,622 - APP.ui.controllers.chart_controller - DEBUG - User yêu cầu snapshot chart ngay lập tức.
2025-10-17 06:46:32,622 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'candlestick', 'component': 'chart'})
2025-10-17 06:46:32,623 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'candlestick', 'component': 'chart'})
2025-10-17 06:46:32,624 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-17 06:46:32,625 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-17 06:46:43,435 - APP.ui.controllers.chart_controller - DEBUG - Cập nhật config chart stream: ChartStreamConfig(symbol='XAUUSD', timeframe='M1', candles=50, chart_type='line')
2025-10-17 06:46:45,383 - APP.ui.controllers.chart_controller - DEBUG - Cập nhật config chart stream: ChartStreamConfig(symbol='XAUUSD', timeframe='M1', candles=50, chart_type='candlestick')
2025-10-17 06:46:53,329 - APP.ui.controllers.chart_controller - DEBUG - Cập nhật config chart stream: ChartStreamConfig(symbol='XAUUSD', timeframe='M15', candles=50, chart_type='candlestick')
2025-10-17 06:47:02,079 - APP.ui.controllers.news_controller - INFO - User yêu cầu refresh tin tức ngay lập tức.
2025-10-17 06:47:02,080 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.user' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'user', 'timeout_sec': 20})
2025-10-17 06:47:02,081 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'user'})
2025-10-17 06:47:02,082 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:47:02,085 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:47:02,087 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.00s
2025-10-17 06:47:02,089 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=user, source=network, latency=0.01s)
2025-10-17 06:47:02,090 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.user' (group=news.polling) hoàn tất sau 0.01s
2025-10-17 06:47:04,015 - APP.ui.controllers.news_controller - INFO - User yêu cầu refresh tin tức ngay lập tức.
2025-10-17 06:47:04,016 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.user' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'user', 'timeout_sec': 20})
2025-10-17 06:47:04,017 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'user'})
2025-10-17 06:47:04,018 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:47:04,018 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:47:04,019 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.00s
2025-10-17 06:47:04,020 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=user, source=network, latency=0.00s)
2025-10-17 06:47:04,063 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.user' (group=news.polling) hoàn tất sau 0.05s
2025-10-17 06:47:11,419 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:47:11,420 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:47:11,421 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:47:11,421 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:47:11,422 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:47:11,422 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:47:11,424 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:47:11,424 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:47:11,425 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:47:11,426 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:47:11,428 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.session.autorun-20251017-064711' vào nhóm 'analysis.session' (metadata={'component': 'analysis', 'session_id': 'autorun-20251017-064711', 'priority': 'autorun'})
2025-10-17 06:47:11,474 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:47:11,475 - APP.core.analysis_controller - INFO - Đã submit phiên phân tích autorun-20251017-064711 (priority=autorun)
2025-10-17 06:47:11,475 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-17 06:47:11,477 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:47:11,479 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-17 06:47:11,483 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.01s
2025-10-17 06:47:11,484 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Không có ảnh để phân tích.
2025-10-17 06:47:11,485 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.06s)
2025-10-17 06:47:11,485 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-17 06:47:11,486 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.06s
2025-10-17 06:47:11,487 - APP.persistence.json_handler - DEBUG - JsonSaver được khởi tạo cho workspace: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots
2025-10-17 06:47:11,488 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu tạo map timeframe với 0 tên file.
2025-10-17 06:47:11,488 - APP.ui.utils.timeframe_detector - DEBUG - Kết thúc tạo map timeframe. Map: {}
2025-10-17 06:47:11,490 - APP.persistence.md_handler - DEBUG - Bắt đầu lưu báo cáo Markdown.
2025-10-17 06:47:11,558 - APP.persistence.json_handler - DEBUG - Bắt đầu quá trình lưu báo cáo JSON.
2025-10-17 06:47:11,561 - APP.persistence.md_handler - DEBUG - Đường dẫn file báo cáo Markdown: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports\report_20251017_064711.md
2025-10-17 06:47:11,562 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:47:11,563 - APP.persistence.md_handler - DEBUG - Bắt đầu trích xuất báo cáo human-readable.
2025-10-17 06:47:11,563 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:47:11,564 - APP.persistence.md_handler - WARNING - Không tìm thấy điểm bắt đầu báo cáo hợp lệ, trả về toàn bộ nội dung.
2025-10-17 06:47:11,564 - APP.persistence.json_handler - DEBUG - Đã thêm 1 khối JSON vào data_to_save.
2025-10-17 06:47:11,565 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất tóm tắt và chữ ký.
2025-10-17 06:47:11,566 - APP.persistence.md_handler - INFO - Đã lưu báo cáo Markdown thành công tại: report_20251017_064711.md
2025-10-17 06:47:11,566 - APP.analysis.report_parser - DEBUG - Hoàn tất trích xuất. High Prob: False
2025-10-17 06:47:11,566 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: *.md, giữ lại: 10 file.
2025-10-17 06:47:11,567 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:47:11,568 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:47:11,570 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:47:11,570 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:47:11,571 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: report_20251015_075843.md
2025-10-17 06:47:11,571 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:47:11,571 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:47:11,572 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:47:11,574 - APP.persistence.md_handler - DEBUG - Kết thúc việc lưu báo cáo Markdown.
2025-10-17 06:47:11,575 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:47:11,576 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:47:11,576 - APP.persistence.json_handler - DEBUG - Đã parse và lưu plan: {'direction': None}
2025-10-17 06:47:11,579 - APP.persistence.json_handler - INFO - Đã lưu file JSON báo cáo thành công tại: ctx_20251017_064711.json
2025-10-17 06:47:11,580 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: ctx_*.json, giữ lại: 10 file.
2025-10-17 06:47:11,583 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: ctx_20251015_075843.json
2025-10-17 06:47:11,584 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:47:11,709 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:47:11,719 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:47:11,720 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:47:11,722 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:47:11,723 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:47:11,723 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:47:11,725 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:47:11,726 - APP.persistence.json_handler - DEBUG - Kết thúc quá trình lưu báo cáo JSON.
2025-10-17 06:47:11,728 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:47:11,729 - APP.core.analysis_worker - INFO - Đã lưu báo cáo MD và JSON song song.
2025-10-17 06:47:11,729 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-17 06:47:11,730 - APP.utils.threading_utils - DEBUG - Task 'analysis.session.autorun-20251017-064711' (group=analysis.session) hoàn tất sau 0.25s
2025-10-17 06:47:11,794 - APP.core.analysis_controller - INFO - Kết thúc session autorun-20251017-064711: {'status': 'completed', 'early_exit': False}
2025-10-17 06:47:14,651 - APP.utils.threading_utils - DEBUG - Gửi task 'prompt.load' vào nhóm 'prompt' (metadata={'component': 'prompt', 'operation': 'load'})
2025-10-17 06:47:14,652 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O prompt.load vào group prompt (metadata={'component': 'prompt', 'operation': 'load'})
2025-10-17 06:47:14,652 - APP.utils.threading_utils - DEBUG - Task 'prompt.load' (group=prompt) hoàn tất sau 0.00s
2025-10-17 06:47:18,141 - APP.utils.threading_utils - DEBUG - Gửi task 'prompt.save' vào nhóm 'prompt' (metadata={'component': 'prompt', 'operation': 'save'})
2025-10-17 06:47:18,141 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O prompt.save vào group prompt (metadata={'component': 'prompt', 'operation': 'save'})
2025-10-17 06:47:18,143 - APP.utils.threading_utils - ERROR - Task 'prompt.save' (group=prompt) gặp lỗi.
Traceback (most recent call last):
  File "C:\tool\app_gemini-1\APP\utils\threading_utils.py", line 124, in _runner
    result = func(*args, **call_kwargs)
  File "C:\tool\app_gemini-1\APP\ui\controllers\io_controller.py", line 53, in _runner
    return worker(*args, **kwargs)
  File "C:\tool\app_gemini-1\APP\ui\pyqt6\main_window.py", line 899, in _job
    path.write_text(serialized, encoding="utf-8")
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\leanhchi\AppData\Local\Programs\Python\Python313\Lib\pathlib\_local.py", line 555, in write_text
    return PathBase.write_text(self, data, encoding, errors, newline)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\leanhchi\AppData\Local\Programs\Python\Python313\Lib\pathlib\_abc.py", line 651, in write_text
    with self.open(mode='w', encoding=encoding, errors=errors, newline=newline) as f:
         ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\leanhchi\AppData\Local\Programs\Python\Python313\Lib\pathlib\_local.py", line 537, in open
    return io.open(self, mode, buffering, encoding, errors, newline)
           ~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
PermissionError: [Errno 13] Permission denied: '.'
2025-10-17 06:47:29,915 - APP.utils.threading_utils - DEBUG - Gửi task 'history.refresh.reports' vào nhóm 'history.reports' (metadata={})
2025-10-17 06:47:29,921 - APP.utils.threading_utils - DEBUG - Task 'history.refresh.reports' (group=history.reports) hoàn tất sau 0.01s
2025-10-17 06:47:32,247 - APP.utils.threading_utils - DEBUG - Gửi task 'history.refresh.contexts' vào nhóm 'history.contexts' (metadata={})
2025-10-17 06:47:32,253 - APP.utils.threading_utils - DEBUG - Task 'history.refresh.contexts' (group=history.contexts) hoàn tất sau 0.01s
2025-10-17 06:47:38,891 - APP.utils.threading_utils - DEBUG - Gửi task 'history.preview' vào nhóm 'history.preview' (metadata={})
2025-10-17 06:47:38,893 - APP.utils.threading_utils - DEBUG - Task 'history.preview' (group=history.preview) hoàn tất sau 0.00s
2025-10-17 06:47:41,405 - APP.utils.threading_utils - DEBUG - Gửi task 'history.preview' vào nhóm 'history.preview' (metadata={})
2025-10-17 06:47:41,407 - APP.utils.threading_utils - DEBUG - Task 'history.preview' (group=history.preview) hoàn tất sau 0.00s
2025-10-17 06:47:42,639 - APP.utils.threading_utils - DEBUG - Gửi task 'history.preview' vào nhóm 'history.preview' (metadata={})
2025-10-17 06:47:42,689 - APP.utils.threading_utils - DEBUG - Task 'history.preview' (group=history.preview) hoàn tất sau 0.05s
2025-10-17 06:47:44,433 - APP.utils.threading_utils - DEBUG - Gửi task 'history.preview' vào nhóm 'history.preview' (metadata={})
2025-10-17 06:47:44,484 - APP.utils.threading_utils - DEBUG - Task 'history.preview' (group=history.preview) hoàn tất sau 0.05s
2025-10-17 06:47:45,011 - APP.utils.threading_utils - DEBUG - Gửi task 'history.preview' vào nhóm 'history.preview' (metadata={})
2025-10-17 06:47:45,103 - APP.utils.threading_utils - DEBUG - Task 'history.preview' (group=history.preview) hoàn tất sau 0.04s
2025-10-17 06:47:46,730 - APP.utils.threading_utils - DEBUG - Gửi task 'history.preview' vào nhóm 'history.preview' (metadata={})
2025-10-17 06:47:46,731 - APP.utils.threading_utils - DEBUG - Task 'history.preview' (group=history.preview) hoàn tất sau 0.00s
2025-10-17 06:47:47,641 - APP.utils.threading_utils - DEBUG - Gửi task 'history.preview' vào nhóm 'history.preview' (metadata={})
2025-10-17 06:47:47,643 - APP.utils.threading_utils - DEBUG - Task 'history.preview' (group=history.preview) hoàn tất sau 0.00s
2025-10-17 06:47:48,469 - APP.utils.threading_utils - DEBUG - Gửi task 'history.preview' vào nhóm 'history.preview' (metadata={})
2025-10-17 06:47:48,470 - APP.utils.threading_utils - DEBUG - Task 'history.preview' (group=history.preview) hoàn tất sau 0.00s
2025-10-17 06:47:49,421 - APP.utils.threading_utils - DEBUG - Gửi task 'history.preview' vào nhóm 'history.preview' (metadata={})
2025-10-17 06:47:49,422 - APP.utils.threading_utils - DEBUG - Task 'history.preview' (group=history.preview) hoàn tất sau 0.00s
2025-10-17 06:47:50,520 - APP.utils.threading_utils - DEBUG - Gửi task 'history.preview' vào nhóm 'history.preview' (metadata={})
2025-10-17 06:47:50,521 - APP.utils.threading_utils - DEBUG - Task 'history.preview' (group=history.preview) hoàn tất sau 0.00s
2025-10-17 06:47:52,145 - APP.utils.threading_utils - DEBUG - Gửi task 'history.preview' vào nhóm 'history.preview' (metadata={})
2025-10-17 06:47:52,146 - APP.utils.threading_utils - DEBUG - Task 'history.preview' (group=history.preview) hoàn tất sau 0.00s
2025-10-17 06:47:53,253 - APP.utils.threading_utils - DEBUG - Gửi task 'history.preview' vào nhóm 'history.preview' (metadata={})
2025-10-17 06:47:53,254 - APP.utils.threading_utils - DEBUG - Task 'history.preview' (group=history.preview) hoàn tất sau 0.00s
2025-10-17 06:47:54,500 - APP.utils.threading_utils - DEBUG - Gửi task 'history.preview' vào nhóm 'history.preview' (metadata={})
2025-10-17 06:47:54,502 - APP.utils.threading_utils - DEBUG - Task 'history.preview' (group=history.preview) hoàn tất sau 0.00s
2025-10-17 06:48:00,690 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:00,691 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:00,692 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:00,693 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:00,693 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:00,694 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:00,695 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:00,696 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:00,696 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:00,699 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:00,707 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:00,740 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:00,742 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.04s
2025-10-17 06:48:00,744 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.04s)
2025-10-17 06:48:00,746 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.05s
2025-10-17 06:48:01,190 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:01,286 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:01,512 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:01,607 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:01,610 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:01,613 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:01,615 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:01,619 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:01,657 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:01,665 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:01,666 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.session.autorun-20251017-064801' vào nhóm 'analysis.session' (metadata={'component': 'analysis', 'session_id': 'autorun-20251017-064801', 'priority': 'autorun'})
2025-10-17 06:48:01,667 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:01,667 - APP.core.analysis_controller - INFO - Đã submit phiên phân tích autorun-20251017-064801 (priority=autorun)
2025-10-17 06:48:01,668 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-17 06:48:01,669 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:01,671 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-17 06:48:01,671 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Không có ảnh để phân tích.
2025-10-17 06:48:01,672 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.01s
2025-10-17 06:48:01,673 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-17 06:48:01,674 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.01s)
2025-10-17 06:48:01,681 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.02s
2025-10-17 06:48:01,681 - APP.persistence.json_handler - DEBUG - JsonSaver được khởi tạo cho workspace: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots
2025-10-17 06:48:01,712 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:01,713 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu tạo map timeframe với 0 tên file.
2025-10-17 06:48:01,719 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:01,723 - APP.ui.utils.timeframe_detector - DEBUG - Kết thúc tạo map timeframe. Map: {}
2025-10-17 06:48:01,726 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:01,729 - APP.persistence.md_handler - DEBUG - Bắt đầu lưu báo cáo Markdown.
2025-10-17 06:48:01,729 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:01,730 - APP.persistence.json_handler - DEBUG - Bắt đầu quá trình lưu báo cáo JSON.
2025-10-17 06:48:01,732 - APP.persistence.md_handler - DEBUG - Đường dẫn file báo cáo Markdown: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports\report_20251017_064801.md
2025-10-17 06:48:01,735 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:01,736 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:01,737 - APP.persistence.md_handler - DEBUG - Bắt đầu trích xuất báo cáo human-readable.
2025-10-17 06:48:01,738 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:01,739 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:01,741 - APP.persistence.md_handler - WARNING - Không tìm thấy điểm bắt đầu báo cáo hợp lệ, trả về toàn bộ nội dung.
2025-10-17 06:48:01,775 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:01,807 - APP.persistence.json_handler - DEBUG - Đã thêm 1 khối JSON vào data_to_save.
2025-10-17 06:48:01,848 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:01,849 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất tóm tắt và chữ ký.
2025-10-17 06:48:01,850 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:01,850 - APP.persistence.md_handler - INFO - Đã lưu báo cáo Markdown thành công tại: report_20251017_064801.md
2025-10-17 06:48:01,851 - APP.analysis.report_parser - DEBUG - Hoàn tất trích xuất. High Prob: False
2025-10-17 06:48:01,853 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:01,854 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: *.md, giữ lại: 10 file.
2025-10-17 06:48:01,855 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:48:01,857 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:01,860 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: report_20251015_080048.md
2025-10-17 06:48:01,861 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:01,861 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:01,862 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:48:01,864 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:01,865 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.01s
2025-10-17 06:48:01,866 - APP.persistence.md_handler - DEBUG - Kết thúc việc lưu báo cáo Markdown.
2025-10-17 06:48:01,867 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:48:01,867 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.01s)
2025-10-17 06:48:01,868 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:48:01,868 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:48:01,869 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.02s
2025-10-17 06:48:01,870 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:48:01,900 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:48:01,901 - APP.persistence.json_handler - DEBUG - Đã parse và lưu plan: {'direction': None}
2025-10-17 06:48:01,960 - APP.persistence.json_handler - INFO - Đã lưu file JSON báo cáo thành công tại: ctx_20251017_064801.json
2025-10-17 06:48:01,963 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: ctx_*.json, giữ lại: 10 file.
2025-10-17 06:48:01,976 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: ctx_20251015_080048.json
2025-10-17 06:48:01,980 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:48:01,981 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:48:01,983 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:01,984 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:01,987 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:48:01,988 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:48:01,990 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:48:01,990 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:48:01,991 - APP.persistence.json_handler - DEBUG - Kết thúc quá trình lưu báo cáo JSON.
2025-10-17 06:48:01,994 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:48:01,995 - APP.core.analysis_worker - INFO - Đã lưu báo cáo MD và JSON song song.
2025-10-17 06:48:02,053 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-17 06:48:02,057 - APP.utils.threading_utils - DEBUG - Task 'analysis.session.autorun-20251017-064801' (group=analysis.session) hoàn tất sau 0.39s
2025-10-17 06:48:02,110 - APP.core.analysis_controller - INFO - Kết thúc session autorun-20251017-064801: {'status': 'completed', 'early_exit': False}
2025-10-17 06:48:03,289 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:03,339 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:03,356 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:03,358 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:03,360 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:03,362 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:03,549 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:03,632 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:03,723 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:03,775 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:03,796 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:03,798 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:03,799 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.00s
2025-10-17 06:48:03,800 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.03s)
2025-10-17 06:48:03,807 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.03s
2025-10-17 06:48:04,272 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:04,293 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:04,306 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:04,308 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:04,312 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:04,379 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:04,392 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:04,393 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:04,493 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:04,536 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:04,537 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.session.autorun-20251017-064804' vào nhóm 'analysis.session' (metadata={'component': 'analysis', 'session_id': 'autorun-20251017-064804', 'priority': 'autorun'})
2025-10-17 06:48:04,539 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:04,539 - APP.core.analysis_controller - INFO - Đã submit phiên phân tích autorun-20251017-064804 (priority=autorun)
2025-10-17 06:48:04,540 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-17 06:48:04,541 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:04,545 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-17 06:48:04,548 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.01s
2025-10-17 06:48:04,550 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Không có ảnh để phân tích.
2025-10-17 06:48:04,552 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.02s)
2025-10-17 06:48:04,612 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-17 06:48:04,617 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.08s
2025-10-17 06:48:04,619 - APP.persistence.json_handler - DEBUG - JsonSaver được khởi tạo cho workspace: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots
2025-10-17 06:48:04,671 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu tạo map timeframe với 0 tên file.
2025-10-17 06:48:04,676 - APP.ui.utils.timeframe_detector - DEBUG - Kết thúc tạo map timeframe. Map: {}
2025-10-17 06:48:04,681 - APP.persistence.md_handler - DEBUG - Bắt đầu lưu báo cáo Markdown.
2025-10-17 06:48:04,728 - APP.persistence.json_handler - DEBUG - Bắt đầu quá trình lưu báo cáo JSON.
2025-10-17 06:48:04,732 - APP.persistence.md_handler - DEBUG - Đường dẫn file báo cáo Markdown: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports\report_20251017_064804.md
2025-10-17 06:48:04,733 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:04,739 - APP.persistence.md_handler - DEBUG - Bắt đầu trích xuất báo cáo human-readable.
2025-10-17 06:48:04,743 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:04,788 - APP.persistence.md_handler - WARNING - Không tìm thấy điểm bắt đầu báo cáo hợp lệ, trả về toàn bộ nội dung.
2025-10-17 06:48:04,790 - APP.persistence.json_handler - DEBUG - Đã thêm 1 khối JSON vào data_to_save.
2025-10-17 06:48:04,793 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất tóm tắt và chữ ký.
2025-10-17 06:48:04,793 - APP.persistence.md_handler - INFO - Đã lưu báo cáo Markdown thành công tại: report_20251017_064804.md
2025-10-17 06:48:04,794 - APP.analysis.report_parser - DEBUG - Hoàn tất trích xuất. High Prob: False
2025-10-17 06:48:04,794 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: *.md, giữ lại: 10 file.
2025-10-17 06:48:04,795 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:48:04,797 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:04,798 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: report_20251015_080319.md
2025-10-17 06:48:04,799 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:04,800 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:48:04,801 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:48:04,802 - APP.persistence.md_handler - DEBUG - Kết thúc việc lưu báo cáo Markdown.
2025-10-17 06:48:04,803 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:48:04,806 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:48:04,807 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:48:04,811 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:48:04,840 - APP.persistence.json_handler - DEBUG - Đã parse và lưu plan: {'direction': None}
2025-10-17 06:48:04,870 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:04,900 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:04,901 - APP.persistence.json_handler - INFO - Đã lưu file JSON báo cáo thành công tại: ctx_20251017_064804.json
2025-10-17 06:48:04,931 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:04,932 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: ctx_*.json, giữ lại: 10 file.
2025-10-17 06:48:05,065 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:05,086 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:05,086 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: ctx_20251015_080319.json
2025-10-17 06:48:05,175 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:05,176 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:48:05,177 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:05,178 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:48:05,178 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:05,179 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:05,179 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:05,181 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:05,182 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:05,187 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:48:05,191 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:05,191 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:48:05,225 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:05,226 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:48:05,230 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.04s
2025-10-17 06:48:05,230 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:48:05,231 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.05s)
2025-10-17 06:48:05,231 - APP.persistence.json_handler - DEBUG - Kết thúc quá trình lưu báo cáo JSON.
2025-10-17 06:48:05,232 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.05s
2025-10-17 06:48:05,233 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:48:05,235 - APP.core.analysis_worker - INFO - Đã lưu báo cáo MD và JSON song song.
2025-10-17 06:48:05,236 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-17 06:48:05,237 - APP.utils.threading_utils - DEBUG - Task 'analysis.session.autorun-20251017-064804' (group=analysis.session) hoàn tất sau 0.70s
2025-10-17 06:48:05,302 - APP.core.analysis_controller - INFO - Kết thúc session autorun-20251017-064804: {'status': 'completed', 'early_exit': False}
2025-10-17 06:48:06,512 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:06,513 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=False, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:06,516 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:06,517 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:06,519 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:06,520 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=False, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:06,580 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:06,584 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:06,586 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:06,632 - APP.services.news_service - DEBUG - Không có nhà cung cấp tin tức nào được kích hoạt.
2025-10-17 06:48:06,636 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.00s)
2025-10-17 06:48:06,637 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.00s
2025-10-17 06:48:07,126 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:07,130 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=False, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:07,136 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:07,138 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:07,139 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:07,141 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=False, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:07,150 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:07,152 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:07,297 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:07,302 - APP.services.news_service - DEBUG - Không có nhà cung cấp tin tức nào được kích hoạt.
2025-10-17 06:48:07,303 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.session.autorun-20251017-064807' vào nhóm 'analysis.session' (metadata={'component': 'analysis', 'session_id': 'autorun-20251017-064807', 'priority': 'autorun'})
2025-10-17 06:48:07,304 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.00s)
2025-10-17 06:48:07,307 - APP.core.analysis_controller - INFO - Đã submit phiên phân tích autorun-20251017-064807 (priority=autorun)
2025-10-17 06:48:07,308 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-17 06:48:07,350 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.05s
2025-10-17 06:48:07,356 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-17 06:48:07,362 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Không có ảnh để phân tích.
2025-10-17 06:48:07,365 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-17 06:48:07,368 - APP.persistence.json_handler - DEBUG - JsonSaver được khởi tạo cho workspace: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots
2025-10-17 06:48:07,369 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu tạo map timeframe với 0 tên file.
2025-10-17 06:48:07,442 - APP.ui.utils.timeframe_detector - DEBUG - Kết thúc tạo map timeframe. Map: {}
2025-10-17 06:48:07,451 - APP.persistence.md_handler - DEBUG - Bắt đầu lưu báo cáo Markdown.
2025-10-17 06:48:07,452 - APP.persistence.json_handler - DEBUG - Bắt đầu quá trình lưu báo cáo JSON.
2025-10-17 06:48:07,455 - APP.persistence.md_handler - DEBUG - Đường dẫn file báo cáo Markdown: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports\report_20251017_064807.md
2025-10-17 06:48:07,455 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:07,663 - APP.persistence.md_handler - DEBUG - Bắt đầu trích xuất báo cáo human-readable.
2025-10-17 06:48:07,682 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:07,684 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:07,706 - APP.persistence.md_handler - WARNING - Không tìm thấy điểm bắt đầu báo cáo hợp lệ, trả về toàn bộ nội dung.
2025-10-17 06:48:07,709 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:07,712 - APP.persistence.json_handler - DEBUG - Đã thêm 1 khối JSON vào data_to_save.
2025-10-17 06:48:07,715 - APP.persistence.md_handler - INFO - Đã lưu báo cáo Markdown thành công tại: report_20251017_064807.md
2025-10-17 06:48:07,719 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:07,721 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất tóm tắt và chữ ký.
2025-10-17 06:48:07,723 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: *.md, giữ lại: 10 file.
2025-10-17 06:48:07,771 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:07,772 - APP.analysis.report_parser - DEBUG - Hoàn tất trích xuất. High Prob: False
2025-10-17 06:48:07,774 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:07,775 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: report_20251015_080525.md
2025-10-17 06:48:07,776 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:48:07,808 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:07,817 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:48:07,818 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:07,819 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:07,820 - APP.persistence.md_handler - DEBUG - Kết thúc việc lưu báo cáo Markdown.
2025-10-17 06:48:07,820 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:07,821 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:07,821 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:48:07,822 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:48:07,823 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:07,825 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:48:07,826 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:07,826 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:48:07,827 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:07,828 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:48:07,829 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:07,830 - APP.persistence.json_handler - DEBUG - Đã parse và lưu plan: {'direction': None}
2025-10-17 06:48:07,831 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.00s
2025-10-17 06:48:07,833 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.01s)
2025-10-17 06:48:07,834 - APP.persistence.json_handler - INFO - Đã lưu file JSON báo cáo thành công tại: ctx_20251017_064807.json
2025-10-17 06:48:07,834 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.01s
2025-10-17 06:48:07,836 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: ctx_*.json, giữ lại: 10 file.
2025-10-17 06:48:07,839 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: ctx_20251015_080525.json
2025-10-17 06:48:07,901 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:48:07,941 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:48:07,946 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:07,949 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:07,952 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:48:07,953 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:48:07,954 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:48:07,955 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:48:07,956 - APP.persistence.json_handler - DEBUG - Kết thúc quá trình lưu báo cáo JSON.
2025-10-17 06:48:07,959 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:48:07,960 - APP.core.analysis_worker - INFO - Đã lưu báo cáo MD và JSON song song.
2025-10-17 06:48:07,960 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-17 06:48:07,961 - APP.utils.threading_utils - DEBUG - Task 'analysis.session.autorun-20251017-064807' (group=analysis.session) hoàn tất sau 0.65s
2025-10-17 06:48:07,987 - APP.core.analysis_controller - INFO - Kết thúc session autorun-20251017-064807: {'status': 'completed', 'early_exit': False}
2025-10-17 06:48:23,334 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:23,335 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:23,336 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:23,337 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:23,337 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:23,338 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:23,339 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:23,340 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:23,340 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:23,345 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:23,348 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:23,390 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:23,393 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.04s
2025-10-17 06:48:23,394 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.05s)
2025-10-17 06:48:23,395 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.05s
2025-10-17 06:48:23,837 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:23,889 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:23,900 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:23,901 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:23,902 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:23,954 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=False, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:23,962 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:23,966 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:24,011 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:24,014 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:24,016 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.session.autorun-20251017-064824' vào nhóm 'analysis.session' (metadata={'component': 'analysis', 'session_id': 'autorun-20251017-064824', 'priority': 'autorun'})
2025-10-17 06:48:24,017 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:24,018 - APP.core.analysis_controller - INFO - Đã submit phiên phân tích autorun-20251017-064824 (priority=autorun)
2025-10-17 06:48:24,018 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-17 06:48:24,021 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:24,025 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.01s
2025-10-17 06:48:24,028 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-17 06:48:24,060 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.05s)
2025-10-17 06:48:24,099 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Không có ảnh để phân tích.
2025-10-17 06:48:24,101 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.09s
2025-10-17 06:48:24,102 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-17 06:48:24,105 - APP.persistence.json_handler - DEBUG - JsonSaver được khởi tạo cho workspace: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots
2025-10-17 06:48:24,108 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu tạo map timeframe với 0 tên file.
2025-10-17 06:48:24,108 - APP.ui.utils.timeframe_detector - DEBUG - Kết thúc tạo map timeframe. Map: {}
2025-10-17 06:48:24,111 - APP.persistence.md_handler - DEBUG - Bắt đầu lưu báo cáo Markdown.
2025-10-17 06:48:24,112 - APP.persistence.json_handler - DEBUG - Bắt đầu quá trình lưu báo cáo JSON.
2025-10-17 06:48:24,116 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:24,117 - APP.persistence.md_handler - DEBUG - Đường dẫn file báo cáo Markdown: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports\report_20251017_064824.md
2025-10-17 06:48:24,117 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:24,118 - APP.persistence.md_handler - DEBUG - Bắt đầu trích xuất báo cáo human-readable.
2025-10-17 06:48:24,119 - APP.persistence.json_handler - DEBUG - Đã thêm 1 khối JSON vào data_to_save.
2025-10-17 06:48:24,119 - APP.persistence.md_handler - WARNING - Không tìm thấy điểm bắt đầu báo cáo hợp lệ, trả về toàn bộ nội dung.
2025-10-17 06:48:24,120 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất tóm tắt và chữ ký.
2025-10-17 06:48:24,122 - APP.persistence.md_handler - INFO - Đã lưu báo cáo Markdown thành công tại: report_20251017_064824.md
2025-10-17 06:48:24,215 - APP.analysis.report_parser - DEBUG - Hoàn tất trích xuất. High Prob: False
2025-10-17 06:48:24,257 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: *.md, giữ lại: 10 file.
2025-10-17 06:48:24,261 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:48:24,264 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:24,264 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: report_20251015_080729.md
2025-10-17 06:48:24,267 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:24,267 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:48:24,268 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:48:24,271 - APP.persistence.md_handler - DEBUG - Kết thúc việc lưu báo cáo Markdown.
2025-10-17 06:48:24,272 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:48:24,273 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:48:24,274 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:48:24,326 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:48:24,333 - APP.persistence.json_handler - DEBUG - Đã parse và lưu plan: {'direction': None}
2025-10-17 06:48:24,384 - APP.persistence.json_handler - INFO - Đã lưu file JSON báo cáo thành công tại: ctx_20251017_064824.json
2025-10-17 06:48:24,444 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: ctx_*.json, giữ lại: 10 file.
2025-10-17 06:48:24,521 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: ctx_20251015_080729.json
2025-10-17 06:48:24,568 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:48:24,574 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:48:24,580 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:24,585 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:24,625 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:48:24,636 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:48:24,719 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:48:24,742 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:48:24,889 - APP.persistence.json_handler - DEBUG - Kết thúc quá trình lưu báo cáo JSON.
2025-10-17 06:48:24,904 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:48:25,156 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:25,261 - APP.core.analysis_worker - INFO - Đã lưu báo cáo MD và JSON song song.
2025-10-17 06:48:25,438 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:25,530 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-17 06:48:25,752 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:25,864 - APP.utils.threading_utils - DEBUG - Task 'analysis.session.autorun-20251017-064824' (group=analysis.session) hoàn tất sau 1.85s
2025-10-17 06:48:25,867 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:25,870 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:25,963 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:25,994 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:25,997 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:26,004 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:26,009 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:26,011 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:26,011 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:26,012 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.00s
2025-10-17 06:48:26,013 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.00s)
2025-10-17 06:48:26,014 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.01s
2025-10-17 06:48:26,018 - APP.core.analysis_controller - INFO - Kết thúc session autorun-20251017-064824: {'status': 'completed', 'early_exit': False}
2025-10-17 06:48:27,578 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:27,594 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:27,646 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:27,647 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:27,649 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:27,650 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:27,661 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:27,663 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:27,664 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:27,670 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:27,671 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:27,672 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:27,674 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.00s
2025-10-17 06:48:27,676 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.01s)
2025-10-17 06:48:27,677 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.01s
2025-10-17 06:48:28,160 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:28,161 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:28,162 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:28,163 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:28,164 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:28,165 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=True, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:28,166 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:28,171 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:28,172 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:28,210 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.session.autorun-20251017-064828' vào nhóm 'analysis.session' (metadata={'component': 'analysis', 'session_id': 'autorun-20251017-064828', 'priority': 'autorun'})
2025-10-17 06:48:28,211 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:28,214 - APP.core.analysis_controller - INFO - Đã submit phiên phân tích autorun-20251017-064828 (priority=autorun)
2025-10-17 06:48:28,214 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-17 06:48:28,215 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:28,260 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-17 06:48:28,262 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:28,263 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Không có ảnh để phân tích.
2025-10-17 06:48:28,265 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.05s
2025-10-17 06:48:28,266 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-17 06:48:28,269 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.06s)
2025-10-17 06:48:28,270 - APP.persistence.json_handler - DEBUG - JsonSaver được khởi tạo cho workspace: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots
2025-10-17 06:48:28,271 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.06s
2025-10-17 06:48:28,273 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu tạo map timeframe với 0 tên file.
2025-10-17 06:48:28,278 - APP.ui.utils.timeframe_detector - DEBUG - Kết thúc tạo map timeframe. Map: {}
2025-10-17 06:48:28,347 - APP.persistence.md_handler - DEBUG - Bắt đầu lưu báo cáo Markdown.
2025-10-17 06:48:28,350 - APP.persistence.json_handler - DEBUG - Bắt đầu quá trình lưu báo cáo JSON.
2025-10-17 06:48:28,352 - APP.persistence.md_handler - DEBUG - Đường dẫn file báo cáo Markdown: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports\report_20251017_064828.md
2025-10-17 06:48:28,352 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:28,353 - APP.persistence.md_handler - DEBUG - Bắt đầu trích xuất báo cáo human-readable.
2025-10-17 06:48:28,355 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:28,356 - APP.persistence.md_handler - WARNING - Không tìm thấy điểm bắt đầu báo cáo hợp lệ, trả về toàn bộ nội dung.
2025-10-17 06:48:28,358 - APP.persistence.json_handler - DEBUG - Đã thêm 1 khối JSON vào data_to_save.
2025-10-17 06:48:28,360 - APP.persistence.md_handler - INFO - Đã lưu báo cáo Markdown thành công tại: report_20251017_064828.md
2025-10-17 06:48:28,362 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất tóm tắt và chữ ký.
2025-10-17 06:48:28,364 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: *.md, giữ lại: 10 file.
2025-10-17 06:48:28,366 - APP.analysis.report_parser - DEBUG - Hoàn tất trích xuất. High Prob: False
2025-10-17 06:48:28,369 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: report_20251015_080921.md
2025-10-17 06:48:28,370 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:48:28,413 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:48:28,415 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:28,419 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:28,421 - APP.persistence.md_handler - DEBUG - Kết thúc việc lưu báo cáo Markdown.
2025-10-17 06:48:28,423 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:48:28,426 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:48:28,428 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:48:28,801 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:48:28,806 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:28,807 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:48:28,853 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:28,861 - APP.persistence.json_handler - DEBUG - Đã parse và lưu plan: {'direction': None}
2025-10-17 06:48:28,863 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:28,866 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:28,866 - APP.persistence.json_handler - INFO - Đã lưu file JSON báo cáo thành công tại: ctx_20251017_064828.json
2025-10-17 06:48:28,867 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:28,869 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: ctx_*.json, giữ lại: 10 file.
2025-10-17 06:48:28,871 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:28,873 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: ctx_20251015_080921.json
2025-10-17 06:48:28,912 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:28,917 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:48:28,918 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:28,919 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:48:28,920 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:28,920 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:28,922 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:28,923 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:28,924 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:28,925 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:48:28,926 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:28,927 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:48:28,928 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.00s
2025-10-17 06:48:28,929 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:48:28,930 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.01s)
2025-10-17 06:48:28,932 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:48:28,932 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.01s
2025-10-17 06:48:28,932 - APP.persistence.json_handler - DEBUG - Kết thúc quá trình lưu báo cáo JSON.
2025-10-17 06:48:28,934 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:48:28,935 - APP.core.analysis_worker - INFO - Đã lưu báo cáo MD và JSON song song.
2025-10-17 06:48:28,966 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-17 06:48:28,998 - APP.utils.threading_utils - DEBUG - Task 'analysis.session.autorun-20251017-064828' (group=analysis.session) hoàn tất sau 0.75s
2025-10-17 06:48:29,050 - APP.core.analysis_controller - INFO - Kết thúc session autorun-20251017-064828: {'status': 'completed', 'early_exit': False}
2025-10-17 06:48:29,647 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:29,649 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:29,651 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:29,652 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:29,653 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:29,658 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:29,702 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:29,706 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:29,708 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:29,711 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:29,758 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:29,760 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:29,762 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.00s
2025-10-17 06:48:29,763 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.05s)
2025-10-17 06:48:29,764 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.05s
2025-10-17 06:48:30,213 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:30,289 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:30,354 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:30,360 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:30,364 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:30,370 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=False, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:30,448 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:30,454 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:30,459 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:30,465 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:30,467 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.session.autorun-20251017-064830' vào nhóm 'analysis.session' (metadata={'component': 'analysis', 'session_id': 'autorun-20251017-064830', 'priority': 'autorun'})
2025-10-17 06:48:30,476 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:30,479 - APP.core.analysis_controller - INFO - Đã submit phiên phân tích autorun-20251017-064830 (priority=autorun)
2025-10-17 06:48:30,481 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-17 06:48:30,483 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:30,487 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-17 06:48:30,489 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.01s
2025-10-17 06:48:30,525 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Không có ảnh để phân tích.
2025-10-17 06:48:30,529 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:30,569 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.10s)
2025-10-17 06:48:30,571 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:30,572 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-17 06:48:30,574 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.11s
2025-10-17 06:48:30,577 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:30,582 - APP.persistence.json_handler - DEBUG - JsonSaver được khởi tạo cho workspace: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots
2025-10-17 06:48:30,586 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:30,588 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu tạo map timeframe với 0 tên file.
2025-10-17 06:48:30,590 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:30,591 - APP.ui.utils.timeframe_detector - DEBUG - Kết thúc tạo map timeframe. Map: {}
2025-10-17 06:48:30,593 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:30,666 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:30,670 - APP.persistence.md_handler - DEBUG - Bắt đầu lưu báo cáo Markdown.
2025-10-17 06:48:30,671 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:30,672 - APP.persistence.json_handler - DEBUG - Bắt đầu quá trình lưu báo cáo JSON.
2025-10-17 06:48:30,674 - APP.persistence.md_handler - DEBUG - Đường dẫn file báo cáo Markdown: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports\report_20251017_064830.md
2025-10-17 06:48:30,679 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:30,681 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:30,683 - APP.persistence.md_handler - DEBUG - Bắt đầu trích xuất báo cáo human-readable.
2025-10-17 06:48:30,757 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:30,760 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:30,761 - APP.persistence.md_handler - WARNING - Không tìm thấy điểm bắt đầu báo cáo hợp lệ, trả về toàn bộ nội dung.
2025-10-17 06:48:30,764 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:30,768 - APP.persistence.json_handler - DEBUG - Đã thêm 1 khối JSON vào data_to_save.
2025-10-17 06:48:30,770 - APP.persistence.md_handler - INFO - Đã lưu báo cáo Markdown thành công tại: report_20251017_064830.md
2025-10-17 06:48:30,771 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:30,774 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất tóm tắt và chữ ký.
2025-10-17 06:48:30,775 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: *.md, giữ lại: 10 file.
2025-10-17 06:48:30,779 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.02s
2025-10-17 06:48:30,854 - APP.analysis.report_parser - DEBUG - Hoàn tất trích xuất. High Prob: False
2025-10-17 06:48:30,859 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: report_20251015_125828.md
2025-10-17 06:48:30,863 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.11s)
2025-10-17 06:48:30,864 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:48:30,865 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:48:30,869 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.11s
2025-10-17 06:48:30,872 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:30,923 - APP.persistence.md_handler - DEBUG - Kết thúc việc lưu báo cáo Markdown.
2025-10-17 06:48:30,930 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:30,932 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:48:30,932 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:48:30,934 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:48:30,964 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:48:31,033 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:48:31,040 - APP.persistence.json_handler - DEBUG - Đã parse và lưu plan: {'direction': None}
2025-10-17 06:48:31,055 - APP.persistence.json_handler - INFO - Đã lưu file JSON báo cáo thành công tại: ctx_20251017_064831.json
2025-10-17 06:48:31,101 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: ctx_*.json, giữ lại: 10 file.
2025-10-17 06:48:31,152 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: ctx_20251015_125828.json
2025-10-17 06:48:31,157 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:48:31,163 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:48:31,166 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:31,169 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:31,171 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:48:31,172 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:48:31,174 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:48:31,174 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:48:31,176 - APP.persistence.json_handler - DEBUG - Kết thúc quá trình lưu báo cáo JSON.
2025-10-17 06:48:31,178 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:48:31,179 - APP.core.analysis_worker - INFO - Đã lưu báo cáo MD và JSON song song.
2025-10-17 06:48:31,180 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-17 06:48:31,180 - APP.utils.threading_utils - DEBUG - Task 'analysis.session.autorun-20251017-064830' (group=analysis.session) hoàn tất sau 0.70s
2025-10-17 06:48:31,240 - APP.core.analysis_controller - INFO - Kết thúc session autorun-20251017-064830: {'status': 'completed', 'early_exit': False}
2025-10-17 06:48:36,620 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:36,631 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:36,633 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:36,634 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:36,634 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:36,636 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:36,640 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:36,641 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:36,643 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:36,693 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:36,704 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:36,705 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:36,705 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.00s
2025-10-17 06:48:36,707 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:36,707 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.01s)
2025-10-17 06:48:36,708 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=1.2000000000000002, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:36,708 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.02s
2025-10-17 06:48:36,710 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:36,712 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:36,712 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:36,713 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=1.2000000000000002, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:36,714 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:36,714 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:36,715 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:36,717 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:36,762 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:36,763 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:36,764 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.00s
2025-10-17 06:48:36,765 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.05s)
2025-10-17 06:48:36,766 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.05s
2025-10-17 06:48:37,213 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:37,310 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=1.2000000000000002, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:37,324 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:37,325 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:37,326 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:37,328 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=1.2000000000000002, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:37,372 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:37,440 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:37,445 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:37,448 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:37,450 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.session.autorun-20251017-064837' vào nhóm 'analysis.session' (metadata={'component': 'analysis', 'session_id': 'autorun-20251017-064837', 'priority': 'autorun'})
2025-10-17 06:48:37,451 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:37,452 - APP.core.analysis_controller - INFO - Đã submit phiên phân tích autorun-20251017-064837 (priority=autorun)
2025-10-17 06:48:37,452 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-17 06:48:37,452 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:37,453 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-17 06:48:37,454 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.00s
2025-10-17 06:48:37,454 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Không có ảnh để phân tích.
2025-10-17 06:48:37,460 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.01s)
2025-10-17 06:48:37,461 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-17 06:48:37,462 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.01s
2025-10-17 06:48:37,464 - APP.persistence.json_handler - DEBUG - JsonSaver được khởi tạo cho workspace: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots
2025-10-17 06:48:37,465 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu tạo map timeframe với 0 tên file.
2025-10-17 06:48:37,466 - APP.ui.utils.timeframe_detector - DEBUG - Kết thúc tạo map timeframe. Map: {}
2025-10-17 06:48:37,467 - APP.persistence.md_handler - DEBUG - Bắt đầu lưu báo cáo Markdown.
2025-10-17 06:48:37,526 - APP.persistence.json_handler - DEBUG - Bắt đầu quá trình lưu báo cáo JSON.
2025-10-17 06:48:37,527 - APP.persistence.md_handler - DEBUG - Đường dẫn file báo cáo Markdown: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports\report_20251017_064837.md
2025-10-17 06:48:37,529 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:37,530 - APP.persistence.md_handler - DEBUG - Bắt đầu trích xuất báo cáo human-readable.
2025-10-17 06:48:37,559 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:37,560 - APP.persistence.md_handler - WARNING - Không tìm thấy điểm bắt đầu báo cáo hợp lệ, trả về toàn bộ nội dung.
2025-10-17 06:48:37,561 - APP.persistence.json_handler - DEBUG - Đã thêm 1 khối JSON vào data_to_save.
2025-10-17 06:48:37,591 - APP.persistence.md_handler - INFO - Đã lưu báo cáo Markdown thành công tại: report_20251017_064837.md
2025-10-17 06:48:37,592 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất tóm tắt và chữ ký.
2025-10-17 06:48:37,682 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: *.md, giữ lại: 10 file.
2025-10-17 06:48:37,685 - APP.analysis.report_parser - DEBUG - Hoàn tất trích xuất. High Prob: False
2025-10-17 06:48:37,689 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:48:37,691 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: report_20251015_132749.md
2025-10-17 06:48:37,692 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:37,692 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:48:37,693 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:37,694 - APP.persistence.md_handler - DEBUG - Kết thúc việc lưu báo cáo Markdown.
2025-10-17 06:48:37,696 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:48:37,697 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:48:37,697 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:48:37,700 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:48:37,701 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:48:37,701 - APP.persistence.json_handler - DEBUG - Đã parse và lưu plan: {'direction': None}
2025-10-17 06:48:37,703 - APP.persistence.json_handler - INFO - Đã lưu file JSON báo cáo thành công tại: ctx_20251017_064837.json
2025-10-17 06:48:37,704 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: ctx_*.json, giữ lại: 10 file.
2025-10-17 06:48:37,706 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: ctx_20251015_132749.json
2025-10-17 06:48:37,707 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:48:37,708 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:48:37,710 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:37,712 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:37,713 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:48:37,713 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:48:37,714 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:48:37,714 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:48:37,715 - APP.persistence.json_handler - DEBUG - Kết thúc quá trình lưu báo cáo JSON.
2025-10-17 06:48:37,716 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:48:37,720 - APP.core.analysis_worker - INFO - Đã lưu báo cáo MD và JSON song song.
2025-10-17 06:48:37,748 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-17 06:48:37,778 - APP.utils.threading_utils - DEBUG - Task 'analysis.session.autorun-20251017-064837' (group=analysis.session) hoàn tất sau 0.33s
2025-10-17 06:48:37,802 - APP.core.analysis_controller - INFO - Kết thúc session autorun-20251017-064837: {'status': 'completed', 'early_exit': False}
2025-10-17 06:48:38,522 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:38,617 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:38,767 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:38,831 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:38,922 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:39,011 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:39,087 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:39,139 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:39,207 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:39,270 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:39,279 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:39,445 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:39,489 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.21s
2025-10-17 06:48:39,491 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.22s)
2025-10-17 06:48:39,493 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.22s
2025-10-17 06:48:39,775 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:39,776 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:39,778 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:39,778 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:39,779 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:39,779 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:39,782 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:39,783 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:39,784 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:39,788 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.session.autorun-20251017-064839' vào nhóm 'analysis.session' (metadata={'component': 'analysis', 'session_id': 'autorun-20251017-064839', 'priority': 'autorun'})
2025-10-17 06:48:39,800 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:39,823 - APP.core.analysis_controller - INFO - Đã submit phiên phân tích autorun-20251017-064839 (priority=autorun)
2025-10-17 06:48:39,824 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-17 06:48:39,826 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:39,827 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-17 06:48:39,827 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:39,830 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Không có ảnh để phân tích.
2025-10-17 06:48:39,832 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.01s
2025-10-17 06:48:39,834 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-17 06:48:39,835 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.03s)
2025-10-17 06:48:39,836 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.04s
2025-10-17 06:48:39,836 - APP.persistence.json_handler - DEBUG - JsonSaver được khởi tạo cho workspace: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots
2025-10-17 06:48:39,839 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu tạo map timeframe với 0 tên file.
2025-10-17 06:48:39,840 - APP.ui.utils.timeframe_detector - DEBUG - Kết thúc tạo map timeframe. Map: {}
2025-10-17 06:48:39,841 - APP.persistence.md_handler - DEBUG - Bắt đầu lưu báo cáo Markdown.
2025-10-17 06:48:39,842 - APP.persistence.json_handler - DEBUG - Bắt đầu quá trình lưu báo cáo JSON.
2025-10-17 06:48:39,844 - APP.persistence.md_handler - DEBUG - Đường dẫn file báo cáo Markdown: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports\report_20251017_064839.md
2025-10-17 06:48:39,903 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:39,904 - APP.persistence.md_handler - DEBUG - Bắt đầu trích xuất báo cáo human-readable.
2025-10-17 06:48:39,921 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:39,926 - APP.persistence.md_handler - WARNING - Không tìm thấy điểm bắt đầu báo cáo hợp lệ, trả về toàn bộ nội dung.
2025-10-17 06:48:39,927 - APP.persistence.json_handler - DEBUG - Đã thêm 1 khối JSON vào data_to_save.
2025-10-17 06:48:39,930 - APP.persistence.md_handler - INFO - Đã lưu báo cáo Markdown thành công tại: report_20251017_064839.md
2025-10-17 06:48:40,060 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất tóm tắt và chữ ký.
2025-10-17 06:48:40,213 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: *.md, giữ lại: 10 file.
2025-10-17 06:48:40,298 - APP.analysis.report_parser - DEBUG - Hoàn tất trích xuất. High Prob: False
2025-10-17 06:48:40,306 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: report_20251017_064605.md
2025-10-17 06:48:40,355 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:48:40,357 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:48:40,358 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:40,360 - APP.persistence.md_handler - DEBUG - Kết thúc việc lưu báo cáo Markdown.
2025-10-17 06:48:40,360 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:40,361 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:48:40,362 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:48:40,363 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:48:40,363 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:48:40,365 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:48:40,365 - APP.persistence.json_handler - DEBUG - Đã parse và lưu plan: {'direction': None}
2025-10-17 06:48:40,367 - APP.persistence.json_handler - INFO - Đã lưu file JSON báo cáo thành công tại: ctx_20251017_064840.json
2025-10-17 06:48:40,368 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: ctx_*.json, giữ lại: 10 file.
2025-10-17 06:48:40,369 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: ctx_20251017_064606.json
2025-10-17 06:48:40,371 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:48:40,373 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:48:40,467 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:40,506 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:40,508 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:48:40,510 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:48:40,512 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:48:40,514 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:48:40,515 - APP.persistence.json_handler - DEBUG - Kết thúc quá trình lưu báo cáo JSON.
2025-10-17 06:48:40,517 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:48:40,519 - APP.core.analysis_worker - INFO - Đã lưu báo cáo MD và JSON song song.
2025-10-17 06:48:40,520 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-17 06:48:40,520 - APP.utils.threading_utils - DEBUG - Task 'analysis.session.autorun-20251017-064839' (group=analysis.session) hoàn tất sau 0.70s
2025-10-17 06:48:40,555 - APP.core.analysis_controller - INFO - Kết thúc session autorun-20251017-064839: {'status': 'completed', 'early_exit': False}
2025-10-17 06:48:40,885 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:40,886 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=False, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:40,889 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:40,890 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:40,892 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:40,896 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=False, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:40,904 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:40,945 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:40,951 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:40,954 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:40,957 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:40,959 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:40,962 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.01s
2025-10-17 06:48:40,963 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.01s)
2025-10-17 06:48:40,965 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.01s
2025-10-17 06:48:41,445 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:41,446 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=False, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:41,450 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:41,454 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:41,488 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:41,496 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=False, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:41,498 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:41,582 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:41,586 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:41,629 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:41,632 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.session.autorun-20251017-064841' vào nhóm 'analysis.session' (metadata={'component': 'analysis', 'session_id': 'autorun-20251017-064841', 'priority': 'autorun'})
2025-10-17 06:48:41,637 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:41,638 - APP.core.analysis_controller - INFO - Đã submit phiên phân tích autorun-20251017-064841 (priority=autorun)
2025-10-17 06:48:41,638 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-17 06:48:41,639 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:41,640 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-17 06:48:41,640 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.00s
2025-10-17 06:48:41,643 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Không có ảnh để phân tích.
2025-10-17 06:48:41,644 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.01s)
2025-10-17 06:48:41,645 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-17 06:48:41,650 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.02s
2025-10-17 06:48:41,652 - APP.persistence.json_handler - DEBUG - JsonSaver được khởi tạo cho workspace: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots
2025-10-17 06:48:41,654 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu tạo map timeframe với 0 tên file.
2025-10-17 06:48:41,654 - APP.ui.utils.timeframe_detector - DEBUG - Kết thúc tạo map timeframe. Map: {}
2025-10-17 06:48:41,690 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:41,696 - APP.persistence.md_handler - DEBUG - Bắt đầu lưu báo cáo Markdown.
2025-10-17 06:48:41,698 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:41,698 - APP.persistence.json_handler - DEBUG - Bắt đầu quá trình lưu báo cáo JSON.
2025-10-17 06:48:41,701 - APP.persistence.md_handler - DEBUG - Đường dẫn file báo cáo Markdown: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports\report_20251017_064841.md
2025-10-17 06:48:41,706 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:41,707 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:41,710 - APP.persistence.md_handler - DEBUG - Bắt đầu trích xuất báo cáo human-readable.
2025-10-17 06:48:41,713 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:41,717 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:41,775 - APP.persistence.md_handler - WARNING - Không tìm thấy điểm bắt đầu báo cáo hợp lệ, trả về toàn bộ nội dung.
2025-10-17 06:48:41,839 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:41,842 - APP.persistence.json_handler - DEBUG - Đã thêm 1 khối JSON vào data_to_save.
2025-10-17 06:48:41,847 - APP.persistence.md_handler - INFO - Đã lưu báo cáo Markdown thành công tại: report_20251017_064841.md
2025-10-17 06:48:41,849 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:41,854 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất tóm tắt và chữ ký.
2025-10-17 06:48:41,858 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: *.md, giữ lại: 10 file.
2025-10-17 06:48:41,862 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:41,864 - APP.analysis.report_parser - DEBUG - Hoàn tất trích xuất. High Prob: False
2025-10-17 06:48:41,867 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: report_20251017_064611.md
2025-10-17 06:48:41,867 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:41,921 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:48:41,926 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:48:41,927 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:41,928 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:41,929 - APP.persistence.md_handler - DEBUG - Kết thúc việc lưu báo cáo Markdown.
2025-10-17 06:48:41,930 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:41,931 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:41,983 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:48:41,986 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:41,987 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:48:41,989 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:41,990 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:48:41,991 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.01s
2025-10-17 06:48:41,994 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:48:41,995 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.06s)
2025-10-17 06:48:41,996 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:48:41,997 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.07s
2025-10-17 06:48:42,003 - APP.persistence.json_handler - DEBUG - Đã parse và lưu plan: {'direction': None}
2025-10-17 06:48:42,033 - APP.persistence.json_handler - INFO - Đã lưu file JSON báo cáo thành công tại: ctx_20251017_064842.json
2025-10-17 06:48:42,036 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: ctx_*.json, giữ lại: 10 file.
2025-10-17 06:48:42,039 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: ctx_20251017_064611.json
2025-10-17 06:48:42,044 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:48:42,047 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:48:42,051 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:42,053 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:42,154 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:48:42,166 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:48:42,169 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:48:42,177 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:48:42,182 - APP.persistence.json_handler - DEBUG - Kết thúc quá trình lưu báo cáo JSON.
2025-10-17 06:48:42,217 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:48:42,422 - APP.core.analysis_worker - INFO - Đã lưu báo cáo MD và JSON song song.
2025-10-17 06:48:42,604 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-17 06:48:42,633 - APP.utils.threading_utils - DEBUG - Task 'analysis.session.autorun-20251017-064841' (group=analysis.session) hoàn tất sau 0.99s
2025-10-17 06:48:42,676 - APP.core.analysis_controller - INFO - Kết thúc session autorun-20251017-064841: {'status': 'completed', 'early_exit': False}
2025-10-17 06:48:48,385 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:48,387 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:48,389 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:48,390 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:48,390 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:48,391 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:48,396 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:48,475 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:48,476 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:48,480 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:48,483 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:48,486 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:48,492 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.01s
2025-10-17 06:48:48,494 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.01s)
2025-10-17 06:48:48,495 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.02s
2025-10-17 06:48:48,976 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:48,978 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:48,981 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:48,983 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:48,984 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:48,985 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=False, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:49,092 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:49,093 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:49,097 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:49,101 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.session.autorun-20251017-064849' vào nhóm 'analysis.session' (metadata={'component': 'analysis', 'session_id': 'autorun-20251017-064849', 'priority': 'autorun'})
2025-10-17 06:48:49,102 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:49,293 - APP.core.analysis_controller - INFO - Đã submit phiên phân tích autorun-20251017-064849 (priority=autorun)
2025-10-17 06:48:49,295 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-17 06:48:49,311 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:49,321 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-17 06:48:49,324 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:49,326 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Không có ảnh để phân tích.
2025-10-17 06:48:49,328 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:49,380 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.07s
2025-10-17 06:48:49,393 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-17 06:48:49,394 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:49,396 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.29s)
2025-10-17 06:48:49,399 - APP.persistence.json_handler - DEBUG - JsonSaver được khởi tạo cho workspace: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots
2025-10-17 06:48:49,402 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:49,402 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.30s
2025-10-17 06:48:49,403 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu tạo map timeframe với 0 tên file.
2025-10-17 06:48:49,404 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:49,528 - APP.ui.utils.timeframe_detector - DEBUG - Kết thúc tạo map timeframe. Map: {}
2025-10-17 06:48:49,543 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:49,545 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:49,545 - APP.persistence.md_handler - DEBUG - Bắt đầu lưu báo cáo Markdown.
2025-10-17 06:48:49,548 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:49,550 - APP.persistence.json_handler - DEBUG - Bắt đầu quá trình lưu báo cáo JSON.
2025-10-17 06:48:49,553 - APP.persistence.md_handler - DEBUG - Đường dẫn file báo cáo Markdown: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports\report_20251017_064849.md
2025-10-17 06:48:49,590 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:49,675 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:49,684 - APP.persistence.md_handler - DEBUG - Bắt đầu trích xuất báo cáo human-readable.
2025-10-17 06:48:49,686 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:49,727 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:49,729 - APP.persistence.md_handler - WARNING - Không tìm thấy điểm bắt đầu báo cáo hợp lệ, trả về toàn bộ nội dung.
2025-10-17 06:48:49,731 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:49,731 - APP.persistence.json_handler - DEBUG - Đã thêm 1 khối JSON vào data_to_save.
2025-10-17 06:48:49,733 - APP.persistence.md_handler - INFO - Đã lưu báo cáo Markdown thành công tại: report_20251017_064849.md
2025-10-17 06:48:49,733 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:49,734 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất tóm tắt và chữ ký.
2025-10-17 06:48:49,734 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: *.md, giữ lại: 10 file.
2025-10-17 06:48:49,735 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:49,736 - APP.analysis.report_parser - DEBUG - Hoàn tất trích xuất. High Prob: False
2025-10-17 06:48:49,737 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.00s
2025-10-17 06:48:49,740 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:48:49,743 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.01s)
2025-10-17 06:48:49,744 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: report_20251017_064711.md
2025-10-17 06:48:49,744 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:49,745 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.01s
2025-10-17 06:48:49,746 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:48:49,747 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:49,749 - APP.persistence.md_handler - DEBUG - Kết thúc việc lưu báo cáo Markdown.
2025-10-17 06:48:49,749 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:48:49,793 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:48:49,793 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:48:49,794 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:48:49,795 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:48:49,795 - APP.persistence.json_handler - DEBUG - Đã parse và lưu plan: {'direction': None}
2025-10-17 06:48:49,798 - APP.persistence.json_handler - INFO - Đã lưu file JSON báo cáo thành công tại: ctx_20251017_064849.json
2025-10-17 06:48:49,799 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: ctx_*.json, giữ lại: 10 file.
2025-10-17 06:48:49,801 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: ctx_20251017_064711.json
2025-10-17 06:48:49,803 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:48:49,803 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:48:49,805 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:49,806 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:49,806 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:48:49,807 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:48:49,808 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:48:49,808 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:48:49,810 - APP.persistence.json_handler - DEBUG - Kết thúc quá trình lưu báo cáo JSON.
2025-10-17 06:48:49,811 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:48:49,813 - APP.core.analysis_worker - INFO - Đã lưu báo cáo MD và JSON song song.
2025-10-17 06:48:49,873 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-17 06:48:49,875 - APP.utils.threading_utils - DEBUG - Task 'analysis.session.autorun-20251017-064849' (group=analysis.session) hoàn tất sau 0.58s
2025-10-17 06:48:49,929 - APP.core.analysis_controller - INFO - Kết thúc session autorun-20251017-064849: {'status': 'completed', 'early_exit': False}
2025-10-17 06:48:50,867 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:50,869 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=False, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:50,873 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:50,874 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:50,878 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:50,918 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=False, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:50,928 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:50,934 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:50,935 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:50,987 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:50,989 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:50,990 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:50,991 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.00s
2025-10-17 06:48:50,992 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.01s)
2025-10-17 06:48:50,993 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.01s
2025-10-17 06:48:51,476 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:51,562 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=False, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:51,619 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:51,683 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:51,727 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:51,734 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=False, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:51,748 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:51,793 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:51,795 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:51,799 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:51,800 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.session.autorun-20251017-064851' vào nhóm 'analysis.session' (metadata={'component': 'analysis', 'session_id': 'autorun-20251017-064851', 'priority': 'autorun'})
2025-10-17 06:48:51,801 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:51,801 - APP.core.analysis_controller - INFO - Đã submit phiên phân tích autorun-20251017-064851 (priority=autorun)
2025-10-17 06:48:51,801 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-17 06:48:51,802 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:51,803 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-17 06:48:51,804 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.00s
2025-10-17 06:48:51,804 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Không có ảnh để phân tích.
2025-10-17 06:48:51,805 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.01s)
2025-10-17 06:48:51,807 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-17 06:48:51,811 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.01s
2025-10-17 06:48:51,814 - APP.persistence.json_handler - DEBUG - JsonSaver được khởi tạo cho workspace: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots
2025-10-17 06:48:51,832 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:51,842 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu tạo map timeframe với 0 tên file.
2025-10-17 06:48:51,843 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:51,874 - APP.ui.utils.timeframe_detector - DEBUG - Kết thúc tạo map timeframe. Map: {}
2025-10-17 06:48:51,880 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:51,882 - APP.persistence.md_handler - DEBUG - Bắt đầu lưu báo cáo Markdown.
2025-10-17 06:48:51,883 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:51,884 - APP.persistence.json_handler - DEBUG - Bắt đầu quá trình lưu báo cáo JSON.
2025-10-17 06:48:51,886 - APP.persistence.md_handler - DEBUG - Đường dẫn file báo cáo Markdown: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports\report_20251017_064851.md
2025-10-17 06:48:51,886 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:48:51,887 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:51,888 - APP.persistence.md_handler - DEBUG - Bắt đầu trích xuất báo cáo human-readable.
2025-10-17 06:48:51,888 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:48:51,889 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:51,890 - APP.persistence.md_handler - WARNING - Không tìm thấy điểm bắt đầu báo cáo hợp lệ, trả về toàn bộ nội dung.
2025-10-17 06:48:51,891 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:48:51,891 - APP.persistence.json_handler - DEBUG - Đã thêm 1 khối JSON vào data_to_save.
2025-10-17 06:48:51,893 - APP.persistence.md_handler - INFO - Đã lưu báo cáo Markdown thành công tại: report_20251017_064851.md
2025-10-17 06:48:51,894 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:48:51,894 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất tóm tắt và chữ ký.
2025-10-17 06:48:51,895 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: *.md, giữ lại: 10 file.
2025-10-17 06:48:51,895 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:48:51,896 - APP.analysis.report_parser - DEBUG - Hoàn tất trích xuất. High Prob: False
2025-10-17 06:48:51,898 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: report_20251017_064801.md
2025-10-17 06:48:51,900 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:48:51,901 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:48:51,903 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:48:51,909 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:48:51,965 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:51,967 - APP.persistence.md_handler - DEBUG - Kết thúc việc lưu báo cáo Markdown.
2025-10-17 06:48:51,967 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:48:51,968 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:51,998 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:48:51,999 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.09s
2025-10-17 06:48:51,999 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:48:52,029 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.13s)
2025-10-17 06:48:52,030 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:48:52,031 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.13s
2025-10-17 06:48:52,059 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:48:52,061 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:48:52,062 - APP.persistence.json_handler - DEBUG - Đã parse và lưu plan: {'direction': None}
2025-10-17 06:48:52,094 - APP.persistence.json_handler - INFO - Đã lưu file JSON báo cáo thành công tại: ctx_20251017_064852.json
2025-10-17 06:48:52,125 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: ctx_*.json, giữ lại: 10 file.
2025-10-17 06:48:52,156 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: ctx_20251017_064801.json
2025-10-17 06:48:52,186 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:48:52,188 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:48:52,218 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:48:52,258 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:48:52,259 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:48:52,260 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:48:52,261 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:48:52,263 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:48:52,264 - APP.persistence.json_handler - DEBUG - Kết thúc quá trình lưu báo cáo JSON.
2025-10-17 06:48:52,266 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:48:52,267 - APP.core.analysis_worker - INFO - Đã lưu báo cáo MD và JSON song song.
2025-10-17 06:48:52,267 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-17 06:48:52,268 - APP.utils.threading_utils - DEBUG - Task 'analysis.session.autorun-20251017-064851' (group=analysis.session) hoàn tất sau 0.47s
2025-10-17 06:48:52,302 - APP.core.analysis_controller - INFO - Kết thúc session autorun-20251017-064851: {'status': 'completed', 'early_exit': False}
2025-10-17 06:49:00,558 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:49:00,567 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.0, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:49:00,569 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:49:00,569 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:49:00,575 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:49:00,576 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.0, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:49:00,624 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:49:00,679 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:49:00,762 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:49:00,779 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:49:00,884 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:49:00,899 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:49:00,901 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.02s
2025-10-17 06:49:00,902 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.12s)
2025-10-17 06:49:00,955 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.18s
2025-10-17 06:49:01,280 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:49:01,356 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.0, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:49:01,364 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:49:01,366 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:49:01,367 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:49:01,369 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.0, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:49:01,371 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:49:01,372 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:49:01,373 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:49:01,374 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:49:01,382 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.session.autorun-20251017-064901' vào nhóm 'analysis.session' (metadata={'component': 'analysis', 'session_id': 'autorun-20251017-064901', 'priority': 'autorun'})
2025-10-17 06:49:01,435 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:49:01,436 - APP.core.analysis_controller - INFO - Đã submit phiên phân tích autorun-20251017-064901 (priority=autorun)
2025-10-17 06:49:01,436 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-17 06:49:01,437 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:49:01,468 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-17 06:49:01,469 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.03s
2025-10-17 06:49:01,529 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Không có ảnh để phân tích.
2025-10-17 06:49:01,531 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.16s)
2025-10-17 06:49:01,531 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-17 06:49:01,532 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.16s
2025-10-17 06:49:01,535 - APP.persistence.json_handler - DEBUG - JsonSaver được khởi tạo cho workspace: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots
2025-10-17 06:49:01,538 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu tạo map timeframe với 0 tên file.
2025-10-17 06:49:01,538 - APP.ui.utils.timeframe_detector - DEBUG - Kết thúc tạo map timeframe. Map: {}
2025-10-17 06:49:01,540 - APP.persistence.md_handler - DEBUG - Bắt đầu lưu báo cáo Markdown.
2025-10-17 06:49:01,541 - APP.persistence.json_handler - DEBUG - Bắt đầu quá trình lưu báo cáo JSON.
2025-10-17 06:49:01,542 - APP.persistence.md_handler - DEBUG - Đường dẫn file báo cáo Markdown: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports\report_20251017_064901.md
2025-10-17 06:49:01,543 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:49:01,544 - APP.persistence.md_handler - DEBUG - Bắt đầu trích xuất báo cáo human-readable.
2025-10-17 06:49:01,544 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:49:01,545 - APP.persistence.md_handler - WARNING - Không tìm thấy điểm bắt đầu báo cáo hợp lệ, trả về toàn bộ nội dung.
2025-10-17 06:49:01,545 - APP.persistence.json_handler - DEBUG - Đã thêm 1 khối JSON vào data_to_save.
2025-10-17 06:49:01,546 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất tóm tắt và chữ ký.
2025-10-17 06:49:01,546 - APP.persistence.md_handler - INFO - Đã lưu báo cáo Markdown thành công tại: report_20251017_064901.md
2025-10-17 06:49:01,547 - APP.analysis.report_parser - DEBUG - Hoàn tất trích xuất. High Prob: False
2025-10-17 06:49:01,547 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: *.md, giữ lại: 10 file.
2025-10-17 06:49:01,548 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:49:01,550 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: report_20251017_064804.md
2025-10-17 06:49:01,550 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:49:01,551 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:49:01,551 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:49:01,552 - APP.persistence.md_handler - DEBUG - Kết thúc việc lưu báo cáo Markdown.
2025-10-17 06:49:01,553 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:49:01,553 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:49:01,554 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:49:01,554 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:49:01,555 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:49:01,559 - APP.persistence.json_handler - DEBUG - Đã parse và lưu plan: {'direction': None}
2025-10-17 06:49:01,560 - APP.persistence.json_handler - INFO - Đã lưu file JSON báo cáo thành công tại: ctx_20251017_064901.json
2025-10-17 06:49:01,561 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: ctx_*.json, giữ lại: 10 file.
2025-10-17 06:49:01,563 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: ctx_20251017_064804.json
2025-10-17 06:49:01,604 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:49:01,608 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:49:01,760 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:49:01,770 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:49:01,810 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:49:01,828 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:49:01,836 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:49:01,842 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:49:01,887 - APP.persistence.json_handler - DEBUG - Kết thúc quá trình lưu báo cáo JSON.
2025-10-17 06:49:01,893 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:49:01,896 - APP.core.analysis_worker - INFO - Đã lưu báo cáo MD và JSON song song.
2025-10-17 06:49:01,896 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-17 06:49:01,898 - APP.utils.threading_utils - DEBUG - Task 'analysis.session.autorun-20251017-064901' (group=analysis.session) hoàn tất sau 0.46s
2025-10-17 06:49:01,928 - APP.core.analysis_controller - INFO - Kết thúc session autorun-20251017-064901: {'status': 'completed', 'early_exit': False}
2025-10-17 06:49:08,183 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:49:08,185 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.0, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:49:08,187 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:49:08,188 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:49:08,191 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:49:08,192 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.0, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:49:08,238 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:49:08,241 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:49:08,243 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:49:08,246 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:49:08,292 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:49:08,295 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:49:08,296 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.00s
2025-10-17 06:49:08,298 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.05s)
2025-10-17 06:49:08,299 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.05s
2025-10-17 06:49:08,744 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:49:08,747 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.0, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:49:08,751 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:49:08,755 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:49:08,792 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:49:08,794 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=True), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.0, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:49:08,800 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:49:08,800 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:49:08,802 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:49:08,804 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:49:08,804 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.session.autorun-20251017-064908' vào nhóm 'analysis.session' (metadata={'component': 'analysis', 'session_id': 'autorun-20251017-064908', 'priority': 'autorun'})
2025-10-17 06:49:08,809 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:49:08,812 - APP.core.analysis_controller - INFO - Đã submit phiên phân tích autorun-20251017-064908 (priority=autorun)
2025-10-17 06:49:08,812 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-17 06:49:08,843 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:49:08,844 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-17 06:49:08,871 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.06s
2025-10-17 06:49:08,875 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Không có ảnh để phân tích.
2025-10-17 06:49:08,875 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.07s)
2025-10-17 06:49:08,876 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-17 06:49:08,877 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.07s
2025-10-17 06:49:08,912 - APP.persistence.json_handler - DEBUG - JsonSaver được khởi tạo cho workspace: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots
2025-10-17 06:49:08,939 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu tạo map timeframe với 0 tên file.
2025-10-17 06:49:08,970 - APP.ui.utils.timeframe_detector - DEBUG - Kết thúc tạo map timeframe. Map: {}
2025-10-17 06:49:08,999 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:49:09,002 - APP.persistence.md_handler - DEBUG - Bắt đầu lưu báo cáo Markdown.
2025-10-17 06:49:09,002 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.0, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:49:09,030 - APP.persistence.json_handler - DEBUG - Bắt đầu quá trình lưu báo cáo JSON.
2025-10-17 06:49:09,032 - APP.persistence.md_handler - DEBUG - Đường dẫn file báo cáo Markdown: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports\report_20251017_064909.md
2025-10-17 06:49:09,032 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:49:09,034 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:49:09,062 - APP.persistence.md_handler - DEBUG - Bắt đầu trích xuất báo cáo human-readable.
2025-10-17 06:49:09,063 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:49:09,064 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:49:09,067 - APP.persistence.md_handler - WARNING - Không tìm thấy điểm bắt đầu báo cáo hợp lệ, trả về toàn bộ nội dung.
2025-10-17 06:49:09,134 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 06:49:09,135 - APP.persistence.json_handler - DEBUG - Đã thêm 1 khối JSON vào data_to_save.
2025-10-17 06:49:09,137 - APP.persistence.md_handler - INFO - Đã lưu báo cáo Markdown thành công tại: report_20251017_064909.md
2025-10-17 06:49:09,137 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=2.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.0, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M15', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 06:49:09,138 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất tóm tắt và chữ ký.
2025-10-17 06:49:09,139 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: *.md, giữ lại: 10 file.
2025-10-17 06:49:09,140 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 06:49:09,140 - APP.analysis.report_parser - DEBUG - Hoàn tất trích xuất. High Prob: False
2025-10-17 06:49:09,143 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 06:49:09,144 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: report_20251017_064807.md
2025-10-17 06:49:09,145 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:49:09,146 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 06:49:09,146 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:49:09,148 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:49:09,149 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 06:49:09,150 - APP.persistence.md_handler - DEBUG - Kết thúc việc lưu báo cáo Markdown.
2025-10-17 06:49:09,150 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:49:09,152 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 06:49:09,153 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:49:09,154 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:49:09,155 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 06:49:09,155 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:49:09,156 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.00s
2025-10-17 06:49:09,156 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:49:09,157 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.01s)
2025-10-17 06:49:09,157 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:49:09,158 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.01s
2025-10-17 06:49:09,186 - APP.persistence.json_handler - DEBUG - Đã parse và lưu plan: {'direction': None}
2025-10-17 06:49:09,189 - APP.persistence.json_handler - INFO - Đã lưu file JSON báo cáo thành công tại: ctx_20251017_064909.json
2025-10-17 06:49:09,219 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: ctx_*.json, giữ lại: 10 file.
2025-10-17 06:49:09,286 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: ctx_20251017_064807.json
2025-10-17 06:49:09,320 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 06:49:09,323 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 06:49:09,324 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 06:49:09,325 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 06:49:09,326 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 06:49:09,327 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 06:49:09,328 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 06:49:09,330 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 06:49:09,331 - APP.persistence.json_handler - DEBUG - Kết thúc quá trình lưu báo cáo JSON.
2025-10-17 06:49:09,332 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 06:49:09,333 - APP.core.analysis_worker - INFO - Đã lưu báo cáo MD và JSON song song.
2025-10-17 06:49:09,334 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-17 06:49:09,334 - APP.utils.threading_utils - DEBUG - Task 'analysis.session.autorun-20251017-064908' (group=analysis.session) hoàn tất sau 0.52s
2025-10-17 06:49:09,369 - APP.core.analysis_controller - INFO - Kết thúc session autorun-20251017-064908: {'status': 'completed', 'early_exit': False}
2025-10-17 06:49:21,602 - APP.ui.pyqt6.event_bridge - DEBUG - Dừng timer chuyển queue → signal
2025-10-17 06:49:21,618 - APP.utils.threading_utils - INFO - ThreadingManager.shutdown(wait=True, timeout=None, force=False)
2025-10-17 06:49:21,637 - __main__ - INFO - Application closed successfully.
2025-10-17 09:04:59,857 - APP.persistence.log_handler - INFO - Đã cấu hình logging xoay vòng. File log: Log\app_debug.log, Size: 5MB, Backups: 5
2025-10-17 09:04:59,858 - APP.persistence.log_handler - DEBUG - Hoàn tất thiết lập logging cho ứng dụng.
2025-10-17 09:04:59,858 - __main__ - INFO - Application starting...
2025-10-17 09:04:59,860 - __main__ - INFO - telemetry.ui_backend=pyqt6
2025-10-17 09:04:59,860 - APP.utils.threading_utils - INFO - Khởi tạo ThreadPoolExecutor với tối đa 10 luồng.
2025-10-17 09:04:59,971 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 09:04:59,973 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 09:04:59,976 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 09:04:59,977 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 09:04:59,981 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 09:04:59,982 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 09:04:59,983 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 09:04:59,983 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 09:04:59,986 - APP.ui.utils.timeframe_detector - DEBUG - TimeframeDetector đã được khởi tạo và biên dịch 9 mẫu regex.
2025-10-17 09:05:00,261 - APP.ui.controllers.chart_controller - DEBUG - Cập nhật config chart stream: ChartStreamConfig(symbol='XAUUSD', timeframe='M1', candles=50, chart_type='candlestick')
2025-10-17 09:05:00,262 - APP.ui.controllers.chart_controller - INFO - Khởi động ChartController cho symbol=XAUUSD
2025-10-17 09:05:00,263 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.info' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'candlestick', 'component': 'chart'})
2025-10-17 09:05:00,267 - APP.utils.threading_utils - DEBUG - Task 'chart.info' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-17 09:05:00,271 - APP.utils.threading_utils - DEBUG - Gửi task 'chart.draw' vào nhóm 'chart.refresh' (metadata={'symbol': 'XAUUSD', 'timeframe': 'M1', 'candles': 50, 'chart_type': 'candlestick', 'component': 'chart'})
2025-10-17 09:05:00,272 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 09:05:00,273 - APP.utils.threading_utils - DEBUG - Task 'chart.draw' (group=chart.refresh) hoàn tất sau 0.00s
2025-10-17 09:05:00,276 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 09:05:00,312 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 09:05:00,342 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 09:05:00,350 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 09:05:00,356 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.04s
2025-10-17 09:05:00,361 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:/Users/leanhchi/AppData/Roaming/MetaQuotes/Terminal/D0E8209F77C8CF37AD8BF550E51FF075/MQL5/Files/Screenshots', delete_after=True, max_files=0, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='Nến', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 09:05:00,363 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.09s)
2025-10-17 09:05:00,368 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 09:05:00,371 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.09s
2025-10-17 09:05:00,373 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 09:05:00,428 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 09:05:00,430 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 09:05:00,431 - APP.utils.threading_utils - DEBUG - Gửi task 'prompt.load' vào nhóm 'prompt' (metadata={'component': 'prompt', 'operation': 'load'})
2025-10-17 09:05:00,433 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 09:05:00,439 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 09:05:00,444 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.01s
2025-10-17 09:05:00,481 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.05s)
2025-10-17 09:05:00,481 - APP.ui.controllers.io_controller - INFO - Đã gửi worker I/O prompt.load vào group prompt (metadata={'component': 'prompt', 'operation': 'load'})
2025-10-17 09:05:00,482 - APP.utils.threading_utils - DEBUG - Task 'prompt.load' (group=prompt) hoàn tất sau 0.00s
2025-10-17 09:05:00,482 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.05s
2025-10-17 09:05:00,484 - APP.utils.threading_utils - DEBUG - Gửi task 'reports.refresh' vào nhóm 'reports' (metadata={})
2025-10-17 09:05:00,486 - APP.ui.pyqt6.event_bridge - DEBUG - Bắt đầu timer chuyển queue → signal (interval=50ms)
2025-10-17 09:05:00,672 - APP.utils.threading_utils - DEBUG - Task 'reports.refresh' (group=reports) hoàn tất sau 0.19s
2025-10-17 09:06:00,436 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 09:06:00,438 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 09:06:00,439 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 09:06:00,440 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 09:06:00,440 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 09:06:00,441 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 09:06:00,442 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 09:06:00,442 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 09:06:00,443 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 09:06:00,446 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.session.autorun-20251017-090600' vào nhóm 'analysis.session' (metadata={'component': 'analysis', 'session_id': 'autorun-20251017-090600', 'priority': 'autorun'})
2025-10-17 09:06:00,447 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 09:06:00,452 - APP.core.analysis_controller - INFO - Đã submit phiên phân tích autorun-20251017-090600 (priority=autorun)
2025-10-17 09:06:00,456 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-17 09:06:00,492 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 09:06:00,493 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-17 09:06:00,495 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 09:06:00,496 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Không có ảnh để phân tích.
2025-10-17 09:06:00,496 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.00s
2025-10-17 09:06:00,497 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-17 09:06:00,497 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.05s)
2025-10-17 09:06:00,498 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.05s
2025-10-17 09:06:00,499 - APP.persistence.json_handler - DEBUG - JsonSaver được khởi tạo cho workspace: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots
2025-10-17 09:06:00,500 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu tạo map timeframe với 0 tên file.
2025-10-17 09:06:00,501 - APP.ui.utils.timeframe_detector - DEBUG - Kết thúc tạo map timeframe. Map: {}
2025-10-17 09:06:00,503 - APP.persistence.md_handler - DEBUG - Bắt đầu lưu báo cáo Markdown.
2025-10-17 09:06:00,504 - APP.persistence.json_handler - DEBUG - Bắt đầu quá trình lưu báo cáo JSON.
2025-10-17 09:06:00,505 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 09:06:00,505 - APP.persistence.md_handler - DEBUG - Đường dẫn file báo cáo Markdown: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports\report_20251017_090600.md
2025-10-17 09:06:00,506 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 09:06:00,506 - APP.persistence.md_handler - DEBUG - Bắt đầu trích xuất báo cáo human-readable.
2025-10-17 09:06:00,579 - APP.persistence.json_handler - DEBUG - Đã thêm 1 khối JSON vào data_to_save.
2025-10-17 09:06:00,583 - APP.persistence.md_handler - WARNING - Không tìm thấy điểm bắt đầu báo cáo hợp lệ, trả về toàn bộ nội dung.
2025-10-17 09:06:00,583 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất tóm tắt và chữ ký.
2025-10-17 09:06:00,585 - APP.analysis.report_parser - DEBUG - Hoàn tất trích xuất. High Prob: False
2025-10-17 09:06:00,586 - APP.persistence.md_handler - INFO - Đã lưu báo cáo Markdown thành công tại: report_20251017_090600.md
2025-10-17 09:06:00,587 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 09:06:00,587 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: *.md, giữ lại: 10 file.
2025-10-17 09:06:00,588 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 09:06:00,591 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 09:06:00,592 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: report_20251017_064824.md
2025-10-17 09:06:00,592 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 09:06:00,593 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 09:06:00,593 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 09:06:00,594 - APP.persistence.md_handler - DEBUG - Kết thúc việc lưu báo cáo Markdown.
2025-10-17 09:06:00,595 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 09:06:00,597 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 09:06:00,600 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 09:06:00,672 - APP.persistence.json_handler - DEBUG - Đã parse và lưu plan: {'direction': None}
2025-10-17 09:06:00,675 - APP.persistence.json_handler - INFO - Đã lưu file JSON báo cáo thành công tại: ctx_20251017_090600.json
2025-10-17 09:06:00,688 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: ctx_*.json, giữ lại: 10 file.
2025-10-17 09:06:00,691 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: ctx_20251017_064824.json
2025-10-17 09:06:00,767 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 09:06:00,824 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 09:06:00,836 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 09:06:00,840 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 09:06:00,842 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 09:06:00,844 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 09:06:00,848 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 09:06:00,981 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 09:06:01,100 - APP.persistence.json_handler - DEBUG - Kết thúc quá trình lưu báo cáo JSON.
2025-10-17 09:06:01,251 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 09:06:01,260 - APP.core.analysis_worker - INFO - Đã lưu báo cáo MD và JSON song song.
2025-10-17 09:06:01,331 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-17 09:06:01,335 - APP.utils.threading_utils - DEBUG - Task 'analysis.session.autorun-20251017-090600' (group=analysis.session) hoàn tất sau 0.88s
2025-10-17 09:06:01,357 - APP.core.analysis_controller - INFO - Kết thúc session autorun-20251017-090600: {'status': 'completed', 'early_exit': False}
2025-10-17 09:06:25,991 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 09:06:25,992 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 09:06:25,993 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 09:06:25,994 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 09:06:25,994 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 09:06:25,995 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 09:06:25,996 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 09:06:25,996 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 09:06:25,997 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 09:06:26,000 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 09:06:26,005 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 09:06:26,007 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 09:06:26,008 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.00s
2025-10-17 09:06:26,047 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.05s)
2025-10-17 09:06:26,050 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.05s
2025-10-17 09:06:26,502 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 09:06:26,503 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 09:06:26,505 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 09:06:26,506 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 09:06:26,507 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 09:06:26,507 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 09:06:26,514 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 09:06:26,515 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 09:06:26,516 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 09:06:26,518 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 09:06:26,519 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.session.autorun-20251017-090626' vào nhóm 'analysis.session' (metadata={'component': 'analysis', 'session_id': 'autorun-20251017-090626', 'priority': 'autorun'})
2025-10-17 09:06:26,521 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 09:06:26,522 - APP.core.analysis_controller - INFO - Đã submit phiên phân tích autorun-20251017-090626 (priority=autorun)
2025-10-17 09:06:26,522 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-17 09:06:26,523 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 09:06:26,523 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-17 09:06:26,524 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.00s
2025-10-17 09:06:26,525 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Không có ảnh để phân tích.
2025-10-17 09:06:26,526 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.01s)
2025-10-17 09:06:26,526 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-17 09:06:26,529 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.01s
2025-10-17 09:06:26,531 - APP.persistence.json_handler - DEBUG - JsonSaver được khởi tạo cho workspace: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots
2025-10-17 09:06:26,532 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu tạo map timeframe với 0 tên file.
2025-10-17 09:06:26,532 - APP.ui.utils.timeframe_detector - DEBUG - Kết thúc tạo map timeframe. Map: {}
2025-10-17 09:06:26,534 - APP.persistence.md_handler - DEBUG - Bắt đầu lưu báo cáo Markdown.
2025-10-17 09:06:26,535 - APP.persistence.json_handler - DEBUG - Bắt đầu quá trình lưu báo cáo JSON.
2025-10-17 09:06:26,537 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 09:06:26,537 - APP.persistence.md_handler - DEBUG - Đường dẫn file báo cáo Markdown: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports\report_20251017_090626.md
2025-10-17 09:06:26,537 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 09:06:26,538 - APP.persistence.md_handler - DEBUG - Bắt đầu trích xuất báo cáo human-readable.
2025-10-17 09:06:26,578 - APP.persistence.json_handler - DEBUG - Đã thêm 1 khối JSON vào data_to_save.
2025-10-17 09:06:26,580 - APP.persistence.md_handler - WARNING - Không tìm thấy điểm bắt đầu báo cáo hợp lệ, trả về toàn bộ nội dung.
2025-10-17 09:06:26,582 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất tóm tắt và chữ ký.
2025-10-17 09:06:26,583 - APP.analysis.report_parser - DEBUG - Hoàn tất trích xuất. High Prob: False
2025-10-17 09:06:26,583 - APP.persistence.md_handler - INFO - Đã lưu báo cáo Markdown thành công tại: report_20251017_090626.md
2025-10-17 09:06:26,584 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 09:06:26,584 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: *.md, giữ lại: 10 file.
2025-10-17 09:06:26,585 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 09:06:26,586 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 09:06:26,587 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 09:06:26,588 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: report_20251017_064828.md
2025-10-17 09:06:26,589 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 09:06:26,590 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 09:06:26,590 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 09:06:26,591 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 09:06:26,591 - APP.persistence.md_handler - DEBUG - Kết thúc việc lưu báo cáo Markdown.
2025-10-17 09:06:26,592 - APP.persistence.json_handler - DEBUG - Đã parse và lưu plan: {'direction': None}
2025-10-17 09:06:26,593 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 09:06:26,597 - APP.persistence.json_handler - INFO - Đã lưu file JSON báo cáo thành công tại: ctx_20251017_090626.json
2025-10-17 09:06:26,597 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: ctx_*.json, giữ lại: 10 file.
2025-10-17 09:06:26,600 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: ctx_20251017_064828.json
2025-10-17 09:06:26,600 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 09:06:26,601 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 09:06:26,605 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 09:06:26,670 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 09:06:26,673 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 09:06:26,674 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 09:06:26,677 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 09:06:26,678 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 09:06:26,681 - APP.persistence.json_handler - DEBUG - Kết thúc quá trình lưu báo cáo JSON.
2025-10-17 09:06:26,682 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 09:06:26,684 - APP.core.analysis_worker - INFO - Đã lưu báo cáo MD và JSON song song.
2025-10-17 09:06:26,685 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-17 09:06:26,687 - APP.utils.threading_utils - DEBUG - Task 'analysis.session.autorun-20251017-090626' (group=analysis.session) hoàn tất sau 0.16s
2025-10-17 09:06:26,734 - APP.core.analysis_controller - INFO - Kết thúc session autorun-20251017-090626: {'status': 'completed', 'early_exit': False}
2025-10-17 09:07:26,740 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 09:07:26,741 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 09:07:26,742 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 09:07:26,743 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 09:07:26,743 - APP.configs.app_config - DEBUG - Bắt đầu hàm __post_init__ của RunConfig.
2025-10-17 09:07:26,744 - APP.configs.app_config - DEBUG - RunConfig được khởi tạo: RunConfig(folder=FolderConfig(folder='C:\\Users\\leanhchi\\AppData\\Roaming\\MetaQuotes\\Terminal\\D0E8209F77C8CF37AD8BF550E51FF075\\MQL5\\Files\\Screenshots', delete_after=True, max_files=1, only_generate_if_changed=False), upload=UploadConfig(upload_workers=4, cache_enabled=True, optimize_lossless=False), image_processing=ImageProcessingConfig(max_width=1600, jpeg_quality=85), context=ContextConfig(ctx_limit=2000, create_ctx_json=True, prefer_ctx_json=True, ctx_json_n=5, remember_context=True, n_reports=1), telegram=TelegramConfig(enabled=True, token='8401224691:AAHu14vQxwnOlD9IBPsU1yp59nZ8Ta0mMYk', chat_id='907737980', skip_verify=True, ca_path='', notify_on_early_exit=False), mt5=MT5Config(enabled=True, symbol='XAUUSD', n_M1=120, n_M5=180, n_M15=96, n_H1=120), no_run=NoRunConfig(weekend_enabled=True, killzone_enabled=False, holiday_check_enabled=True, holiday_check_country='US', timezone='Asia/Ho_Chi_Minh', killzone_summer={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '14:00', 'end': '17:00'}, 'newyork_am': {'start': '19:30', 'end': '22:00'}, 'newyork_pm': {'start': '00:00', 'end': '03:00'}}, killzone_winter={'asia': {'start': '06:00', 'end': '09:00'}, 'london': {'start': '15:00', 'end': '18:00'}, 'newyork_am': {'start': '20:30', 'end': '23:00'}, 'newyork_pm': {'start': '01:00', 'end': '04:00'}}), no_trade=NoTradeConfig(enabled=True, spread_max_pips=4.2, min_atr_m5_pips=0.3, min_dist_keylvl_pips=5.0, allow_session_asia=True, allow_session_london=True, allow_session_ny=True), auto_trade=AutoTradeConfig(enabled=True, strict_bias=True, size_mode='risk_percent', risk_per_trade=1.0, split_tp_enabled=True, split_tp_ratio=50, deviation=20, magic_number=26092025, comment='AI-ICT', pending_ttl_min=90, min_rr_tp2=2.0, cooldown_min=10, dynamic_pending=True, dry_run=False, move_to_be_after_tp1=True, trailing_atr_mult=0.5, filling_type='IOC'), news=NewsConfig(block_enabled=True, block_before_min=5, block_after_min=5, cache_ttl_sec=600, provider_timeout_sec=20, priority_keywords=('business confidence', 'consumer confidence', 'consumer price index', 'cpi', 'gdp', 'gross domestic product', 'ifo', 'industrial production', 'inflation rate', 'interest rate', 'ism', 'nfp', 'non-farm payroll', 'pmi', 'purchasing managers', 'retail sales', 'trade balance', 'unemployment rate', 'zew'), provider_error_threshold=2, provider_error_backoff_sec=300, surprise_score_threshold=0.5, currency_country_overrides=None, symbol_country_overrides=None), fmp=FMPConfig(enabled=True, api_key='XL0taxDun2w72XyH70rVACj628PS0hxs'), persistence=PersistenceConfig(max_md_reports=10, max_json_reports=10), chart=ChartConfig(timeframe='M1', num_candles=50, chart_type='candlestick', refresh_interval_secs=1), api=ApiConfig(tries=5, delay=2.0), logging=LoggingConfig(log_dir='Log', log_file_name='app_debug.log', log_rotation_size_mb=5, log_rotation_backup_count=5))
2025-10-17 09:07:26,745 - APP.configs.app_config - DEBUG - Kết thúc hàm __post_init__ của RunConfig.
2025-10-17 09:07:26,746 - APP.services.news_service - DEBUG - C?u h�nh NewsService da du?c c?p nh?t.
2025-10-17 09:07:26,747 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.autorun' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'autorun', 'timeout_sec': 20})
2025-10-17 09:07:26,750 - APP.utils.threading_utils - DEBUG - Gửi task 'analysis.session.autorun-20251017-090726' vào nhóm 'analysis.session' (metadata={'component': 'analysis', 'session_id': 'autorun-20251017-090726', 'priority': 'autorun'})
2025-10-17 09:07:26,750 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'autorun'})
2025-10-17 09:07:26,751 - APP.core.analysis_controller - INFO - Đã submit phiên phân tích autorun-20251017-090726 (priority=autorun)
2025-10-17 09:07:26,752 - APP.core.analysis_worker - DEBUG - Bắt đầu AnalysisWorker.run với model: models/gemini-2.5-flash
2025-10-17 09:07:26,783 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 09:07:26,785 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 1: Khởi tạo và kiểm tra đầu vào.
2025-10-17 09:07:26,789 - APP.core.analysis_worker - INFO - Worker đã thoát một cách có kiểm soát: Không có ảnh để phân tích.
2025-10-17 09:07:26,795 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 09:07:26,799 - APP.core.analysis_worker - DEBUG - GIAI ĐOẠN 6: Hoàn tất và dọn dẹp.
2025-10-17 09:07:26,823 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.04s
2025-10-17 09:07:26,825 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=autorun, source=network, latency=0.07s)
2025-10-17 09:07:26,826 - APP.persistence.json_handler - DEBUG - JsonSaver được khởi tạo cho workspace: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots
2025-10-17 09:07:26,826 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.autorun' (group=news.polling) hoàn tất sau 0.08s
2025-10-17 09:07:26,887 - APP.ui.utils.timeframe_detector - DEBUG - Bắt đầu tạo map timeframe với 0 tên file.
2025-10-17 09:07:26,889 - APP.ui.utils.timeframe_detector - DEBUG - Kết thúc tạo map timeframe. Map: {}
2025-10-17 09:07:26,919 - APP.persistence.md_handler - DEBUG - Bắt đầu lưu báo cáo Markdown.
2025-10-17 09:07:26,920 - APP.persistence.json_handler - DEBUG - Bắt đầu quá trình lưu báo cáo JSON.
2025-10-17 09:07:26,923 - APP.persistence.md_handler - DEBUG - Đường dẫn file báo cáo Markdown: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports\report_20251017_090726.md
2025-10-17 09:07:26,951 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 09:07:26,955 - APP.persistence.md_handler - DEBUG - Bắt đầu trích xuất báo cáo human-readable.
2025-10-17 09:07:26,980 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 09:07:26,982 - APP.persistence.md_handler - WARNING - Không tìm thấy điểm bắt đầu báo cáo hợp lệ, trả về toàn bộ nội dung.
2025-10-17 09:07:26,986 - APP.persistence.json_handler - DEBUG - Đã thêm 1 khối JSON vào data_to_save.
2025-10-17 09:07:27,012 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất tóm tắt và chữ ký.
2025-10-17 09:07:27,013 - APP.analysis.report_parser - DEBUG - Hoàn tất trích xuất. High Prob: False
2025-10-17 09:07:27,013 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 09:07:27,045 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 09:07:27,047 - APP.persistence.md_handler - INFO - Đã lưu báo cáo Markdown thành công tại: report_20251017_090726.md
2025-10-17 09:07:27,104 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 09:07:27,105 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: *.md, giữ lại: 10 file.
2025-10-17 09:07:27,105 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 09:07:27,106 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 09:07:27,107 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 09:07:27,108 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: report_20251017_064830.md
2025-10-17 09:07:27,110 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 09:07:27,111 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 09:07:27,113 - APP.persistence.json_handler - DEBUG - Đã parse và lưu plan: {'direction': None}
2025-10-17 09:07:27,114 - APP.persistence.md_handler - DEBUG - Kết thúc việc lưu báo cáo Markdown.
2025-10-17 09:07:27,115 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 09:07:27,116 - APP.persistence.json_handler - INFO - Đã lưu file JSON báo cáo thành công tại: ctx_20251017_090727.json
2025-10-17 09:07:27,118 - APP.utils.general_utils - DEBUG - Bắt đầu cleanup_old_files trong thư mục: C:\Users\leanhchi\AppData\Roaming\MetaQuotes\Terminal\D0E8209F77C8CF37AD8BF550E51FF075\MQL5\Files\Screenshots\XAUUSD\Reports, pattern: ctx_*.json, giữ lại: 10 file.
2025-10-17 09:07:27,120 - APP.utils.general_utils - DEBUG - Đã xóa file cũ: ctx_20251017_064831.json
2025-10-17 09:07:27,121 - APP.utils.general_utils - DEBUG - Kết thúc cleanup_old_files.
2025-10-17 09:07:27,122 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất cài đặt giao dịch từ báo cáo.
2025-10-17 09:07:27,123 - APP.analysis.report_parser - DEBUG - Bắt đầu trích xuất khối JSON ưu tiên.
2025-10-17 09:07:27,123 - APP.analysis.report_parser - WARNING - Không tìm thấy khối JSON hợp lệ nào trong văn bản.
2025-10-17 09:07:27,124 - APP.analysis.report_parser - DEBUG - Không tìm thấy JSON hợp lệ, đang sử dụng regex để phân tích.
2025-10-17 09:07:27,125 - APP.analysis.report_parser - DEBUG - Đang xác định hướng từ dòng: ''
2025-10-17 09:07:27,126 - APP.analysis.report_parser - DEBUG - Không tìm thấy hướng giao dịch trong dòng.
2025-10-17 09:07:27,126 - APP.analysis.report_parser - DEBUG - Hoàn tất phân tích bằng regex. Cài đặt: {'direction': None}
2025-10-17 09:07:27,127 - APP.persistence.json_handler - DEBUG - Kết thúc quá trình lưu báo cáo JSON.
2025-10-17 09:07:27,127 - APP.utils.threading_utils - DEBUG - Task song song 'save_report' hoàn tất thành công.
2025-10-17 09:07:27,129 - APP.core.analysis_worker - INFO - Đã lưu báo cáo MD và JSON song song.
2025-10-17 09:07:27,130 - APP.core.analysis_worker - DEBUG - Kết thúc AnalysisWorker.run.
2025-10-17 09:07:27,131 - APP.utils.threading_utils - DEBUG - Task 'analysis.session.autorun-20251017-090726' (group=analysis.session) hoàn tất sau 0.38s
2025-10-17 09:07:27,177 - APP.core.analysis_controller - INFO - Kết thúc session autorun-20251017-090726: {'status': 'completed', 'early_exit': False}
2025-10-17 09:07:30,935 - APP.ui.controllers.news_controller - INFO - User yêu cầu refresh tin tức ngay lập tức.
2025-10-17 09:07:30,935 - APP.utils.threading_utils - DEBUG - Gửi task 'news.refresh.user' vào nhóm 'news.polling' (metadata={'component': 'news', 'priority': 'user', 'timeout_sec': 20})
2025-10-17 09:07:30,937 - APP.utils.threading_utils - DEBUG - Gửi task 'news.provider.fmp' vào nhóm 'news.polling' (metadata={'component': 'news', 'provider': 'fmp', 'priority': 'user'})
2025-10-17 09:07:30,938 - APP.services.fmp_service - DEBUG - Đang lấy dữ liệu lịch kinh tế từ investpy...
2025-10-17 09:07:30,938 - APP.services.fmp_service - WARNING - Không thể lấy dữ liệu lịch kinh tế vì thiếu thư viện investpy.
2025-10-17 09:07:30,939 - APP.utils.threading_utils - DEBUG - Task 'news.provider.fmp' (group=news.polling) hoàn tất sau 0.00s
2025-10-17 09:07:30,940 - APP.services.news_service - INFO - NewsService làm mới cache (0 sự kiện, priority=user, source=network, latency=0.00s)
2025-10-17 09:07:30,940 - APP.utils.threading_utils - DEBUG - Task 'news.refresh.user' (group=news.polling) hoàn tất sau 0.00s
2025-10-17 09:07:52,166 - APP.ui.pyqt6.event_bridge - DEBUG - Dừng timer chuyển queue → signal
2025-10-17 09:07:52,167 - APP.utils.threading_utils - INFO - ThreadingManager.shutdown(wait=True, timeout=None, force=False)
2025-10-17 09:07:52,170 - __main__ - INFO - Application closed successfully.
